
CREATE OR REPLACE PACKAGE BODY RECONCILIATION_INTERFACES IS

/*FUNCTION P_CHECK_DUMPS_VALIDITY return number IS 

RESULT NUMBER;
COUNT_CS4 NUMBER;
COUNT_SV NUMBER;

begin
 EXECUTE IMMEDIATE 'SELECT COUNT(*) 
                     FROM FAFIF.PPS_ABONNE_JOUR_MIGDB PP
                    WHERE PP.JOUR = TRUNC(SYSDATE)
                      AND ROWNUM<2' INTO COUNT_CS4;

 EXECUTE IMMEDIATE 'SELECT COUNT(*) 
                     FROM FAFIF.CLEAN_SV_ALL_UPD SV
                    WHERE TRUNC(SV.LAST_RUN_DATE) = TRUNC(SYSDATE)
                      AND ROWNUM<2' INTO COUNT_SV;
                      
  
 RESULT :=  COUNT_SV + COUNT_CS4;
 
 RETURN RESULT;                  
                      
END P_CHECK_DUMPS_VALIDITY;*/

PROCEDURE P1_MAIN_SYS_INTERFACES(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS



   -- =============================================================================================
    --    Modified by                 : FAF
    --    Release                     : R1.1
    --    Modification Date           : 01/11/2009
    --    Author                      : FAF
    --    Requirement book version    : V3.0
    --    Comments                    :
    --   -------------------------------------------------------------------------------------------

    -- =============================================================================================
    --    Pre-requisite(s)            : SV DMP (CLEAN_SV_ALL_UPD)
    --                                  HLR DMP (HLR1 & HLR2)
    --                                  MINSAT DMP (FAFIF.PPS_ABONNE_JOUR_dbauserDB D)
    --    Release                     : R1.0
    --    Date                        : 31/10/2009
    --    Author                      : FAF
    --    Requirement  version        : V1.0
    --    Comments                    : Reconciliation
    --   -------------------------------------------------------------------------------------------


    --================================================================================================================
    -- sql_txt : contains the sql statment body
    --================================================================================================================
    SQL_TXT              VARCHAR2(8000);
    RELEASE              VARCHAR2(20)    := 'R1.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;


    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);
    CURRENT_DATE         VARCHAR2(100);
    --count_cs4            NUMBER;
    --count_sv             NUMBER;


  BEGIN


    UTILS_INTERFACES.INTERFACE_NAME := 'P1_MAIN_SYS_INTERFACES';


    --================================================================================================================
    -- Initiate Tables
    --================================================================================================================

   -- DMP CS5

    SQL_TXT := ' CREATE TABLE SYS_MINSAT NOLOGGING AS
                    SELECT DECODE(SUBSTR(SUBSTR(NUM_APPEL, 4), 1, 1),8,SUBSTR(NUM_APPEL, 4),7,SUBSTR(NUM_APPEL, 4),3,''0'' || (SUBSTR(NUM_APPEL, 4)),1, ''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN,
                           D.*
                      FROM FAFIF.PPS_ABONNE_JOUR_MIGDB D ';


    IF UTILS_INTERFACES.CREATE_TABLE('SYS_MINSAT', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('SYS_MINSAT',
                                     'FAFIF',
                                     'IX_MINSAT_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


   -- HLR Dumps


/*   SQL_TXT := ' CREATE TABLE HLR1_APN_DATA NOLOGGING AS
                SELECT  DECODE(SUBSTR(SUBSTR(T.NUM_APPEL, 4), 1, 1),8,SUBSTR(T.NUM_APPEL, 4),7,SUBSTR(T.NUM_APPEL, 4),3,''0'' || (SUBSTR(T.NUM_APPEL, 4)),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN_APN1,
                 T.IMSI AS IMSI_1,
                 T.PDP_ID AS PDP_ID_1,
                 T.APN_ID AS APN_ID_1,
                 T.QOS AS QOS_1
                FROM HLR1  T';


    IF UTILS_INTERFACES.CREATE_TABLE('HLR1_APN_DATA', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('HLR1_APN_DATA',
                                     'FAFIF',
                                     'IX_MSISDN_APN1',
                                     'MSISDN_APN1') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;*/
 
    
   /*===================================================
   ENHANCEMENT MAY 14 2015
   ===================================================*/
   
  --HH 18-02-2020 (VOLTE update)
  -- max( decode( APN_ID, ''94'', APN_ID, null ) ) AS VOLTE01_APN1,
  --max( decode( APN_ID, ''95'', APN_ID, null ) ) AS VOLTE02_APN1
  
    SQL_TXT := ' CREATE TABLE HLR1_APN_DATA AS
                 select NUM_APPEL AS NUM_APPEL_APN1, 
                       DECODE(SUBSTR(SUBSTR(NUM_APPEL, 4), 1, 1),8,SUBSTR(NUM_APPEL, 4),7,SUBSTR(NUM_APPEL, 4),3,''0'' || (SUBSTR(NUM_APPEL, 4)),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN_APN1,
                       max( decode( APN_ID, ''20'', APN_ID, null ) ) AS WLL_APN1,
                       max( decode( APN_ID, ''15'', APN_ID, null ) ) AS ALFA_APN1,
                       max( decode( APN_ID, ''13'', APN_ID, null ) ) AS MBB_APN1,
                       max( decode( APN_ID, ''12'', APN_ID, null ) ) AS BLACKBERRY_APN1,
                       max( decode( APN_ID, ''10'', APN_ID, null ) ) AS GPRS_INTRA_APN1,
                       max( decode( APN_ID, ''9'', APN_ID, null ) )  AS MMS_APN1,
                       max( decode( APN_ID, ''8'', APN_ID, null ) ) AS WAP_APN1,
                       max( decode( APN_ID, ''7'', APN_ID, null ) ) AS GPRS_APN1,
                       max( decode( APN_ID, ''3'', APN_ID, null ) ) AS DATACARD1_APN1,
                       max( decode( APN_ID, ''4'', APN_ID, null ) ) AS DATACARD2_APN1,
                       max( decode( APN_ID, ''6'', APN_ID, null ) ) AS DATACARD3_APN1,
                       max( decode( APN_ID, ''94'', APN_ID, null ) ) AS VOLTE01_APN1,
                       max( decode( APN_ID, ''95'', APN_ID, null ) ) AS VOLTE02_APN1
                       FROM
                       (
                       SELECT *
                       FROM HLR1 
                       )
                       GROUP BY NUM_APPEL';


    IF UTILS_INTERFACES.CREATE_TABLE('HLR1_APN_DATA', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('HLR1_APN_DATA',
                                     'FAFIF',
                                     'IX_MSISDN_APN1',
                                     'MSISDN_APN1') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;
    




    SQL_TXT := ' CREATE TABLE HLR1_PARAM AS
                 SELECT DISTINCT(T.NUM_APPEL),
                 DECODE(SUBSTR(SUBSTR(T.NUM_APPEL, 4), 1, 1),8,SUBSTR(T.NUM_APPEL, 4),7,SUBSTR(T.NUM_APPEL, 4),3,''0'' || (SUBSTR(T.NUM_APPEL, 4)),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN,
                 T.IMSI, T.CFU, T.CFB, T.CFNRY,T.CFNRC,T.SPN,T.CAW,T.HOLD,T.MPTY,T.AOC,T.BAOC,T.BOIC,T.BOIEX,T.BAIC,T.BICRO,
                 T.CAT,T.OBO,T.OBI,T.OBR,T.OBOPRI,T.OBOPRE,T.OBSSM,T.OSB1,T.OSB2,T.OSB3,T.OSB4,T.OFA,T.PWD,T.ICI,T.OIN,T.TIN,
                 T.CLIP,T.CLIR,T.COLP,T.COLR,T.SOCB,T.SOCFU,T.SOCFB,T.SOCFRY,T.SOCFRC,T.SOCLIP,T.SOCLIR,T.SOCOLP,T.TS11,T.TS21,
                 T.TS22,T.TS62,T.TSD1,T.BS21,T.BS22,T.BS23,T.BS24,T.BS25,T.BS26,T.BS31,T.BS32,T.BS33,T.BS34,T.DBSG,T.TS61,T.CUG,
                 T.REGSER,T.PICI,T.DCF,T.SODCF,T.SOSDCF,T.CAPL,T.OICK,T.TICK,T.NAM,T.TSMO,T.REDUND,T.OCSI,T.RSA,T.RM,T.OBP,T.OSMCSI,
                 T.STYPE,T.SCHAR,T.REDMCH,T.GPRCSI,T.BS3G,T.CAMEL,T.RBT,T.EMLPP,T.NEMLPP,T.DEMLPP,
                 T.GPRSCSINF,T.MCSINF,T.OCSINF,T.OSMCSINF,T.TCSINF,T.TSMCSINF,T.VTCSINF,T.TIFCSINF,T.DCSIST,T.GPRSCSIST,
                 T.MCSIST,T.OCSIST,T.OSMCSIST,T.TCSIST,T.TSMCSIST,T.VTCSIST,T.ICS,T.CWNF,T.CHNF,T.CLIPNF,T.CLIRNF,T.ECTNF,T.ARD,
                 T.DATE_INSERTION_HLR1
                 FROM HLR1 T';

    IF UTILS_INTERFACES.CREATE_TABLE('HLR1_PARAM', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;



    IF UTILS_INTERFACES.CREATE_INDEX('HLR1_PARAM',
                                     'FAFIF',
                                     'IX_HLR1_msisdn',
                                     'msisdn') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


/*     SQL_TXT := ' CREATE TABLE MERGE_HLR1_APN NOLOGGING AS
                  SELECT T.*,
                       (SELECT V.APN_ID_1 FROM HLR1_APN_DATA V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 IN (20)) WLL_APN1,
                       (SELECT V.APN_ID_1 FROM HLR1_APN_DATA V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 IN (15)) ALFA_APN1,
                       (SELECT V.APN_ID_1 FROM HLR1_APN_DATA V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 IN (13)) MBB_APN1,
                       (SELECT V.APN_ID_1 FROM HLR1_APN_DATA V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 IN (12)) BLACKBERRY_APN1,
                       (SELECT V.APN_ID_1 FROM HLR1_APN_DATA V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 IN (10)) GPRS_INTRA_APN1,
                       (SELECT V.APN_ID_1 FROM HLR1_APN_DATA V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 IN (9)) MMS_APN1,
                       (SELECT V.APN_ID_1 FROM HLR1_APN_DATA V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 IN (8)) WAP_APN1,
                       (SELECT V.APN_ID_1 FROM HLR1_APN_DATA V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 IN (7)) GPRS_APN1,
                       (SELECT V.APN_ID_1 FROM HLR1_APN_DATA V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 IN (3)) DATACARD1_APN1,
                       (SELECT V.APN_ID_1 FROM HLR1_APN_DATA V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 IN (4)) DATACARD2_APN1,
                       (SELECT V.APN_ID_1 FROM HLR1_APN_DATA V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 IN (6)) DATACARD3_APN1
                   FROM HLR1_PARAM T ';

    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_HLR1_APN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;*/
    
     /*===================================================
   ENHANCEMENT MAY 14 2015
   ===================================================*/
   
   SQL_TXT := ' CREATE TABLE MERGE_HLR1_APN NOLOGGING AS
                SELECT  TT.*,T.*
                FROM HLR1_APN_DATA T, HLR1_PARAM TT
                WHERE T.MSISDN_APN1 (+)= TT.MSISDN 
                UNION
                SELECT  TT.*,T.*
                FROM HLR1_APN_DATA T, HLR1_PARAM TT
                WHERE T.MSISDN_APN1 = TT.MSISDN(+) ';

    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_HLR1_APN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
   
   

/*    SQL_TXT := ' CREATE TABLE HLR2_APN_DATA NOLOGGING AS
                SELECT  DECODE(SUBSTR(SUBSTR(T.NUM_APPEL, 4), 1, 1),8,SUBSTR(T.NUM_APPEL, 4),7,SUBSTR(T.NUM_APPEL, 4),3,''0'' || (SUBSTR(T.NUM_APPEL, 4)),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN_APN2,
                 T.IMSI AS IMSI_2,
                 T.PDP_ID AS PDP_ID_2,
                 T.APN_ID AS APN_ID_2,
                 T.QOS AS QOS_2
                FROM HLR2 T';


    IF UTILS_INTERFACES.CREATE_TABLE('HLR2_APN_DATA', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('HLR2_APN_DATA',
                                     'FAFIF',
                                     'IX_MSISDN_APN2',
                                     'MSISDN_APN2') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;*/
    
     /*===================================================
   ENHANCEMENT MAY 14 2015
   ===================================================*/
   
   --HH 18-02-2020(VOLTE update)
   --max( decode( APN_ID, ''94'', APN_ID, null ) ) AS VOLTE01_APN2,
   --max( decode( APN_ID, ''95'', APN_ID, null ) ) AS VOLTE02_APN2
   
    SQL_TXT := ' CREATE TABLE HLR2_APN_DATA AS
                 select NUM_APPEL AS NUM_APPEL_APN2, 
                       DECODE(SUBSTR(SUBSTR(NUM_APPEL, 4), 1, 1),8,SUBSTR(NUM_APPEL, 4),7,SUBSTR(NUM_APPEL, 4),3,''0'' || (SUBSTR(NUM_APPEL, 4)),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN_APN2,
                       max( decode( APN_ID, ''20'', APN_ID, null ) ) AS WLL_APN2,
                       max( decode( APN_ID, ''15'', APN_ID, null ) ) AS ALFA_APN2,
                       max( decode( APN_ID, ''13'', APN_ID, null ) ) AS MBB_APN2,
                       max( decode( APN_ID, ''12'', APN_ID, null ) ) AS BLACKBERRY_APN2,
                       max( decode( APN_ID, ''10'', APN_ID, null ) ) AS GPRS_INTRA_APN2,
                       max( decode( APN_ID, ''9'', APN_ID, null ) )  AS MMS_APN2,
                       max( decode( APN_ID, ''8'', APN_ID, null ) ) AS WAP_APN2,
                       max( decode( APN_ID, ''7'', APN_ID, null ) ) AS GPRS_APN2,
                       max( decode( APN_ID, ''3'', APN_ID, null ) ) AS DATACARD1_APN2,
                       max( decode( APN_ID, ''4'', APN_ID, null ) ) AS DATACARD2_APN2,
                       max( decode( APN_ID, ''6'', APN_ID, null ) ) AS DATACARD3_APN2,
                       max( decode( APN_ID, ''94'', APN_ID, null ) ) AS VOLTE01_APN2,
                       max( decode( APN_ID, ''95'', APN_ID, null ) ) AS VOLTE02_APN2
                       FROM
                       (
                       SELECT *
                       FROM HLR2 
                       )
                       GROUP BY NUM_APPEL';


    IF UTILS_INTERFACES.CREATE_TABLE('HLR2_APN_DATA', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('HLR2_APN_DATA',
                                     'FAFIF',
                                     'IX_MSISDN_APN2',
                                     'MSISDN_APN2') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;



    SQL_TXT := ' CREATE TABLE HLR2_PARAM AS
                 SELECT DISTINCT(T.NUM_APPEL),
                 DECODE(SUBSTR(SUBSTR(T.NUM_APPEL, 4), 1, 1),8,SUBSTR(T.NUM_APPEL, 4),7,SUBSTR(T.NUM_APPEL, 4),3,''0'' || (SUBSTR(T.NUM_APPEL, 4)),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN,
                 T.IMSI, T.CFU, T.CFB, T.CFNRY,T.CFNRC,T.SPN,T.CAW,T.HOLD,T.MPTY,T.AOC,T.BAOC,T.BOIC,T.BOIEX,T.BAIC,T.BICRO,
                 T.CAT,T.OBO,T.OBI,T.OBR,T.OBOPRI,T.OBOPRE,T.OBSSM,T.OSB1,T.OSB2,T.OSB3,T.OSB4,T.OFA,T.PWD,T.ICI,T.OIN,T.TIN,
                 T.CLIP,T.CLIR,T.COLP,T.COLR,T.SOCB,T.SOCFU,T.SOCFB,T.SOCFRY,T.SOCFRC,T.SOCLIP,T.SOCLIR,T.SOCOLP,T.TS11,T.TS21,
                 T.TS22,T.TS62,T.TSD1,T.BS21,T.BS22,T.BS23,T.BS24,T.BS25,T.BS26,T.BS31,T.BS32,T.BS33,T.BS34,T.DBSG,T.TS61,T.CUG,
                 T.REGSER,T.PICI,T.DCF,T.SODCF,T.SOSDCF,T.CAPL,T.OICK,T.TICK,T.NAM,T.TSMO,T.REDUND,T.OCSI,T.RSA,T.RM,T.OBP,T.OSMCSI,
                 T.STYPE,T.SCHAR,T.REDMCH,T.GPRCSI,T.BS3G,T.CAMEL,T.RBT,T.EMLPP,T.NEMLPP,T.DEMLPP,
                 T.GPRSCSINF,T.MCSINF,T.OCSINF,T.OSMCSINF,T.TCSINF,T.TSMCSINF,T.VTCSINF,T.TIFCSINF,T.DCSIST,T.GPRSCSIST,
                 T.MCSIST,T.OCSIST,T.OSMCSIST,T.TCSIST,T.TSMCSIST,T.VTCSIST,T.ICS,T.CWNF,T.CHNF,T.CLIPNF,T.CLIRNF,T.ECTNF,T.ARD,
                 T.DATE_INSERTION_HLR2
                 FROM HLR2 T';

    IF UTILS_INTERFACES.CREATE_TABLE('HLR2_PARAM', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;



    IF UTILS_INTERFACES.CREATE_INDEX('HLR2_PARAM',
                                     'FAFIF',
                                     'IX_HLR2_msisdn',
                                     'msisdn') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


/*     SQL_TXT := ' CREATE TABLE MERGE_HLR2_APN NOLOGGING AS
                  SELECT T.*,
                       (SELECT V.APN_ID_2 FROM HLR2_APN_DATA V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 IN (20)) WLL_APN2,
                       (SELECT V.APN_ID_2 FROM HLR2_APN_DATA V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 IN (15)) ALFA_APN2,
                       (SELECT V.APN_ID_2 FROM HLR2_APN_DATA V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 IN (13)) MBB_APN2,
                       (SELECT V.APN_ID_2 FROM HLR2_APN_DATA V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 IN (12)) BLACKBERRY_APN2,
                       (SELECT V.APN_ID_2 FROM HLR2_APN_DATA V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 IN (10)) GPRS_INTRA_APN2,
                       (SELECT V.APN_ID_2 FROM HLR2_APN_DATA V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 IN (9)) MMS_APN2,
                       (SELECT V.APN_ID_2 FROM HLR2_APN_DATA V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 IN (8)) WAP_APN2,
                       (SELECT V.APN_ID_2 FROM HLR2_APN_DATA V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 IN (7)) GPRS_APN2,
                       (SELECT V.APN_ID_2 FROM HLR2_APN_DATA V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 IN (3)) DATACARD1_APN2,
                       (SELECT V.APN_ID_2 FROM HLR2_APN_DATA V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 IN (4)) DATACARD2_APN2,
                       (SELECT V.APN_ID_2 FROM HLR2_APN_DATA V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 IN (6)) DATACARD3_APN2
                   FROM HLR2_PARAM T ';

    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_HLR2_APN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;*/
    
    SQL_TXT := ' CREATE TABLE MERGE_HLR2_APN NOLOGGING AS
                SELECT  TT.*,T.*
                FROM HLR2_APN_DATA T, HLR2_PARAM TT
                WHERE T.MSISDN_APN2 (+)= TT.MSISDN 
                UNION
                SELECT  TT.*,T.*
                FROM HLR2_APN_DATA T, HLR2_PARAM TT
                WHERE T.MSISDN_APN2 = TT.MSISDN(+) ';

    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_HLR2_APN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     SQL_TXT := ' CREATE TABLE REP_SV_MSISDN_IN_MISP NOLOGGING AS
                  SELECT *
                  FROM CLEAN_SV_ALL_UPD t
                  WHERE
                  T.PRODUCT_TYPE_NAME IN (''Mobile Broadband Prepaid'')
                  AND T.RATE_PLAN IN (31,33,30,34,32,35,36,37,38,59)
                ';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_MSISDN_IN_MISP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


     SQL_TXT := ' CREATE TABLE REP_SV_MSISDN_NOT_MISP NOLOGGING AS
                  SELECT *
                  FROM CLEAN_SV_ALL_UPD t
                  WHERE
                  T.SERVICE_NAME NOT IN ( SELECT SERVICE_NAME FROM REP_SV_MSISDN_IN_MISP)';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_MSISDN_NOT_MISP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

      -- DMP SV Merged with CS4 
      --  Re-include MISP in Reconciliation: FROM REP_SV_MSISDN_NOT_MISP t, SYS_MINSAT TT

    SQL_TXT := ' CREATE TABLE MERGE_SYS_SV_CS4 NOLOGGING AS
          SELECT
          T.service_name  AS MSISDN_SV,
          id, account_name, service_name, service_type_name, product_type_name, service_status, account_type, customer_node_id,
          service_start_date, service_end_date, imsi, first_call, shelf_life_exp, service_id, serv_bp_int, product_instance_id,
          prod_start_date, prod_end_date, product_id, prod_bp_inst, prod_status, prod_reason_code, prod_reason_name, service_reason_name,
          serv_reason_code, customer_start_date, account_start_date,last_run_date ,T.DEALER_CODE_P,IMEI,ACCOUNT_ID,RATE_PLAN,CUSTOMER_NODE_STATUS_CODE,LOGIN_OPTION,
          TT.MSISDN AS MSISDN_CS4, jour, num_appel, cust_id, cust_class, langue, date_actif,
          date_inactif,date_susp, date_init, date_creat, etat_ppas, etat, duree_validite, date_chgt_etat, amount, DATE_RETENTION
          FROM CLEAN_SV_ALL_UPD t, SYS_MINSAT TT
          WHERE  T.SERVICE_NAME (+)= TT.MSISDN
          UNION
          SELECT
          T.service_name  AS MSISDN_SV,
          id, account_name, service_name, service_type_name, product_type_name, service_status, account_type, customer_node_id,
          service_start_date, service_end_date, imsi, first_call, shelf_life_exp, service_id, serv_bp_int, product_instance_id,
          prod_start_date, prod_end_date, product_id, prod_bp_inst, prod_status, prod_reason_code, prod_reason_name, service_reason_name,
          serv_reason_code, customer_start_date, account_start_date,last_run_date ,T.DEALER_CODE_P,IMEI,ACCOUNT_ID,RATE_PLAN,CUSTOMER_NODE_STATUS_CODE,LOGIN_OPTION,
          TT.MSISDN AS MSISDN_CS4, jour, num_appel, cust_id, cust_class, langue, date_actif,
          date_inactif,date_susp, date_init, date_creat, etat_ppas, etat, duree_validite, date_chgt_etat, amount, date_retention
          FROM CLEAN_SV_ALL_UPD t, SYS_MINSAT TT
          WHERE  T.SERVICE_NAME = TT.MSISDN(+)';

    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_SYS_SV_CS4', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MERGE_SYS_SV_CS4',
                                     'FAFIF',
                                     'IX_MSISDN_SYS_MERG_SV',
                                     'msisdn_sv') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MERGE_SYS_SV_CS4',
                                     'FAFIF',
                                     'IX_MSISDN_SYS_MERG_CS4',
                                     'msisdn_cs4') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


    -- Clean table
    -- SUBSTR(M.IMSI,0,6) NOT IN ''415018''
    -- AND    SUBSTR(M.IMSI,0,6) NOT IN ''415018'' AND
              
    SQL_TXT := ' CREATE TABLE CLEAN_ALL_SYS_MERGED NOLOGGING AS
              SELECT  (CASE WHEN M.msisdn_sv  IS NULL THEN msisdn_cs4
                           WHEN M.msisdn_cs4  IS NULL THEN msisdn_sv
                           ELSE msisdn_sv END)  AS MSISDN_SYS, m.*
              FROM MERGE_SYS_SV_CS4 M 
               ';           

    IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_ALL_SYS_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('CLEAN_ALL_SYS_MERGED',
                                     'FAFIF',
                                     'IX_MSISDN_SYSM',
                                     'MSISDN_SYS') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('CLEAN_ALL_SYS_MERGED',
                                     'FAFIF',
                                     'IX_PROD_SYSM',
                                     'PRODUCT_INSTANCE_ID') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


    IF UTILS_INTERFACES.CREATE_INDEX('CLEAN_ALL_SYS_MERGED',
                                     'FAFIF',
                                     'IX_SERV_SYSM',
                                     'SERV_BP_INT') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


    -- HLRs Merge
--HH 318-02-2020 (update)
--,T.VOLTE01_APN1,T.VOLTE02_APN1

    SQL_TXT := ' CREATE TABLE MERGE_HLR1_HLR2_1 NOLOGGING AS
          SELECT
              DECODE(SUBSTR(SUBSTR(t.NUM_APPEL,4 ),1,1),8,SUBSTR(t.NUM_APPEL, 4),7, SUBSTR(t.NUM_APPEL,4),3,''0''||(SUBSTR(t.NUM_APPEL,4 )),1,''0'' || (SUBSTR(T.NUM_APPEL, 4))) AS MSISDN_HLR1,
               t.IMSI as IMSI_1,t.NUM_APPEL as NUM_APPEL_1, t.CFU as CFU_1, t.CFB as CFB_1, t.CFNRY as CFNRY_1,
              t.CFNRC as CFNRC_1, t.SPN as SPN_1, t.CAW as CAW_1, t.HOLD as HOLD_1, t.MPTY as
              MPTY_1, t.AOC as AOC_1, t.BAOC as BAOC_1, t.BOIC as BOIC_1, t.BOIEX as BOIEX_1,
              t.BAIC as BAIC_1, t.BICRO as BICRO_1, t.CAT as CAT_1, t.OBO as OBO_1, t.OBI as
              OBI_1, t.OBR as OBR_1, t.OBOPRI as OBOPRI_1, t.OBOPRE as OBOPRE_1, t.OBSSM as
              OBSSM_1, t.OSB1 as OSB1_1, t.OSB2 as OSB2_1, t.OSB3 as OSB3_1, t.OSB4 as OSB4_1,
              t.OFA as OFA_1, t.PWD as PWD_1, t.ICI as ICI_1, t.OIN as OIN_1, t.TIN as TIN_1,
              t.CLIP as CLIP_1, t.CLIR as CLIR_1, t.COLP as COLP_1, t.COLR as COLR_1, t.SOCB
              as SOCB_1, t.SOCFU as SOCFU_1, t.SOCFB as SOCFB_1, t.SOCFRY as SOCFRY_1,
              t.SOCFRC as SOCFRC_1, t.SOCLIP as SOCLIP_1, t.SOCLIR as SOCLIR_1, t.SOCOLP as
              SOCOLP_1, t.TS11 as TS11_1, t.TS21 as TS21_1, t.TS22 as TS22_1, t.TS62 as
              TS62_1, t.TSD1 as TSD1_1, t.BS21 as BS21_1, t.BS22 as BS22_1, t.BS23 as BS23_1,
              t.BS24 as BS24_1, t.BS25 as BS25_1, t.BS26 as BS26_1, t.BS31 as BS31_1, t.BS32
              as BS32_1, t.BS33 as BS33_1, t.BS34 as BS34_1, t.DBSG as DBSG_1, t.TS61 as
              TS61_1, t.CUG as CUG_1, t.REGSER as REGSER_1, t.PICI as PICI_1, t.DCF as DCF_1,
              t.SODCF as SODCF_1, t.SOSDCF as SOSDCF_1, t.CAPL as CAPL_1, t.OICK as OICK_1,
              t.TICK as TICK_1, t.NAM as NAM_1, t.TSMO as TSMO_1, t.REDUND as REDUND_1, t.OCSI
              as OCSI_1, t.RSA as RSA_1, t.rm as rm_1,t.obp as obp_1, t.osmcsi as osmcsi_1,
              t.STYPE as STYPE_1, t.SCHAR as SCHAR_1, t.REDMCH as REDMCH_1, t.GPRCSI as GPRCSI_1,t.BS3G as BS3G_1,
              T.CAMEL as CAMEL_1,T.RBT as RBT_1,T.EMLPP as EMLPP_1,T.NEMLPP as NEMLPP_1 ,T.DEMLPP as DEMLPP_1,
              T.GPRSCSINF as GPRSCSINF_1,T.MCSINF as MCSINF_1,T.OCSINF as OCSINF_1,T.OSMCSINF as OSMCSINF_1,T.TCSINF as TCSINF_1,
              T.TSMCSINF as TSMCSINF_1,T.VTCSINF as VTCSINF_1,T.TIFCSINF as TIFCSINF_1,T.DCSIST as DCSIST_1,T.GPRSCSIST as GPRSCSIST_1,
              T.MCSIST as MCSIST_1,T.OCSIST as OCSIST_1,T.OSMCSIST as OSMCSIST_1,T.TCSIST as TCSIST_1,T.TSMCSIST AS TSMCSIST_1,
              T.VTCSIST AS VTCSIST_1,T.ICS AS ICS_1,T.CWNF AS CWNF_1,T.CHNF AS CHNF_1,T.CLIPNF AS CLIPNF_1,T.CLIRNF as CLIRNF_1,T.ECTNF AS ECTNF_1,T.ARD AS ARD_1,        
              T.WLL_APN1,T.mbb_apn1, T.ALFA_APN1 , T.blackberry_apn1, T.gprs_intra_apn1, T.mms_apn1, T.wap_apn1,T.gprs_apn1, T.datacard1_apn1,
              T.datacard2_apn1, T.datacard3_apn1,T.VOLTE01_APN1,T.VOLTE02_APN1,T.Date_Insertion_Hlr1,
              DECODE(SUBSTR(SUBSTR(TT.NUM_APPEL,4 ),1,1),8,SUBSTR(TT.NUM_APPEL, 4),7, SUBSTR(TT.NUM_APPEL,4 ),3,''0''||(SUBSTR(TT.NUM_APPEL,4 )),1,''0'' || (SUBSTR(TT.NUM_APPEL, 4))) AS MSISDN_HLR2,
              tt.IMSI as IMSI_2, tt.NUM_APPEL as NUM_APPEL_2, tt.CFU as CFU_2, tt.CFB as CFB_2, tt.CFNRY as CFNRY_2,
               tt.CFNRC as CFNRC_2, tt.SPN as SPN_2, tt.CAW as CAW_2, tt.HOLD as
              HOLD_2, tt.MPTY as MPTY_2, tt.AOC as AOC_2, tt.BAOC as BAOC_2, tt.BOIC as
              BOIC_2, tt.BOIEX as BOIEX_2, tt.BAIC as BAIC_2, tt.BICRO as BICRO_2, tt.CAT as
              CAT_2, tt.OBO as OBO_2, tt.OBI as OBI_2, tt.OBR as OBR_2, tt.OBOPRI as OBOPRI_2,
              tt.OBOPRE as OBOPRE_2, tt.OBSSM as OBSSM_2, tt.OSB1 as OSB1_2, tt.OSB2 as
              OSB2_2, tt.OSB3 as OSB3_2, tt.OSB4 as OSB4_2, tt.OFA as OFA_2, tt.PWD as PWD_2,
              tt.ICI as ICI_2, tt.OIN as OIN_2, tt.TIN as TIN_2, tt.CLIP as CLIP_2, tt.CLIR as
              CLIR_2, tt.COLP as COLP_2, tt.COLR as COLR_2, tt.SOCB as SOCB_2, tt.SOCFU as
              SOCFU_2, tt.SOCFB as SOCFB_2, tt.SOCFRY as SOCFRY_2, tt.SOCFRC as SOCFRC_2,
              tt.SOCLIP as SOCLIP_2, tt.SOCLIR as SOCLIR_2, tt.SOCOLP as SOCOLP_2, tt.TS11 as
              TS11_2, tt.TS21 as TS21_2, tt.TS22 as TS22_2, tt.TS62 as TS62_2, tt.TSD1 as
              TSD1_2, tt.BS21 as BS21_2, tt.BS22 as BS22_2, tt.BS23 as BS23_2, tt.BS24 as
              BS24_2, tt.BS25 as BS25_2, tt.BS26 as BS26_2, tt.BS31 as BS31_2, tt.BS32 as
              BS32_2, tt.BS33 as BS33_2, tt.BS34 as BS34_2, tt.DBSG as DBSG_2, tt.TS61 as
              TS61_2, tt.CUG as CUG_2, tt.REGSER as REGSER_2, tt.PICI as PICI_2, tt.DCF as
              DCF_2, tt.SODCF as SODCF_2, tt.SOSDCF as SOSDCF_2, tt.CAPL as CAPL_2, tt.OICK as
              OICK_2, tt.TICK as TICK_2, tt.NAM as NAM_2, tt.TSMO as TSMO_2, tt.REDUND as
              REDUND_2, tt.OCSI as OCSI_2, tt.RSA as RSA_2,tt.rm as rm_2,tt.obp as obp_2,
              tt.osmcsi as osmcsi_2,tt.STYPE as STYPE_2, tt.SCHAR as SCHAR_2, tt.REDMCH as REDMCH_2, tt.GPRCSI as GPRCSI_2,tt.BS3G as BS3G_2,
              tt.CAMEL as CAMEL_2,tt.RBT as RBT_2,tt.EMLPP as EMLPP_2,tt.NEMLPP as NEMLPP_2 ,tt.DEMLPP as DEMLPP_2,         
              TT.GPRSCSINF as GPRSCSINF_2,TT.MCSINF as MCSINF_2,TT.OCSINF as OCSINF_2,TT.OSMCSINF as OSMCSINF_2,TT.TCSINF as TCSINF_2,
              TT.TSMCSINF as TSMCSINF_2,TT.VTCSINF as VTCSINF_2,TT.TIFCSINF as TIFCSINF_2,TT.DCSIST as DCSIST_2,TT.GPRSCSIST as GPRSCSIST_2,
              TT.MCSIST as MCSIST_2,TT.OCSIST as OCSIST_2,TT.OSMCSIST as OSMCSIST_2,TT.TCSIST as TCSIST_2,TT.TSMCSIST AS TSMCSIST_2,
              TT.VTCSIST AS VTCSIST_2,TT.ICS AS ICS_2,TT.CWNF AS CWNF_2,TT.CHNF AS CHNF_2,TT.CLIPNF AS CLIPNF_2,TT.CLIRNF as CLIRNF_2,TT.ECTNF AS ECTNF_2,TT.ARD AS ARD_2,      
              TT.WLL_APN2,tt.mbb_apn2, tt.ALFA_APN2 , tt.blackberry_apn2, tt.gprs_intra_apn2, tt.mms_apn2, tt.wap_apn2,tt.gprs_apn2, tt.datacard1_apn2,
              tt.datacard2_apn2, tt.datacard3_apn2,tt.VOLTE01_APN2,tt.VOLTE02_APN2,
              TT.DATE_INSERTION_HLR2 FROM MERGE_HLR1_APN t, MERGE_HLR2_APN TT WHERE  T.NUM_APPEL (+)= TT.NUM_APPEL ';

    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_HLR1_HLR2_1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


--HH 18-02-2020 (VOLTE Update)
--T.VOLTE01_APN1,T.VOLTE02_APN1

SQL_TXT := ' CREATE TABLE MERGE_HLR1_HLR2_2 NOLOGGING AS
          SELECT DECODE(SUBSTR(SUBSTR(t.NUM_APPEL,4 ),1,1),8,SUBSTR(t.NUM_APPEL, 4),7, SUBSTR(t.NUM_APPEL,4),3,''0''||(SUBSTR(t.NUM_APPEL,4 )),1,''0'' || (SUBSTR(T.NUM_APPEL, 4))) AS MSISDN_HLR1,
             t.IMSI as IMSI_1, t.NUM_APPEL as NUM_APPEL_1, t.CFU as CFU_1, t.CFB as CFB_1, t.CFNRY as CFNRY_1,
            t.CFNRC as CFNRC_1, t.SPN as SPN_1, t.CAW as CAW_1, t.HOLD as HOLD_1, t.MPTY as
            MPTY_1, t.AOC as AOC_1, t.BAOC as BAOC_1, t.BOIC as BOIC_1, t.BOIEX as BOIEX_1,
            t.BAIC as BAIC_1, t.BICRO as BICRO_1, t.CAT as CAT_1, t.OBO as OBO_1, t.OBI as
            OBI_1, t.OBR as OBR_1, t.OBOPRI as OBOPRI_1, t.OBOPRE as OBOPRE_1, t.OBSSM as
            OBSSM_1, t.OSB1 as OSB1_1, t.OSB2 as OSB2_1, t.OSB3 as OSB3_1, t.OSB4 as OSB4_1,
            t.OFA as OFA_1, t.PWD as PWD_1, t.ICI as ICI_1, t.OIN as OIN_1, t.TIN as TIN_1,
            t.CLIP as CLIP_1, t.CLIR as CLIR_1, t.COLP as COLP_1, t.COLR as COLR_1, t.SOCB
            as SOCB_1, t.SOCFU as SOCFU_1, t.SOCFB as SOCFB_1, t.SOCFRY as SOCFRY_1,
            t.SOCFRC as SOCFRC_1, t.SOCLIP as SOCLIP_1, t.SOCLIR as SOCLIR_1, t.SOCOLP as
            SOCOLP_1, t.TS11 as TS11_1, t.TS21 as TS21_1, t.TS22 as TS22_1, t.TS62 as
            TS62_1, t.TSD1 as TSD1_1, t.BS21 as BS21_1, t.BS22 as BS22_1, t.BS23 as BS23_1,
            t.BS24 as BS24_1, t.BS25 as BS25_1, t.BS26 as BS26_1, t.BS31 as BS31_1, t.BS32
            as BS32_1, t.BS33 as BS33_1, t.BS34 as BS34_1, t.DBSG as DBSG_1, t.TS61 as
            TS61_1, t.CUG as CUG_1, t.REGSER as REGSER_1, t.PICI as PICI_1, t.DCF as DCF_1,
            t.SODCF as SODCF_1, t.SOSDCF as SOSDCF_1, t.CAPL as CAPL_1, t.OICK as OICK_1,
            t.TICK as TICK_1, t.NAM as NAM_1, t.TSMO as TSMO_1, t.REDUND as REDUND_1, t.OCSI
            as OCSI_1, t.RSA as RSA_1, t.rm as rm_1,t.obp as obp_1, t.osmcsi as osmcsi_1,
            t.STYPE as STYPE_1, t.SCHAR as SCHAR_1, t.REDMCH as REDMCH_1, t.GPRCSI as GPRCSI_1,t.BS3G AS BS3G_1,
            T.CAMEL as CAMEL_1,T.RBT as RBT_1,T.EMLPP as EMLPP_1,T.NEMLPP as NEMLPP_1 ,T.DEMLPP as DEMLPP_1,
            T.GPRSCSINF as GPRSCSINF_1,T.MCSINF as MCSINF_1,T.OCSINF as OCSINF_1,T.OSMCSINF as OSMCSINF_1,T.TCSINF as TCSINF_1,
            T.TSMCSINF as TSMCSINF_1,T.VTCSINF as VTCSINF_1,T.TIFCSINF as TIFCSINF_1,T.DCSIST as DCSIST_1,T.GPRSCSIST as GPRSCSIST_1,
            T.MCSIST as MCSIST_1,T.OCSIST as OCSIST_1,T.OSMCSIST as OSMCSIST_1,T.TCSIST as TCSIST_1,T.TSMCSIST AS TSMCSIST_1,
            T.VTCSIST AS VTCSIST_1,T.ICS AS ICS_1,T.CWNF AS CWNF_1,T.CHNF AS CHNF_1,T.CLIPNF AS CLIPNF_1,T.CLIRNF as CLIRNF_1,T.ECTNF AS ECTNF_1,T.ARD AS ARD_1,
            T.WLL_APN1, T.mbb_apn1, t.ALFA_APN1 , T.blackberry_apn1, T.gprs_intra_apn1, T.mms_apn1, T.wap_apn1,T.gprs_apn1, T.datacard1_apn1,
            T.datacard2_apn1, T.datacard3_apn1,T.VOLTE01_APN1,T.VOLTE02_APN1,
            T.DATE_INSERTION_HLR1,
            DECODE(SUBSTR(SUBSTR(TT.NUM_APPEL,4 ),1,1),8,SUBSTR(TT.NUM_APPEL, 4),7, SUBSTR(TT.NUM_APPEL,4),3,''0''||(SUBSTR(TT.NUM_APPEL,4 )),1,''0'' || (SUBSTR(TT.NUM_APPEL, 4))) AS MSISDN_HLR2,
            tt.IMSI as IMSI_2, tt.NUM_APPEL as NUM_APPEL_2, tt.CFU as CFU_2, tt.CFB as CFB_2, tt.CFNRY as CFNRY_2,
            tt.CFNRC as CFNRC_2, tt.SPN as SPN_2, tt.CAW as CAW_2, tt.HOLD as
            HOLD_2, tt.MPTY as MPTY_2, tt.AOC as AOC_2, tt.BAOC as BAOC_2, tt.BOIC as
            BOIC_2, tt.BOIEX as BOIEX_2, tt.BAIC as BAIC_2, tt.BICRO as BICRO_2, tt.CAT as
            CAT_2, tt.OBO as OBO_2, tt.OBI as OBI_2, tt.OBR as OBR_2, tt.OBOPRI as OBOPRI_2,
            tt.OBOPRE as OBOPRE_2, tt.OBSSM as OBSSM_2, tt.OSB1 as OSB1_2, tt.OSB2 as
            OSB2_2, tt.OSB3 as OSB3_2, tt.OSB4 as OSB4_2, tt.OFA as OFA_2, tt.PWD as PWD_2,
            tt.ICI as ICI_2, tt.OIN as OIN_2, tt.TIN as TIN_2, tt.CLIP as CLIP_2, tt.CLIR as
            CLIR_2, tt.COLP as COLP_2, tt.COLR as COLR_2, tt.SOCB as SOCB_2, tt.SOCFU as
            SOCFU_2, tt.SOCFB as SOCFB_2, tt.SOCFRY as SOCFRY_2, tt.SOCFRC as SOCFRC_2,
            tt.SOCLIP as SOCLIP_2, tt.SOCLIR as SOCLIR_2, tt.SOCOLP as SOCOLP_2, tt.TS11 as
            TS11_2, tt.TS21 as TS21_2, tt.TS22 as TS22_2, tt.TS62 as TS62_2, tt.TSD1 as
            TSD1_2, tt.BS21 as BS21_2, tt.BS22 as BS22_2, tt.BS23 as BS23_2, tt.BS24 as
            BS24_2, tt.BS25 as BS25_2, tt.BS26 as BS26_2, tt.BS31 as BS31_2, tt.BS32 as
            BS32_2, tt.BS33 as BS33_2, tt.BS34 as BS34_2, tt.DBSG as DBSG_2, tt.TS61 as
            TS61_2, tt.CUG as CUG_2, tt.REGSER as REGSER_2, tt.PICI as PICI_2, tt.DCF as
            DCF_2, tt.SODCF as SODCF_2, tt.SOSDCF as SOSDCF_2, tt.CAPL as CAPL_2, tt.OICK as
            OICK_2, tt.TICK as TICK_2, tt.NAM as NAM_2, tt.TSMO as TSMO_2, tt.REDUND as
            REDUND_2, tt.OCSI as OCSI_2, tt.RSA as RSA_2,tt.rm as rm_2,tt.obp as obp_2,
            tt.osmcsi as osmcsi_2,
            tt.STYPE as STYPE_2, tt.SCHAR as SCHAR_2, tt.REDMCH as REDMCH_2, tt.GPRCSI as GPRCSI_2,tt.BS3G AS BS3G_2,
            tt.CAMEL as CAMEL_2,tt.RBT as RBT_2,tt.EMLPP as EMLPP_2,tt.NEMLPP as NEMLPP_2 ,tt.DEMLPP as DEMLPP_2,
            TT.GPRSCSINF as GPRSCSINF_2,TT.MCSINF as MCSINF_2,TT.OCSINF as OCSINF_2,TT.OSMCSINF as OSMCSINF_2,TT.TCSINF as TCSINF_2,
            TT.TSMCSINF as TSMCSINF_2,TT.VTCSINF as VTCSINF_2,TT.TIFCSINF as TIFCSINF_2,TT.DCSIST as DCSIST_2,TT.GPRSCSIST as GPRSCSIST_2,
            TT.MCSIST as MCSIST_2,TT.OCSIST as OCSIST_2,TT.OSMCSIST as OSMCSIST_2,TT.TCSIST as TCSIST_2,TT.TSMCSIST AS TSMCSIST_2,
            TT.VTCSIST AS VTCSIST_2,TT.ICS AS ICS_2,TT.CWNF AS CWNF_2,TT.CHNF AS CHNF_2,TT.CLIPNF AS CLIPNF_2,TT.CLIRNF as CLIRNF_2,TT.ECTNF AS ECTNF_2,TT.ARD AS ARD_2,
            TT.WLL_APN2,tt.mbb_apn2,tt.ALFA_APN2 , tt.blackberry_apn2, tt.gprs_intra_apn2, tt.mms_apn2, tt.wap_apn2,tt.gprs_apn2, tt.datacard1_apn2,
            tt.datacard2_apn2, tt.datacard3_apn2,tt.VOLTE01_APN2,tt.VOLTE02_APN2,
            TT.DATE_INSERTION_HLR2 FROM MERGE_HLR1_APN t, MERGE_HLR2_APN TT WHERE T.NUM_APPEL = TT.NUM_APPEL(+)';



    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_HLR1_HLR2_2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


     SQL_TXT := 'CREATE TABLE MERGE_HLR1_HLR2 NOLOGGING AS
                select * from MERGE_HLR1_HLR2_1
                union
                SELECT * FROM MERGE_HLR1_HLR2_2';

    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_HLR1_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    


 --************************** Update NULL values to 0 ************
 -- **************************************************************


    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OBO_1 = 0
                  WHERE HH.OBO_1 IS NULL';


    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                SET HH.OBI_1 = 0
                WHERE HH.OBI_1 IS NULL';


    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                SET HH.TICK_1 = 0
                WHERE HH.TICK_1 IS NULL';


    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
              SET HH.OBR_1 = 0
              WHERE HH.OBR_1 IS NULL';


    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;


    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OICK_1 = 0
                  WHERE HH.OICK_1 IS NULL';


    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;


    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.RSA_1 = 0
                  WHERE HH.RSA_1 IS NULL';


    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OBO_2 = 0
                  WHERE HH.OBO_2 IS NULL';


    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                SET HH.OBI_2 = 0
                WHERE HH.OBI_2 IS NULL';


    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                SET HH.TICK_2 = 0
                WHERE HH.TICK_2 IS NULL';


    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
              SET HH.OBR_2 = 0
              WHERE HH.OBR_2 IS NULL';


    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;


    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OICK_2 = 0
                  WHERE HH.OICK_2 IS NULL';


    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;


    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.RSA_2 = 0
                  WHERE HH.RSA_2 IS NULL';

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OBP_1 = 0
                  WHERE HH.OBP_1 IS NULL';

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OBP_2 = 0
                  WHERE HH.OBP_2 IS NULL';

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    -- RSA for Roaming 17092010

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.RSA_1 = 0
                  WHERE HH.RSA_1 IS NULL';

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.RSA_2 = 0
                  WHERE HH.RSA_2 IS NULL';

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;
    
      -- OCSIST  for Prepaid Roaming 17092010

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OCSIST_1 = 0
                  WHERE HH.OCSIST_1 IS NULL';

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OCSIST_2 = 0
                  WHERE HH.OCSIST_2 IS NULL';

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;


      -- TCSIST for Prepaid Roaming 17092010

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.TCSIST_1 = 0
                  WHERE HH.TCSIST_1 IS NULL';

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.TCSIST_2 = 0
                  WHERE HH.TCSIST_2 IS NULL';

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;


    COMMIT;

 --************************** END Update NULL values to 0 ************
 -- **************************************************************


     -- Report listing difference between MSISDNs on HLRs

 SQL_TXT := 'CREATE TABLE REP_HLRS_MIS_MSISDN NOLOGGING AS
              SELECT * FROM MERGE_HLR1_HLR2 HH
              WHERE HH.MSISDN_HLR1 IS NULL OR HH.MSISDN_HLR2 IS NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_HLRS_MIS_MSISDN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;



-- Report listing difference between IMSIs on HLRs

    SQL_TXT := 'CREATE TABLE REP_HLRS_MIS_IMSI NOLOGGING AS
              SELECT * FROM MERGE_HLR1_HLR2 HH
              WHERE HH.MSISDN_HLR1 = HH.MSISDN_HLR2
              AND HH.MSISDN_HLR1 IS NOT NULL
              AND HH.IMSI_1<>HH.IMSI_2';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_HLRS_MIS_IMSI', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    -- Merge HLRs final table
    --(SUBSTR(M.IMSI_1,0,6) NOT IN ''415018''
    --AND   SUBSTR(M.IMSI_2,0,6) NOT IN ''415018''

     SQL_TXT := 'CREATE TABLE CLEAN_HLRS_MERGED NOLOGGING AS
                  SELECT  (CASE WHEN M.MSISDN_HLR1 IS NULL THEN M.MSISDN_HLR2
                               WHEN M.MSISDN_HLR2  IS NULL THEN MSISDN_HLR1
                               ELSE M.MSISDN_HLR2
                               END)  AS MSISDN_HLRS, m.*
                  FROM MERGE_HLR1_HLR2 M
                  WHERE 1=1
                  OR M.IMSI_1 IS NULL
                  OR M.IMSI_2 IS NULL
                  ';
               
    IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_HLRS_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     IF UTILS_INTERFACES.CREATE_INDEX('CLEAN_HLRS_MERGED',
                                     'FAFIF',
                                     'IX_MSISDN_HLR',
                                     'MSISDN_HLRS') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
     END IF;

     -- Merge SV, CS4, HLR1 and HLR2

     SQL_TXT := 'CREATE TABLE MERGE_SYS_HLRS AS
                  SELECT t.*, SUBSTR(tt.IMSI_1,0,6) as prim_flag,TT.*
                  FROM CLEAN_ALL_SYS_MERGED t, CLEAN_HLRS_MERGED TT
                  WHERE T.MSISDN_SYS(+)=TT.MSISDN_HLRS
                  UNION
                  SELECT t.*, SUBSTR(tt.IMSI_1,0,6) as prim_flag ,TT.*
                  FROM CLEAN_ALL_SYS_MERGED t, CLEAN_HLRS_MERGED TT
                  WHERE t.MSISDN_SYS =TT.MSISDN_HLRS(+)';

    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_SYS_HLRS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    



    -- Final Merge SV, CS5, HLR1 and HLR2

     SQL_TXT := 'CREATE TABLE REP_CLEAN_ALL_MERGED NOLOGGING AS
                  SELECT  (CASE WHEN M.MSISDN_SYS IS NULL THEN M.MSISDN_HLRS
                               WHEN M.MSISDN_HLRS  IS NULL THEN M.MSISDN_SYS
                               ELSE M.MSISDN_SYS END)  AS MSISDN ,
                          decode(prim_flag,''415012'', 1,''415019'',1,2) as primary_hlr,
                          (CASE WHEN M.MSISDN_SYS IS NULL THEN
                             (case when (to_number(M.MSISDN_HLRS) between 71900000 and 71999999) then ''SDP05''
                                   when (to_number(M.MSISDN_HLRS) between 71800000 and 71899999) then ''SDP06''
                                   when (to_number(M.MSISDN_HLRS) between 3000000  and 3999999)  then ''SDP03''
                                   when (to_number(M.MSISDN_HLRS) between 70000000 and 70999999) then ''SDP04''
                                   when (to_number(M.MSISDN_HLRS) between 71000000 and 71099999) then ''SDP04''
                                   when (to_number(M.MSISDN_HLRS) between 76100000 and 76199999) then ''SDP05''
                                   when (to_number(M.MSISDN_HLRS) between 71600000 and 71699999) then ''SDP04''
                                   when (to_number(M.MSISDN_HLRS) between 71700000 and 71799999) then ''SDP05''
                                   when (to_number(M.MSISDN_HLRS) between 76300000 and 76399999) then ''SDP05''
                                   when (to_number(M.MSISDN_HLRS) between 76400000 and 76499999) then ''SDP06''
                                   when (to_number(M.MSISDN_HLRS) between 76500000 and 76599999) then ''SDP05''
                                   when (to_number(M.MSISDN_HLRS) between 79100000 and 79199999) then ''SDP06''
                                   when (to_number(M.MSISDN_HLRS) between 79300000 and 79324999) then ''SDP06''
                                   when (to_number(M.MSISDN_HLRS) between 1000000 and 1999999) then ''SDP06''
                                   when (to_number(M.MSISDN_HLRS) between 81000000 and 81999999) then ''SDP05''
                                   else ''SDP''
                               end)
                            WHEN M.MSISDN_HLRS  IS NULL THEN
                            (case when (to_number(M.MSISDN_SYS) between 71900000 and 71999999) then ''SDP05''
                                  when (to_number(M.MSISDN_SYS) between 71800000 and 71899999) then ''SDP04''
                                  when (to_number(M.MSISDN_SYS) between 3000000  and 3999999)  then ''SDP03''
                                  when (to_number(M.MSISDN_SYS) between 70000000 and 70999999) then ''SDP04''
                                  when (to_number(M.MSISDN_SYS) between 71000000 and 71099999) then ''SDP06''
                                  when (to_number(M.MSISDN_SYS) between 76100000 and 76199999) then ''SDP05''
                                  when (to_number(M.MSISDN_SYS) between 71600000 and 71699999) then ''SDP04''
                                  when (to_number(M.MSISDN_SYS) between 71700000 and 71799999) then ''SDP05''
                                  when (to_number(M.MSISDN_SYS) between 76300000 and 76399999) then ''SDP05''
                                  when (to_number(M.MSISDN_SYS) between 76400000 and 76499999) then ''SDP06''
                                  when (to_number(M.MSISDN_SYS) between 76500000 and 76599999) then ''SDP05''
                                  when (to_number(M.MSISDN_SYS) between 79100000 and 79199999) then ''SDP06''
                                  when (to_number(M.MSISDN_SYS) between 79300000 and 79324999) then ''SDP06''
                                  when (to_number(M.MSISDN_SYS) between 1000000 and 1999999) then ''SDP06''
                                  when (to_number(M.MSISDN_SYS) between 81000000 and 81999999) then ''SDP05''
                                  else ''SDP''
                             end)
                            ELSE
                            (case when (to_number(M.MSISDN_SYS) between 71900000 and 71999999) then ''SDP05''
                                  when (to_number(M.MSISDN_SYS) between 71800000 and 71899999) then ''SDP06''
                                  when (to_number(M.MSISDN_SYS) between 3000000  and 3999999)  then ''SDP03''
                                  when (to_number(M.MSISDN_SYS) between 70000000 and 70999999) then ''SDP04''
                                  when (to_number(M.MSISDN_SYS) between 71000000 and 71099999) then ''SDP04''
                                  when (to_number(M.MSISDN_SYS) between 76100000 and 76199999) then ''SDP05''
                                  when (to_number(M.MSISDN_SYS) between 71600000 and 71699999) then ''SDP04''
                                  when (to_number(M.MSISDN_SYS) between 71700000 and 71799999) then ''SDP05''
                                  when (to_number(M.MSISDN_SYS) between 76300000 and 76399999) then ''SDP05''
                                  when (to_number(M.MSISDN_SYS) between 76400000 and 76499999) then ''SDP06''
                                  when (to_number(M.MSISDN_SYS) between 76500000 and 76599999) then ''SDP05''
                                  when (to_number(M.MSISDN_SYS) between 79100000 and 79199999) then ''SDP06''
                                  when (to_number(M.MSISDN_SYS) between 79300000 and 79324999) then ''SDP06''
                                  when (to_number(M.MSISDN_SYS) between 1000000 and 1999999) then ''SDP06''
                                  when (to_number(M.MSISDN_SYS) between 81000000 and 81999999) then ''SDP05''
                                  else ''SDP''
                             end)
                         END) AS  SDP,
                            m.*
                  FROM MERGE_SYS_HLRS M';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLEAN_ALL_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('REP_CLEAN_ALL_MERGED',
                                     'FAFIF',
                                     'IX_clean_all_msisdn',
                                     'msisdn') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


    IF UTILS_INTERFACES.CREATE_INDEX('REP_CLEAN_ALL_MERGED',
                                     'FAFIF',
                                     'IX_PRODUCT_INSTANCE_ID',
                                     'PRODUCT_INSTANCE_ID') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


     SQL_TXT := 'CREATE TABLE REP_ADM_DMP_HLR1 NOLOGGING AS
                      select t.msisdn, t.imsi,
                      (case
                        when t.wll_apn1 is not null then ''Mobile Internet WLL''
                          when t.mbb_apn1 is not null then ''Mobile BroadBand''
                            when t.alfa_apn1 is not null then ''Alfa APN''
                              when t.blackberry_apn1 is not null then ''Blackberry''
                                when t.gprs_intra_apn1 is not null then ''GPRS INTRA''
                                  when t.mms_apn1 is not null then ''MMS''
                                    when t.wap_apn1 is not null then ''WAP''
                                      when t.gprs_apn1 is not null then ''GPRS''
                                        when t.datacard1_apn1 is not null then ''Data Card''
                                          when t.datacard2_apn1 is not null then ''Data Card''
                                            when t.datacard3_apn1 is not null then ''Data Card''
                                              when t.volte01_apn1 is not null then ''Volte''
                                                  when t.volte02_apn1 is not null then ''Volte''
                                                    else ''OTHER''
                         end) AS Companion_Product,
                       t.service_type_name
                      from REP_CLEAN_ALL_MERGED t
                      WHERE 1=1
                      AND t.primary_hlr = 1';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_ADM_DMP_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    -- HLR2

        SQL_TXT := 'CREATE TABLE REP_ADM_DMP_HLR2 NOLOGGING AS
                    select t.msisdn, t.imsi, 
                       (case
                        when t.wll_apn2 is not null then ''Mobile Internet WLL''
                          when t.mbb_apn2 is not null then ''Mobile BroadBand''
                            when t.alfa_apn2 is not null then ''Alfa APN''
                              when t.blackberry_apn2 is not null then ''Blackberry''
                                when t.gprs_intra_apn2 is not null then ''GPRS INTRA''
                                  when t.mms_apn2 is not null then ''MMS''
                                    when t.wap_apn2 is not null then ''WAP''
                                      when t.gprs_apn2 is not null then ''GPRS''
                                        when t.datacard1_apn2 is not null then ''Data Card''
                                          when t.datacard2_apn2 is not null then ''Data Card''
                                            when t.datacard3_apn2 is not null then ''Data Card''
                                              when t.volte01_apn2 is not null then ''Volte''
                                                  when t.volte02_apn2 is not null then ''Volte''
                                                    else ''OTHER''
                         end) AS Companion_Product,
                         t.service_type_name
                    from REP_CLEAN_ALL_MERGED t
                    WHERE 1=1
                    AND t.primary_hlr = 2';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_ADM_DMP_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    -- Merge APN tables

        SQL_TXT := 'CREATE TABLE UNION_APNS NOLOGGING AS
                      SELECT ss.* FROM REP_ADM_DMP_HLR1 ss
                      UNION
                      SELECT vv.* FROM REP_ADM_DMP_HLR2 vv';

    IF UTILS_INTERFACES.CREATE_TABLE('UNION_APNS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


       -- Merge APN with SV

        SQL_TXT := 'CREATE TABLE REP_APN_SYS_ALL NOLOGGING AS
                SELECT AA.MSISDN, AA.IMSI, AA.COMPANION_PRODUCT, AA.SERVICE_TYPE_NAME FROM UNION_APNS AA
                UNION
                SELECT MM.MSISDN, MM.IMSI, NULL, MM.SERVICE_TYPE_NAME FROM REP_CLEAN_ALL_MERGED MM
                WHERE mm.service_status <> ''Cancelled''';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_APN_SYS_ALL', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    -- Report Duplicates

        SQL_TXT := 'CREATE TABLE list_null_cp_group NOLOGGING AS
                  SELECT t.msisdn, COUNT (t.msisdn) AS count_NUM FROM rep_apn_sys_all t
                  GROUP BY t.msisdn
                  HAVING COUNT (t.msisdn) >1';

    IF UTILS_INTERFACES.CREATE_TABLE('list_null_cp_group', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    -- Remove duplicates from REP_APN_SYS_ALL

        SQL_TXT := 'DELETE FROM REP_APN_SYS_ALL T
                    WHERE T.MSISDN IN (SELECT V.MSISDN FROM LIST_NULL_CP_GROUP V)
                    AND T.COMPANION_PRODUCT IS NULL';

    IF UTILS_INTERFACES.DELETE_TABLE (SQL_TXT) = 0 THEN
      RAISE TABLE_INSERT_FAILED;
    END IF;

    -- 'reconciliation'||'_'||CURRENT_DATE||'.csv'
    fafif.reconciliation_interfaces.EXPORT_TABLE_TO_ADM_TXT ('FAFIF','REP_APN_SYS_ALL');

    CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

   --DBAUSER.P_FTP('192.168.41.13','ftp_prov','123Prov','OUTPUT_BOPS','reconciliation_'||CURRENT_DATE||'.csv','reconciliation_'||CURRENT_DATE||'.txt');

    -- END FA 13102010

--END IF;

 EXCEPTION
 WHEN OTHERS THEN
 NULL;



 END P1_MAIN_SYS_INTERFACES;

PROCEDURE P1_MAIN_SYS_INTERFACES_OLD(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS


   
    -- =============================================================================================
    --    Modified by                 : FAF
    --    Release                     : R1.1
    --    Modification Date           : 01/11/2009
    --    Author                      : FAF
    --    Requirement book version    : V3.0
    --    Comments                    : 
    --   ------------------------------------------------------------------------------------------- 
    
    -- =============================================================================================
    --    Pre-requisite(s)            : SV DMP (CLEAN_SV_ALL_UPD)
    --                                  HLR DMP (HLR1 & HLR2)
    --                                  MINSAT DMP (FAFIF.PPS_ABONNE_JOUR_dbauserDB D)
    --    Release                     : R1.0
    --    Date                        : 31/10/2009
    --    Author                      : FAF
    --    Requirement  version        : V1.0
    --    Comments                    : Reconciliation
    --   ------------------------------------------------------------------------------------------- 
    
    
    --================================================================================================================
    -- sql_txt : contains the sql statment body
    --================================================================================================================
    SQL_TXT             VARCHAR2(8000);
    RELEASE              VARCHAR2(20)    := 'R1.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;
    

    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);
    CURRENT_DATE         VARCHAR2(100);
    --count_cs4            NUMBER;
    --count_sv             NUMBER;


  BEGIN


    UTILS_INTERFACES.INTERFACE_NAME := 'P1_MAIN_SYS_INTERFACES_OLD';
 

    --================================================================================================================
    -- Initiate Tables
    --================================================================================================================

 -- 10/02/2011: New checks added to make sure that SV and CS4 DMPs are extracted on SYSDATE
 
/* EXECUTE IMMEDIATE 'SELECT COUNT(*) 
                     FROM FAFIF.PPS_ABONNE_JOUR_dbauserDB PP
                    WHERE PP.JOUR = TRUNC(SYSDATE)
                      AND ROWNUM<2' INTO COUNT_CS4;

 EXECUTE IMMEDIATE 'SELECT COUNT(*) 
                     FROM FAFIF.CLEAN_SV_ALL_UPD SV
                    WHERE TRUNC(SV.LAST_RUN_DATE) = TRUNC(SYSDATE)
                      AND ROWNUM<2' INTO COUNT_SV;*/


 --IF (COUNT_CS4 =1 AND COUNT_SV=1) THEN
    
 -- DMP CS4
 
    SQL_TXT := ' CREATE TABLE SYS_MINSAT NOLOGGING AS
                    SELECT DECODE(SUBSTR(SUBSTR(NUM_APPEL, 4), 1, 1),7,SUBSTR(NUM_APPEL, 4),3,''0'' || (SUBSTR(NUM_APPEL, 4)),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN,
                           D.*
                      FROM FAFIF.PPS_ABONNE_JOUR_MIGDB D ';

            
    IF UTILS_INTERFACES.CREATE_TABLE('SYS_MINSAT', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
  
    IF UTILS_INTERFACES.CREATE_INDEX('SYS_MINSAT',
                                     'FAFIF',
                                     'IX_MINSAT_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

    -- DMP APNs
 

    SQL_TXT := 'CREATE TABLE APN_DATA_HLR1 NOLOGGING AS
                    SELECT DECODE(SUBSTR(SUBSTR(D.MSISDN, 4), 1, 1),7,SUBSTR(D.MSISDN, 4),3,''0'' || (SUBSTR(D.MSISDN, 4)),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN_APN1,
                           D.IMSI AS IMSI_1, D.MSISDN AS MSISDN_1, D.APN_ID AS APN_ID_1, D.PDP_ID AS PDP_ID_1, D.QOS AS QOS_1
                      FROM FAFIF.APNID_HLR1 D 
                      WHERE 
                        SUBSTR(D.msisdn,0,2) NOT IN ''01''
                      and
                      (SUBSTR(D.IMSI,0,6) NOT IN ''415018''
                       OR D.IMSI IS NULL)
                       ';
                      /* AND D.MSISDN_APN1 NOT IN (''70153876'',
                                   ''70142246'',
                                   ''70163914'',
                                   ''70137982'',
                                   ''70359137'',
                                   ''70359991'',
                                   ''01021285'')*/


    IF UTILS_INTERFACES.CREATE_TABLE('APN_DATA_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
  
    IF UTILS_INTERFACES.CREATE_INDEX('APN_DATA_HLR1',
                                     'FAFIF',
                                     'IX_MSISDN_APN1',
                                     'MSISDN_APN1') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


    SQL_TXT := 'CREATE TABLE APN_DATA_HLR2 NOLOGGING AS
                    SELECT DECODE(SUBSTR(SUBSTR(D.MSISDN, 4), 1, 1),7,SUBSTR(D.MSISDN, 4),3,''0'' || (SUBSTR(D.MSISDN, 4)),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN_APN2,
                           D.IMSI AS IMSI_2, D.MSISDN AS MSISDN_2, D.APN_ID AS APN_ID_2, D.PDP_ID AS PDP_ID_2, D.QOS AS QOS_2
                      FROM FAFIF.APNID_HLR2 D 
                      WHERE 
                      SUBSTR(D.msisdn,0,2) NOT IN ''01''
                      and
                      (SUBSTR(D.IMSI,0,6) NOT IN ''415018''
                       OR D.IMSI IS NULL)
                       ';
                       
                    /* AND D.MSISDN_APN2 NOT IN (''70153876'',
                                   ''70142246'',
                                   ''70163914'',
                                   ''70137982'',
                                   ''70359137'',
                                   ''70359991'',
                                   ''01021285'')*/

            
    IF UTILS_INTERFACES.CREATE_TABLE('APN_DATA_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
  
    IF UTILS_INTERFACES.CREATE_INDEX('APN_DATA_HLR2',
                                     'FAFIF',
                                     'IX_MSISDN_APN2',
                                     'MSISDN_APN2') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;
    
     SQL_TXT := ' CREATE TABLE REP_SV_MSISDN_IN_MISP NOLOGGING AS
                  SELECT *
                  FROM CLEAN_SV_ALL_UPD t
                  WHERE 
                  T.PRODUCT_TYPE_NAME IN (''Mobile Broadband Prepaid'')
                  AND T.RATE_PLAN IN (31,33,30,34,32)
                ';
          
    
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_MSISDN_IN_MISP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


     SQL_TXT := ' CREATE TABLE REP_SV_MSISDN_NOT_MISP NOLOGGING AS
                  SELECT *
                  FROM CLEAN_SV_ALL_UPD t
                  WHERE 
                  T.SERVICE_NAME NOT IN ( SELECT SERVICE_NAME FROM REP_SV_MSISDN_IN_MISP)';
          
    
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_MSISDN_NOT_MISP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    -- DMP SV Merged with CS4

    SQL_TXT := ' CREATE TABLE MERGE_SYS_SV_CS4 NOLOGGING AS
          SELECT 
          T.service_name  AS MSISDN_SV,
          id, account_name, service_name, service_type_name, product_type_name, service_status, account_type, customer_node_id,
          service_start_date, service_end_date, imsi, first_call, shelf_life_exp, service_id, serv_bp_int, product_instance_id,
          prod_start_date, prod_end_date, product_id, prod_bp_inst, prod_status, prod_reason_code, prod_reason_name, service_reason_name,
          serv_reason_code, customer_start_date, account_start_date,last_run_date ,T.DEALER_CODE_P,IMEI,ACCOUNT_ID,RATE_PLAN,CUSTOMER_NODE_STATUS_CODE,
          TT.MSISDN AS MSISDN_CS4, jour, num_appel, cust_id, cust_class, langue, date_actif,
          date_inactif,date_susp, date_init, date_creat, etat_ppas, etat, duree_validite, date_chgt_etat, amount, DATE_RETENTION
          FROM REP_SV_MSISDN_NOT_MISP t, SYS_MINSAT TT
          WHERE  T.SERVICE_NAME (+)= TT.MSISDN
          UNION 
          SELECT
          T.service_name  AS MSISDN_SV,
          id, account_name, service_name, service_type_name, product_type_name, service_status, account_type, customer_node_id,
          service_start_date, service_end_date, imsi, first_call, shelf_life_exp, service_id, serv_bp_int, product_instance_id,
          prod_start_date, prod_end_date, product_id, prod_bp_inst, prod_status, prod_reason_code, prod_reason_name, service_reason_name,
          serv_reason_code, customer_start_date, account_start_date,last_run_date ,T.DEALER_CODE_P,IMEI,ACCOUNT_ID,RATE_PLAN,CUSTOMER_NODE_STATUS_CODE,
          TT.MSISDN AS MSISDN_CS4, jour, num_appel, cust_id, cust_class, langue, date_actif,
          date_inactif,date_susp, date_init, date_creat, etat_ppas, etat, duree_validite, date_chgt_etat, amount, date_retention
          FROM REP_SV_MSISDN_NOT_MISP t, SYS_MINSAT TT
          WHERE  T.SERVICE_NAME = TT.MSISDN(+)';

    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_SYS_SV_CS4', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
  
    IF UTILS_INTERFACES.CREATE_INDEX('MERGE_SYS_SV_CS4',
                                     'FAFIF',
                                     'IX_MSISDN_SYS_MERG_SV',
                                     'msisdn_sv') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;
    
    IF UTILS_INTERFACES.CREATE_INDEX('MERGE_SYS_SV_CS4',
                                     'FAFIF',
                                     'IX_MSISDN_SYS_MERG_CS4',
                                     'msisdn_cs4') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;
    

    -- Clean table
    SQL_TXT := ' CREATE TABLE CLEAN_ALL_SYS_MERGED NOLOGGING AS
              SELECT  (CASE WHEN M.msisdn_sv  IS NULL THEN msisdn_cs4 
                           WHEN M.msisdn_cs4  IS NULL THEN msisdn_sv
                           ELSE msisdn_sv END)  AS MSISDN_SYS, m.*
              FROM MERGE_SYS_SV_CS4 M
              WHERE (SUBSTR(M.IMSI,0,6) NOT IN ''415018''
              AND    SUBSTR(M.IMSI,0,6) NOT IN ''415018''             
              ) ';
                      
    IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_ALL_SYS_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
  
    IF UTILS_INTERFACES.CREATE_INDEX('CLEAN_ALL_SYS_MERGED',
                                     'FAFIF',
                                     'IX_MSISDN_SYSM',
                                     'MSISDN_SYS') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('CLEAN_ALL_SYS_MERGED',
                                     'FAFIF',
                                     'IX_PROD_SYSM',
                                     'PRODUCT_INSTANCE_ID') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


    IF UTILS_INTERFACES.CREATE_INDEX('CLEAN_ALL_SYS_MERGED',
                                     'FAFIF',
                                     'IX_SERV_SYSM',
                                     'SERV_BP_INT') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('CLEAN_ALL_SYS_MERGED',
                                     'FAFIF',
                                     'IX_DEA_SYSM',
                                     'DEALER_CODE_P') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


    -- HLRs Merge

    SQL_TXT := ' CREATE TABLE MERGE_HLR1_HLR2_1 NOLOGGING AS
          SELECT 
              DECODE(SUBSTR(SUBSTR(t.NUM_APPEL,4 ),1,1),7, SUBSTR(t.NUM_APPEL,4),3,''0''||(SUBSTR(t.NUM_APPEL,4 )),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN_HLR1,
               t.IMSI as IMSI_1,t.NUM_APPEL as NUM_APPEL_1, t.CFU as CFU_1, t.CFB as CFB_1, t.CFNRY as CFNRY_1, 
              t.CFNRC as CFNRC_1, t.SPN as SPN_1, t.CAW as CAW_1, t.HOLD as HOLD_1, t.MPTY as 
              MPTY_1, t.AOC as AOC_1, t.BAOC as BAOC_1, t.BOIC as BOIC_1, t.BOIEX as BOIEX_1, 
              t.BAIC as BAIC_1, t.BICRO as BICRO_1, t.CAT as CAT_1, t.OBO as OBO_1, t.OBI as 
              OBI_1, t.OBR as OBR_1, t.OBOPRI as OBOPRI_1, t.OBOPRE as OBOPRE_1, t.OBSSM as 
              OBSSM_1, t.OSB1 as OSB1_1, t.OSB2 as OSB2_1, t.OSB3 as OSB3_1, t.OSB4 as OSB4_1, 
              t.OFA as OFA_1, t.PWD as PWD_1, t.ICI as ICI_1, t.OIN as OIN_1, t.TIN as TIN_1, 
              t.CLIP as CLIP_1, t.CLIR as CLIR_1, t.COLP as COLP_1, t.COLR as COLR_1, t.SOCB 
              as SOCB_1, t.SOCFU as SOCFU_1, t.SOCFB as SOCFB_1, t.SOCFRY as SOCFRY_1, 
              t.SOCFRC as SOCFRC_1, t.SOCLIP as SOCLIP_1, t.SOCLIR as SOCLIR_1, t.SOCOLP as 
              SOCOLP_1, t.TS11 as TS11_1, t.TS21 as TS21_1, t.TS22 as TS22_1, t.TS62 as 
              TS62_1, t.TSD1 as TSD1_1, t.BS21 as BS21_1, t.BS22 as BS22_1, t.BS23 as BS23_1, 
              t.BS24 as BS24_1, t.BS25 as BS25_1, t.BS26 as BS26_1, t.BS31 as BS31_1, t.BS32 
              as BS32_1, t.BS33 as BS33_1, t.BS34 as BS34_1, t.DBSG as DBSG_1, t.TS61 as 
              TS61_1, t.CUG as CUG_1, t.REGSER as REGSER_1, t.PICI as PICI_1, t.DCF as DCF_1, 
              t.SODCF as SODCF_1, t.SOSDCF as SOSDCF_1, t.CAPL as CAPL_1, t.OICK as OICK_1, 
              t.TICK as TICK_1, t.NAM as NAM_1, t.TSMO as TSMO_1, t.REDUND as REDUND_1, t.OCSI 
              as OCSI_1, t.RSA as RSA_1, t.rm as rm_1,t.obp as obp_1, t.osmcsi as osmcsi_1,
              t.STYPE as STYPE_1, t.SCHAR as SCHAR_1, t.REDMCH as REDMCH_1, t.GPRCSI as GPRCSI_1,t.BS3G as BS3G_1,
              T.Date_Insertion_Hlr1,
              DECODE(SUBSTR(SUBSTR(TT.NUM_APPEL,4 ),1,1),7, SUBSTR(TT.NUM_APPEL,4 ),3,''0''||(SUBSTR(TT.NUM_APPEL,4 )),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN_HLR2,
              tt.IMSI as IMSI_2, tt.NUM_APPEL as NUM_APPEL_2, tt.CFU as CFU_2, tt.CFB as CFB_2, tt.CFNRY as CFNRY_2,
               tt.CFNRC as CFNRC_2, tt.SPN as SPN_2, tt.CAW as CAW_2, tt.HOLD as 
              HOLD_2, tt.MPTY as MPTY_2, tt.AOC as AOC_2, tt.BAOC as BAOC_2, tt.BOIC as 
              BOIC_2, tt.BOIEX as BOIEX_2, tt.BAIC as BAIC_2, tt.BICRO as BICRO_2, tt.CAT as 
              CAT_2, tt.OBO as OBO_2, tt.OBI as OBI_2, tt.OBR as OBR_2, tt.OBOPRI as OBOPRI_2, 
              tt.OBOPRE as OBOPRE_2, tt.OBSSM as OBSSM_2, tt.OSB1 as OSB1_2, tt.OSB2 as 
              OSB2_2, tt.OSB3 as OSB3_2, tt.OSB4 as OSB4_2, tt.OFA as OFA_2, tt.PWD as PWD_2, 
              tt.ICI as ICI_2, tt.OIN as OIN_2, tt.TIN as TIN_2, tt.CLIP as CLIP_2, tt.CLIR as 
              CLIR_2, tt.COLP as COLP_2, tt.COLR as COLR_2, tt.SOCB as SOCB_2, tt.SOCFU as 
              SOCFU_2, tt.SOCFB as SOCFB_2, tt.SOCFRY as SOCFRY_2, tt.SOCFRC as SOCFRC_2, 
              tt.SOCLIP as SOCLIP_2, tt.SOCLIR as SOCLIR_2, tt.SOCOLP as SOCOLP_2, tt.TS11 as 
              TS11_2, tt.TS21 as TS21_2, tt.TS22 as TS22_2, tt.TS62 as TS62_2, tt.TSD1 as 
              TSD1_2, tt.BS21 as BS21_2, tt.BS22 as BS22_2, tt.BS23 as BS23_2, tt.BS24 as 
              BS24_2, tt.BS25 as BS25_2, tt.BS26 as BS26_2, tt.BS31 as BS31_2, tt.BS32 as 
              BS32_2, tt.BS33 as BS33_2, tt.BS34 as BS34_2, tt.DBSG as DBSG_2, tt.TS61 as 
              TS61_2, tt.CUG as CUG_2, tt.REGSER as REGSER_2, tt.PICI as PICI_2, tt.DCF as 
              DCF_2, tt.SODCF as SODCF_2, tt.SOSDCF as SOSDCF_2, tt.CAPL as CAPL_2, tt.OICK as 
              OICK_2, tt.TICK as TICK_2, tt.NAM as NAM_2, tt.TSMO as TSMO_2, tt.REDUND as 
              REDUND_2, tt.OCSI as OCSI_2, tt.RSA as RSA_2,tt.rm as rm_2,tt.obp as obp_2,
              tt.osmcsi as osmcsi_2,tt.STYPE as STYPE_2, tt.SCHAR as SCHAR_2, tt.REDMCH as REDMCH_2, tt.GPRCSI as GPRCSI_2,tt.BS3G as BS3G_2,
              TT.DATE_INSERTION_HLR2 FROM HLR1 t, HLR2 TT WHERE  T.NUM_APPEL (+)= TT.NUM_APPEL ';


    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_HLR1_HLR2_1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    SQL_TXT := ' CREATE TABLE MERGE_HLR1_HLR2_2 NOLOGGING AS
          SELECT DECODE(SUBSTR(SUBSTR(t.NUM_APPEL,4 ),1,1),7, SUBSTR(t.NUM_APPEL,4),3,''0''||(SUBSTR(t.NUM_APPEL,4 )),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN_HLR1,
             t.IMSI as IMSI_1, t.NUM_APPEL as NUM_APPEL_1, t.CFU as CFU_1, t.CFB as CFB_1, t.CFNRY as CFNRY_1, 
            t.CFNRC as CFNRC_1, t.SPN as SPN_1, t.CAW as CAW_1, t.HOLD as HOLD_1, t.MPTY as 
            MPTY_1, t.AOC as AOC_1, t.BAOC as BAOC_1, t.BOIC as BOIC_1, t.BOIEX as BOIEX_1, 
            t.BAIC as BAIC_1, t.BICRO as BICRO_1, t.CAT as CAT_1, t.OBO as OBO_1, t.OBI as 
            OBI_1, t.OBR as OBR_1, t.OBOPRI as OBOPRI_1, t.OBOPRE as OBOPRE_1, t.OBSSM as 
            OBSSM_1, t.OSB1 as OSB1_1, t.OSB2 as OSB2_1, t.OSB3 as OSB3_1, t.OSB4 as OSB4_1, 
            t.OFA as OFA_1, t.PWD as PWD_1, t.ICI as ICI_1, t.OIN as OIN_1, t.TIN as TIN_1, 
            t.CLIP as CLIP_1, t.CLIR as CLIR_1, t.COLP as COLP_1, t.COLR as COLR_1, t.SOCB 
            as SOCB_1, t.SOCFU as SOCFU_1, t.SOCFB as SOCFB_1, t.SOCFRY as SOCFRY_1, 
            t.SOCFRC as SOCFRC_1, t.SOCLIP as SOCLIP_1, t.SOCLIR as SOCLIR_1, t.SOCOLP as 
            SOCOLP_1, t.TS11 as TS11_1, t.TS21 as TS21_1, t.TS22 as TS22_1, t.TS62 as 
            TS62_1, t.TSD1 as TSD1_1, t.BS21 as BS21_1, t.BS22 as BS22_1, t.BS23 as BS23_1, 
            t.BS24 as BS24_1, t.BS25 as BS25_1, t.BS26 as BS26_1, t.BS31 as BS31_1, t.BS32 
            as BS32_1, t.BS33 as BS33_1, t.BS34 as BS34_1, t.DBSG as DBSG_1, t.TS61 as 
            TS61_1, t.CUG as CUG_1, t.REGSER as REGSER_1, t.PICI as PICI_1, t.DCF as DCF_1, 
            t.SODCF as SODCF_1, t.SOSDCF as SOSDCF_1, t.CAPL as CAPL_1, t.OICK as OICK_1, 
            t.TICK as TICK_1, t.NAM as NAM_1, t.TSMO as TSMO_1, t.REDUND as REDUND_1, t.OCSI 
            as OCSI_1, t.RSA as RSA_1, t.rm as rm_1,t.obp as obp_1, t.osmcsi as osmcsi_1,
            t.STYPE as STYPE_1, t.SCHAR as SCHAR_1, t.REDMCH as REDMCH_1, t.GPRCSI as GPRCSI_1,t.BS3G AS BS3G_1,
            T.DATE_INSERTION_HLR1, 
            DECODE(SUBSTR(SUBSTR(TT.NUM_APPEL,4 ),1,1),7, SUBSTR(TT.NUM_APPEL,4),3,''0''||(SUBSTR(TT.NUM_APPEL,4 )),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MSISDN_HLR2,
            tt.IMSI as IMSI_2, tt.NUM_APPEL as NUM_APPEL_2, tt.CFU as CFU_2, tt.CFB as CFB_2, tt.CFNRY as CFNRY_2,
            tt.CFNRC as CFNRC_2, tt.SPN as SPN_2, tt.CAW as CAW_2, tt.HOLD as 
            HOLD_2, tt.MPTY as MPTY_2, tt.AOC as AOC_2, tt.BAOC as BAOC_2, tt.BOIC as 
            BOIC_2, tt.BOIEX as BOIEX_2, tt.BAIC as BAIC_2, tt.BICRO as BICRO_2, tt.CAT as 
            CAT_2, tt.OBO as OBO_2, tt.OBI as OBI_2, tt.OBR as OBR_2, tt.OBOPRI as OBOPRI_2, 
            tt.OBOPRE as OBOPRE_2, tt.OBSSM as OBSSM_2, tt.OSB1 as OSB1_2, tt.OSB2 as 
            OSB2_2, tt.OSB3 as OSB3_2, tt.OSB4 as OSB4_2, tt.OFA as OFA_2, tt.PWD as PWD_2, 
            tt.ICI as ICI_2, tt.OIN as OIN_2, tt.TIN as TIN_2, tt.CLIP as CLIP_2, tt.CLIR as 
            CLIR_2, tt.COLP as COLP_2, tt.COLR as COLR_2, tt.SOCB as SOCB_2, tt.SOCFU as 
            SOCFU_2, tt.SOCFB as SOCFB_2, tt.SOCFRY as SOCFRY_2, tt.SOCFRC as SOCFRC_2, 
            tt.SOCLIP as SOCLIP_2, tt.SOCLIR as SOCLIR_2, tt.SOCOLP as SOCOLP_2, tt.TS11 as 
            TS11_2, tt.TS21 as TS21_2, tt.TS22 as TS22_2, tt.TS62 as TS62_2, tt.TSD1 as 
            TSD1_2, tt.BS21 as BS21_2, tt.BS22 as BS22_2, tt.BS23 as BS23_2, tt.BS24 as 
            BS24_2, tt.BS25 as BS25_2, tt.BS26 as BS26_2, tt.BS31 as BS31_2, tt.BS32 as 
            BS32_2, tt.BS33 as BS33_2, tt.BS34 as BS34_2, tt.DBSG as DBSG_2, tt.TS61 as 
            TS61_2, tt.CUG as CUG_2, tt.REGSER as REGSER_2, tt.PICI as PICI_2, tt.DCF as 
            DCF_2, tt.SODCF as SODCF_2, tt.SOSDCF as SOSDCF_2, tt.CAPL as CAPL_2, tt.OICK as 
            OICK_2, tt.TICK as TICK_2, tt.NAM as NAM_2, tt.TSMO as TSMO_2, tt.REDUND as 
            REDUND_2, tt.OCSI as OCSI_2, tt.RSA as RSA_2,tt.rm as rm_2,tt.obp as obp_2,
            tt.osmcsi as osmcsi_2, 
            tt.STYPE as STYPE_2, tt.SCHAR as SCHAR_2, tt.REDMCH as REDMCH_2, tt.GPRCSI as GPRCSI_2,tt.BS3G AS BS3G_2,
            TT.DATE_INSERTION_HLR2 FROM HLR1 t, HLR2 TT WHERE T.NUM_APPEL = TT.NUM_APPEL(+)';

            
    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_HLR1_HLR2_2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    SQL_TXT := 'CREATE TABLE MERGE_HLR1_HLR2 NOLOGGING AS
                select * from MERGE_HLR1_HLR2_1 
                union
                SELECT * FROM MERGE_HLR1_HLR2_2';

    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_HLR1_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

 --************************** Update NULL values to 0 ************
 -- **************************************************************


    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OBO_1 = 0
                  WHERE HH.OBO_1 IS NULL';
                                

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                SET HH.OBI_1 = 0
                WHERE HH.OBI_1 IS NULL';
                                

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                SET HH.TICK_1 = 0
                WHERE HH.TICK_1 IS NULL';
                                

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
              SET HH.OBR_1 = 0
              WHERE HH.OBR_1 IS NULL';
                                

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;


    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OICK_1 = 0
                  WHERE HH.OICK_1 IS NULL';
                                

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;


    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.RSA_1 = 0
                  WHERE HH.RSA_1 IS NULL';
                                

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OBO_2 = 0
                  WHERE HH.OBO_2 IS NULL';
                                

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                SET HH.OBI_2 = 0
                WHERE HH.OBI_2 IS NULL';
                                

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                SET HH.TICK_2 = 0
                WHERE HH.TICK_2 IS NULL';
                                

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
              SET HH.OBR_2 = 0
              WHERE HH.OBR_2 IS NULL';
                                

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;


    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OICK_2 = 0
                  WHERE HH.OICK_2 IS NULL';
                                

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;


    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.RSA_2 = 0
                  WHERE HH.RSA_2 IS NULL';

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;

    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OBP_1 = 0
                  WHERE HH.OBP_1 IS NULL';

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;
    
    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.OBP_2 = 0
                  WHERE HH.OBP_2 IS NULL';

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;
    
    -- RSA for Roaming 17092010                      
    
    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.RSA_1 = 0
                  WHERE HH.RSA_1 IS NULL';

    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;
    
    SQL_TXT := 'UPDATE MERGE_HLR1_HLR2 HH
                  SET HH.RSA_2 = 0
                  WHERE HH.RSA_2 IS NULL';
                  
    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;
           
    COMMIT;

 --************************** END Update NULL values to 0 ************
 -- **************************************************************


    -- Report listing difference between MSISDNs on HLRs
    
 SQL_TXT := 'CREATE TABLE REP_HLRS_MIS_MSISDN NOLOGGING AS
              SELECT * FROM MERGE_HLR1_HLR2 HH
              WHERE HH.MSISDN_HLR1 IS NULL OR HH.MSISDN_HLR2 IS NULL';
                  
    IF UTILS_INTERFACES.CREATE_TABLE('REP_HLRS_MIS_MSISDN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  



-- Report listing difference between IMSIs on HLRs

 SQL_TXT := 'CREATE TABLE REP_HLRS_MIS_IMSI NOLOGGING AS
              SELECT * FROM MERGE_HLR1_HLR2 HH
              WHERE HH.MSISDN_HLR1 = HH.MSISDN_HLR2
              AND HH.MSISDN_HLR1 IS NOT NULL
              AND HH.IMSI_1<>HH.IMSI_2';
                  
    IF UTILS_INTERFACES.CREATE_TABLE('REP_HLRS_MIS_IMSI', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    -- Merge HLRs final table
    
     SQL_TXT := 'CREATE TABLE CLEAN_HLRS_MERGED NOLOGGING AS
                  SELECT  (CASE WHEN M.MSISDN_HLR1 IS NULL THEN M.MSISDN_HLR2 
                               WHEN M.MSISDN_HLR2  IS NULL THEN MSISDN_HLR1
                               ELSE M.MSISDN_HLR2
                               END)  AS MSISDN_HLRS, m.*
                  FROM MERGE_HLR1_HLR2 M
                  WHERE (SUBSTR(M.IMSI_1,0,6) NOT IN ''415018''
                  AND   SUBSTR(M.IMSI_2,0,6) NOT IN ''415018''
                  and    SUBSTR(M.msisdn_hlr1,0,2) NOT IN ''01''
                  and    SUBSTR(M.msisdn_hlr2,0,2) NOT IN ''01''
                  )
                  OR M.IMSI_1 IS NULL
                  OR M.IMSI_2 IS NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_HLRS_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  



    -- Merge SV, CS4, HLR1 and HLR2
    
     SQL_TXT := 'CREATE TABLE MERGE_SYS_HLRS AS
                  SELECT t.*, SUBSTR(tt.IMSI_1,0,6) as prim_flag,TT.* 
                  FROM CLEAN_ALL_SYS_MERGED t, CLEAN_HLRS_MERGED TT
                  WHERE T.MSISDN_SYS(+)=TT.MSISDN_HLRS
                  UNION
                  SELECT t.*, SUBSTR(tt.IMSI_1,0,6) as prim_flag ,TT.*  
                  FROM CLEAN_ALL_SYS_MERGED t, CLEAN_HLRS_MERGED TT
                  WHERE t.MSISDN_SYS =TT.MSISDN_HLRS(+)';

    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_SYS_HLRS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  



    -- Final Merge SV, CS4, HLR1 and HLR2

     SQL_TXT := 'CREATE TABLE REP_CLEAN_ALL_MERGED NOLOGGING AS
                  SELECT  (CASE WHEN M.MSISDN_SYS IS NULL THEN M.MSISDN_HLRS
                               WHEN M.MSISDN_HLRS  IS NULL THEN M.MSISDN_SYS
                               ELSE M.MSISDN_SYS END)  AS MSISDN , 
                          decode(prim_flag,''415012'', 1,''415019'',1,2) as primary_hlr,
                          (CASE WHEN M.MSISDN_SYS IS NULL THEN
                             (case when (to_number(M.MSISDN_HLRS) between 71900000 and 71999999) then ''SDP01'' 
                                   when (to_number(M.MSISDN_HLRS) between 71800000 and 71899999) then ''SDP02'' 
                                   when (to_number(M.MSISDN_HLRS) between 3000000  and 3999999)  then ''SDP01'' 
                                   when (to_number(M.MSISDN_HLRS) between 70000000 and 70999999) then ''SDP02''
                                   when (to_number(M.MSISDN_HLRS) between 71000000 and 71099999) then ''SDP02''
                                   when (to_number(M.MSISDN_HLRS) between 76100000 and 76199999) then ''SDP01''
                                   when (to_number(M.MSISDN_HLRS) between 71600000 and 71699999) then ''SDP02''
                                   when (to_number(M.MSISDN_HLRS) between 71700000 and 71799999) then ''SDP01''
                                   when (to_number(M.MSISDN_HLRS) between 76300000 and 76399999) then ''SDP01''
                                   when (to_number(M.MSISDN_HLRS) between 76400000 and 76499999) then ''SDP02''
                                   when (to_number(M.MSISDN_HLRS) between 76500000 and 76599999) then ''SDP01''
                                   when (to_number(M.MSISDN_HLRS) between 79100000 and 79199999) then ''SDP02''
                                   else ''SDP''
                               end)
                            WHEN M.MSISDN_HLRS  IS NULL THEN 
                            (case when (to_number(M.MSISDN_SYS) between 71900000 and 71999999) then ''SDP01'' 
                                  when (to_number(M.MSISDN_SYS) between 71800000 and 71899999) then ''SDP02'' 
                                  when (to_number(M.MSISDN_SYS) between 3000000  and 3999999)  then ''SDP01'' 
                                  when (to_number(M.MSISDN_SYS) between 70000000 and 70999999) then ''SDP02''
                                  when (to_number(M.MSISDN_SYS) between 71000000 and 71099999) then ''SDP02''
                                  when (to_number(M.MSISDN_SYS) between 76100000 and 76199999) then ''SDP01''
                                  when (to_number(M.MSISDN_SYS) between 71600000 and 71699999) then ''SDP02''
                                  when (to_number(M.MSISDN_SYS) between 71700000 and 71799999) then ''SDP01''
                                  when (to_number(M.MSISDN_SYS) between 76300000 and 76399999) then ''SDP01''
                                  when (to_number(M.MSISDN_SYS) between 76400000 and 76499999) then ''SDP02''
                                  when (to_number(M.MSISDN_SYS) between 76500000 and 76599999) then ''SDP01''
                                  when (to_number(M.MSISDN_SYS) between 79100000 and 79199999) then ''SDP02''
                                  else ''SDP''
                             end)
                            ELSE 
                            (case when (to_number(M.MSISDN_SYS) between 71900000 and 71999999) then ''SDP01'' 
                                  when (to_number(M.MSISDN_SYS) between 71800000 and 71899999) then ''SDP02'' 
                                  when (to_number(M.MSISDN_SYS) between 3000000  and 3999999)  then ''SDP01''
                                  when (to_number(M.MSISDN_SYS) between 70000000 and 70999999) then ''SDP02''
                                  when (to_number(M.MSISDN_SYS) between 71000000 and 71099999) then ''SDP02''
                                  when (to_number(M.MSISDN_SYS) between 76100000 and 76199999) then ''SDP01''
                                  when (to_number(M.MSISDN_SYS) between 71600000 and 71699999) then ''SDP02''
                                  when (to_number(M.MSISDN_SYS) between 71700000 and 71799999) then ''SDP01''
                                  when (to_number(M.MSISDN_SYS) between 76300000 and 76399999) then ''SDP01''
                                  when (to_number(M.MSISDN_SYS) between 76400000 and 76499999) then ''SDP02''
                                  when (to_number(M.MSISDN_SYS) between 76500000 and 76599999) then ''SDP01''
                                  when (to_number(M.MSISDN_SYS) between 79100000 and 79199999) then ''SDP02''
                                  else ''SDP''
                             end)
                         END) AS  SDP,     
                            m.*
                  FROM MERGE_SYS_HLRS M';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLEAN_ALL_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    IF UTILS_INTERFACES.CREATE_INDEX('REP_CLEAN_ALL_MERGED',
                                     'FAFIF',
                                     'IX_clean_all_msisdn',
                                     'msisdn') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


    IF UTILS_INTERFACES.CREATE_INDEX('REP_CLEAN_ALL_MERGED',
                                     'FAFIF',
                                     'IX_PRODUCT_INSTANCE_ID',
                                     'PRODUCT_INSTANCE_ID') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


   -- APN 1 SYS HLRs


     SQL_TXT := ' CREATE TABLE SYS_APN1 NOLOGGING AS
                  SELECT T.*
                  FROM REP_CLEAN_ALL_MERGED T  
                  WHERE EXISTS (SELECT 1 FROM APN_DATA_HLR1 H WHERE T.MSISDN = h.msisdn_apn1)';
                  
    IF UTILS_INTERFACES.CREATE_TABLE('SYS_APN1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;      


    IF UTILS_INTERFACES.CREATE_INDEX('SYS_APN1',
                                     'FAFIF',
                                     'IX_SYSAPN1_MSISDN',
                                     'msisdn') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;



     SQL_TXT := ' CREATE TABLE MERGE_SYS_APN1 NOLOGGING AS
                  SELECT T.*, 
                       (SELECT V.APN_ID_1 FROM APN_DATA_HLR1 V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 = 13) MBB_APN1, 
                       (SELECT V.APN_ID_1 FROM APN_DATA_HLR1 V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 = 12) BLACKBERRY_APN1,
                       (SELECT V.APN_ID_1 FROM APN_DATA_HLR1 V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 = 10) GPRS_INTRA_APN1,
                       (SELECT V.APN_ID_1 FROM APN_DATA_HLR1 V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 = 9) MMS_APN1,
                       (SELECT V.APN_ID_1 FROM APN_DATA_HLR1 V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 = 8) WAP_APN1,
                       (SELECT V.APN_ID_1 FROM APN_DATA_HLR1 V WHERE V.MSISDN_APN1 = T.MSISDN AND V.APN_ID_1 = 7) GPRS_APN1
                  FROM SYS_APN1 T';

    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_SYS_APN1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;      
    

    IF UTILS_INTERFACES.CREATE_INDEX('MERGE_SYS_APN1',
                                     'FAFIF',
                                     'IX_MERSYSAPN1_MSISDN',
                                     'msisdn') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

    -- APN HLR2

     SQL_TXT := ' CREATE TABLE SYS_APN2 NOLOGGING AS
                  SELECT T.*
                  FROM REP_CLEAN_ALL_MERGED T  
                  WHERE EXISTS (SELECT 1 FROM APN_DATA_HLR2 H WHERE T.MSISDN = h.msisdn_APN2)';
                  
    IF UTILS_INTERFACES.CREATE_TABLE('SYS_APN2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;      


    IF UTILS_INTERFACES.CREATE_INDEX('SYS_APN2',
                                     'FAFIF',
                                     'IX_SYSAPN1_MSISDN',
                                     'msisdn') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;



     SQL_TXT := ' CREATE TABLE MERGE_SYS_APN2 NOLOGGING AS
                  SELECT T.*, 
                       (SELECT V.APN_ID_2 FROM APN_DATA_HLR2 V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 = 13) MBB_APN2,
                       (SELECT V.APN_ID_2 FROM APN_DATA_HLR2 V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 = 12) BLACKBERRY_APN2,
                       (SELECT V.APN_ID_2 FROM APN_DATA_HLR2 V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 = 10) GPRS_INTRA_APN2,
                       (SELECT V.APN_ID_2 FROM APN_DATA_HLR2 V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 = 9) MMS_APN2,
                       (SELECT V.APN_ID_2 FROM APN_DATA_HLR2 V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 = 8) WAP_APN2,
                       (SELECT V.APN_ID_2 FROM APN_DATA_HLR2 V WHERE V.MSISDN_APN2 = T.MSISDN AND V.APN_ID_2 = 7) GPRS_APN2
                  FROM SYS_APN2 T';

    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_SYS_APN2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;      


    IF UTILS_INTERFACES.CREATE_INDEX('MERGE_SYS_APN2',
                                     'FAFIF',
                                     'IX_MERSYSAPN2_MSISDN',
                                     'msisdn') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


 -- FA 30032010
 -- ############ Reporting mismatches for data companion products between HLRs (no next action required)
 
      SQL_TXT := 'CREATE TABLE rep_apn_mismatch NOLOGGING AS 
                  select  t.account_name, t.service_type_name,t.msisdn, t.service_name, t.blackberry_apn1, t.gprs_intra_apn1, t.mms_apn1, t.wap_apn1, t.gprs_apn1,t.mbb_apn1,
                          tt.msisdn AS msisdn2, tt.blackberry_apn2, tt.gprs_intra_apn2, tt.mms_apn2, tt.wap_apn2, tt.gprs_apn2, tt.mbb_apn2
                    from merge_sys_apn1 t, merge_sys_apn2 tt
                   WHERE t.msisdn = tt.msisdn
                     AND (nvl(t.blackberry_apn1,0) <> nvl(tt.blackberry_apn2,0)
                      OR nvl(t.gprs_intra_apn1,0) <> nvl(tt.gprs_intra_apn2,0)
                      OR nvl(t.mms_apn1,0) <> nvl(tt.mms_apn2,0)
                      OR nvl(t.wap_apn1,0) <>nvl(tt.wap_apn2,0)
                      OR nvl(t.gprs_apn1,0)<>nvl(tt.gprs_apn2,0)
                      OR nvl(t.gprs_apn1,0)<>nvl(tt.gprs_apn2,0)
                      OR nvl(t.mbb_apn1,0)<>nvl(tt.mbb_apn2,0))';

    IF UTILS_INTERFACES.CREATE_TABLE('rep_apn_mismatch', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;      

 -- FA 30032010
 -- ############ Reporting mismatches for Call Forward between HLRs (no next action required)
 
       SQL_TXT := 'CREATE TABLE rep_call_fwd_mismatch NOLOGGING AS 
                  SELECT decode((SUBSTR(t.IMSI_1,0,6)),''415012'', 1,2) as primary_hlr,
                         t.msisdn_hlr1, t.imsi_1, t.msisdn_hlr2, t.imsi_2,
                         t.CFU_1,t.CFU_2,T.CFB_1,T.CFB_2,T.CFNRY_1,T.CFNRY_2,
                         T.CFNRC_1, T.CFNRC_2
                      FROM MERGE_HLR1_HLR2 t
                     WHERE NVL(t.CFU_1, 0) <> NVL(T.CFU_2, 0)
                        OR NVL(T.CFB_1, 0) <> NVL(T.CFB_2, 0)
                        OR NVL(T.CFNRY_1, 0) <> NVL(T.CFNRY_2, 0)
                        OR NVL(T.CFNRC_1, 0) <> NVL(T.CFNRC_2, 0)';

    IF UTILS_INTERFACES.CREATE_TABLE('rep_call_fwd_mismatch', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;      

 
  -- FA 30032010
 -- ############ Reporting mismatches for Call barring between HLRs (no next action required)
 
       SQL_TXT := 'CREATE TABLE rep_call_bar_mismatch NOLOGGING AS 
                    SELECT t.msisdn_hlr1, t.imsi_1, t.msisdn_hlr2, t.imsi_2,
                           t.BAOC_1,t.BAOC_2,T.BOIC_1,T.BOIC_2,T.BOIEX_1,T.BOIEX_2,
                           T.BAIC_1, T.BAIC_2, T.BICRO_1,T.BICRO_2, T.SOCB_1, T.SOCB_2
                      FROM MERGE_HLR1_HLR2 t
                      WHERE NVL(T.BAOC_1, 0) <> NVL(T.BAOC_2, 0)
                         OR NVL(T.BAOC_1, 0) <> NVL(T.BAOC_2, 0)
                         OR NVL(T.BOIEX_1, 0) <> NVL(T.BOIEX_2, 0)
                         OR NVL(T.BAIC_1, 0) <> NVL(T.BAIC_2, 0)
                         OR NVL(T.BICRO_1, 0) <> NVL(T.BICRO_2, 0)
                         OR NVL(T.SOCB_1, 0) <> NVL(T.SOCB_2, 0)';

    IF UTILS_INTERFACES.CREATE_TABLE('rep_call_bar_mismatch', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;      


  -- FA 13102010
  -- ############ Export Data for ADM system
 
 
        SQL_TXT := 'CREATE TABLE REP_ADM_DMP_HLR1 NOLOGGING AS
                      select t.msisdn, t.imsi, decode(a.apn_id_1,3,''Data Card'',4,''Data Card'', 7,''GPRS'', 8, ''WAP'', 9, ''MMS'', 10, ''GPRS INTRA'', 12, ''Blackberry'', 13, ''Mobile BroadBand'',5,''Other'',11,''Other'',NULL) AS Companion_Product,
                       t.service_type_name 
                      from REP_CLEAN_ALL_MERGED t, APN_DATA_HLR1 a
                      WHERE a.msisdn_apn1 = t.msisdn
                      AND t.primary_hlr = 1';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_ADM_DMP_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;    

    -- HLR2

        SQL_TXT := 'CREATE TABLE REP_ADM_DMP_HLR2 NOLOGGING AS
                    select t.msisdn, t.imsi, decode(a.apn_id_2,3,''Data Card'',4,''Data Card'', 7,''GPRS'', 8, ''WAP'', 9, ''MMS'', 10, ''GPRS INTRA'', 12, ''Blackberry'', 13, ''Mobile BroadBand'',5,''Other'',11,''Other'',NULL) AS Companion_Product,
                     t.service_type_name 
                    from REP_CLEAN_ALL_MERGED t, APN_DATA_HLR2 a
                    WHERE a.msisdn_apn2 = t.msisdn
                    AND t.primary_hlr = 2';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_ADM_DMP_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;    


    -- Merge APN tables

        SQL_TXT := 'CREATE TABLE UNION_APNS NOLOGGING AS 
                      SELECT ss.* FROM REP_ADM_DMP_HLR1 ss
                      UNION 
                      SELECT vv.* FROM REP_ADM_DMP_HLR2 vv';

    IF UTILS_INTERFACES.CREATE_TABLE('UNION_APNS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    -- Merge APN with SV

        SQL_TXT := 'CREATE TABLE REP_APN_SYS_ALL NOLOGGING AS
                SELECT AA.MSISDN, AA.IMSI, AA.COMPANION_PRODUCT, AA.SERVICE_TYPE_NAME FROM UNION_APNS AA
                UNION 
                SELECT MM.MSISDN, MM.IMSI, NULL, MM.SERVICE_TYPE_NAME FROM REP_CLEAN_ALL_MERGED MM
                WHERE mm.service_status <> ''Cancelled''';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_APN_SYS_ALL', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    -- Report Duplicates

        SQL_TXT := 'CREATE TABLE list_null_cp_group NOLOGGING AS
                  SELECT t.msisdn, COUNT (t.msisdn) AS count_NUM FROM rep_apn_sys_all t
                  GROUP BY t.msisdn
                  HAVING COUNT (t.msisdn) >1';

    IF UTILS_INTERFACES.CREATE_TABLE('list_null_cp_group', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  


    -- Remove duplicates from REP_APN_SYS_ALL

        SQL_TXT := 'DELETE FROM REP_APN_SYS_ALL T
                    WHERE T.MSISDN IN (SELECT V.MSISDN FROM LIST_NULL_CP_GROUP V)
                    AND T.COMPANION_PRODUCT IS NULL';

    IF UTILS_INTERFACES.DELETE_TABLE (SQL_TXT) = 0 THEN
      RAISE TABLE_INSERT_FAILED;
    END IF;

    -- 'reconciliation'||'_'||CURRENT_DATE||'.csv'
    fafif.reconciliation_interfaces.EXPORT_TABLE_TO_ADM_TXT ('FAFIF','REP_APN_SYS_ALL');

    CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

    DBAUSER.P_FTP('192.168.41.13','ftp_prov','123Prov','OUTPUT_BOPS','reconciliation_'||CURRENT_DATE||'.csv','reconciliation_'||CURRENT_DATE||'.txt');

    --runos.P_FTP('192.168.41.13','ftp_prov','123Prov','OUTPUT_BOPS','reconciliation_'||CURRENT_DATE||'.csv','reconciliation_'||CURRENT_DATE||'.txt');

    -- END FA 13102010

--END IF;

 EXCEPTION
 WHEN OTHERS THEN
 NULL;
 
/*   WHEN EMPTY_ERROR THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_61_TABLE_EMPTY'),
                                        SQLERRM,
                                        SAS_TABLE,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'EMPTY_TABLE');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_3_SUCCESS');
    WHEN TABLE_CREATION_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_73_TABLE_CREATION_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN TABLE_UPDATE_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_18_TABLE_UPDATE_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN TABLE_INSERT_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_14_TABLE_INSERT_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN INDEX_CREATION_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_25_INDEX_CREATION_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN FATAL_ERROR THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_22_FATAL_ERROR'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN TABLE_DROP_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_94_TABLE_DROP_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');
*/


    
  END P1_MAIN_SYS_INTERFACES_OLD;

PROCEDURE P1_HLR_RECON_MONTH_INTERFACES(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS

   -- variables
 --================================================================================================================
    -- sql_txt : contains the sql statment body
    --================================================================================================================
    
    SQL_TXT             VARCHAR2(4000);
    RELEASE              VARCHAR2(20)    := 'R1.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;
    

    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);




  BEGIN
  
      UTILS_INTERFACES.INTERFACE_NAME := 'P1_HLR_RECON_MONTH_INTERFACES';
      
       -- UPDATE Null Values with 0 for Reconcilition HLR1/HLR2
    SQL_TXT := 'UPDATE rep_clean_all_merged HH
                  SET HH.CFU_1 = 0
                  WHERE HH.CFU_1 IS NULL';
                  
    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;
    
    SQL_TXT := 'UPDATE rep_clean_all_merged HH
                  SET HH.CFU_2 = 0
                  WHERE HH.CFU_2 IS NULL';
                  
    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;
    
     SQL_TXT := 'UPDATE rep_clean_all_merged HH
                  SET HH.CFB_1 = 0
                  WHERE HH.CFB_1 IS NULL';
                  
    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;
    
    SQL_TXT := 'UPDATE rep_clean_all_merged HH
                  SET HH.CFB_2 = 0
                  WHERE HH.CFB_2 IS NULL';
                  
    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;
               
     SQL_TXT := 'UPDATE rep_clean_all_merged HH
                  SET HH.CFNRY_1 = 0
                  WHERE HH.CFNRY_1 IS NULL';
                  
    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;
    
    SQL_TXT := 'UPDATE rep_clean_all_merged HH
                  SET HH.CFNRY_2 = 0
                  WHERE HH.CFNRY_2 IS NULL';
                  
    IF UTILS_INTERFACES.UPDATE_TABLE(SQL_TXT) = 0 THEN
      RAISE TABLE_UPDATE_FAILED;
    END IF;
    
    COMMIT;

      SQL_TXT := 'create table RECON_NAM_PRIM_HLR1_RUN_HLR2 NOLOGGING AS 
                  select decode (t.nam_1, 0, ''HGSNC:MSISDN=961''||to_number(t.MSISDN)||'',NAM=0;'', 1,''HGSNC:MSISDN=961''||to_number(t.MSISDN)||'',NAM=1,KEEP;'') AS CMD_ON_HLR2,
                  t.msisdn, t.primary_hlr, t.service_type_name, t.nam_1, t.nam_2 from rep_clean_all_merged t
                  WHERE t.nam_1 <> t.nam_2
                  AND t.primary_hlr = 1';

      IF UTILS_INTERFACES.CREATE_TABLE('RECON_NAM_PRIM_HLR1_RUN_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
      

      SQL_TXT := 'create table RECON_NAM_PRIM_HLR2_RUN_HLR1 NOLOGGING AS 
                  select decode (t.nam_2, 0, ''HGSNC:MSISDN=961''||to_number(t.MSISDN)||'',NAM=0;'', 1,''HGSNC:MSISDN=961''||to_number(t.MSISDN)||'',NAM=1,KEEP;'') AS CMD_ON_HLR2,
                  t.msisdn, t.primary_hlr, t.service_type_name, t.nam_1, t.nam_2 from rep_clean_all_merged t
                  WHERE t.nam_1 <> t.nam_2
                  AND t.primary_hlr = 2';

      IF UTILS_INTERFACES.CREATE_TABLE('RECON_NAM_PRIM_HLR2_RUN_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
      
           
  

END P1_HLR_RECON_MONTH_INTERFACES;

PROCEDURE P2_POST_PREP_SERV_INTERFACES(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS
  

    -- =============================================================================================
    --    Pre-requisite               : SV DMP
    --    Release                     : R1.0
    --    Date                        : 31/10/2009
    --    Author                      : FAF
    --    Requirement  version        : V1.0
    --    Comments                    : Reconciliation CPs
    --   ------------------------------------------------------------------------------------------- 
    
    
    --================================================================================================================
    -- sql_txt : contains the sql statment body
    --================================================================================================================
    SQL_TXT             VARCHAR2(4000);
    RELEASE              VARCHAR2(20)    := 'R1.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;
    

    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);




  BEGIN


    UTILS_INTERFACES.INTERFACE_NAME := 'P2_POST_PREP_SERV_INTERFACES';


    --########## FAF: 04-11-2009--- ########################
    --########## Reports ###################################
    --########## ------- ###################################
    --########## ------- ###################################


    -- Provisioning Required statuses for BOPs

     SQL_TXT := 'CREATE TABLE REP_REQUIR_STATUSES NOLOGGING AS
                  SELECT c.*
                  FROM REP_CLEAN_ALL_MERGED C
                  WHERE C.SERVICE_STATUS LIKE ''%Required%''';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_REQUIR_STATUSES', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    -- Provisioning FAILED statuses for COPs

     SQL_TXT := 'CREATE TABLE REP_FAILED_STATUS NOLOGGING AS
                  SELECT c.*
                  FROM REP_CLEAN_ALL_MERGED C
                  WHERE C.SERVICE_STATUS LIKE ''%Failed%''';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_FAILED_STATUS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    -- Postp SV in CS4
    -- MSISDNs to be removed from CS4 - 27052010

     SQL_TXT := 'CREATE TABLE REP_POST_SV_PREP_CS4 NOLOGGING AS
                  select * from rep_clean_all_merged t
                  WHERE t.service_name = t.msisdn_cs4
                  AND t.service_type_name = ''Voice''
                  AND t.service_status <> ''Cancelled''
                  AND t.msisdn_cs4 IS NOT NULL
                  AND t.cust_class NOT IN (''06'',''07'')';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_PREP_CS4', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    -- HLR1

     SQL_TXT := 'CREATE TABLE REP_MSISDN_HLR_NOT_IN_BIL_1 NOLOGGING AS 
                 SELECT t.msisdn_hlr1, t.imsi_1, t.msisdn, t.MSISDN_SV, t.imsi AS imsi_sv
                   FROM rep_clean_all_merged t
                  WHERE t.msisdn_hlr1 IS NOT NULL
                  AND t.msisdn_sv IS NULL
                  ';
    
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MSISDN_HLR_NOT_IN_BIL_1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
  
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MSISDN_HLR_NOT_IN_BIL_1','DELETE','CLASSIC','1');

    -- HLR2
    
      SQL_TXT := 'CREATE TABLE REP_MSISDN_HLR_NOT_IN_BIL_2 NOLOGGING AS 
                 SELECT t.msisdn_hlr2, t.imsi_2, t.msisdn, t.MSISDN_SV, t.imsi AS imsi_sv
                   FROM rep_clean_all_merged t
                  WHERE t.msisdn_hlr2 IS NOT NULL
                  AND t.msisdn_sv IS NULL
                  ';
               
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MSISDN_HLR_NOT_IN_BIL_2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MSISDN_HLR_NOT_IN_BIL_2','DELETE','CLASSIC','2');
       
    -- Prep SV Post HLR1 --> Fraud

     SQL_TXT := 'CREATE TABLE REP_PREP_SV_POST_HLR_1 NOLOGGING AS
                  SELECT *                                 
                  FROM REP_CLEAN_ALL_MERGED M                      
                  WHERE M.SERVICE_STATUS NOT IN (''Cancelled'', ''Moved'')        
                    AND M.SERVICE_TYPE_NAME = ''Prepaid''                
                    AND (m.OICK_1 <> 100 OR m.OICK_1 = 0)
                    AND M.MSISDN_HLR1 = M.MSISDN_SYS
                    AND M.msisdn_cs4 IS NOT NULL
                    AND M.SERVICE_NAME NOT IN (
                                               ''70283708'',
                                               ''79112769'',
                                               ''79112769'',''71631594''
                                               
                                               )
                    AND M.SERVICE_NAME NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''PREPAID'',''ALL''))'; 

                  
    IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_POST_HLR_1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_POST_HLR_1','DELETE','CLASSIC','1');
    -- Prep SV Post HLR2 --> Fraud

     SQL_TXT := 'CREATE TABLE REP_PREP_SV_POST_HLR_2 NOLOGGING AS
                  SELECT *                                 
                  FROM REP_CLEAN_ALL_MERGED M                      
                  WHERE M.SERVICE_STATUS NOT IN (''Cancelled'', ''Moved'')        
                    AND M.SERVICE_TYPE_NAME = ''Prepaid''                
                    AND (M.OICK_2 <> 100 OR M.OICK_2 = 0)
                    AND M.MSISDN_HLR2= m.msisdn_sys
                    AND M.msisdn_cs4 IS NOT NULL
                    AND M.SERVICE_NAME NOT IN (
                                               ''70283708'',
                                             ''79112769'',''71631594''
                                             )
                    AND M.SERVICE_NAME NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''PREPAID'',''ALL''))';
                

    IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_POST_HLR_2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_POST_HLR_2','DELETE','CLASSIC','2');
    -- IMSI Mismatches between SV and HLRs --> Fraud Opportunity Risk
/*
         SQL_TXT := 'CREATE TABLE REP_MIS_IMSIS_FULL_RECON NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.IMSI <> HH.IMSI_1
                      OR HH.IMSI <>HH.IMSI_2';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MIS_IMSIS_FULL_RECON', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
*/

      -- HLR1

         SQL_TXT := 'CREATE TABLE REP_MIS_IMSIS_FULL_RECON_1 NOLOGGING AS
                      SELECT hh.msisdn, hh.imsi AS imsi_sv, hh.imsi_1,HH.product_type_name 
                        FROM REP_CLEAN_ALL_MERGED HH
                      WHERE hh.msisdn = hh.msisdn_hlr1
                        AND HH.IMSI <> HH.IMSI_1';
                        /*AND HH.MSISDN <> ''76101255''';*/
                        /*AND HH.msisdn <>''70343889''';*/

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MIS_IMSIS_FULL_RECON_1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MIS_IMSIS_FULL_RECON_1','CHANGE_MSISDN_IMSI','CLASSIC','1');
      -- HLR2

         SQL_TXT := 'CREATE TABLE REP_MIS_IMSIS_FULL_RECON_2 NOLOGGING AS
                      SELECT hh.msisdn, hh.imsi AS imsi_sv, hh.imsi_2,HH.product_type_name
                        FROM REP_CLEAN_ALL_MERGED HH
                       WHERE hh.msisdn = hh.msisdn_hlr2
                         AND HH.IMSI <>HH.IMSI_2';
                         /*AND HH.MSISDN <> ''76101255''';*/
                         /*AND HH.msisdn <>''70343889''';*/

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MIS_IMSIS_FULL_RECON_2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MIS_IMSIS_FULL_RECON_2','CHANGE_MSISDN_IMSI','CLASSIC','2');

    -- Cancelled SV and Existing on HLR --> Fraud

         SQL_TXT := 'CREATE TABLE REP_CANC_SV_IN_HLR NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Cancelled''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.MSISDN_HLR1 IS NOT NULL';
                      /*AND HH.MSISDN_SYS <> ''76101255''';*/
                     /* AND HH.MSISDN_SYS <>''70343889''';*/

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CANC_SV_IN_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_CANC_SV_IN_HLR','DELETE','CLASSIC','1');
    
         SQL_TXT := 'CREATE TABLE REP_CANC_SV_IN_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Cancelled''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.MSISDN_HLR2 IS NOT NULL';
                      /*AND HH.MSISDN_SYS <> ''76101255''';*/
                     /* AND HH.MSISDN_SYS <>''70343889''';*/

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CANC_SV_IN_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_CANC_SV_IN_HLR2','DELETE','CLASSIC','2');
        -- NOT Cancelled SV and not Existing on HLR --> Revenue opportunity Loss
                    
         SQL_TXT := 'CREATE TABLE REP_NOT_CANC_SV_NOT_IN_HLR NOLOGGING AS
                    SELECT * FROM REP_CLEAN_ALL_MERGED HH
                    WHERE HH.SERVICE_STATUS not in (''Cancelled'',''Cancellation Failed'', ''Cancellation Required'')
                    AND HH.MSISDN_HLRS IS NULL
                    AND HH.MSISDN_SV IS NOT NULL
                    and HH.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')';
                 

    IF UTILS_INTERFACES.CREATE_TABLE('REP_NOT_CANC_SV_NOT_IN_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_NOT_CANC_SV_NOT_IN_HLR','CREATE_ACTIVATE','CLASSIC','1');
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_NOT_CANC_SV_NOT_IN_HLR','CREATE_ACTIVATE','ACTIVE','2');
    
     SQL_TXT := 'CREATE TABLE REP_PREP_SV_NOT_IN_HLR1 NOLOGGING AS
                  SELECT * FROM REP_CLEAN_ALL_MERGED HH
                  where Service_Type_Name = ''Prepaid''
                  and HH.SERVICE_STATUS not in (''Cancelled'',''Cancellation Failed'',''Cancellation Required'')
                  AND HH.MSISDN_HLR1 IS NULL
                  AND HH.MSISDN_SV IS NOT NULL';
                    
               
    IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_NOT_IN_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_NOT_IN_HLR1','CREATE_ACTIVATE','ACTIVE','1');
    
    SQL_TXT := 'CREATE TABLE REP_PREP_SV_NOT_IN_HLR2 NOLOGGING AS
                  SELECT * FROM REP_CLEAN_ALL_MERGED HH
                  where Service_Type_Name = ''Prepaid''
                  and HH.SERVICE_STATUS not in (''Cancelled'',''Cancellation Failed'',''Cancellation Required'')
                  AND HH.MSISDN_HLR2 IS NULL
                  AND HH.MSISDN_SV IS NOT NULL';
                    
               
    IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_NOT_IN_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_NOT_IN_HLR2','CREATE_ACTIVATE','ACTIVE','2');
    
--*****************************************************
--Active SV - Barred HLR --> Revenue opportunity Loss
--*****************************************************

      -- Postpaid: Barred Out HLR1, Active SV

         SQL_TXT := 'CREATE TABLE REP_SV_ACT_BARO_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.OBO_1 =1
                      AND HH.OICK_1=300';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_ACT_BARO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_ACT_BARO_HLR1','UNSUSPEND_BAR_OUT','CLASSIC','1');


   -- Postpaid: Barred Out HLR2, Active SV
   -- FAF: Rem: Check for NAM = 1 considering number is Active having MMS/GPRS/WAP CPs Active, DATA Card Service

         SQL_TXT := 'CREATE TABLE REP_SV_ACT_BARO_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.OBO_2 =1
                      AND HH.OICK_2=300';
                  
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_ACT_BARO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_ACT_BARO_HLR2','UNSUSPEND_BAR_OUT','CLASSIC','2');

    -- Postpaid: Barred In/Out HLR1, Active SV


         SQL_TXT := 'CREATE TABLE REP_SV_ACT_BARIO_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.OBO_1 =1
                      AND HH.OBI_1 = 1
                      AND HH.SERV_REASON_CODE <> 46
                      UNION
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.OBO_1 = 1
                      AND HH.OBI_1 = 1
                      AND HH.TICK_1 = 5
                      AND HH.SERV_REASON_CODE = 46
                      AND HH.OICK_1= 300 ';

                  
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_ACT_BARIO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_ACT_BARIO_HLR1','UNSUSPEND_BAR_IN_OUT','CLASSIC','1');

-- Postpaid: Barred In Out HLR2, Active SV

         SQL_TXT := 'CREATE TABLE REP_SV_ACT_BARIO_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.OBO_2 =1
                      AND HH.OBI_2 = 1
                      AND HH.SERV_REASON_CODE <> 46
                      UNION
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.OBO_2 = 1
                      AND HH.OBI_2 = 1
                      AND HH.TICK_2 = 5
                      AND HH.SERV_REASON_CODE = 46
                      AND HH.OICK_2=300'; --(2)
                  
              IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_ACT_BARIO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
                RAISE TABLE_CREATION_FAILED;
              END IF;  
    
              RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_ACT_BARIO_HLR2','UNSUSPEND_BAR_IN_OUT','CLASSIC','2');




    -- Postpaid: Suspended - Active HLR1 --> Fraud

         SQL_TXT := 'CREATE TABLE REP_POST_SV_SUSP_ACT_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''%Suspended - Bar In & Out%''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.OBO_1 <> 1 
                      AND  HH.OBI_1 <> 1
                      AND HH.TICK_1 <>5';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_SUSP_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

          RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_SUSP_ACT_HLR1','SUSPEND_BAR_OUT','CLASSIC','1');

  
    -- Postpaid: Suspended - Active HLR2 --> Fraud

         SQL_TXT := 'CREATE TABLE REP_POST_SV_SUSP_ACT_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''%Suspended - Bar In & Out%''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.OBO_2 <> 1 
                      AND HH.OBI_2 <> 1
                      AND HH.TICK_2 <>5';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_SUSP_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
    
          RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_SUSP_ACT_HLR2','SUSPEND_BAR_OUT','CLASSIC','2');

-- Added by julie 22-03-2011
 -- Postpaid: Suspended Network Disconnect- Active HLR1 --> Fraud

    SQL_TXT := 'CREATE TABLE REP_POST_SV_NETDISC_ACT_HLR1 NOLOGGING AS
                    SELECT * FROM REP_CLEAN_ALL_MERGED HH
                    WHERE HH.SERVICE_STATUS LIKE ''%Suspended - Network Disconnect%''
                    AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                    AND HH.SERVICE_TYPE_NAME = ''Voice''
                    AND (HH.OBO_1 <> 1 
                    OR  HH.OBI_1 <> 1
                    OR  HH.NAM_1 <> 1)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_NETDISC_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_NETDISC_ACT_HLR1','SUSPEND_NETWK_DISC','CLASSIC','1');

-- Postpaid: Suspended Network Disconnect- Active HLR2 --> Fraud

    SQL_TXT := 'CREATE TABLE REP_POST_SV_NETDISC_ACT_HLR2 NOLOGGING AS
                    SELECT * FROM REP_CLEAN_ALL_MERGED HH
                    WHERE HH.SERVICE_STATUS LIKE ''%Suspended - Network Disconnect%''
                    AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                    AND HH.SERVICE_TYPE_NAME = ''Voice''
                    AND (HH.OBO_2 <> 1 
                    OR  HH.OBI_2 <> 1
                    OR  HH.NAM_1 <> 1)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_NETDISC_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

   RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_NETDISC_ACT_HLR2','SUSPEND_NETWK_DISC','CLASSIC','2');

-- Postpaid: Suspended Bar In OUT  Reason Code = Non Voluntary - Active HLR1 --> Fraud

     SQL_TXT := 'CREATE TABLE REP_POST_SV_SP_IO_NV_ACT_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar In & Out''
                      AND HH.SERVICE_REASON_NAME not in (''Voluntary'',''Temporary'')
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_1 <> 1 
                      OR  HH.OBI_1 <> 1)';
                      --OR  HH.TICK_1 <>0)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_SP_IO_NV_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

   RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_SP_IO_NV_ACT_HLR1','SUSPEND_BAR_IN_OUT','CLASSIC','1');

-- Postpaid: Suspended Bar In OUT Reason Code = Non Voluntary - Active HLR2 --> Fraud

     SQL_TXT := 'CREATE TABLE REP_POST_SV_SP_IO_NV_ACT_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar In & Out''
                       AND HH.SERVICE_REASON_NAME not in (''Voluntary'',''Temporary'')
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_2 <> 1 
                      OR  HH.OBI_2 <> 1)';
                      --OR  HH.TICK_2 <>0)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_SP_IO_NV_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

   RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_SP_IO_NV_ACT_HLR2','SUSPEND_BAR_IN_OUT','CLASSIC','2');

-- Postpaid: Suspended Bar In OUT Reason Code = Voluntary - Active HLR1 --> Fraud
       
       SQL_TXT := 'CREATE TABLE REP_POST_IOV_ACT_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar In & Out''
                      AND HH.SERVICE_REASON_NAME in (''Voluntary'',''Temporary'')
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_1 <> 1 
                      OR  HH.OBI_1 <> 0
                      OR  HH.TICK_1 <>5)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_IOV_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 
  RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_IOV_ACT_HLR1','SUSPEND_BAR_IN_OUT','CLASSIC','1');

-- Postpaid: Suspended Bar In OUT Reason Code = Voluntary - Active HLR2 --> Fraud
       
       SQL_TXT := 'CREATE TABLE REP_POST_IOV_ACT_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar In & Out''
                      AND HH.SERVICE_REASON_NAME in (''Voluntary'',''Temporary'')
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_2 <> 1 
                      OR  HH.OBI_2 <> 0
                      OR  HH.TICK_2 <>5)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_IOV_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 
          
 RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_IOV_ACT_HLR2','SUSPEND_BAR_IN_OUT','CLASSIC','2');

-- CHANGES DONE IN 17/12/2014
/*-- Postpaid: Suspended Bar Out - Active HLR1 --> Fraud
  
       SQL_TXT := 'CREATE TABLE REP_POST_SV_BOUT_ACT_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar Out''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_1 <> 1 
                      OR  HH.OBI_1 <> 0
                      OR  HH.TICK_1 = 5)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_BOUT_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 
          
 RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_BOUT_ACT_HLR1','SUSPEND_BAR_OUT','CLASSIC','1');

-- Postpaid: Suspended Bar Out - Active HLR2 --> Fraud
  
       SQL_TXT := 'CREATE TABLE REP_POST_SV_BOUT_ACT_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar Out''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_2 <> 1 
                      OR  HH.OBI_2 <> 0
                      OR  HH.TICK_2 = 5)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_BOUT_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 
          
  RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_BOUT_ACT_HLR2','SUSPEND_BAR_OUT','CLASSIC','2');*/

-- Postpaid: Suspended Bar In - Active HLR1 --> Fraud

      SQL_TXT := 'CREATE TABLE REP_POST_SV_BIN_ACT_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar In''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_1 = 1 
                      OR  HH.OBI_1 <> 1
                      OR  HH.TICK_1 = 5)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_BIN_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_BIN_ACT_HLR1','SUSPEND_BAR_IN','CLASSIC','1');
    
-- Postpaid: Suspended Bar In - Active HLR2 --> Fraud

      SQL_TXT := 'CREATE TABLE REP_POST_SV_BIN_ACT_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar In''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_2 = 1 
                      OR  HH.OBI_2 <> 1
                      OR  HH.TICK_2 = 5)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_BIN_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_BIN_ACT_HLR2','SUSPEND_BAR_IN','CLASSIC','2');

--End Added By Julie

     -- Prepaid: Suspended - Active HLR1 --> Fraud

         SQL_TXT := 'CREATE TABLE REP_PREP_SV_SUSP_ACT_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''%Suspended%''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Prepaid''
                      AND HH.MSISDN_CS4 IS NOT NULL
                      AND HH.OBO_1 <> 1 
                      AND HH.OBI_1 <> 1';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_SUSP_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
          RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_SUSP_ACT_HLR1','SUSPEND_BAR_OUT','ACTIVE','1');

     -- Prepaid: Suspended - Active HLR2 --> Fraud

         SQL_TXT := 'CREATE TABLE REP_PREP_SV_SUSP_ACT_HLR2 NOLOGGING AS
                    SELECT * FROM REP_CLEAN_ALL_MERGED HH
                    WHERE HH.SERVICE_STATUS LIKE ''%Suspended%''
                    AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                    AND HH.SERVICE_TYPE_NAME = ''Prepaid''
                    AND HH.MSISDN_CS4 IS NOT NULL
                    AND HH.OBO_2 <> 1 
                    AND HH.OBI_2 <> 1';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_SUSP_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

          RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_SUSP_ACT_HLR2','SUSPEND_BAR_OUT','ACTIVE','2');

    -- ==========================================================================================================
    -- End of Reconciliation Phase II Interface
    -- ==========================================================================================================

 EXCEPTION
 WHEN OTHERS THEN
 NULL;
 
/*   WHEN EMPTY_ERROR THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_61_TABLE_EMPTY'),
                                        SQLERRM,
                                        SAS_TABLE,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'EMPTY_TABLE');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_3_SUCCESS');
    WHEN TABLE_CREATION_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_73_TABLE_CREATION_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN TABLE_UPDATE_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_18_TABLE_UPDATE_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN TABLE_INSERT_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_14_TABLE_INSERT_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN INDEX_CREATION_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_25_INDEX_CREATION_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN FATAL_ERROR THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_22_FATAL_ERROR'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN TABLE_DROP_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_94_TABLE_DROP_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');
*/


    
  END P2_POST_PREP_SERV_INTERFACES;
  
 PROCEDURE P2_POST_SUSP_SERV_INTERFACES(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS
    
    SQL_TXT              VARCHAR2(6000);
    RELEASE              VARCHAR2(20)    := 'R1.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;
    

    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);


  BEGIN
  
     UTILS_INTERFACES.INTERFACE_NAME := 'P2_POST_SUSP_SERV_INTERFACES';
     
/*SCENARIOS POSTPAID SUSPENDED BAR OUT ON SV NOT ON HLR WITH NON DATA REASON CODES*/

 -- HLR1
  
       SQL_TXT := 'CREATE TABLE REP_SV_BOUT_ACT_HLR1 NOLOGGING AS
                      SELECT HH.* FROM REP_CLEAN_ALL_MERGED HH   
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar Out''
                      AND HH.SERVICE_REASON_NAME NOT IN (''Threshold Exceeded'',
                      ''Deposit/LG/LE'',
                      ''Consumption'',
                      ''Unpaid Group Association'',
                      ''Down payment'')
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_1 <> 1 
                      OR  HH.OBI_1 <> 0
                      OR  HH.TICK_1 = 5
                      OR  HH.NAM_1 <> 1)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_BOUT_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 
          
 RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_BOUT_ACT_HLR1','SUSPEND_BAR_OUT','CLASSIC','1');
  
 -- HLR2
 
        SQL_TXT := 'CREATE TABLE REP_SV_BOUT_ACT_HLR2 NOLOGGING AS
                      SELECT HH.* FROM REP_CLEAN_ALL_MERGED HH   
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar Out''
                      AND HH.SERVICE_REASON_NAME NOT IN (''Threshold Exceeded'',
                      ''Deposit/LG/LE'',
                      ''Consumption'',
                      ''Unpaid Group Association'',
                      ''Down payment'')
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_2 <> 1 
                      OR  HH.OBI_2 <> 0
                      OR  HH.TICK_2 = 5
                      OR  HH.NAM_2 <> 1)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_BOUT_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 
          
  RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_BOUT_ACT_HLR2','SUSPEND_BAR_OUT','CLASSIC','2');
 
     
     
     /*SCENARIOS POSTPAID SUSPENDED BAR OUT ON SV NOT ON HLR WITH DATA REASON CODES*/
  
  -- HLR1
                             
 /*  SQL_TXT := 'CREATE TABLE REP_SV_BOUT_DATA_ACT_HLR1 NOLOGGING AS                                                                                                     
                      SELECT HH.* FROM REP_CLEAN_ALL_MERGED HH                                                                                                             
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar Out''                                                                                                 
                      AND (
                       (HH.SERVICE_REASON_NAME IN (''Deposit/LG/LE'',                                                                                                                                   
                      ''Consumption'',                                                                                                                                     
                      ''Unpaid Group Association'',                                                                                                                        
                      ''Down payment'')
                        AND (HH.MSISDN_SV IN (SELECT TT.MSISDN_CP FROM MAIN_BB_SYS TT)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
                           OR HH.MSISDN_SV IN (SELECT T.MSISDN FROM MAIN_MI_GIFT_SYS T)                                                                               
                           OR HH.MSISDN_SV IN (SELECT T.MSISDN FROM MAIN_DATASCP_SYS T)))
                    OR  ( HH.SERVICE_REASON_NAME = ''Threshold Exceeded''
                        AND (HH.MSISDN_SV IN (SELECT TT.MSISDN_CP FROM MAIN_BB_SYS TT)                                                                                                                                                                     
                           OR HH.MSISDN_SV IN (SELECT T.MSISDN FROM MAIN_MI_GIFT_SYS T)                                                                              
                           OR HH.MSISDN_SV IN (SELECT T.MSISDN FROM MAIN_DATASCP_SYS T))
                           AND HH.MSISDN_SV NOT IN (Select T.MSISDN FROM MAIN_CALL_COMPLETION_SYS T)))                                                                                                                                     
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS                                                                                                                   
                      AND HH.SERVICE_TYPE_NAME = ''Voice''                                                                                                                 
                      AND (HH.OBO_1 <> 1                                                                                                                                   
                      OR  HH.OBI_1 <> 0                                                                                                                                    
                      OR  HH.TICK_1 = 5                                                                                                                                    
                      OR  HH.NAM_1 <> 0)';                                                                                 
                                              
          IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_BOUT_DATA_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 
    
  RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_BOUT_DATA_ACT_HLR1','SUSPEND_BAR_OUT','CLASSIC','1');
          
     
      -- HLR2
 
     
 SQL_TXT := 'CREATE TABLE REP_SV_BOUT_DATA_ACT_HLR2 NOLOGGING AS                                                                                                     
                      SELECT HH.* FROM REP_CLEAN_ALL_MERGED HH                                                                                                             
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar Out''                                                                                                 
                      AND (                     
                      (HH.SERVICE_REASON_NAME IN (''Deposit/LG/LE'',                                                                                                                                   
                      ''Consumption'',                                                                                                                                     
                      ''Unpaid Group Association'',                                                                                                                        
                      ''Down payment'')
                        AND (HH.MSISDN_SV IN (SELECT TT.MSISDN_CP FROM MAIN_BB_SYS TT)                                                                                                                                                                                                                                                  
                           OR HH.MSISDN_SV IN (SELECT T.MSISDN FROM MAIN_MI_GIFT_SYS T)
                           OR HH.MSISDN_SV IN (SELECT T.MSISDN FROM MAIN_DATASCP_SYS T)))
                    OR  ( HH.SERVICE_REASON_NAME = ''Threshold Exceeded''
                        AND (HH.MSISDN_SV IN (SELECT TT.MSISDN_CP FROM MAIN_BB_SYS TT)                                                                                                                                                                                                                                                   
                           OR HH.MSISDN_SV IN (SELECT T.MSISDN FROM MAIN_MI_GIFT_SYS T)
                           OR HH.MSISDN_SV IN (SELECT T.MSISDN FROM MAIN_DATASCP_SYS T))
                           AND HH.MSISDN_SV NOT IN (Select T.MSISDN FROM MAIN_CALL_COMPLETION_SYS T)))
                                                                                                                                                              
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS                                                                                                                   
                      AND HH.SERVICE_TYPE_NAME = ''Voice''                                                                                                                 
                      AND (HH.OBO_2 <> 1                                                                                                                                   
                      OR  HH.OBI_2 <> 0                                                                                                                                    
                      OR  HH.TICK_2 = 5                                                                                                                                    
                      OR  HH.NAM_2 <> 0)';  
                      
          IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_BOUT_DATA_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;   
   
 RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_BOUT_DATA_ACT_HLR2','SUSPEND_BAR_OUT','CLASSIC','2');
 
  */
    /*SCENARIOS POSTPAID SUSPENDED BAR OUT ON SV WITH CALL COMPLETION NOT ON HLR WITH DATA REASON CODES*/                                                                                      
  -- HLR1                                                                                                                                                                  
                                                                                                                                                                           
       SQL_TXT := 'CREATE TABLE REP_SV_BOUT_CC_ACT_HLR1 NOLOGGING AS                                                                                                     
                      SELECT HH.* FROM REP_CLEAN_ALL_MERGED HH                                                                                                             
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar Out''                                                                                                 
                      AND HH.SERVICE_REASON_NAME = ''Threshold Exceeded''
                      AND HH.MSISDN_SV IN (Select T.MSISDN FROM MAIN_CALL_COMPLETION_SYS T)
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS                                                                                                                   
                      AND HH.SERVICE_TYPE_NAME = ''Voice''   
                          AND (HH.MSISDN_SV IN (SELECT TT.MSISDN_CP FROM MAIN_BB_SYS TT)                                                                                                                                                                                                                                                    
                           OR HH.MSISDN_SV IN (SELECT T.MSISDN FROM MAIN_MI_GIFT_SYS T)
                           OR HH.MSISDN_SV IN (SELECT T.MSISDN FROM MAIN_DATASCP_SYS T))                                                                                                              
                      AND (HH.OBI_1 <> 0                                                                                                                                    
                      OR  HH.TICK_1 = 5                                                                                                                                    
                      OR  HH.NAM_1 <> 0
                      OR OICK_1 Not in (302,303))                                                                                                                                          
                      ';                                                                                 
                                                                                                                                                                           
          IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_BOUT_CC_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN                                                                         
            RAISE TABLE_CREATION_FAILED;                                                                                                                                   
          END IF;                                                                                                                                                          
                                                                                                                                                                           
 RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_BOUT_CC_ACT_HLR1','SUSPEND_BAR_OUT','CLASSIC','1');                                                    
                                                                                                                                                                           
   -- HLR2                                                                                                                                                                 
                                                                                                                                                                           
         SQL_TXT := 'CREATE TABLE REP_SV_BOUT_CC_ACT_HLR2 NOLOGGING AS  
                     SELECT HH.* FROM REP_CLEAN_ALL_MERGED HH                                                                                                               
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar Out''                                                                                                 
                      AND HH.SERVICE_REASON_NAME = ''Threshold Exceeded''
                      AND HH.MSISDN_SV IN (Select T.MSISDN FROM MAIN_CALL_COMPLETION_SYS T)
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS                                                                                                                   
                      AND HH.SERVICE_TYPE_NAME = ''Voice''       
                          AND (HH.MSISDN_SV IN (SELECT TT.MSISDN_CP FROM MAIN_BB_SYS TT)                                                                                                                                                                                                                                                       
                           OR HH.MSISDN_SV IN (SELECT T.MSISDN FROM MAIN_MI_GIFT_SYS T)
                           OR HH.MSISDN_SV IN (SELECT T.MSISDN FROM MAIN_DATASCP_SYS T))                                                                                                          
                      AND (HH.OBI_2 <> 0                                                                                                                                    
                      OR  HH.TICK_2 = 5                                                                                                                                    
                      OR  HH.NAM_2 <> 0
                      OR OICK_2 Not in (302,303))                                                                                                                                   
                      ';                                                                                                   
                                                                                                                                                                           
          IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_BOUT_CC_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN                                                                         
            RAISE TABLE_CREATION_FAILED;                                                                                                                                   
          END IF;                                                                                                                                                          
                                                                                                                                                                           
                                                                                                                                                                           
 RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_BOUT_CC_ACT_HLR2','SUSPEND_BAR_OUT','CLASSIC','2');                                                     
   
         
 
                                                                                                                                                                           
     /*SCENARIOS POSTPAID ACTIVE CALL COMPL IN SV WITH SUSPENDED BAR OUT PARAMETERS ON HLR */                                                                                      
  -- HLR1                                                                                                                                                                  
                                                                                                                                                                           
       SQL_TXT := 'CREATE TABLE REP_CC_SV_ACT_BOUT_HLR1 NOLOGGING AS                                                                                                     
                      SELECT HH.* FROM MAIN_CALL_COMPLETION_SYS HH                                                                                                 
                      Where 1=1
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS                                                                                                                   
                      AND HH.SERVICE_TYPE_NAME = ''Voice''  
                      AND HH.CP_STATUS=''Active''
                      AND HH.Service_Status=''Active''                                                                                                              
                      AND HH.OICK_1 in (302,303)  
                                                                                                                                            
                      ';                                                                                      
                                                                                                                                                                           
          IF UTILS_INTERFACES.CREATE_TABLE('REP_CC_SV_ACT_BOUT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN                                                                         
            RAISE TABLE_CREATION_FAILED;                                                                                                                                   
          END IF;                                                                                                                                                          
                                                                                                                                                                           
  RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_CC_SV_ACT_BOUT_HLR1','UNSUSPEND_BAR_OUT','CLASSIC','1');                                                    
                                                                                                                                                                           
   -- HLR2                                                                                                                                                                 
                                                                                                                                                                           
        SQL_TXT := 'CREATE TABLE REP_CC_SV_ACT_BOUT_HLR2 NOLOGGING AS                                                                                                     
                      SELECT HH.* FROM MAIN_CALL_COMPLETION_SYS HH                                                                                                 
                      Where 1=1
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS                                                                                                                   
                      AND HH.SERVICE_TYPE_NAME = ''Voice''  
                      AND HH.CP_STATUS=''Active''
                      AND HH.Service_Status=''Active''                                                                                                              
                      AND HH.OICK_2 in (302,303)   
                                                                                                                                            
                      ';                                                                                      
                                                                                                                                                                           
          IF UTILS_INTERFACES.CREATE_TABLE('REP_CC_SV_ACT_BOUT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN                                                                         
            RAISE TABLE_CREATION_FAILED;                                                                                                                                   
          END IF;                                                                                                                                                          
                                                                                                                                                                           
  RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_CC_SV_ACT_BOUT_HLR2','UNSUSPEND_BAR_OUT','CLASSIC','2');                                                         
 
                                                      
   /*SCENARIOS POSTPAID ACTIVE WITH NO CALL COMPL IN SV WITH SUSPENDED BAR OUT PARAMETERS ON HLR */                                                                                      
  -- HLR1                                                                                                                                                                  
                                                                                                                                                                           
       SQL_TXT := 'CREATE TABLE REP_CC_NOSV_ACT_BOUT_HLR1 NOLOGGING AS                                                                                                     
                      SELECT HH.* FROM REP_CLEAN_ALL_MERGED HH                                                                                                 
                      Where 1=1
                      AND HH.MSISDN_SV NOT IN (Select T.MSISDN FROM MAIN_CALL_COMPLETION_SYS T WHERE T.CP_STATUS=''Active'')
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS                                                                                                                   
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.Service_Status=''Active''                                                                                                                  
                      AND HH.OICK_1 in (302,303)  
                                                                                                                                            
                      ';                                                                                      
                                                                                                                                                                           
          IF UTILS_INTERFACES.CREATE_TABLE('REP_CC_NOSV_ACT_BOUT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN                                                                         
            RAISE TABLE_CREATION_FAILED;                                                                                                                                   
          END IF;                                                                                                                                                          
                                                                                                                                                                           
 RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_CC_NOSV_ACT_BOUT_HLR1','UNSUSPEND_BAR_OUT','CLASSIC','1');                                                    
                                                                                                                                                                           
   -- HLR2                                                                                                                                                                 
                                                                                                                                                                           
        SQL_TXT := 'CREATE TABLE REP_CC_NOSV_ACT_BOUT_HLR2 NOLOGGING AS                                                                                                     
                      SELECT HH.* FROM REP_CLEAN_ALL_MERGED HH                                                                                                 
                      Where 1=1
                      AND HH.MSISDN_SV NOT IN (Select T.MSISDN FROM MAIN_CALL_COMPLETION_SYS T WHERE T.CP_STATUS=''Active'')
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS                                                                                                                   
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.Service_Status=''Active''                                                                                                                  
                      AND HH.OICK_2 in (302,303)  
                                                                                                                                            
                      ';                                                                                      
                                                                                                                                                                           
          IF UTILS_INTERFACES.CREATE_TABLE('REP_CC_NOSV_ACT_BOUT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN                                                                         
            RAISE TABLE_CREATION_FAILED;                                                                                                                                   
          END IF;                                                                                                                                                          
                                                                                                                                                                           
   RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_CC_NOSV_ACT_BOUT_HLR2','UNSUSPEND_BAR_OUT','CLASSIC','2');                                                         
 
       
 
 
  EXCEPTION
 WHEN OTHERS THEN
 NULL;
 END P2_POST_SUSP_SERV_INTERFACES;
 
PROCEDURE P2_POST_PREP_SERV_INTER_old(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS
  

    -- =============================================================================================
    --    Pre-requisite               : SV DMP
    --    Release                     : R1.0
    --    Date                        : 31/10/2009
    --    Author                      : FAF
    --    Requirement  version        : V1.0
    --    Comments                    : Reconciliation CPs
    --   ------------------------------------------------------------------------------------------- 
    
    
    --================================================================================================================
    -- sql_txt : contains the sql statment body
    --================================================================================================================
    SQL_TXT             VARCHAR2(4000);
    RELEASE              VARCHAR2(20)    := 'R1.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;
    

    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);




  BEGIN


    UTILS_INTERFACES.INTERFACE_NAME := 'P2_POST_PREP_SERV_INTERFACES';


    --########## FAF: 04-11-2009--- ########################
    --########## Reports ###################################
    --########## ------- ###################################
    --########## ------- ###################################


    -- Provisioning Required statuses for BOPs

     SQL_TXT := 'CREATE TABLE REP_REQUIR_STATUSES NOLOGGING AS
                  SELECT c.*
                  FROM REP_CLEAN_ALL_MERGED C
                  WHERE C.SERVICE_STATUS LIKE ''%Required%''';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_REQUIR_STATUSES', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    -- Provisioning FAILED statuses for COPs

     SQL_TXT := 'CREATE TABLE REP_FAILED_STATUS NOLOGGING AS
                  SELECT c.*
                  FROM REP_CLEAN_ALL_MERGED C
                  WHERE C.SERVICE_STATUS LIKE ''%Failed%''';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_FAILED_STATUS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    -- Postp SV in CS4
    -- MSISDNs to be removed from CS4 - 27052010

     SQL_TXT := 'CREATE TABLE REP_POST_SV_PREP_CS4 NOLOGGING AS
                  select * from rep_clean_all_merged t
                  WHERE t.service_name = t.msisdn_cs4
                  AND t.service_type_name = ''Voice''
                  AND t.service_status <> ''Cancelled''
                  AND t.msisdn_cs4 IS NOT NULL
                  AND t.cust_class NOT IN (''06'',''07'')';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_PREP_CS4', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  



    -- removed commented scripts
    -- MSISDNs HLRs not in Billing (Fraud Cases)
/*
     SQL_TXT := 'CREATE TABLE REP_MSISDN_HLR_NOT_IN_BILLINGS NOLOGGING AS 
                 SELECT *
                   FROM rep_clean_all_merged t
                  WHERE t.msisdn_hlr1 = t.msisdn_hlr2
                    AND t.msisdn_hlr1 IS NOT NULL
                    AND t.msisdn_sv IS NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MSISDN_HLR_NOT_IN_BILLINGS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
*/
    -- HLR1

     SQL_TXT := 'CREATE TABLE REP_MSISDN_HLR_NOT_IN_BIL_1 NOLOGGING AS 
                 SELECT t.msisdn_hlr1, t.imsi_1, t.msisdn, t.MSISDN_SV, t.imsi AS imsi_sv
                   FROM rep_clean_all_merged t
                  WHERE t.msisdn_hlr1 IS NOT NULL
                        AND t.msisdn_sv IS NULL';
                       --AND T.MSISDN NOT IN (''01000006'',''01000007'',''01000008'',''01000009'')';
                      --  AND T.MSISDN <> ''76101255'''; 

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MSISDN_HLR_NOT_IN_BIL_1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
  
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MSISDN_HLR_NOT_IN_BIL_1','DELETE','CLASSIC','1');

    -- HLR2
    
      SQL_TXT := 'CREATE TABLE REP_MSISDN_HLR_NOT_IN_BIL_2 NOLOGGING AS 
                 SELECT t.msisdn_hlr2, t.imsi_2, t.msisdn, t.MSISDN_SV, t.imsi AS imsi_sv
                   FROM rep_clean_all_merged t
                  WHERE t.msisdn_hlr2 IS NOT NULL
                      AND t.msisdn_sv IS NULL';
                     -- AND T.MSISDN NOT IN (''01000006'',''01000007'',''01000008'',''01000009'')';
                     -- AND T.MSISDN <> ''76101255''';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MSISDN_HLR_NOT_IN_BIL_2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MSISDN_HLR_NOT_IN_BIL_2','DELETE','CLASSIC','2');
       
    -- Prep SV Post HLR1 --> Fraud

     SQL_TXT := 'CREATE TABLE REP_PREP_SV_POST_HLR_1 NOLOGGING AS
                  SELECT *                                 
                  FROM REP_CLEAN_ALL_MERGED M                      
                  WHERE M.SERVICE_STATUS NOT IN (''Cancelled'', ''Moved'')        
                    AND M.SERVICE_TYPE_NAME = ''Prepaid''                
                    AND (m.OICK_1 <> 100 OR m.OICK_1 = 0)
                    AND M.MSISDN_HLR1 = M.MSISDN_SYS
                    AND M.msisdn_cs4 IS NOT NULL
                   ';
                  
    IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_POST_HLR_1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_POST_HLR_1','DELETE','CLASSIC','1');
    -- Prep SV Post HLR2 --> Fraud

     SQL_TXT := 'CREATE TABLE REP_PREP_SV_POST_HLR_2 NOLOGGING AS
                  SELECT *                                 
                  FROM REP_CLEAN_ALL_MERGED M                      
                  WHERE M.SERVICE_STATUS NOT IN (''Cancelled'', ''Moved'')        
                    AND M.SERVICE_TYPE_NAME = ''Prepaid''                
                    AND (M.OICK_2 <> 100 OR M.OICK_2 = 0)
                    AND M.MSISDN_HLR2= m.msisdn_sys
                    AND M.msisdn_cs4 IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_POST_HLR_2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_POST_HLR_2','DELETE','CLASSIC','2');
    -- IMSI Mismatches between SV and HLRs --> Fraud Opportunity Risk
/*
         SQL_TXT := 'CREATE TABLE REP_MIS_IMSIS_FULL_RECON NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.IMSI <> HH.IMSI_1
                      OR HH.IMSI <>HH.IMSI_2';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MIS_IMSIS_FULL_RECON', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
*/

      -- HLR1

         SQL_TXT := 'CREATE TABLE REP_MIS_IMSIS_FULL_RECON_1 NOLOGGING AS
                      SELECT hh.msisdn, hh.imsi AS imsi_sv, hh.imsi_1,HH.product_type_name 
                        FROM REP_CLEAN_ALL_MERGED HH
                      WHERE hh.msisdn = hh.msisdn_hlr1
                        AND HH.IMSI <> HH.IMSI_1';
                        /*AND HH.MSISDN <> ''76101255''';*/
                        /*AND HH.msisdn <>''70343889''';*/

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MIS_IMSIS_FULL_RECON_1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MIS_IMSIS_FULL_RECON_1','CHANGE_MSISDN_IMSI','CLASSIC','1');
      -- HLR2

         SQL_TXT := 'CREATE TABLE REP_MIS_IMSIS_FULL_RECON_2 NOLOGGING AS
                      SELECT hh.msisdn, hh.imsi AS imsi_sv, hh.imsi_2,HH.product_type_name
                        FROM REP_CLEAN_ALL_MERGED HH
                       WHERE hh.msisdn = hh.msisdn_hlr2
                         AND HH.IMSI <>HH.IMSI_2';
                         /*AND HH.MSISDN <> ''76101255''';*/
                         /*AND HH.msisdn <>''70343889''';*/

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MIS_IMSIS_FULL_RECON_2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MIS_IMSIS_FULL_RECON_2','CHANGE_MSISDN_IMSI','CLASSIC','2');

    -- Cancelled SV and Existing on HLR --> Fraud

         SQL_TXT := 'CREATE TABLE REP_CANC_SV_IN_HLR NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Cancelled''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.MSISDN_HLRS IS NOT NULL';
                      /*AND HH.MSISDN_SYS <> ''76101255''';*/
                     /* AND HH.MSISDN_SYS <>''70343889''';*/

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CANC_SV_IN_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_CANC_SV_IN_HLR','DELETE','CLASSIC','1');
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_CANC_SV_IN_HLR','DELETE','CLASSIC','2');
        -- NOT Cancelled SV and not Existing on HLR --> Revenue opportunity Loss

     /*    SQL_TXT := 'CREATE TABLE REP_NOT_CANC_SV_NOT_IN_HLR NOLOGGING AS
                    SELECT * FROM REP_CLEAN_ALL_MERGED HH
                    WHERE HH.SERVICE_STATUS <> ''Cancelled''
                    --AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                    AND HH.MSISDN_HLRS IS NULL
                    AND HH.MSISDN_SV IS NOT NULL';
                       \*AND HH.MSISDN_SYS <>''70343889''';*\*/
                    
         SQL_TXT := 'CREATE TABLE REP_NOT_CANC_SV_NOT_IN_HLR NOLOGGING AS
                    SELECT * FROM REP_CLEAN_ALL_MERGED HH
                    WHERE HH.SERVICE_STATUS <> ''Cancelled''
                    AND HH.MSISDN_HLRS IS NULL
                    AND HH.MSISDN_SV IS NOT NULL
                    and HH.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')';
                 

    IF UTILS_INTERFACES.CREATE_TABLE('REP_NOT_CANC_SV_NOT_IN_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_NOT_CANC_SV_NOT_IN_HLR','CREATE_ACTIVATE','CLASSIC','1');
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_NOT_CANC_SV_NOT_IN_HLR','CREATE_ACTIVATE','ACTIVE','2');
    
     SQL_TXT := 'CREATE TABLE REP_PREP_SV_NOT_IN_HLR1 NOLOGGING AS
                  SELECT * FROM REP_CLEAN_ALL_MERGED HH
                  where Service_Type_Name = ''Prepaid''
                  and HH.SERVICE_STATUS <> ''Cancelled''
                  AND HH.MSISDN_HLR1 IS NULL
                  AND HH.MSISDN_SV IS NOT NULL';
                    
               
    IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_NOT_IN_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_NOT_IN_HLR1','CREATE_ACTIVATE','ACTIVE','1');
    
    SQL_TXT := 'CREATE TABLE REP_PREP_SV_NOT_IN_HLR2 NOLOGGING AS
                  SELECT * FROM REP_CLEAN_ALL_MERGED HH
                  where Service_Type_Name = ''Prepaid''
                  and HH.SERVICE_STATUS <> ''Cancelled''
                  AND HH.MSISDN_HLR2 IS NULL
                  AND HH.MSISDN_SV IS NOT NULL';
                    
               
    IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_NOT_IN_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_NOT_IN_HLR2','CREATE_ACTIVATE','ACTIVE','2');
    
--*****************************************************
--Active SV - Barred HLR --> Revenue opportunity Loss
--*****************************************************

      -- Postpaid: Barred Out HLR1, Active SV

         SQL_TXT := 'CREATE TABLE REP_SV_ACT_BARO_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.OBO_1 =1
                      AND HH.OICK_1 in (42,300)
                      AND HH.RATE_PLAN <> 8'; -- WLL RATE PLAN TO BE EXCLUDED

    IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_ACT_BARO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_ACT_BARO_HLR1','UNSUSPEND_BAR_OUT','CLASSIC','1');


   -- Postpaid: Barred Out HLR2, Active SV
   -- FAF: Rem: Check for NAM = 1 considering number is Active having MMS/GPRS/WAP CPs Active, DATA Card Service

         SQL_TXT := 'CREATE TABLE REP_SV_ACT_BARO_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.OBO_2 =1
                      AND HH.OICK_2 in (42,300)
                      AND HH.RATE_PLAN <> 8';
                  
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_ACT_BARO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_ACT_BARO_HLR2','UNSUSPEND_BAR_OUT','CLASSIC','2');

    -- Postpaid: Barred In/Out HLR1, Active SV


         SQL_TXT := 'CREATE TABLE REP_SV_ACT_BARIO_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.OBO_1 =1
                      AND HH.OBI_1 = 1
                      AND HH.SERV_REASON_CODE <> 46
                      AND HH.RATE_PLAN <> 8
                      UNION
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.OBO_1 = 1
                      AND HH.OBI_1 = 1
                      AND HH.TICK_1 = 5
                      AND HH.SERV_REASON_CODE = 46
                      AND HH.OICK_1= 300 
                      AND HH.RATE_PLAN <> 8';

                  
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_ACT_BARIO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_ACT_BARIO_HLR1','UNSUSPEND_BAR_IN_OUT','CLASSIC','1');

-- Postpaid: Barred In Out HLR2, Active SV

         SQL_TXT := 'CREATE TABLE REP_SV_ACT_BARIO_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.OBO_2 =1
                      AND HH.OBI_2 = 1
                      AND HH.SERV_REASON_CODE <> 46
                      AND HH.RATE_PLAN <> 8
                      UNION
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.OBO_2 = 1
                      AND HH.OBI_2 = 1
                      AND HH.TICK_2 = 5
                      AND HH.SERV_REASON_CODE = 46
                      AND HH.OICK_2=300
                      AND HH.RATE_PLAN <> 8'; --(2)
                  
              IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_ACT_BARIO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
                RAISE TABLE_CREATION_FAILED;
              END IF;  
    
              RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_SV_ACT_BARIO_HLR2','UNSUSPEND_BAR_IN_OUT','CLASSIC','2');




    -- Postpaid: Suspended - Active HLR1 --> Fraud

         SQL_TXT := 'CREATE TABLE REP_POST_SV_SUSP_ACT_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''%Suspended%''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.OBO_1 <> 1 
                      AND  HH.OBI_1 <> 1
                      AND HH.TICK_1 <>5
                      AND HH.RATE_PLAN <> 8';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_SUSP_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

          RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_SUSP_ACT_HLR1','SUSPEND_BAR_OUT','CLASSIC','1');

  
    -- Postpaid: Suspended - Active HLR2 --> Fraud

         SQL_TXT := 'CREATE TABLE REP_POST_SV_SUSP_ACT_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''%Suspended%''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND HH.OBO_2 <> 1 
                      AND HH.OBI_2 <> 1
                      AND HH.TICK_2 <>5
                      AND HH.RATE_PLAN <> 8';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_SUSP_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
    
          RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_SUSP_ACT_HLR2','SUSPEND_BAR_OUT','CLASSIC','2');

-- Added by julie 22-03-2011
 -- Postpaid: Suspended Network Disconnect- Active HLR1 --> Fraud

    SQL_TXT := 'CREATE TABLE REP_POST_SV_NETDISC_ACT_HLR1 NOLOGGING AS
                    SELECT * FROM REP_CLEAN_ALL_MERGED HH
                    WHERE HH.SERVICE_STATUS LIKE ''%Suspended - Network Disconnect%''
                    AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                    AND HH.SERVICE_TYPE_NAME = ''Voice''
                    AND (HH.OBO_1 <> 1 
                    OR  HH.OBI_1 <> 1)
                    AND HH.RATE_PLAN <> 8';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_NETDISC_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_NETDISC_ACT_HLR1','SUSPEND_NETWK_DISC','CLASSIC','1');

-- Postpaid: Suspended Network Disconnect- Active HLR2 --> Fraud

    SQL_TXT := 'CREATE TABLE REP_POST_SV_NETDISC_ACT_HLR2 NOLOGGING AS
                    SELECT * FROM REP_CLEAN_ALL_MERGED HH
                    WHERE HH.SERVICE_STATUS LIKE ''%Suspended - Network Disconnect%''
                    AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                    AND HH.SERVICE_TYPE_NAME = ''Voice''
                    AND (HH.OBO_2 <> 1 
                    OR  HH.OBI_2 <> 1)
                    AND HH.RATE_PLAN <> 8';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_NETDISC_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

   RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_NETDISC_ACT_HLR2','SUSPEND_NETWK_DISC','CLASSIC','2');

-- Postpaid: Suspended Bar In OUT  Reason Code = Non Voluntary - Active HLR1 --> Fraud

     SQL_TXT := 'CREATE TABLE REP_POST_SV_SP_IO_NV_ACT_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar In & Out''
                      AND HH.SERVICE_REASON_NAME not in (''Voluntary'',''Temporary'')
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_1 <> 1 
                      OR  HH.OBI_1 <> 1)
                      AND HH.RATE_PLAN <> 8';
                      --OR  HH.TICK_1 <>0)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_SP_IO_NV_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

   RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_SP_IO_NV_ACT_HLR1','SUSPEND_BAR_IN_OUT','CLASSIC','1');

-- Postpaid: Suspended Bar In OUT Reason Code = Non Voluntary - Active HLR2 --> Fraud

     SQL_TXT := 'CREATE TABLE REP_POST_SV_SP_IO_NV_ACT_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar In & Out''
                      AND HH.SERVICE_REASON_NAME not in (''Voluntary'',''Temporary'')
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_2 <> 1 
                      OR  HH.OBI_2 <> 1)
                      AND HH.RATE_PLAN <> 8';
                      --OR  HH.TICK_2 <>0)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_SP_IO_NV_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

   RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_SP_IO_NV_ACT_HLR2','SUSPEND_BAR_IN_OUT','CLASSIC','2');

-- Postpaid: Suspended Bar In OUT Reason Code = Voluntary - Active HLR1 --> Fraud
       
       SQL_TXT := 'CREATE TABLE REP_POST_IOV_ACT_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar In & Out''
                      AND HH.SERVICE_REASON_NAME = ''Voluntary''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_1 <> 1 
                      OR  HH.OBI_1 <> 0
                      OR  HH.TICK_1 <>5)
                      AND HH.RATE_PLAN <> 8';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_IOV_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 
  RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_IOV_ACT_HLR1','SUSPEND_BAR_IN_OUT','CLASSIC','1');

-- Postpaid: Suspended Bar In OUT Reason Code = Voluntary - Active HLR2 --> Fraud
       
       SQL_TXT := 'CREATE TABLE REP_POST_IOV_ACT_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar In & Out''
                      AND HH.SERVICE_REASON_NAME = ''Voluntary''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_2 <> 1 
                      OR  HH.OBI_2 <> 0
                      OR  HH.TICK_2 <>5)
                      AND HH.RATE_PLAN <> 8';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_IOV_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 
          
 RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_IOV_ACT_HLR2','SUSPEND_BAR_IN_OUT','CLASSIC','2');

-- Postpaid: Suspended Bar Out - Active HLR1 --> Fraud
  
       SQL_TXT := 'CREATE TABLE REP_POST_SV_BOUT_ACT_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar Out''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_1 <> 1 
                      OR  HH.OBI_1 <> 0
                      OR  HH.TICK_1 = 5)
                      AND HH.RATE_PLAN <> 8';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_BOUT_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 
          
 RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_BOUT_ACT_HLR1','SUSPEND_BAR_OUT','CLASSIC','1');

-- Postpaid: Suspended Bar Out - Active HLR2 --> Fraud
  
       SQL_TXT := 'CREATE TABLE REP_POST_SV_BOUT_ACT_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar Out''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_2 <> 1 
                      OR  HH.OBI_2 <> 0
                      OR  HH.TICK_2 = 5)
                      AND HH.RATE_PLAN <> 8';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_BOUT_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 
          
  RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_BOUT_ACT_HLR2','SUSPEND_BAR_OUT','CLASSIC','2');

-- Postpaid: Suspended Bar In - Active HLR1 --> Fraud

      SQL_TXT := 'CREATE TABLE REP_POST_SV_BIN_ACT_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar In''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_1 = 1 
                      OR  HH.OBI_1 <> 1
                      OR  HH.TICK_1 = 5)
                      AND HH.RATE_PLAN <> 8';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_BIN_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_BIN_ACT_HLR1','SUSPEND_BAR_IN','CLASSIC','1');
    
-- Postpaid: Suspended Bar In - Active HLR2 --> Fraud

      SQL_TXT := 'CREATE TABLE REP_POST_SV_BIN_ACT_HLR2 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''Suspended - Bar In''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Voice''
                      AND (HH.OBO_2 = 1 
                      OR  HH.OBI_2 <> 1
                      OR  HH.TICK_2 = 5)
                      AND HH.RATE_PLAN <> 8';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SV_BIN_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF; 

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_POST_SV_BIN_ACT_HLR2','SUSPEND_BAR_IN','CLASSIC','2');

--End Added By Julie

     -- Prepaid: Suspended - Active HLR1 --> Fraud

         SQL_TXT := 'CREATE TABLE REP_PREP_SV_SUSP_ACT_HLR1 NOLOGGING AS
                      SELECT * FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS LIKE ''%Suspended%''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.SERVICE_TYPE_NAME = ''Prepaid''
                      AND HH.MSISDN_CS4 IS NOT NULL
                      AND HH.OBO_1 <> 1 
                      AND HH.OBI_1 <> 1';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_SUSP_ACT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
          --RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_SUSP_ACT_HLR1','SUSPEND_BAR_OUT','ACTIVE','1');

     -- Prepaid: Suspended - Active HLR2 --> Fraud

         SQL_TXT := 'CREATE TABLE REP_PREP_SV_SUSP_ACT_HLR2 NOLOGGING AS
                    SELECT * FROM REP_CLEAN_ALL_MERGED HH
                    WHERE HH.SERVICE_STATUS LIKE ''%Suspended%''
                    AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                    AND HH.SERVICE_TYPE_NAME = ''Prepaid''
                    AND HH.MSISDN_CS4 IS NOT NULL
                    AND HH.OBO_2 <> 1 
                    AND HH.OBI_2 <> 1';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_SUSP_ACT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

          --RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_SUSP_ACT_HLR2','SUSPEND_BAR_OUT','ACTIVE','2');

    -- ==========================================================================================================
    -- End of Reconciliation Phase II Interface
    -- ==========================================================================================================

 EXCEPTION
 WHEN OTHERS THEN
 NULL;
 
/*   WHEN EMPTY_ERROR THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_61_TABLE_EMPTY'),
                                        SQLERRM,
                                        SAS_TABLE,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'EMPTY_TABLE');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_3_SUCCESS');
    WHEN TABLE_CREATION_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_73_TABLE_CREATION_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN TABLE_UPDATE_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_18_TABLE_UPDATE_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN TABLE_INSERT_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_14_TABLE_INSERT_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN INDEX_CREATION_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_25_INDEX_CREATION_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN FATAL_ERROR THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_22_FATAL_ERROR'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN TABLE_DROP_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_94_TABLE_DROP_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');
*/


    
  END P2_POST_PREP_SERV_INTER_old;

PROCEDURE P3_PREP_INTERFACES(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS
  

   
    -- =============================================================================================
    --    Pre-requisite               : SV DMP
    --    Release                     : R1.0
    --    Date                        : 31/10/2009
    --    Author                      : FAF
    --    Requirement  version        : V1.0
    --    Comments                    : Reconciliation CPs
    --   ------------------------------------------------------------------------------------------- 
    
    
    --================================================================================================================
    -- sql_txt : contains the sql statment body
    --================================================================================================================
    SQL_TXT             VARCHAR2(4000);
    RELEASE              VARCHAR2(20)    := 'R1.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;
    

    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);




  BEGIN


    UTILS_INTERFACES.INTERFACE_NAME := 'P3_PREP_INTERFACES';
 

-- ###############################################
-- ********** PHASE III Prepaid Recon*************
-- ###############################################


   -- Prepaid in SV and not Cancelled, not existing in CS4

    SQL_TXT := 'CREATE TABLE REP_PREP_SV_NOTCANC_NOTCS4 NOLOGGING AS
                SELECT * FROM REP_CLEAN_ALL_MERGED F 
                WHERE f.PRODUCT_TYPE_NAME = ''Alfa Active''
                AND F.SERVICE_STATUS <> ''Cancelled''
                AND  F.MSISDN_CS4 IS NULL';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_NOTCANC_NOTCS4', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;


   -- Prepaid in SV and not Cancelled, not existing in CS4       

    SQL_TXT := 'CREATE TABLE REP_SV_NO_CS4_STATS NOLOGGING AS
                SELECT  T.Service_Status, COUNT(T.MSISDN) NUM FROM REP_PREP_SV_NOTCANC_NOTCS4 T
                GROUP BY  T.SERVICE_STATUS
                ORDER BY T.SERVICE_STATUS';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_SV_NO_CS4_STATS', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

   -- Fraud: Prepaid SV - Postpaid HLR 1
       
    SQL_TXT := 'CREATE TABLE REP_PREP_SV_POST_HLR NOLOGGING AS
                SELECT *                                 
                FROM REP_CLEAN_ALL_MERGED u                       
                WHERE U.SERVICE_STATUS NOT IN (''Cancelled'', ''Moved'')        
                  AND U.Service_Type_Name = ''Prepaid''
                  AND u.msisdn_cs4 = u.msisdn_sv               
                  AND  (U.OICK_1 <> 100 OR U.OICK_1 =0)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_POST_HLR', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

   -- Fraud: Prepaid SV - Postpaid HLR 2

       SQL_TXT := 'CREATE TABLE REP_PREP_SV_POST_HLR2 NOLOGGING AS
                SELECT *                                 
                FROM REP_CLEAN_ALL_MERGED u                       
                WHERE U.SERVICE_STATUS NOT IN (''Cancelled'', ''Moved'')        
                  AND U.Service_Type_Name = ''Prepaid''
                  AND u.msisdn_cs4 = u.msisdn_sv              
                  AND  (U.OICK_2 <> 100 OR U.OICK_2 =0)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_POST_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;




    --Active SV - Barred HLR --> Revenue Loss

    -- Prepaid: Active SV - Barred In/Out or Network Disconnect HLR1
    
       -- P.S: first 3 days in Retention status is Active in SV and CS4 but after that Barred on HLR Normally
       -- Active SV and CS4 while Barred in / out on HLR --> revenue loss
       -- FA: Updates 04/08/2010, Prepaid life cycle
    
    
         /*SQL_TXT := 'CREATE TABLE REP_PREP_SV_ACT_BARIO_HLR1 NOLOGGING AS
                    SELECT *
                    FROM REP_CLEAN_ALL_MERGED HH
                    WHERE HH.SERVICE_STATUS = ''Active''
                    AND HH.SERVICE_TYPE_NAME = ''Prepaid''
                    AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                    AND HH.MSISDN_CS4 IS NOT NULL
                    AND HH.OBO_1 = 1
                    AND HH.OBI_1 = 1
                    AND SYSDATE < to_date(to_char(hh.date_inactif,''mm/dd/yyyy'') || '' 23:59:59'',''mm/dd/yyyy hh24:mi:ss'')+3';
                                  
              IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_ACT_BARIO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
                RAISE TABLE_CREATION_FAILED;
              END IF; 

              RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_ACT_BARIO_HLR1','UNSUSPEND_BAR_IN_OUT','ACTIVE','1');*/

      -- Prepaid: Active SV - Barred In/Out - Network Disconnect HLR2

            -- first 3 days in Retention status is Active in SV and CS4 but after that Barred on HLR Normally
            -- Active SV and CS4 while Barred in / out on HLR --> revenue loss
            -- FA: Updates 04/08/2010, Prepaid life cycle
            

         SQL_TXT := 'CREATE TABLE REP_PREP_SV_ACT_BARIO_HLR2 NOLOGGING AS
                      SELECT *
                    FROM REP_CLEAN_ALL_MERGED HH
                    WHERE HH.SERVICE_STATUS = ''Active''
                    AND HH.SERVICE_TYPE_NAME = ''Prepaid''
                    AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                    AND HH.MSISDN_CS4 IS NOT NULL
                    AND HH.OBO_2 = 1
                    AND HH.OBI_2 = 1
                    AND SYSDATE < to_date(to_char(hh.date_inactif,''mm/dd/yyyy'') || '' 23:59:59'',''mm/dd/yyyy hh24:mi:ss'')+3';
                  
            IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SV_ACT_BARIO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
              RAISE TABLE_CREATION_FAILED;
            END IF; 

            RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_PREP_SV_ACT_BARIO_HLR2','UNSUSPEND_BAR_IN_OUT','ACTIVE','2');

     
     -- FA: Updates 04/08/2010, Prepaid life cycle
     
     --2 - Prep Numbers in Retention, Active SV but not suspended BIO in HLR ==> revenue loss
    -- After checking their HLR profile, it looks like they are correctly barred during or after the HLR DMP generation

         SQL_TXT := 'CREATE TABLE REP_PREP_RET_NOTBARHLR1 NOLOGGING AS
                   SELECT hh.msisdn, hh.service_start_date,hh.date_inactif,hh.etat, HH.Obo_1, hh.obi_1  
                   FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Prepaid''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.MSISDN_CS4 IS NOT NULL
                      AND HH.OBO_1 <> 1
                      AND HH.OBI_1 <> 1
                      AND HH.DATE_INACTIF IS NOT NULL
                      AND SYSDATE BETWEEN HH.DATE_INACTIF+4 AND to_date(to_char(hh.date_retention,''mm/dd/yyyy'') || '' 23:59:59'',''mm/dd/yyyy hh24:mi:ss'')';
                  
            IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_RET_NOTBARHLR1', 'FAFIF', SQL_TXT) = 0 THEN
              RAISE TABLE_CREATION_FAILED;
            END IF; 

         SQL_TXT := 'CREATE TABLE REP_PREP_RET_NOTBARHLR2 NOLOGGING AS
                   SELECT hh.msisdn, hh.service_start_date,hh.date_inactif,hh.etat, HH.Obo_2, hh.obi_2  
                   FROM REP_CLEAN_ALL_MERGED HH
                      WHERE HH.SERVICE_STATUS = ''Active''
                      AND HH.SERVICE_TYPE_NAME = ''Prepaid''
                      AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                      AND HH.MSISDN_CS4 IS NOT NULL
                      AND HH.OBO_2 <> 1
                      AND HH.OBI_2 <> 1
                      AND HH.DATE_INACTIF IS NOT NULL
                      AND SYSDATE BETWEEN HH.DATE_INACTIF+4 AND to_date(to_char(hh.date_retention,''mm/dd/yyyy'') || '' 23:59:59'',''mm/dd/yyyy hh24:mi:ss'')';
                  
            IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_RET_NOTBARHLR2', 'FAFIF', SQL_TXT) = 0 THEN
              RAISE TABLE_CREATION_FAILED;
            END IF; 

      -- 3 - Prep Numbers in Quarantine, Not Suspended Netw Disconnect in SV (They should be)



         SQL_TXT := 'CREATE TABLE REP_PREP_QUAR_NOTSUSPNETDIS NOLOGGING AS
               SELECT hh.msisdn, hh.service_start_date,HH.SERVICE_STATUS,hh.etat,Obo_1, hh.obi_1 
               FROM REP_CLEAN_ALL_MERGED HH
                  WHERE HH.SERVICE_TYPE_NAME = ''Prepaid''
                  AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                  AND HH.MSISDN_CS4 IS NOT NULL
                  AND HH.SERVICE_STATUS <> ''Suspended - Network Disconnect''
                  AND SYSDATE BETWEEN hh.date_retention+1 AND date_retention+12';
                  
            IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_QUAR_NOTSUSPNETDIS', 'FAFIF', SQL_TXT) = 0 THEN
              RAISE TABLE_CREATION_FAILED;
            END IF; 

      -- 3.1 - Prep Numbers in Quarantine, Suspended Netw Disconnect in SV and not Barred on HLR

         SQL_TXT := 'CREATE TABLE REP_PREP_QUAR_SUSPNETD_UBAR1 NOLOGGING AS
               SELECT hh.msisdn, hh.service_start_date,HH.SERVICE_STATUS,hh.etat,Obo_1, hh.obi_1 
               FROM REP_CLEAN_ALL_MERGED HH
                  WHERE HH.SERVICE_TYPE_NAME = ''Prepaid''
                  AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                  AND HH.MSISDN_CS4 IS NOT NULL
                  AND HH.SERVICE_STATUS = ''Suspended - Network Disconnect''
                  AND SYSDATE BETWEEN hh.date_retention+1 AND date_retention+12
                  AND HH.OBO_1 <> 1
                  AND HH.OBI_1 <> 1';
                  
            IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_QUAR_SUSPNETD_UBAR1', 'FAFIF', SQL_TXT) = 0 THEN
              RAISE TABLE_CREATION_FAILED;
            END IF; 

         SQL_TXT := 'CREATE TABLE REP_PREP_QUAR_SUSPNETD_UBAR2 NOLOGGING AS
               SELECT hh.msisdn, hh.service_start_date,HH.SERVICE_STATUS,hh.etat,Obo_2, hh.obi_2 
               FROM REP_CLEAN_ALL_MERGED HH
                  WHERE HH.SERVICE_TYPE_NAME = ''Prepaid''
                  AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                  AND HH.MSISDN_CS4 IS NOT NULL
                  AND HH.SERVICE_STATUS = ''Suspended - Network Disconnect''
                  AND SYSDATE BETWEEN hh.date_retention+1 AND date_retention+12
                  AND HH.OBO_2 <> 1
                  AND HH.OBI_2 <> 1';
                  
            IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_QUAR_SUSPNETD_UBAR2', 'FAFIF', SQL_TXT) = 0 THEN
              RAISE TABLE_CREATION_FAILED;
            END IF; 
            
            
  -- 4 - Prep Numbers in Non Quarantine, Not Cancelled in SV
      
        SQL_TXT := 'CREATE TABLE REP_PREP_NONQUAR_NOTCANCSV NOLOGGING AS
                     SELECT hh.msisdn, hh.date_retention,hh.etat,HH.Obo_1, hh.obi_1,
                     HH.Obo_2, hh.obi_2,hh.service_status 
                     FROM REP_CLEAN_ALL_MERGED HH
                        WHERE HH.SERVICE_TYPE_NAME = ''Prepaid''
                        AND HH.MSISDN_SYS = HH.MSISDN_HLRS
                        AND HH.MSISDN_CS4 IS NOT NULL
                        AND HH.SERVICE_STATUS <> ''Cancelled''
                        AND SYSDATE >= hh.date_retention+13';
                  
      IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_NONQUAR_NOTCANCSV', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
            
            
     -- FA: End Updates 04/08/2010, Prepaid life cycle


    -- ==========================================================================================================
    -- End of Prepaid Reconciliation Interface
    -- ==========================================================================================================


 EXCEPTION
 WHEN OTHERS THEN
 NULL;
 
/*   WHEN EMPTY_ERROR THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_61_TABLE_EMPTY'),
                                        SQLERRM,
                                        SAS_TABLE,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'EMPTY_TABLE');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_3_SUCCESS');
    WHEN TABLE_CREATION_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_73_TABLE_CREATION_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN TABLE_UPDATE_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_18_TABLE_UPDATE_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN TABLE_INSERT_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_14_TABLE_INSERT_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN INDEX_CREATION_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_25_INDEX_CREATION_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN FATAL_ERROR THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_22_FATAL_ERROR'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');

    WHEN TABLE_DROP_FAILED THEN
      UTILS_INTERFACES.MANAGE_EXCEPTION(CURSTEP,
                                        CUROCC,
                                        UTILS_INTERFACES.GET_MESSAGE_VALUE ('ERR_94_TABLE_DROP_FAILED'),
                                        SQLERRM,
                                        NULL,
                                        ENT_CODE,
                                        ENT_TYPE_CODE,
                                        'FAIL');
      RESULT := UTILS_INTERFACES.GET_MESSAGE_VALUE ('STA_1_FAILURE');
*/



  END P3_PREP_INTERFACES;


PROCEDURE P4_CP_INTERFACES_OLD(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS
  
   
    -- =============================================================================================
    --    Pre-requisite               : SV DMP
    --    Release                     : R1.0
    --    Date                        : 31/10/2009
    --    Author                      : FAF
    --    Requirement  version        : V1.0
    --    Comments                    : Reconciliation CPs
    --   ------------------------------------------------------------------------------------------- 
    
    
    --================================================================================================================
    -- sql_txt : contains the sql statment body
    --================================================================================================================
    SQL_TXT             VARCHAR2(4000);
    RELEASE              VARCHAR2(20)    := 'R1.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;
    

    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);




  BEGIN


    UTILS_INTERFACES.INTERFACE_NAME := 'P4_CP_INTERFACES';
 
--================================================================================================================
    -- SMS
    --================================================================================================================
    
     SQL_TXT := 'CREATE TABLE MAIN_SMS_SYS NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.*,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1001760
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS SMS_MODE         
                 FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
              -- AND T.PRODUCT_ID in (1000262,1000241) -- Alfa Classic, Alfa Active
               AND T.PRODUCT_ID in (1000262) -- Alfa Classic, Alfa Active
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000332 -- SMS
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
           
     
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_SMS_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;        
               
      -- BOTH SMS MODE ON SV NOT ON HLR1  
      
          SQL_TXT := 'CREATE TABLE REP_SMS_SV_NO_HLR1 NOLOGGING AS
                   select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''Both''
                      AND (NVL(T.TS21_1,0) <> 1 
                      OR NVL(T.TS22_1,0) <> 1) 
                      --AND t.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                      AND t.SERVICE_TYPE_NAME in (''Voice'')
                      AND T.CP_STATUS = ''Active''
                      AND T.SERVICE_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL'; 
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
   --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1');
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMS_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1','BOTH');

    -- BOTH SMS MODE ON SV NOT ON HLR2  
    
      SQL_TXT := 'CREATE TABLE REP_SMS_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''Both''
                      AND  (NVL(T.TS21_2,0) <> 1 
                      OR NVL(T.TS22_2,0) <> 1 )
                      --AND t.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                      AND t.SERVICE_TYPE_NAME in (''Voice'')
                      AND T.CP_STATUS = ''Active''
                      AND T.SERVICE_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL'; 
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;                                
            
    --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2');
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMS_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2','BOTH');    
    -- BOTH SMS MODE ON HLR1 NOT ON SV                    
    
    SQL_TXT := ' CREATE TABLE REP_SMS_HLR_NO_SV1 NOLOGGING AS
                  select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS21_1,0) = 1
                      AND NVL(T.TS22_1,0) = 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND MS.SMS_MODE = ''Both'')';
        
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;   
    
     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_HLR_NO_SV1','DELETE','SMS','1');
    /* RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMS_HLR_NO_SV1','DELETE','SMS','1','BOTH');  */
    
    -- BOTH SMS MODE ON HLR2 NOT ON SV            
         
    SQL_TXT := 'CREATE TABLE REP_SMS_HLR_NO_SV2 NOLOGGING AS
                    select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS21_2,0) = 1 
                      AND NVL(T.TS22_2,0) = 1 
                       AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND MS.SMS_MODE = ''Both'')'; 
                   
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;    
    
     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_HLR_NO_SV2','DELETE','SMS','2'); 
   /*  RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMS_HLR_NO_SV2','DELETE','SMS','2','BOTH'); */ 
      
     -- SMSMO SMS MODE ON SV NOT ON HLR1   
     SQL_TXT := 'CREATE TABLE REP_SMSMO_SV_NO_HLR1 NOLOGGING AS
                   select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMO''
                      AND NVL(T.TS22_1,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1');     
    /*RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMO_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1','MO');*/
     -- SMSMO SMS MODE ON SV NOT ON HLR2 
     
      SQL_TXT := 'CREATE TABLE REP_SMSMO_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMO''
                      AND NVL(T.TS22_2,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
     -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2');
  /*    RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMO_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2','MO');   */  
     -- SMSMO SMS MODE ON HLR1 NOT ON SV
     
    SQL_TXT := 'CREATE TABLE REP_SMSMO_HLR_NO_SV1 NOLOGGING AS
                  select * from REP_CLEAN_ALL_MERGED T
                    WHERE  NVL(T.TS22_1,0) = 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMO'' OR MS.SMS_MODE = ''Both''))';
       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_HLR_NO_SV1','DELETE','SMS','1'); 
    /*    RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMO_HLR_NO_SV1','DELETE','SMS','1','MO');  */   
    
    -- SMSMO SMS MODE ON HLR1 NOT ON SV
     SQL_TXT := ' CREATE TABLE REP_SMSMO_HLR_NO_SV2 NOLOGGING AS
                    select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS22_2,0) = 1 
                       AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMO'' OR MS.SMS_MODE = ''Both''))';
       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_HLR_NO_SV2','DELETE','SMS','2');
/* RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMO_HLR_NO_SV2','DELETE','SMS','2','MO');*/
     -- SMSMT SMS MODE ON SV NOT ON HLR1                   
           
      SQL_TXT := ' CREATE TABLE REP_SMSMT_SV_NO_HLR1 NOLOGGING AS
                   select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMT''
                      AND NVL(T.TS21_1,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
                
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
     -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1'); 
  /*  RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMT_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1','MT');*/
    -- SMSMT SMS MODE ON SV NOT ON HLR2 
    SQL_TXT := 'CREATE TABLE REP_SMSMT_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMT''
                      AND NVL(T.TS21_2,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
       
     IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF; 
     
     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2');   
     /*   RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMT_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2','MT');*/
      -- SMSMT SMS MODE ON HLR1 NOT ON SV
      SQL_TXT := 'CREATE TABLE REP_SMSMT_HLR_NO_SV1 NOLOGGING AS
                  select * from REP_CLEAN_ALL_MERGED T
                    WHERE  NVL(T.TS21_1,0) = 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMT'' OR MS.SMS_MODE = ''Both''))';
                   
     IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF; 
     
    -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_HLR_NO_SV1','DELETE','SMS','1'); 
    /*   RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMT_HLR_NO_SV1','DELETE','SMS','1','MT');  */ 
     
      -- SMSMT SMS MODE ON HLR2 NOT ON SV  
        SQL_TXT := 'CREATE TABLE REP_SMSMT_HLR_NO_SV2 NOLOGGING AS
                    select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS21_2,0) = 1 
                       AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMT'' OR MS.SMS_MODE = ''Both''))';
                   
     IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF; 
     
     -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_HLR_NO_SV2','DELETE','SMS','2');
    /*   RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMT_HLR_NO_SV2','DELETE','SMS','2','MT'); */
      
    --================================================================================================================
    -- GPRS Roaming main Recon
    --================================================================================================================

  SQL_TXT := 'CREATE TABLE MAIN_GPRS_ROAM_SYS NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.*,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1001800 -- GPRS Roaming
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE NOT IN (9,10)';

      IF UTILS_INTERFACES.CREATE_TABLE('MAIN_GPRS_ROAM_SYS', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;


    -- GPRS Roam SV Not GPRS Roam in HLRs

    SQL_TXT := ' CREATE TABLE REP_GPRSROAM_SV_NO_HLR NOLOGGING AS
                    select * from MAIN_GPRS_ROAM_SYS T
                    WHERE T.RSA_1 <> 0
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSROAM_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSROAM_SV_NO_HLR','CREATE_ACTIVATE','GPRS_ROAMING','1');



    SQL_TXT := ' CREATE TABLE REP_GPRSROAM_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_GPRS_ROAM_SYS T
                    WHERE T.RSA_2 <> 0
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSROAM_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSROAM_SV_NO_HLR2','CREATE_ACTIVATE','GPRS_ROAMING','2');
    


    -- GPRS ROAM HLR NOT SV ==> Fraud
    -- 17092010 Added with Elsy and OBR=0

    SQL_TXT := 'CREATE TABLE REP_GPRSROAM_HLR_NOT_SV NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE (M.RSA_1 = 0 AND m.obr_1 = 0)
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME = ''Voice''
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_GPRS_ROAM_SYS MC WHERE MC.MSISDN = m.msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSROAM_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSROAM_HLR_NOT_SV','DELETE','GPRS_ROAMING','1');


    SQL_TXT := 'CREATE TABLE REP_GPRSROAM_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE (M.RSA_2 = 0 AND m.obr_2 = 0)
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME = ''Voice''
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_GPRS_ROAM_SYS MC WHERE MC.MSISDN = m.msisdn)';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSROAM_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSROAM_HLR_NOT_SV2','DELETE','GPRS_ROAMING','2');

    --================================================================================================================
    -- BlackBerry main Recon
    --================================================================================================================


                 
    SQL_TXT :=   'CREATE TABLE MAIN_BB_SYS NOLOGGING AS
                  SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.MSISDN AS MSISDN_CP,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON,
                     (SELECT RCR.CODE_LABEL
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1003160
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_7) AS SERVICE_TYPE,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1003160
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_7) AS BB_SERVICE_TYPE_NAME,
                     (SELECT RCR.CODE_LABEL
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1003141
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS VOLUME_OPTION,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1003141
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS VOLUME_OPTION_NAME
                         
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1000262
                 AND T.Service_Type_Name =''Voice''
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1001920 -- BB
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

      IF UTILS_INTERFACES.CREATE_TABLE('MAIN_BB_SYS', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;


                                  
    SQL_TXT := 'CREATE TABLE MERGE_APN1SYS_CP_BB AS
                                  SELECT T.*, TT.*
                                  FROM MAIN_BB_SYS t, MERGE_SYS_APN1 TT
                                  WHERE T.MSISDN_CP(+)=TT.MSISDN
                                  UNION
                                  SELECT t.*, TT.*  
                                  FROM MAIN_BB_SYS t, MERGE_SYS_APN1 TT
                                  WHERE t.MSISDN_CP =TT.MSISDN(+)';

      IF UTILS_INTERFACES.CREATE_TABLE('MERGE_APN1SYS_CP_BB', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;


   SQL_TXT := 'CREATE TABLE CLEAN_BB_APN1_MERGED NOLOGGING AS
                    SELECT  (CASE WHEN M.MSISDN_CP IS NULL THEN M.MSISDN 
                                 WHEN M.MSISDN  IS NULL THEN MSISDN_CP
                                 ELSE M.MSISDN
                                 END)  AS MSISDN_BB_APN, m.*
                    FROM MERGE_APN1SYS_CP_BB M';

      IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_BB_APN1_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
     
 --ADDED BY JULIE 19-04-2010 
 -- CPs and Services having BlackBerry on SV and not in HLR (ACTIVATE)
 
    SQL_TXT := 'CREATE TABLE REP_BB_SV_NOT_HLRAPN1 NOLOGGING AS
                  SELECT * FROM CLEAN_BB_APN1_MERGED B
                   WHERE (B.BLACKBERRY_APN1 IS NULL OR B.GPRS_APN1 IS NULL OR B.NAM_1 = 1) 
                     AND (B.MSISDN_CP IS NOT NULL)
                     AND B.CP_STATUS = ''Active''
                     AND B.SERVICE_TYPE_NAME = ''Voice''
                     ';
                     /*--AND B.MSISDN_CP IN (''76447470'')*/

    IF UTILS_INTERFACES.CREATE_TABLE('REP_BB_SV_NOT_HLRAPN1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
   RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_BB_SV_NOT_HLRAPN1','CREATE_ACTIVATE','BLACKBERRY','1');
 --END ADDED BY JULIE

 -- CPs and Services having BlackBerry on HLR and not in SV (Fraud)
 
   SQL_TXT := 'CREATE TABLE BB_HLRAPN_NOT_SV NOLOGGING AS
                  SELECT * FROM CLEAN_BB_APN1_MERGED B
                   WHERE B.BLACKBERRY_APN1 IS NOT NULL
                     AND B.NAM_1 = 0
                     AND B.MSISDN_CP IS NULL
                     AND B.SERVICE_TYPE_NAME = ''Voice''';

    IF UTILS_INTERFACES.CREATE_TABLE('BB_HLRAPN_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    
  --   Added by julie
  --   CPs and Services having BlackBerry on HLR and not in SV excluded from specific number confirmed from Revenue assurance(see email bernard abou karam friday june 04--  
  SQL_TXT := 'CREATE TABLE REP_BB_HLRAPN_NOT_SV NOLOGGING AS
                 SELECT * FROM BB_HLRAPN_NOT_SV B
                   WHERE B.Msisdn not in (''03140536'',''03140204'',''71631839'',''03140937'',''71631838'',''03399755'',
                                          ''03140604'',''71631795'',''03399411'',''03399981'',''71680680'',''70252206'')';
    
    IF UTILS_INTERFACES.CREATE_TABLE('REP_BB_HLRAPN_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
     RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_BB_HLRAPN_NOT_SV','DELETE','BLACKBERRY','1');
    
  -- End added by julie

  /* SQL_TXT := 'CREATE TABLE MERGE_APN2SYS_CP_BB AS
                                  SELECT T.*, TT.*
                                  FROM MAIN_BB_SYS t, MERGE_SYS_APN2 TT
                                  WHERE T.MSISDN_CP(+)=TT.MSISDN
                                  and t.msisdn_cp IS NOT NULL
                                  UNION
                                  SELECT t.*, TT.*  
                                  FROM MAIN_BB_SYS t, MERGE_SYS_APN2 TT
                                  WHERE t.MSISDN_CP =TT.MSISDN(+)';*/
                                  
  SQL_TXT := 'CREATE TABLE MERGE_APN2SYS_CP_BB AS
                                  SELECT T.*, TT.*
                                  FROM MAIN_BB_SYS t, MERGE_SYS_APN2 TT
                                  WHERE T.MSISDN_CP(+)=TT.MSISDN
                                  UNION
                                  SELECT t.*, TT.*  
                                  FROM MAIN_BB_SYS t, MERGE_SYS_APN2 TT
                                  WHERE t.MSISDN_CP =TT.MSISDN(+)';

      IF UTILS_INTERFACES.CREATE_TABLE('MERGE_APN2SYS_CP_BB', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;


   SQL_TXT := 'CREATE TABLE CLEAN_BB_APN2_MERGED NOLOGGING AS
                    SELECT  (CASE WHEN M.MSISDN_CP IS NULL THEN M.MSISDN 
                                 WHEN M.MSISDN  IS NULL THEN MSISDN_CP
                                 ELSE M.MSISDN
                                 END)  AS MSISDN_BB_APN, m.*
                    FROM MERGE_APN2SYS_CP_BB M';

      IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_BB_APN2_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;

 --ADDED BY JULIE 19-04-2010
 -- CPs and Services having BlackBerry on SV and not in HLR (ACTIVATE)
 
    SQL_TXT := 'CREATE TABLE REP_BB_SV_NOT_HLRAPN2 NOLOGGING AS
                  SELECT * FROM CLEAN_BB_APN2_MERGED B
                   WHERE 
                     (B.BLACKBERRY_APN2 IS NULL OR B.GPRS_APN2 IS NULL
                      OR 
                      B.NAM_2 = 1) 
                     AND B.MSISDN_CP IS NOT NULL
                     AND B.CP_STATUS = ''Active''
                     AND B.SERVICE_TYPE_NAME = ''Voice''
                     ';

                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_BB_SV_NOT_HLRAPN2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
  RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_BB_SV_NOT_HLRAPN2','CREATE_ACTIVATE','BLACKBERRY','2');
--END ADDED BY JULIE

 -- CPs and Services having BlackBerry on HLR 2 and not in SV (Fraud)
 
   SQL_TXT := 'CREATE TABLE BB_HLRAPN2_NOT_SV NOLOGGING AS
                  SELECT * FROM CLEAN_BB_APN2_MERGED B
                   WHERE B.BLACKBERRY_APN2 IS NOT NULL
                     AND B.NAM_2 = 0
                     AND B.MSISDN_CP IS NULL
                     AND B.SERVICE_TYPE_NAME = ''Voice''';

    IF UTILS_INTERFACES.CREATE_TABLE('BB_HLRAPN2_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
  --   Added by julie
  --   CPs and Services having BlackBerry on HLR and not in SV excluded from specific number confirmed from Revenue assurance(see email bernard abou karam friday june 04--  
  SQL_TXT := 'CREATE TABLE REP_BB_HLRAPN2_NOT_SV NOLOGGING AS
                 SELECT * FROM BB_HLRAPN2_NOT_SV B
                   WHERE B.Msisdn not in (''03140536'',''03140204'',''71631839'',''03140937'',''71631838'',''03399755'',
                                          ''03140604'',''71631795'',''03399411'',''03399981'',''71680680'',''70252206'')';
    
    IF UTILS_INTERFACES.CREATE_TABLE('REP_BB_HLRAPN2_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_BB_HLRAPN2_NOT_SV','DELETE','BLACKBERRY','2');
    
  -- End added by julie

    --================================================================================================================
    -- BUNDLED VAS main Recon
    --================================================================================================================

    -- Bundled VAS MAIN
    -- Message Box (regular), Call Divert, CLIP Alert, CLIP, Call Waiting/Hold and AOC
    -- not a full recon since this is a parent/Global CP for above CPs
    
    SQL_TXT := ' CREATE TABLE MAIN_BVAS NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000345 -- Bundled VAS
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_BVAS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_BVAS',
                                     'FAFIF',
                                     'IX_MAIN_BVAS_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

    -- CLIP MAIN
    
    SQL_TXT := ' CREATE TABLE MAIN_CLIP NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               --AND T.PRODUCT_ID in (1000262,1000241) -- Alfa Classic, Alfa Active
               AND T.PRODUCT_ID in (1000262) -- Alfa Classic, Alfa Active
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000302 -- CLIP
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

            
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CLIP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
  
    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_CLIP',
                                     'FAFIF',
                                     'IX_MAIN_CLIP_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

    -- CLIP SV Not Clip in HLR

    SQL_TXT := ' CREATE TABLE REP_CLIP_SV_NO_HLR NOLOGGING AS
                    select * from main_clip T
                    WHERE T.CLIP_1 IS NULL
                      --AND t.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                      AND t.SERVICE_TYPE_NAME in (''Voice'')
                      AND T.CP_STATUS = 3
                      AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIP_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIP_SV_NO_HLR','CREATE_ACTIVATE','CLIP','1');

    SQL_TXT := ' CREATE TABLE REP_CLIP_SV_NO_HLR2 NOLOGGING AS
                    select * from main_clip T
                    WHERE T.CLIP_2 IS NULL
                      --AND t.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                      AND t.SERVICE_TYPE_NAME in (''Voice'')
                      AND T.CP_STATUS = 3
                      AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIP_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIP_SV_NO_HLR2','CREATE_ACTIVATE','CLIP','2');
   
    -- CLIP HLR NOT SV ==> Fraud

    SQL_TXT := 'CREATE TABLE REP_CLIP_HLR_NOT_SV NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE NVL(M.CLIP_1,0) = 1
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME in (''Voice'')
                     --AND M.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                     AND NOT EXISTS
                   (SELECT 1 FROM main_clip MC WHERE MC.MSISDN = m.msisdn)
                    AND NOT EXISTS 
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIP_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIP_HLR_NOT_SV','DELETE','CLIP','1');

    SQL_TXT := ' CREATE TABLE REP_CLIP_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE NVL(M.CLIP_2,0) = 1
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME in (''Voice'')
                      --AND M.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                     AND NOT EXISTS
                   (SELECT 1 FROM main_clip MC WHERE MC.MSISDN = m.msisdn)
                     AND NOT EXISTS 
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIP_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIP_HLR_NOT_SV2','DELETE','CLIP','2');

    --================================================================================================================
    -- AOC Recon
    --================================================================================================================

    -- AOC MAIN
    
    SQL_TXT := 'CREATE TABLE MAIN_AOC NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000325 -- Advice of Charge
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_AOC', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_AOC',
                                     'FAFIF',
                                     'IX_MAIN_AOC_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

        -- AOC SV Not AOC in HLR

    SQL_TXT := ' CREATE TABLE REP_AOC_SV_NO_HLR NOLOGGING AS
                    select * from MAIN_AOC T
                    WHERE T.AOC_1 IS NULL
                      AND T.CP_STATUS = 3
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND t.MSISDN_HLRS IS NOT NULL';

            
    IF UTILS_INTERFACES.CREATE_TABLE('REP_AOC_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_AOC_SV_NO_HLR','CREATE_ACTIVATE','AOC','1');

    SQL_TXT := 'CREATE TABLE REP_AOC_SV_NO_HLR2 NOLOGGING AS
                   select * from MAIN_AOC T
                   WHERE T.AOC_2 IS NULL
                     AND T.CP_STATUS = 3
                     AND t.SERVICE_TYPE_NAME = ''Voice''
                     AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_AOC_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_AOC_SV_NO_HLR2','CREATE_ACTIVATE','AOC','2');

    -- AOC HLR NOT SV ==> Fraud

    SQL_TXT := 'CREATE TABLE REP_AOC_HLR_NOT_SV NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE NVL(M.AOC_1,0) = 1
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME = ''Voice''
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_AOC MC WHERE MC.MSISDN = m.msisdn)
                     AND NOT EXISTS 
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';

            
    IF UTILS_INTERFACES.CREATE_TABLE('REP_AOC_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_AOC_HLR_NOT_SV','DELETE','AOC','1');

    SQL_TXT := ' CREATE TABLE REP_AOC_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE NVL(M.AOC_2,0) = 1
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME = ''Voice''
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_AOC MC WHERE MC.MSISDN = m.msisdn)
                     AND NOT EXISTS 
                        (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_AOC_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_AOC_HLR_NOT_SV2','DELETE','AOC','2');
   
    --================================================================================================================
    -- Call Barring Recon
    --================================================================================================================

    -- Call Barring MAIN

    SQL_TXT := 'CREATE TABLE MAIN_CALLBAR NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000326 -- Call Barring
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

            
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CALLBAR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_CALLBAR',
                                     'FAFIF',
                                     'IX_MAIN_CALLBAR_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;
    
    
     -- Call Barring SV Not Call Barring in HLR

    SQL_TXT := ' CREATE TABLE REP_CBAR_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_CALLBAR T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.BAOC_1, 0) <> 1
                        OR NVL(T.BOIC_1, 0) <> 1
                        OR NVL(T.BOIEX_1, 0) <> 1
                        OR NVL(T.BAIC_1, 0) <> 1
                        OR NVL(T.BICRO_1, 0) <> 1
                        OR NVL(T.SOCB_1, 0) not in (1,3))
                       AND T.MSISDN_HLRS IS NOT NULL';

            
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CBAR_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CBAR_SV_NO_HLR','CREATE_ACTIVATE','CALL_BAR','1');

    SQL_TXT := 'CREATE TABLE REP_CBAR_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_CALLBAR T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.BAOC_2, 0) <> 1
                        OR NVL(T.BOIC_2, 0) <> 1
                        OR NVL(T.BOIEX_2, 0) <> 1
                        OR NVL(T.BAIC_2, 0) <> 1
                        OR NVL(T.BICRO_2, 0) <> 1
                        OR NVL(T.SOCB_2, 0) not in (1,3))
                       AND T.MSISDN_HLRS IS NOT NULL';

            
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CBAR_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CBAR_SV_NO_HLR2','CREATE_ACTIVATE','CALL_BAR','2');

    -- Call Bar HLR NOT SV ==> Fraud

    SQL_TXT := 'CREATE TABLE REP_CBAR_HLR_NOT_SV NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE NVL(M.BAOC_1, 0) = 1
                   AND NVL(M.BOIC_1, 0) = 1
                   AND NVL(M.BOIEX_1, 0) = 1
                   AND NVL(M.BAIC_1, 0) = 1
                   AND NVL(M.BICRO_1, 0) = 1
                   AND NVL(M.SOCB_1, 0) = 1
                   AND M.MSISDN_HLRS IS NOT NULL
                   AND M.SERVICE_STATUS <> ''Cancelled''
                   AND M.SERVICE_TYPE_NAME = ''Voice''
                   AND NOT EXISTS
                 (SELECT 1 FROM MAIN_CALLBAR MC WHERE MC.MSISDN = M.msisdn)';

            
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CBAR_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CBAR_HLR_NOT_SV','DELETE','CALL_BAR','1');--CALL_BARRING

    SQL_TXT := 'CREATE TABLE REP_CBAR_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE NVL(M.BAOC_2, 0) = 1
                   AND NVL(M.BOIC_2, 0) = 1
                   AND NVL(M.BOIEX_2, 0) = 1
                   AND NVL(M.BAIC_2, 0) = 1
                   AND NVL(M.BICRO_2, 0) = 1
                   AND NVL(M.SOCB_2, 0) = 1
                   AND M.MSISDN_HLRS IS NOT NULL
                   AND M.SERVICE_STATUS <> ''Cancelled''
                   AND M.SERVICE_TYPE_NAME = ''Voice''
                   AND NOT EXISTS
                 (SELECT 1 FROM MAIN_CALLBAR MC WHERE MC.MSISDN = M.msisdn)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CBAR_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CBAR_HLR_NOT_SV2','DELETE','CALL_BAR','2');--CALL BARRING

    --================================================================================================================
    -- Call Divert Recon
    --================================================================================================================

    -- Call Divert MAIN
    
    SQL_TXT := 'CREATE TABLE MAIN_CALLDIV NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000321 -- Call Divert
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

            
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CALLDIV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_CALLDIV',
                                     'FAFIF',
                                     'IX_MAIN_CALLDIV_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;
    
    
   -- Call Divert SV Not Call Divert in HLR

    SQL_TXT :=  'CREATE TABLE REP_CADIV_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_CALLDIV T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.CFU_1, 0) <> 1
                        OR NVL(T.CFB_1, 0) <> 1
                        OR NVL(T.CFNRY_1, 0) <> 1
                        OR NVL(T.CFNRC_1, 0) <> 1)
                       AND T.MSISDN_HLRS IS NOT NULL';

            
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CADIV_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CADIV_SV_NO_HLR','CREATE_ACTIVATE','CALL_DIVERT','1'); --CALL_DIVERT

    SQL_TXT := 'CREATE TABLE REP_CADIV_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_CALLDIV T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.CFU_2, 0) <> 1
                        OR NVL(T.CFB_2, 0) <> 1
                        OR NVL(T.CFNRY_2, 0) <> 1
                        OR NVL(T.CFNRC_2, 0) <> 1)
                       AND T.MSISDN_HLRS IS NOT NULL';

            
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CADIV_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CADIV_SV_NO_HLR2','CREATE_ACTIVATE','CALL_DIVERT','2'); --CALL_DIVERT
    
   -- Call Divert HLR NOT SV ==> Fraud

    SQL_TXT := 'CREATE TABLE REP_CDIVER_HLR_NOT_SV NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE NVL(m.CFU_1, 0) = 1
                  AND NVL(m.CFB_1, 0) = 1
                  AND NVL(m.CFNRY_1, 0) = 1
                  AND NVL(m.CFNRC_1, 0) = 1
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                  AND M.SERVICE_TYPE_NAME = ''Voice''
                  AND NOT EXISTS
                 (SELECT 1 FROM MAIN_CALLDIV MC WHERE MC.MSISDN = M.msisdn)
                   AND NOT EXISTS 
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';

            
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CDIVER_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CDIVER_HLR_NOT_SV','DELETE','CALL_DIVERT','1');--CALL_DIVERT

    SQL_TXT := 'CREATE TABLE REP_CDIVER_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE NVL(m.CFU_2, 0) = 1
                  AND NVL(m.CFB_2, 0) = 1
                  AND NVL(m.CFNRY_2, 0) = 1
                  AND NVL(m.CFNRC_2, 0) = 1
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                  AND M.SERVICE_TYPE_NAME = ''Voice''
                  AND NOT EXISTS
                 (SELECT 1 FROM MAIN_CALLDIV MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS 
                   (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CDIVER_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CDIVER_HLR_NOT_SV2','DELETE','CALL_DIVERT','2');--CALL_DIVERT
   
    --================================================================================================================
    -- Call Waiting Recon
    --================================================================================================================

    -- Call Waiting MAIN
    
    SQL_TXT := 'CREATE TABLE MAIN_CALLWAIT NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               --AND T.PRODUCT_ID in (1000262,1000241) -- Alfa Classic, Alfa Active
               AND T.PRODUCT_ID in (1000262) -- Alfa Classic, Alfa Active
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000320 -- Call Waiting
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

            
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CALLWAIT', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_CALLWAIT',
                                     'FAFIF',
                                     'IX_MAIN_CALLWAIT_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;
    
    
   -- Call Waiting SV Not Call Waiting in HLR

    SQL_TXT :=  'CREATE TABLE REP_CAWAIT_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_CALLWAIT T
                     WHERE T.SERVICE_TYPE_NAME in (''Voice'')
                       --T.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                       AND T.CP_STATUS = 3
                       AND NVL(T.CAW_1,0) <> 1
                       AND T.MSISDN_HLRS IS NOT NULL';

            
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CAWAIT_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CAWAIT_SV_NO_HLR','CREATE_ACTIVATE','CALL_WAITHOLD','1');--CALL_WAITING

    SQL_TXT := 'CREATE TABLE REP_CAWAIT_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_CALLWAIT T
                     WHERE  T.SERVICE_TYPE_NAME in (''Voice'')
                     -- T.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                       AND T.CP_STATUS = 3
                       AND NVL(T.CAW_2,0) <> 1
                       AND T.MSISDN_HLRS IS NOT NULL';

            
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CAWAIT_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CAWAIT_SV_NO_HLR2','CREATE_ACTIVATE','CALL_WAITHOLD','2');--CALL_WAITING
    
   -- Call Waiting HLR NOT SV ==> Fraud

    SQL_TXT := 'CREATE TABLE REP_CWAIT_HLR_NOT_SV NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE NVL(M.CAW_1,0) = 1
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                 -- AND M.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                  AND M.SERVICE_TYPE_NAME in (''Voice'')
                  AND NOT EXISTS
                 (SELECT 1 FROM MAIN_CALLWAIT MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS 
                     (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';

            
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CWAIT_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CWAIT_HLR_NOT_SV','DELETE','CALL_WAITHOLD','1');--CALL_WAITING

    SQL_TXT := 'CREATE TABLE REP_CWAIT_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE NVL(M.CAW_2,0) = 1
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''CANCELLED''
                  --AND M.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                  AND M.SERVICE_TYPE_NAME in (''Voice'')
                  AND NOT EXISTS
                 (SELECT 1 FROM MAIN_CALLWAIT MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS 
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CWAIT_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CWAIT_HLR_NOT_SV2','DELETE','CALL_WAITHOLD','2');--CALL_WAITING
    
    --================================================================================================================
    -- Clip Alert Recon
    --================================================================================================================

    -- Clip Alert MAIN
    -- Recon After Message BOX
    
    SQL_TXT := 'CREATE TABLE MAIN_CLIPALERT NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000344 -- Clip Alert
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

            
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CLIPALERT', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_CLIPALERT',
                                     'FAFIF',
                                     'IX_MAIN_CLIPALERT_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


    --================================================================================================================
    -- Message Box Recon
    --================================================================================================================

    -- Message Box MAIN
    
    SQL_TXT := 'CREATE TABLE MAIN_MESS_BOX NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000322 -- Message Box
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

            
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_MESS_BOX', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_MESS_BOX',
                                     'FAFIF',
                                     'IX_MAIN_MBOX_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;



   -- Clip Alert SV Not Clip Alert in HLR (with Message BOX)

    SQL_TXT := 'CREATE TABLE REP_CLIPAL_MBOX_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_CLIPALERT T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.OFA_1, 0) <> 3
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND EXISTS
                           (SELECT 1
                              FROM MAIN_MESS_BOX MC
                             WHERE MC.MSISDN = T.MSISDN)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIPAL_MBOX_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIPAL_MBOX_SV_NO_HLR','CREATE_ACTIVATE','CLIP_ALERT','1');--CLIP_ALERT
   -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIPAL_MBOX_SV_NO_HLR','CREATE_ACTIVATE','MESSAGE_BOX','1');--MESSAGE_BOX

    SQL_TXT := 'CREATE TABLE REP_CLIPAL_MBOX_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_CLIPALERT T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.OFA_2, 0) <> 3
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND EXISTS
                           (SELECT 1
                              FROM MAIN_MESS_BOX MC
                             WHERE MC.MSISDN = T.MSISDN)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIPAL_MBOX_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIPAL_MBOX_SV_NO_HLR2','CREATE_ACTIVATE','CLIP_ALERT','2');--CLIP_ALERT
    --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIPAL_MBOX_SV_NO_HLR2','CREATE_ACTIVATE','MESSAGE_BOX','2');--MESSAGE_BOX

   -- Clip Alert SV Not Clip Alert in HLR (without Message BOX)


    SQL_TXT := 'CREATE TABLE REP_CLIPAL_NOMBOX_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_CLIPALERT T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.OFA_1, 0) <> 4
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND NOT EXISTS
                           (SELECT 1
                              FROM MAIN_MESS_BOX MC
                             WHERE MC.MSISDN = T.MSISDN)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIPAL_NOMBOX_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIPAL_NOMBOX_SV_NO_HLR','CREATE_ACTIVATE','CLIP_ALERT','1');--CLIP_ALERT WITHOUT MSGBOX
   
    SQL_TXT := 'CREATE TABLE REP_CLIPAL_NOMBOX_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_CLIPALERT T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.OFA_2, 0) <> 4
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND NOT EXISTS
                           (SELECT 1
                              FROM MAIN_MESS_BOX MC
                             WHERE MC.MSISDN = T.MSISDN)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIPAL_NOMBOX_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIPAL_NOMBOX_SV_NO_HLR2','CREATE_ACTIVATE','CLIP_ALERT','2');--CLIP_ALERT WITHOUT MSGBOX

   -- Clip Alert HLR NOT SV ==> Fraud
   -- With Message Box
   
      SQL_TXT := 'CREATE TABLE REP_CALERT_WMB_HLR_NOT_SV NOLOGGING AS
                    SELECT *
                      FROM REP_CLEAN_ALL_MERGED M
                     WHERE NVL(M.OFA_1,0) = 3
                      AND M.MSISDN_HLRS IS NOT NULL
                      AND M.SERVICE_STATUS <> ''CANCELLED''
                      AND M.SERVICE_TYPE_NAME = ''Voice''
                      AND EXISTS
                     (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                      AND NOT EXISTS
                     (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                     AND NOT EXISTS 
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CALERT_WMB_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CALERT_WMB_HLR_NOT_SV','DELETE','CLIP_ALERT','1');--CLIP_ALERT
    
          SQL_TXT := 'CREATE TABLE REP_CALERT_WMB_HLR_NOT_SV2 NOLOGGING AS
                    SELECT *
                      FROM REP_CLEAN_ALL_MERGED M
                     WHERE NVL(M.OFA_2,0) = 3
                      AND M.MSISDN_HLRS IS NOT NULL
                      AND M.SERVICE_STATUS <> ''CANCELLED''
                      AND M.SERVICE_TYPE_NAME = ''Voice''
                      AND EXISTS
                     (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                      AND NOT EXISTS
                     (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                     AND NOT EXISTS 
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CALERT_WMB_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CALERT_WMB_HLR_NOT_SV2','DELETE','CLIP_ALERT','2');--CLIP_ALERT
       -- Without Message Box   
              
      SQL_TXT := 'CREATE TABLE REP_CALERT_NOMB_HLR_NOT_SV NOLOGGING AS
                    SELECT *
                      FROM REP_CLEAN_ALL_MERGED M
                     WHERE NVL(M.OFA_1,0) = 4
                      AND M.MSISDN_HLRS IS NOT NULL
                      AND M.SERVICE_STATUS <> ''CANCELLED''
                      AND M.SERVICE_TYPE_NAME = ''Voice''
                      AND NOT EXISTS
                     (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                      AND NOT EXISTS
                     (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                     AND NOT EXISTS 
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CALERT_NOMB_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
      
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CALERT_NOMB_HLR_NOT_SV','DELETE','CLIP_ALERT','1');--CLIP_ALERT WITHOUT MSGBOX
              
      SQL_TXT := 'CREATE TABLE REP_CALERT_NOMB_HLR_NOT_SV2 NOLOGGING AS
                    SELECT *
                      FROM REP_CLEAN_ALL_MERGED M
                     WHERE NVL(M.OFA_2,0) = 4
                      AND M.MSISDN_HLRS IS NOT NULL
                      AND M.SERVICE_STATUS <> ''CANCELLED''
                      AND M.SERVICE_TYPE_NAME = ''Voice''
                      AND NOT EXISTS
                     (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                      AND NOT EXISTS
                     (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                      AND NOT EXISTS 
                       (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CALERT_NOMB_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CALERT_NOMB_HLR_NOT_SV2','DELETE','CLIP_ALERT','2');--CLIP_ALERT WITHOUT MSGBOX

 -- Message BOX reconciliation
 
 -- Message Box SV without Clip Alert in HLR
 
       SQL_TXT := 'CREATE TABLE REP_MB_CLIPAL_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_MESS_BOX T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.CFU_1, 0) <> 1
                        OR NVL(T.CFB_1, 0) <> 1
                        OR NVL(T.CFNRY_1, 0) <> 1
                        OR NVL(T.CFNRC_1, 0) <> 1
                        OR NVL(T.OFA_1, 0) <> 3)
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND EXISTS
                           (SELECT 1
                              FROM MAIN_CLIPALERT MC
                             WHERE MC.MSISDN = T.MSISDN)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MB_CLIPAL_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
 
    --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MB_CLIPAL_SV_NO_HLR','CREATE_ACTIVATE','CLIP_ALERT','1');  
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MB_CLIPAL_SV_NO_HLR','CREATE_ACTIVATE','MESSAGE_BOX','1');
  -- Message Box SV without Clip Alert in HLR 
 
       SQL_TXT := 'CREATE TABLE REP_MB_CLIPAL_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_MESS_BOX T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.CFU_2, 0) <> 1
                        OR NVL(T.CFB_2, 0) <> 1
                        OR NVL(T.CFNRY_2, 0) <> 1
                        OR NVL(T.CFNRC_2, 0) <> 1
                        OR NVL(T.OFA_2, 0) <> 3)
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND EXISTS
                           (SELECT 1
                              FROM MAIN_CLIPALERT MC
                             WHERE MC.MSISDN = T.MSISDN)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MB_CLIPAL_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
   
   --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MB_CLIPAL_SV_NO_HLR2','CREATE_ACTIVATE','CLIP_ALERT','2');--MSGBOX WITHOUT CLIP_ALERT
   RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MB_CLIPAL_SV_NO_HLR2','CREATE_ACTIVATE','MESSAGE_BOX','2');--MSGBOX WITHOUT CLIP_ALERT
  
 -- Message Box SV with Clip Alert in HLR
 
        SQL_TXT := 'CREATE TABLE REP_MB_NOCLIPAL_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_MESS_BOX T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.CFU_1, 0) <> 1
                        OR NVL(T.CFB_1, 0) <> 1
                        OR NVL(T.CFNRY_1, 0) <> 1
                        OR NVL(T.CFNRC_1, 0) <> 1
                        OR NVL(T.OFA_1, 0) <> 10)
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND NOT EXISTS
                           (SELECT 1
                              FROM MAIN_CLIPALERT MC
                             WHERE MC.MSISDN = T.MSISDN)';
           
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MB_NOCLIPAL_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
   
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MB_NOCLIPAL_SV_NO_HLR','CREATE_ACTIVATE','MESSAGE_BOX','1');--List Message Box  not having Clip Alert in SV with Clip Alert in HLR
 
 
        SQL_TXT := 'CREATE TABLE REP_MB_NOCLIPAL_SV_NO_HLR2 NOLOGGING AS
            SELECT *
              FROM MAIN_MESS_BOX T
             WHERE T.SERVICE_TYPE_NAME = ''Voice''
               AND T.CP_STATUS = 3
               AND (NVL(T.CFU_2, 0) <> 1
                OR NVL(T.CFB_2, 0) <> 1
                OR NVL(T.CFNRY_2, 0) <> 1
                OR NVL(T.CFNRC_2, 0) <> 1
                OR NVL(T.OFA_2, 0) <> 10)
               AND T.MSISDN_HLRS IS NOT NULL
               AND NOT EXISTS
                   (SELECT 1
                      FROM MAIN_CLIPALERT MC
                     WHERE MC.MSISDN = T.MSISDN)';
             
      IF UTILS_INTERFACES.CREATE_TABLE('REP_MB_NOCLIPAL_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
     
      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MB_NOCLIPAL_SV_NO_HLR2','CREATE_ACTIVATE','MESSAGE_BOX','2');--List Message Box  not having Clip Alert in SV with Clip Alert in HLR
    -- Message BOX HLR NOT SV ==> Fraud
   -- With Clip Alert

         SQL_TXT := 'CREATE TABLE REP_MBOX_CLAL_HLR_NOT_SV NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                WHERE NVL(m.CFU_1, 0) = 1
                  AND NVL(m.CFB_1, 0) = 1
                  AND NVL(m.CFNRY_1, 0) = 1
                  AND NVL(m.CFNRC_1, 0) = 1
                  AND NVL(m.OFA_1, 0) = 3
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                  AND M.SERVICE_TYPE_NAME = ''Voice''
                  AND NOT EXISTS
                  (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                  AND EXISTS
                  (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS 
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';
             
      IF UTILS_INTERFACES.CREATE_TABLE('REP_MBOX_CLAL_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
     
    --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBOX_CLAL_HLR_NOT_SV','DELETE','CLIP_ALERT','1');--List Products having Message Box (with Clip Alert) in HLR and not in SV 
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBOX_CLAL_HLR_NOT_SV','DELETE','MESSAGE_BOX','1');--List Products having Message Box (with Clip Alert) in HLR and not in SV
             
             SQL_TXT := 'CREATE TABLE REP_MBOX_CLAL_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                WHERE NVL(m.CFU_2, 0) = 1
                  AND NVL(m.CFB_2, 0) = 1
                  AND NVL(m.CFNRY_2, 0) = 1
                  AND NVL(m.CFNRC_2, 0) = 1
                  AND NVL(m.OFA_2, 0) = 3
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                  AND M.SERVICE_TYPE_NAME = ''Voice''
                  AND NOT EXISTS
                  (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                  AND EXISTS
                  (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS 
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';
             
      IF UTILS_INTERFACES.CREATE_TABLE('REP_MBOX_CLAL_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
     
      --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBOX_CLAL_HLR_NOT_SV2','DELETE','CLIP_ALERT','2');--List Products having Message Box (with Clip Alert) in HLR and not in SV 
      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBOX_CLAL_HLR_NOT_SV2','DELETE','MESSAGE_BOX','2');--List Products having Message Box (with Clip Alert) in HLR and not in SV         
    -- Without Clip Alert
              
       SQL_TXT := 'CREATE TABLE REP_MBOX_NO_CLAL_HLR_NOT_SV NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                WHERE NVL(m.CFU_1, 0) = 1
                  AND NVL(m.CFB_1, 0) = 1
                  AND NVL(m.CFNRY_1, 0) = 1
                  AND NVL(m.CFNRC_1, 0) = 1
                  AND NVL(m.OFA_1, 0) = 10
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                  AND M.SERVICE_TYPE_NAME = ''Voice''
                  AND EXISTS
                  (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS
                  (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS 
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';
             
      IF UTILS_INTERFACES.CREATE_TABLE('REP_MBOX_NO_CLAL_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
      
      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBOX_NO_CLAL_HLR_NOT_SV','DELETE','MESSAGE_BOX','1');--List Products having Message Box (without Clip Alert) in HLR and not in SV 
     
     SQL_TXT := 'CREATE TABLE REP_MBOX_NO_CLAL_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                WHERE NVL(m.CFU_2, 0) = 1
                  AND NVL(m.CFB_2, 0) = 1
                  AND NVL(m.CFNRY_2, 0) = 1
                  AND NVL(m.CFNRC_2, 0) = 1
                  AND NVL(m.OFA_2, 0) = 10
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                  AND M.SERVICE_TYPE_NAME = ''Voice''
                  AND EXISTS
                  (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS
                  (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS 
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';

      IF UTILS_INTERFACES.CREATE_TABLE('REP_MBOX_NO_CLAL_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
        
      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBOX_NO_CLAL_HLR_NOT_SV2','DELETE','MESSAGE_BOX','2');--List Products having Message Box (without Clip Alert) in HLR and not in SV
 -- added by julie 17/092010
 --================================================================================================================
    -- BUNDLED VAS Recon
    --================================================================================================================     
  -- BVAS SV NOT  HLR1
  
      SQL_TXT := 'CREATE TABLE REP_BVAS_SV_NO_HLR1 NOLOGGING AS
                    select * from MAIN_BVAS T
                    WHERE (NVL(T.CLIP_1, 0)<>1 
                           OR NVL(T.AOC_1, 0) <>1 
                           OR NVL(T.CFU_1, 0) <> 1
                           OR NVL(T.CFB_1, 0) <> 1
                           OR NVL(T.CFNRY_1, 0) <> 1
                           OR NVL(T.CFNRC_1, 0) <> 1
                           OR NVL(T.CAW_1, 0) <> 1
                           OR NVL(T.OFA_1, 0) <> 3)
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = 3
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
      IF UTILS_INTERFACES.CREATE_TABLE('REP_BVAS_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
      
      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_BVAS_SV_NO_HLR1','CREATE_ACTIVATE','BUNDLED_VAS','1');--List Products having BUNDLED VAS ON SV NOT IN HLR1                      
       
     -- BVAS SV NOT  HLR2
     
        SQL_TXT := 'CREATE TABLE REP_BVAS_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_BVAS T
                    WHERE (NVL(T.CLIP_2, 0)<>1 
                           OR NVL(T.AOC_2, 0) <>1 
                           OR NVL(T.CFU_2, 0) <> 1
                           OR NVL(T.CFB_2, 0) <> 1
                           OR NVL(T.CFNRY_2, 0) <> 1
                           OR NVL(T.CFNRC_2, 0) <> 1
                           OR NVL(T.CAW_2, 0) <> 1
                           OR NVL(T.OFA_2, 0) <> 3)
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = 3
                      AND t.MSISDN_HLRS IS NOT NULL';   
                      
      IF UTILS_INTERFACES.CREATE_TABLE('REP_BVAS_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
      
      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_BVAS_SV_NO_HLR2','CREATE_ACTIVATE','BUNDLED_VAS','2');--List Products having BUNDLED VAS ON SV NOT IN HLR2
 
 
     -- BVAS HLR1 NOT SV

       SQL_TXT := 'CREATE TABLE REP_BVAS_HLR_NOT_SV1 NOLOGGING AS
                   SELECT *
                   FROM REP_CLEAN_ALL_MERGED T
                   WHERE NVL(T.CFU_1, 0) = 1
                         AND NVL(T.CFB_1, 0) = 1
                         AND NVL(T.CFNRY_1, 0) = 1
                         AND NVL(T.CFNRC_1, 0) = 1
                         AND NVL(T.AOC_1, 0) = 1
                         AND NVL(T.CLIP_1, 0) = 1
                          AND NVL(T.CAW_1, 0) = 1
                          AND NVL(T.OFA_1, 0) = 3
                          AND T.MSISDN_HLRS IS NOT NULL
                           AND T.SERVICE_STATUS <> ''Cancelled''
                           AND T.SERVICE_TYPE_NAME = ''Voice''
                           AND NOT EXISTS 
                           (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = T.Msisdn)
                           AND NOT EXISTS
                            ( SELECT 1 FROM MAIN_AOC AOC WHERE AOC.MSISDN = T.MSISDN)
                           AND NOT EXISTS 
                            (SELECT 1 FROM MAIN_CLIP CP WHERE CP.MSISDN = T.MSISDN)
                           AND NOT EXISTS 
                            (SELECT 1 FROM MAIN_CLIPALERT CPA WHERE CPA.MSISDN = T.MSISDN)
                           AND NOT EXISTS 
                            (SELECT 1 FROM MAIN_MESS_BOX MB WHERE MB.MSISDN = T.MSISDN)
                           AND NOT EXISTS
                             (SELECT 1 FROM MAIN_CALLDIV CD WHERE CD.MSISDN = T.MSISDN)
                           AND NOT EXISTS
                             (SELECT 1 FROM MAIN_CALLWAIT CW WHERE CW.MSISDN = T.MSISDN)';
                             
      IF UTILS_INTERFACES.CREATE_TABLE('REP_BVAS_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
      
      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_BVAS_HLR_NOT_SV1','DELETE','BUNDLED_VAS','1');--List Products having BUNDLED VAS ON HLR1 NOT IN SV
 
 
 -- BVAS HLR2 NOT SV

         SQL_TXT := 'CREATE TABLE REP_BVAS_HLR_NOT_SV2 NOLOGGING AS
                     SELECT *
                     FROM REP_CLEAN_ALL_MERGED T
                     WHERE NVL(T.CFU_2, 0) = 1
                        AND NVL(T.CFB_2, 0) = 1
                        AND NVL(T.CFNRY_2, 0) = 1
                        AND NVL(T.CFNRC_2, 0) = 1
                        AND NVL(T.AOC_2, 0) = 1
                        AND NVL(T.CAW_2, 0) = 1
                        AND NVL(T.CLIP_2, 0) = 1
                        AND NVL(T.OFA_2, 0) = 3
                        AND T.MSISDN_HLRS IS NOT NULL
                        AND T.SERVICE_STATUS <> ''Cancelled''
                        AND T.SERVICE_TYPE_NAME = ''Voice''
                        AND NOT EXISTS 
                         (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = T.Msisdn)
                        AND NOT EXISTS
                         ( SELECT 1 FROM MAIN_AOC AOC WHERE AOC.MSISDN = T.MSISDN)
                        AND NOT EXISTS 
                         (SELECT 1 FROM MAIN_CLIP CP WHERE CP.MSISDN = T.MSISDN)
                        AND NOT EXISTS 
                         (SELECT 1 FROM MAIN_CLIPALERT CPA WHERE CPA.MSISDN = T.MSISDN)
                        AND NOT EXISTS 
                         (SELECT 1 FROM MAIN_MESS_BOX MB WHERE MB.MSISDN = T.MSISDN)
                        AND NOT EXISTS
                         (SELECT 1 FROM MAIN_CALLDIV CD WHERE CD.MSISDN = T.MSISDN)
                        AND NOT EXISTS
                         (SELECT 1 FROM MAIN_CALLWAIT CW WHERE CW.MSISDN = T.MSISDN)';
                         
              
          IF UTILS_INTERFACES.CREATE_TABLE('REP_BVAS_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
          END IF; 
 
          RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_BVAS_HLR_NOT_SV2','DELETE','BUNDLED_VAS','2');--List Products having BUNDLED VAS ON HLR1 NOT IN SV
 
 --- END ADDED BY JULIE 17/09/2010
    
    --================================================================================================================
    -- CLEAR SOC Recon
    --================================================================================================================

    -- CLEAR SOC MAIN
    
    SQL_TXT := ' CREATE TABLE MAIN_CLIR_SOC NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON,
                   (SELECT RC.CODE_LABEL FROM REFERENCE_CODE RC 
                     WHERE RC.REFERENCE_TYPE_ID = 1000446 
                       AND PIH.GENERAL_5 = RC.REFERENCE_CODE) AS SOCLIR_TYPE
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000323 -- CLIR SOC
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CLIR_SOC', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_CLIR_SOC',
                                     'FAFIF',
                                     'IX_MAIN_CLSOC_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

    -- CLIR SOCLIR T1 SV Not CLIR SOCLIR in HLR

 SQL_TXT := 'CREATE TABLE REP_CL_SOCT1_SV_NO_HLR NOLOGGING AS
            select * from MAIN_CLIR_SOC T
            WHERE (T.CLIR_1 <> 1 OR T.SOCLIR_1 <> 1)
              AND T.CP_STATUS = 3
              AND t.SERVICE_TYPE_NAME = ''Voice''
              AND T.soclir_type = ''TYPE_1''
              AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT1_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CL_SOCT1_SV_NO_HLR','CREATE_ACTIVATE','CLIR_SOCLIR','1'); -- CLIR SOCLIR

    SQL_TXT := ' CREATE TABLE REP_CL_SOCT1_SV_NO_HLR2 NOLOGGING AS
                  select * from MAIN_CLIR_SOC T
                  WHERE (T.CLIR_2 <> 1 OR T.SOCLIR_2 <> 1)
                    AND T.CP_STATUS = 3
                    AND t.SERVICE_TYPE_NAME = ''Voice''
                    AND T.soclir_type = ''TYPE_1''
                    AND t.MSISDN_HLRS IS NOT NULL';

            
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT1_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CL_SOCT1_SV_NO_HLR2','CREATE_ACTIVATE','CLIR_SOCLIR','2'); -- CLIR SOCLIR

-- added by julie 15-04-2010

-- CLIR SOCLIR T1 in HLR Not SV 
--HLR1
SQL_TXT := 'CREATE TABLE REP_CL_SOCT1_HLR_NOT_SV1 NOLOGGING AS
            select * from MAIN_CLIR_SOC T
            WHERE T.CLIR_1 = 1 
              AND T.SOCLIR_1 = 1
              AND T.CP_STATUS = 3
              AND T.SERVICE_STATUS <> ''Cancelled''
              AND T.SERVICE_TYPE_NAME = ''Voice''
              AND T.soclir_type = ''TYPE_1''
              AND t.MSISDN_HLRS IS NOT NULL';
              
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT1_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
              
              
    
--HLR2          
SQL_TXT := 'CREATE TABLE REP_CL_SOCT1_HLR_NOT_SV2 NOLOGGING AS
            select * from MAIN_CLIR_SOC T
            WHERE T.CLIR_2 = 1 
              AND T.SOCLIR_2 = 1
              AND T.CP_STATUS = 3
              AND T.SERVICE_STATUS <> ''Cancelled''
              AND T.SERVICE_TYPE_NAME = ''Voice''
              AND T.soclir_type = ''TYPE_1''
              AND t.MSISDN_HLRS IS NOT NULL';
              
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT1_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
 --end added by julie

 -- CLIR SOCLIR T2 SV Not CLIR SOCLIR in HLR

     SQL_TXT := 'CREATE TABLE REP_CL_SOCT2_SV_NO_HLR NOLOGGING AS
                select * from MAIN_CLIR_SOC T
                WHERE (T.CLIR_1 <> 1 OR T.SOCLIR_1 <> 2)
                  AND T.CP_STATUS = 3
                  AND t.SERVICE_TYPE_NAME = ''Voice''
                  AND T.soclir_type = ''TYPE_2''
                  AND t.MSISDN_HLRS IS NOT NULL';


        IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT2_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
        END IF;
        
        RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CL_SOCT2_SV_NO_HLR','CREATE_ACTIVATE','CLIR_SOCLIR','1'); -- CLIR SOCLIR T2

    SQL_TXT := ' CREATE TABLE REP_CL_SOCT2_SV_NO_HLR2 NOLOGGING AS
                  select * from MAIN_CLIR_SOC T
                  WHERE (T.CLIR_2 <> 1 OR T.SOCLIR_2 <> 2)
                    AND T.CP_STATUS = 3
                    AND t.SERVICE_TYPE_NAME = ''Voice''
                    AND T.soclir_type = ''TYPE_2''
                    AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT2_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CL_SOCT2_SV_NO_HLR2','CREATE_ACTIVATE','CLIR_SOCLIR','2'); -- CLIR SOCLIR T2
    
    
    -- added by julie 15-04-2010
   --CLIR SOCLIR T2 HLR Not CLIR SOCLIR in SV
   --hlr1

   SQL_TXT := 'CREATE TABLE REP_CL_SOCT2_HLR_NOT_SV1 NOLOGGING AS
            select * from MAIN_CLIR_SOC T
            WHERE T.CLIR_1 = 1 
              AND T.SOCLIR_1 = 1
              AND T.CP_STATUS = 3
              AND T.SERVICE_STATUS <> ''Cancelled''
              AND T.SERVICE_TYPE_NAME = ''Voice''
              AND T.soclir_type = ''TYPE_2''
              AND t.MSISDN_HLRS IS NOT NULL';
              
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT2_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

--HLR2        
 SQL_TXT :='CREATE TABLE REP_CL_SOCT2_HLR_NOT_SV2 NOLOGGING AS
            select * from MAIN_CLIR_SOC T
            WHERE T.CLIR_2 = 1 
              AND T.SOCLIR_2 = 1
              AND T.CP_STATUS = 3
              AND T.SERVICE_STATUS <> ''Cancelled''
              AND T.SERVICE_TYPE_NAME = ''Voice''
              AND T.soclir_type = ''TYPE_2''
              AND t.MSISDN_HLRS IS NOT NULL';
              
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT2_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    --end added by julie
    
     --================================================================================================================
    -- VPN Recon
    --================================================================================================================
    
    
    -- added by julie 16-04-2010
    -- VPN
    
 SQL_TXT :='CREATE TABLE MAIN_VPN NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262 --ALFA CLASSIC
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000339 -- VPN
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
               
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_VPN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
         
    
    --VPN SV NOT IN HLR
    --HLR1
          
    SQL_TXT :='CREATE TABLE REP_VPN_SV_NO_HLR1 NOLOGGING AS
                    SELECT *
                      FROM MAIN_VPN T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.OICK_1, 0)not in (42,151)
                       AND T.MSISDN_HLRS IS NOT NULL
                       ';
                 

    IF UTILS_INTERFACES.CREATE_TABLE('REP_VPN_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
   RECONCILIATION_INTERFACES.PROV_RECON_VPN_CPS('FAFIF','REP_VPN_SV_NO_HLR1','CREATE_ACTIVATE','VPN','1');
    
    --HLR2
    
         SQL_TXT :='CREATE TABLE REP_VPN_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_VPN T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.OICK_2, 0)not in (42,151)
                       AND T.MSISDN_HLRS IS NOT NULL
                       ';
                   
                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_VPN_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.PROV_RECON_VPN_CPS('FAFIF','REP_VPN_SV_NO_HLR2','CREATE_ACTIVATE','VPN','2');
    
    -- VPN HLR NOT IN SV
    --HLR1
    
       SQL_TXT :='CREATE TABLE REP_VPN_HLR_NOT_SV1 NOLOGGING AS
                     SELECT *
                      FROM REP_CLEAN_ALL_MERGED T
                      WHERE T.SERVICE_TYPE_NAME = ''Voice''
                      AND T.SERVICE_STATUS <> ''Cancelled''
                      AND( NVL(T.OICK_1, 0)= 42
                       or NVL(T.OICK_1, 0)= 151)
                      AND T.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                      (SELECT 1 FROM MAIN_VPN TV WHERE TV.MSISDN = T.msisdn)';
                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_VPN_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.PROV_RECON_VPN_CPS('FAFIF','REP_VPN_HLR_NOT_SV1','DELETE','VPN','1');
    
    --HLR2
    
      SQL_TXT :='CREATE TABLE REP_VPN_HLR_NOT_SV2 NOLOGGING AS
                     SELECT *
                     FROM REP_CLEAN_ALL_MERGED T
                      WHERE T.SERVICE_TYPE_NAME = ''Voice''
                      AND T.SERVICE_STATUS <> ''Cancelled''
                      AND( NVL(T.OICK_2, 0)= 42
                       or NVL(T.OICK_2, 0)= 151)
                      AND T.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                      (SELECT 1 FROM MAIN_VPN TV WHERE TV.MSISDN = T.msisdn)';
                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_VPN_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.PROV_RECON_VPN_CPS('FAFIF','REP_VPN_HLR_NOT_SV2','DELETE','VPN','2');
    
    -- end added by julie
    
    
       --================================================================================================================
    -- VIP Recon
    --================================================================================================================
    
    
    -- added by julie 20-04-2010
    -- VIP
    
 SQL_TXT :='CREATE TABLE MAIN_VIP NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262 --ALFA CLASSIC
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000324 -- VIP
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
               
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_VIP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
         
    
    --VIP SV NOT IN HLR
    --HLR1
          
    SQL_TXT :='CREATE TABLE REP_VIP_SV_NO_HLR1 NOLOGGING AS
                    SELECT *
                      FROM MAIN_VIP T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.TICK_1, 0)<>320
                       AND T.MSISDN_HLRS IS NOT NULL';
                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_VIP_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_VIP_SV_NO_HLR1','CREATE_ACTIVATE','VIP','1');
    --HLR2
    
         SQL_TXT :='CREATE TABLE REP_VIP_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_VIP T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.TICK_2, 0)<>320
                       AND T.MSISDN_HLRS IS NOT NULL';
                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_VIP_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_VIP_SV_NO_HLR2','CREATE_ACTIVATE','VIP','2');
    
    -- VIP HLR NOT IN SV
    --HLR1
    
       SQL_TXT :='CREATE TABLE REP_VIP_HLR_NOT_SV1 NOLOGGING AS
                  SELECT *
                      FROM REP_CLEAN_ALL_MERGED T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.SERVICE_STATUS<> ''Cancelled''
                       AND NVL(T.TICK_1, 0)= 320
                       AND T.MSISDN_HLRS IS NOT NULL
                        AND NOT EXISTS
                   (SELECT 1 FROM MAIN_VIP TV WHERE TV.MSISDN = T.msisdn)';
                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_VIP_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_VIP_HLR_NOT_SV1','DELETE','VIP','1');
    
    --HLR2
    
      SQL_TXT :='CREATE TABLE REP_VIP_HLR_NOT_SV2 NOLOGGING AS
                 SELECT *
                      FROM REP_CLEAN_ALL_MERGED T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.SERVICE_STATUS<> ''Cancelled''
                       AND NVL(T.TICK_2, 0)= 320
                       AND T.MSISDN_HLRS IS NOT NULL
                        AND NOT EXISTS
                   (SELECT 1 FROM MAIN_VIP TV WHERE TV.MSISDN = T.msisdn)';
                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_VIP_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_VIP_HLR_NOT_SV2','DELETE','VIP','2');
    
    -- end added by julie
    
    
    -- ADDED BY JULIE RECONCILIATION DATA WITH ADDITIONAL NUMBER
   
    --MERGE FAX AND DATA SV
     SQL_TXT :='CREATE TABLE FAX_DATA_SV NOLOGGING AS
                  SELECT T.*
                  FROM REP_CLEAN_ALL_MERGED T  
                  WHERE T.SERVICE_TYPE_NAME IN (''FAX with additional number'',''Data with additional number'')';
    
    IF UTILS_INTERFACES.CREATE_TABLE('FAX_DATA_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    SQL_TXT := 'CREATE TABLE BASE_PRODUCT_SV NOLOGGING AS
                SELECT T.*
                FROM REP_CLEAN_ALL_MERGED T  
                WHERE T.SERVICE_TYPE_NAME IN (''Voice'')';
               
    IF UTILS_INTERFACES.CREATE_TABLE('BASE_PRODUCT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     SQL_TXT :='CREATE TABLE FAX_DATA_ALL_SV NOLOGGING AS
                  SELECT T.MSISDN AS MSISDN_MAIN,
                   T.IMSI AS IMSI_MAIN,
                   TT.*
                FROM base_product_sv T, FAX_DATA_SV TT 
                WHERE T.PRODUCT_INSTANCE_ID (+)= TT.PRODUCT_INSTANCE_ID';
                  
    IF UTILS_INTERFACES.CREATE_TABLE('FAX_DATA_ALL_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    --MERGE DATA AND FAX ADDITIONAL NUMBER IN HLR
     SQL_TXT :='CREATE TABLE DATA_ADDITION_NUM1_CLEAN NOLOGGING AS
                SELECT T.IMSI,
                DECODE(SUBSTR(SUBSTR(T.msisdn1, 4), 1, 1),7,SUBSTR(T.msisdn1, 4),3,''0'' || (SUBSTR(T.msisdn1, 4)),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MAIN_VOICE,
                DECODE(SUBSTR(SUBSTR(T.amsisdn, 4), 1, 1),7,SUBSTR(T.amsisdn, 4),3,''0'' || (SUBSTR(T.amsisdn, 4)),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS ADDITIONAL_MSISDN ,
                T.BC,
                T.BS
                FROM DATA_ADDITION_NUMBER1 T';
                
    IF UTILS_INTERFACES.CREATE_TABLE('DATA_ADDITION_NUM1_CLEAN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
       SQL_TXT :='CREATE TABLE DATA_ADDITION_NUM2_CLEAN NOLOGGING AS
                  SELECT T.IMSI,
                  DECODE(SUBSTR(SUBSTR(T.msisdn1, 4), 1, 1),7,SUBSTR(T.msisdn1, 4),3,''0'' || (SUBSTR(T.msisdn1, 4)),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS MAIN_VOICE,
                  DECODE(SUBSTR(SUBSTR(T.amsisdn, 4), 1, 1),7,SUBSTR(T.amsisdn, 4),3,''0'' || (SUBSTR(T.amsisdn, 4)),1,''0'' || (SUBSTR(NUM_APPEL, 4))) AS ADDITIONAL_MSISDN ,
                  T.BC,
                  T.BS
                  FROM DATA_ADDITION_NUMBER2 T';
                
    IF UTILS_INTERFACES.CREATE_TABLE('DATA_ADDITION_NUM2_CLEAN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    
    SQL_TXT :='CREATE TABLE MERGE_ADDITION_NUM1_NUM2_CLEAN NOLOGGING AS
               SELECT T.IMSI AS IMSI1,
                  T.MAIN_VOICE AS MAIN_VOICE1,
                  T.ADDITIONAL_MSISDN AS ADDITIONAL_MSISDN1,
                  TT.IMSI AS IMSI2,
                  TT.MAIN_VOICE AS MAIN_VOICE2,
                  TT.ADDITIONAL_MSISDN AS ADDITIONAL_MSISDN2,
                  T.BC AS BC1,
                  T.BS AS BS1,
                  TT.BC AS BC2,
                  TT.BS AS BS2
                  FROM DATA_ADDITION_NUM1_CLEAN T, DATA_ADDITION_NUM2_CLEAN TT
                  WHERE T.ADDITIONAL_MSISDN(+)=TT.ADDITIONAL_MSISDN
                  UNION 
                  SELECT T.IMSI AS IMSI1,
                  T.MAIN_VOICE AS MAIN_VOICE1,
                  T.ADDITIONAL_MSISDN AS ADDITIONAL_MSISDN1,
                  TT.IMSI AS IMSI2,
                  TT.MAIN_VOICE AS MAIN_VOICE2,
                  TT.ADDITIONAL_MSISDN AS ADDITIONAL_MSISDN2,
                  T.BC AS BC1,
                  T.BS AS BS1,
                   TT.BC AS BC2,
                   TT.BS AS BS2
                   FROM DATA_ADDITION_NUM1_CLEAN T, DATA_ADDITION_NUM2_CLEAN TT
                   WHERE T.ADDITIONAL_MSISDN=TT.ADDITIONAL_MSISDN(+)';
    
    
    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_ADDITION_NUM1_NUM2_CLEAN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    -- MERGE FAX DATA SV/ HLRS
    
     SQL_TXT :='CREATE TABLE FAX_DATA_MERGED_HLR_SV NOLOGGING AS
                 SELECT t.*, 
                        TT.MAIN_VOICE1,
                        TT.MAIN_VOICE2,
                        TT.ADDITIONAL_MSISDN1,
                        TT.BC1,
                        TT.BS1,
                        TT.BC2,
                        TT.BS2
                      FROM FAX_DATA_ALL_SV t, MERGE_ADDITION_NUM1_NUM2_CLEAN TT
                      WHERE T.MSISDN(+)= TT.ADDITIONAL_MSISDN1
                      UNION
                      SELECT   t.*, 
                        TT.MAIN_VOICE1,
                        TT.MAIN_VOICE2,
                        TT.ADDITIONAL_MSISDN1,
                        TT.BC1,
                        TT.BS1,
                        TT.BC2,
                        TT.BS2
                      FROM FAX_DATA_ALL_SV t, MERGE_ADDITION_NUM1_NUM2_CLEAN TT
                      WHERE t.msisdn =TT.ADDITIONAL_MSISDN1(+)';
    
    
    IF UTILS_INTERFACES.CREATE_TABLE('FAX_DATA_MERGED_HLR_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    -- FAX SV NOT HLR
    -- HLR1
    
     SQL_TXT :='CREATE TABLE REP_FAX_SV_NOT_HLR1 NOLOGGING AS
                 SELECT T.* 
                 FROM FAX_DATA_MERGED_HLR_SV T
                 WHERE 
                 T.SERVICE_TYPE_NAME =''FAX with additional number''
                 AND T.SERVICE_STATUS <>''Cancelled''
                 AND 
                 (T.BC1 <> ''161''
                 OR T.BS1<> ''TS62''
                 OR T.BC1 IS NULL
                 OR T.BS1 IS NULL)';
                
    IF UTILS_INTERFACES.CREATE_TABLE('REP_FAX_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_FAX_SV_NOT_HLR1','CREATE_ACTIVATE','FAX','1');
    -- HLR2
    
     SQL_TXT :='CREATE TABLE REP_FAX_SV_NOT_HLR2 NOLOGGING AS
                SELECT T.* 
                FROM FAX_DATA_MERGED_HLR_SV T
                WHERE 
                T.SERVICE_TYPE_NAME =''FAX with additional number''
                AND T.SERVICE_STATUS <>''Cancelled''
                AND 
                (T.BC2 <> ''161''
                OR T.BS2<> ''TS62''
                OR T.BC2 IS NULL
                OR T.BS2 IS NULL)';
                
    IF UTILS_INTERFACES.CREATE_TABLE('REP_FAX_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_FAX_SV_NOT_HLR2','CREATE_ACTIVATE','FAX','2');
    
    -- FAX HLR NOT IN SV 
    -- HLR1
    SQL_TXT :='CREATE TABLE REP_FAX_HLR_NOT_SV1 NOLOGGING AS
                SELECT T.* 
                FROM FAX_DATA_MERGED_HLR_SV T
                WHERE T.SERVICE_TYPE_NAME <>''FAX with additional number''
                AND T.BC1 = ''161''
                AND T.BS1 = ''TS62''';
                
    IF UTILS_INTERFACES.CREATE_TABLE('REP_FAX_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_FAX_HLR_NOT_SV1','DELETE','FAX','1');
     
    -- HLR2 
    SQL_TXT :='CREATE TABLE REP_FAX_HLR_NOT_SV2 NOLOGGING AS
                SELECT T.* 
                FROM FAX_DATA_MERGED_HLR_SV T
                WHERE T.SERVICE_TYPE_NAME <>''FAX with additional number''
                AND T.BC2 = ''161''
                AND T.BS2 = ''TS62''';
                
    IF UTILS_INTERFACES.CREATE_TABLE('REP_FAX_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_FAX_HLR_NOT_SV2','DELETE','FAX','2');
    
    
    -- DATA SV NOT HLR
    -- HLR1
    
      SQL_TXT :='CREATE TABLE REP_DATA_SV_NOT_HLR1 NOLOGGING AS
                  SELECT T.* 
                  FROM FAX_DATA_MERGED_HLR_SV T
                  WHERE T.SERVICE_TYPE_NAME =''Data with additional number''
                  AND T.SERVICE_STATUS <>''Cancelled''
                  AND (T.BC1 <> ''326''
                  OR T.BS1<> ''BS26''
                  OR T.BC1 IS NULL
                  OR T.BS1 IS NULL)';
                
    IF UTILS_INTERFACES.CREATE_TABLE('REP_DATA_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_DATA_SV_NOT_HLR1','CREATE_ACTIVATE','DATA','1');
    
    -- HLR2
    
     SQL_TXT :='CREATE TABLE REP_DATA_SV_NOT_HLR2 NOLOGGING AS
                  SELECT T.* 
                  FROM FAX_DATA_MERGED_HLR_SV T
                  WHERE T.SERVICE_TYPE_NAME =''Data with additional number''
                  AND T.SERVICE_STATUS <>''Cancelled''
                  AND (T.BC2 <> ''326''
                  OR T.BS2<> ''BS26''
                  OR T.BC2 IS NULL
                  OR T.BS2 IS NULL)';
                
    IF UTILS_INTERFACES.CREATE_TABLE('REP_DATA_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_DATA_SV_NOT_HLR2','CREATE_ACTIVATE','DATA','2');
    
    -- DATA HLR NOT SV
    --HLR1
    
    SQL_TXT :='CREATE TABLE REP_DATA_HLR_NOT_SV1 NOLOGGING AS
                SELECT T.* 
                FROM FAX_DATA_MERGED_HLR_SV T
                WHERE T.SERVICE_TYPE_NAME <>''Data with additional number''
                AND T.BC1 = ''326''
                AND T.BS1 = ''BS26''';
                
    IF UTILS_INTERFACES.CREATE_TABLE('REP_DATA_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_DATA_HLR_NOT_SV1','DELETE','DATA','1');
    
    --HLR2
    
     SQL_TXT :='CREATE TABLE REP_DATA_HLR_NOT_SV2 NOLOGGING AS
                SELECT T.* 
                FROM FAX_DATA_MERGED_HLR_SV T
                WHERE T.SERVICE_TYPE_NAME <>''Data with additional number''
                AND T.BC2 = ''326''
                AND T.BS2 = ''BS26''';
                
    IF UTILS_INTERFACES.CREATE_TABLE('REP_DATA_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_DATA_HLR_NOT_SV2','DELETE','DATA','2');
    
    -- END ADDED BY JULIE RECONCILIATION DATA WITH ADDITIONAL NUMBER
    
    --ADDED BY  JULIE RECONCILIATION GPRS WEB-WAP 17/06/2010
    /*     
    --================================================================================================================
    -- GPRS WEB-WAP main Recon
    --================================================================================================================*/
SQL_TXT :='CREATE TABLE MAIN_GPRS_WEB_WAP_SYS NOLOGGING AS
             SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.MSISDN AS MSISDN_CP,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1000262
                 AND T.Service_Type_Name =''Voice''
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1000327 -- GPRS_WEB_WAP
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_GPRS_WEB_WAP_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
 
--HLR1   
 SQL_TXT :=' CREATE TABLE MERGE_APN1SYS_CP_GPRS_WEB_WAP NOLOGGING AS
              SELECT T.*, TT.*
              FROM MAIN_GPRS_WEB_WAP_SYS t, MERGE_SYS_APN1 TT
              WHERE T.MSISDN_CP(+)=TT.MSISDN
              UNION
              SELECT t.*, TT.*  
              FROM MAIN_GPRS_WEB_WAP_SYS t, MERGE_SYS_APN1 TT
              WHERE t.MSISDN_CP =TT.MSISDN(+)';
              
    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_APN1SYS_CP_GPRS_WEB_WAP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
   SQL_TXT :='CREATE TABLE CLEAN_GPRS_WEB_WAP_APN1_MERGED NOLOGGING AS 
                SELECT  (CASE WHEN M.MSISDN_CP IS NULL THEN M.MSISDN 
                                 WHEN M.MSISDN  IS NULL THEN MSISDN_CP
                                 ELSE M.MSISDN
                                 END)  AS MSISDN_GPRS_WEB_WAP_APN, m.*
                    FROM MERGE_APN1SYS_CP_GPRS_WEB_WAP M'; 
                    
    IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_GPRS_WEB_WAP_APN1_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
   -- CPs and Services having GPRS_WEB_WAP on SV and not in HLR1 (ACTIVATE)

    SQL_TXT := 'CREATE TABLE REP_GPRSWEBWAP_SV_NOT_HLR1 NOLOGGING AS
                SELECT * FROM CLEAN_GPRS_WEB_WAP_APN1_MERGED G
                   WHERE 
                    (G.GPRS_APN1 IS NULL OR G.WAP_APN1 IS NULL OR G.NAM_1 = 1) 
                     AND G.MSISDN_CP IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.SERVICE_TYPE_NAME = ''Voice''
                    ';
                     --AND G.MSISDN_GPRS_WEB_WAP_APN NOT IN (''03499165'', ''03499658'')'; -- ADDED AS REQUESTED FROM ELSY AND SHOULD BE OMITTED IN 5 JULY 2012
                     
     IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSWEBWAP_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSWEBWAP_SV_NOT_HLR1','CREATE_ACTIVATE','MOBILE_INTERNET','1');   
    -- CPs and Services having GPRS_WEB_WAP on HLR and not in SV (Fraud)
    
   SQL_TXT := 'CREATE TABLE REP_GPRSWEBWAP_HLR_NOT_SV1 NOLOGGING AS
               SELECT * FROM CLEAN_GPRS_WEB_WAP_APN1_MERGED G
                   WHERE G.GPRS_APN1 IS NOT NULL
                     AND G.WAP_APN1 IS NOT NULL
                     AND G.NAM_1 = 0
                     --AND (G.MSISDN_CP IS NULL OR G.CP_STATUS LIKE ''%Suspended%'')  Omitted since after rechecking with Jihane the Suspension for WAP and MI no action is taken into consideration for the suspension scenarios 26-03-2012
                     AND (G.MSISDN_CP IS NULL)
                     AND G.SERVICE_TYPE_NAME = ''Voice''
                     AND G.MSISDN_GPRS_WEB_WAP_APN NOT IN (SELECT T.MSISDN_CP FROM MAIN_BB_SYS T)
                     ';
                     --AND G.MSISDN_GPRS_WEB_WAP_APN NOT IN (''03499165'', ''03499658'')'; -- ADDED AS REQUESTED FROM ELSY AND SHOULD BE OMITTED IN 5 JULY 2012
                        
                     /*eraised from reconciliation as per gaby's request over the phone, an email was sent from my side on 24-1-2012
                     AND G.MSISDN_GPRS_WEB_WAP_APN NOT IN (''03107821'', 
                      ''03107797'',''03107838'', ''03107846'', 
                     ''03107732'',''03107760'',
                     ''03107681'',''03107529'')*/
                     /*eraised from reconciliation as per gaby's email 18/1/2012
                     03107738 Roula Batouni- Active
                     03107523 Roula Batouni- Active
                     03107792 Roula Batouni- Active
                     
                     03107366 charbel Aassaf- Active
                     03107352 charbel Aassaf- Active
                     03107324 charbel Aassaf- Active
                     03107343 charbel Aassaf- Active
                       */ 
                     /*eraised from Recon as per Gaby's email 21/12/2011
                     03499147 RE - Active
                     03499207 RE - Active
                     03499847 NAC - Active
                     71631635 RE - Active
                     03399716 RE - Active
                     03108117 - Cancelled
                     03107986 ? Not Needed
                     03108124 ? Cancelled (To be reactivated)
                     03108054 - Active
                     */                   
   
    --''03107902'',''03107938'', ''03107928'' eraised from Recon as per mohamad email 13/09/2011
                     
    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSWEBWAP_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSWEBWAP_HLR_NOT_SV1','DELETE','MOBILE_INTERNET','1'); 
    
 --HLR2   
 SQL_TXT :=' CREATE TABLE MERGE_APN2SYS_CP_GPRS_WEB_WAP NOLOGGING AS
              SELECT T.*, TT.*
              FROM MAIN_GPRS_WEB_WAP_SYS t, MERGE_SYS_APN2 TT
              WHERE T.MSISDN_CP(+)=TT.MSISDN
              UNION
              SELECT t.*, TT.*  
              FROM MAIN_GPRS_WEB_WAP_SYS t, MERGE_SYS_APN2 TT
              WHERE t.MSISDN_CP =TT.MSISDN(+)';
              
              
    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_APN2SYS_CP_GPRS_WEB_WAP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
   SQL_TXT :='CREATE TABLE CLEAN_GPRS_WEB_WAP_APN2_MERGED NOLOGGING AS 
                SELECT  (CASE WHEN M.MSISDN_CP IS NULL THEN M.MSISDN 
                                 WHEN M.MSISDN  IS NULL THEN MSISDN_CP
                                 ELSE M.MSISDN
                                 END)  AS MSISDN_GPRS_WEB_WAP_APN, m.*
                    FROM MERGE_APN2SYS_CP_GPRS_WEB_WAP M'; 
                    
    IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_GPRS_WEB_WAP_APN2_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
   -- CPs and Services having GPRS_WEB_WAP on SV and not in HLR1 (ACTIVATE)
 
    SQL_TXT := 'CREATE TABLE REP_GPRSWEBWAP_SV_NOT_HLR2 NOLOGGING AS
                SELECT * FROM CLEAN_GPRS_WEB_WAP_APN2_MERGED G
                   WHERE (G.GPRS_APN2 IS NULL OR G.WAP_APN2 IS NULL OR G.NAM_2 = 1)
                     AND G.MSISDN_CP IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.SERVICE_TYPE_NAME = ''Voice''
                     ';
                    -- AND G.MSISDN_GPRS_WEB_WAP_APN NOT IN (''03499165'' , ''03499658'')'; -- ADDED AS REQUESTED FROM eLSY AND SHOULD BE OMITTED IN 5 JULY 2012
                     
     IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSWEBWAP_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSWEBWAP_SV_NOT_HLR2','CREATE_ACTIVATE','MOBILE_INTERNET','2'); 
    
    -- CPs and Services having GPRS_WEB_WAP on HLR and not in SV (Fraud)
 
   SQL_TXT := 'CREATE TABLE REP_GPRSWEBWAP_HLR_NOT_SV2 NOLOGGING AS
               SELECT * FROM CLEAN_GPRS_WEB_WAP_APN2_MERGED G
                   WHERE G.GPRS_APN2 IS NOT NULL
                     AND G.NAM_2 = 0
                     AND G.WAP_APN2 IS NOT NULL
                     --AND (G.MSISDN_CP IS NULL OR G.CP_STATUS LIKE ''%Suspended%'') Omitted since after rechecking with Jihane the Suspension for WAP and MI no action is taken into consideration for the suspension scenarios 26-03-2012
                     AND (G.MSISDN_CP IS NULL)
                     AND G.SERVICE_TYPE_NAME = ''Voice''
                     AND G.MSISDN_GPRS_WEB_WAP_APN NOT IN (SELECT T.MSISDN_CP FROM MAIN_BB_SYS T)
                     ';
                    -- AND G.MSISDN_GPRS_WEB_WAP_APN NOT IN (''03499165'' , ''03499658'')';-- ADDED AS REQUESTED FROM ELSY AND SHOULD BE OMITTED IN 5 JULY 2012
                     
              /*   eraised from reconciliation as per gaby's request over the phone, an email was sent from my side on 24-1-2012    
              AND G.MSISDN_GPRS_WEB_WAP_APN NOT IN (''03107821'', 
                     ''03107797'',''03107838'', ''03107846'',
                     ''03107732'',''03107760'',
                     ''03107681'',''03107529''
                     )*/
                     /*eraised from reconciliation as per gaby's email 18/1/2012
                     03107738 Roula Batouni- Active
                     03107523 Roula Batouni- Active
                     03107792 Roula Batouni- Active
                     
                     03107366 charbel Aassaf- Active
                     03107352 
                     03107324
                     03107343 
                       */
                     
                      /*eraised from Recon as per Gaby's email 21/12/2011
                     03499147 RE - Active
                     03499207 RE - Active
                     03499847 NAC - Active
                     71631635 RE - Active
                     03399716 RE - Active
                     03108117 - Cancelled
                     03107986 ? Not Needed
                     03108124 ? Cancelled (To be reactivated)
                     03108054 - Active
                     */            
                     
    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSWEBWAP_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSWEBWAP_HLR_NOT_SV2','DELETE','INTERNET_APN','2');
    
     --''03107902'',''03107938'', ''03107928'' eraised from Recon as per mohamad email 13/09/2011
    
    --END ADDED BY  JULIE RECONCILIATION WAP 22/06/2010
    
      --ADDED BY  JULIE RECONCILIATION WAP 22/06/2010
    /*
    --================================================================================================================
    -- WAP main Recon
    --================================================================================================================*/
SQL_TXT :='CREATE TABLE MAIN_WAP_SYS NOLOGGING AS
             SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.MSISDN AS MSISDN_CP,
                     T.IMSI AS IMSI_SV,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1000262
                 AND T.Service_Type_Name =''Voice''
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1000328 -- WAP
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_WAP_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
 
--HLR1   
 SQL_TXT :=' CREATE TABLE MERGE_APN1SYS_CP_WAP NOLOGGING AS
              SELECT T.*, TT.*
              FROM MAIN_WAP_SYS t, MERGE_SYS_APN1 TT
              WHERE T.MSISDN_CP(+)=TT.MSISDN
              UNION
              SELECT t.*, TT.*  
              FROM MAIN_WAP_SYS t, MERGE_SYS_APN1 TT
              WHERE t.MSISDN_CP =TT.MSISDN(+)';
              
    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_APN1SYS_CP_WAP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
   SQL_TXT :='CREATE TABLE CLEAN_WAP_APN1_MERGED NOLOGGING AS 
                 SELECT  (CASE WHEN W.MSISDN_CP IS NULL THEN W.MSISDN 
                                 WHEN W.MSISDN  IS NULL THEN MSISDN_CP
                                 ELSE W.MSISDN
                                 END)  AS MSISDN,
                        (CASE WHEN W.IMSI IS NULL THEN W.IMSI_SV
                              ELSE W.IMSI
                                 END)  AS IMSI , 
                                  W.MSISDN_CP,   
                                  W.cp_instance_id,
                                  W.CP_START_DATE,
                                  W.CP_END_DATE,
                                  w.cp_status,
                                  W.CP_REASON,
                                  w.account_type,
                                  w.service_type_name,
                                  w.product_type_name,
                                  W.ACCOUNT_NAME,
                                  W.CUSTOMER_NODE_ID,
                                  W.SERVICE_START_DATE,
                                  W.SERVICE_END_DATE,
                                  W.NAM_1,
                                  W.NAM_2,
                                  W.WAP_APN1,
                                  W.GPRS_APN1,
                                  W.MBB_APN1,
                                  W.MMS_APN1,
                                  W.BLACKBERRY_APN1
                    FROM MERGE_APN1SYS_CP_WAP W'; 
                    
    IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_WAP_APN1_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
   -- CPs and Services having WAP on SV and not in HLR1 (ACTIVATE)

    SQL_TXT := 'CREATE TABLE REP_WAP_SV_NOT_HLR1 NOLOGGING AS
                SELECT W.* FROM CLEAN_WAP_APN1_MERGED W
                   WHERE (W.WAP_APN1 IS NULL
                          OR
                          W.NAM_1 = 1)
                     AND W.MSISDN_CP IS NOT NULL
                     AND W.CP_STATUS = ''Active''';
                     --AND W.MSISDN_CP NOT IN (''03499658'')';
                     --AND W.SERVICE_TYPE_NAME = ''Voice''';
                     
     IF UTILS_INTERFACES.CREATE_TABLE('REP_WAP_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_WAP_SV_NOT_HLR1','CREATE_ACTIVATE','WAP','1');
    
    -- CPs and Services having WAP on HLR and not in SV (Fraud)

   SQL_TXT := 'CREATE TABLE REP_WAP_HLR_NOT_SV1 NOLOGGING AS
               SELECT * FROM CLEAN_WAP_APN1_MERGED W
                   WHERE W.WAP_APN1 IS NOT NULL
                     --AND (W.MSISDN_CP IS NULL OR W.CP_STATUS LIKE ''%Suspended%'') Omitted since after rechecking with Jihane the Suspension for WAP and MI no action is taken into consideration for the suspension scenarios 26-03-2012
                     AND (W.MSISDN_CP IS NULL)
                     AND W.NAM_1 = 0
                     AND W.SERVICE_TYPE_NAME = ''Voice''
                     AND W.GPRS_APN1 IS NULL';
                     --AND W.MSISDN NOT IN (''03499658'')';
                     
    IF UTILS_INTERFACES.CREATE_TABLE('REP_WAP_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_WAP_HLR_NOT_SV1','DELETE','WAP','1');
 --HLR2   
 SQL_TXT :=' CREATE TABLE MERGE_APN2SYS_CP_WAP NOLOGGING AS
              SELECT T.*, TT.*
              FROM MAIN_WAP_SYS t, MERGE_SYS_APN2 TT
              WHERE T.MSISDN_CP(+)=TT.MSISDN
              UNION
              SELECT t.*, TT.*  
              FROM MAIN_WAP_SYS t, MERGE_SYS_APN2 TT
              WHERE t.MSISDN_CP =TT.MSISDN(+)';
              
    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_APN2SYS_CP_WAP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
   SQL_TXT :='CREATE TABLE CLEAN_WAP_APN2_MERGED NOLOGGING AS 
                      SELECT  (CASE WHEN W.MSISDN_CP IS NULL THEN W.MSISDN 
                                 WHEN W.MSISDN  IS NULL THEN MSISDN_CP
                                 ELSE W.MSISDN
                                 END)  AS MSISDN,
                        (CASE WHEN W.IMSI IS NULL THEN W.IMSI_SV
                              ELSE W.IMSI
                                 END)  AS IMSI , 
                                  W.MSISDN_CP,   
                                  W.cp_instance_id,
                                  W.CP_START_DATE,
                                  W.CP_END_DATE,
                                  w.cp_status,
                                  W.CP_REASON,
                                  w.account_type,
                                  w.service_type_name,
                                  w.product_type_name,
                                  W.ACCOUNT_NAME,
                                  W.CUSTOMER_NODE_ID,
                                  W.SERVICE_START_DATE,
                                  W.SERVICE_END_DATE,
                                  W.NAM_1,
                                  W.NAM_2,
                                  W.WAP_APN2,
                                  W.GPRS_APN2,
                                  W.MBB_APN2,
                                  W.MMS_APN2,
                                  W.BLACKBERRY_APN2
                    FROM MERGE_APN2SYS_CP_WAP W'; 
                    
    IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_WAP_APN2_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
   -- CPs and Services having WAP on SV and not in HLR1 (ACTIVATE)
 
    SQL_TXT := 'CREATE TABLE REP_WAP_SV_NOT_HLR2 NOLOGGING AS
                SELECT * FROM CLEAN_WAP_APN2_MERGED W
                   WHERE W.WAP_APN2 IS NULL
                     AND (W.MSISDN_CP IS NOT NULL
                          OR
                          W.NAM_2 = 1 )
                     AND W.CP_STATUS = ''Active''';
                    
                     --AND W.SERVICE_TYPE_NAME = ''Voice''';
                     
                     -- AND W.MSISDN_CP NOT IN (''03499658'')
                     
     IF UTILS_INTERFACES.CREATE_TABLE('REP_WAP_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_WAP_SV_NOT_HLR2','CREATE_ACTIVATE','WAP','2');
    
    -- CPs and Services having WAP on HLR and not in SV (Fraud)
 
   SQL_TXT := 'CREATE TABLE REP_WAP_HLR_NOT_SV2 NOLOGGING AS
               SELECT * FROM CLEAN_WAP_APN2_MERGED W
                   WHERE W.WAP_APN2 IS NOT NULL
                      -- AND (W.MSISDN_CP IS NULL OR W.CP_STATUS LIKE ''%Suspended%'') Omitted since after rechecking with Jihane the Suspension for WAP and MI no action is taken into consideration for the suspension scenarios 26-03-2012
                     AND (W.MSISDN_CP IS NULL)
                     AND W.NAM_2 = 0
                     AND W.SERVICE_TYPE_NAME = ''Voice''
                     AND W.GPRS_APN2 IS NULL';
                    -- AND W.MSISDN NOT IN (''03499658'')';
                     
    IF UTILS_INTERFACES.CREATE_TABLE('REP_WAP_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_WAP_HLR_NOT_SV2','DELETE','WAP','2');
    
    --END ADDED BY  JULIE RECONCILIATION WAP 22/06/2010
    
    
    --ADDED BY  JULIE RECONCILIATION GPRS INTRANET 12/07/2010
    /*    
    --================================================================================================================
    -- GPRS INTRANET main Recon
    --================================================================================================================*/
    SQL_TXT := 'CREATE TABLE MAIN_GPRS_INTRA_SYS NOLOGGING AS
                  SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.MSISDN AS MSISDN_CP,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1000262
                 AND T.Service_Type_Name =''Voice''
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1000338 -- GPRS Intranet
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_GPRS_INTRA_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;    
   --HLR1  
    
    SQL_TXT := 'CREATE TABLE MERGE_APN1SYS_CP_GPRSINTRA AS
                SELECT T.*, TT.*
                FROM MAIN_GPRS_INTRA_SYS t, MERGE_SYS_APN1 TT
                WHERE T.MSISDN_CP(+)=TT.MSISDN
                UNION
                SELECT t.*, TT.*  
                FROM MAIN_GPRS_INTRA_SYS t, MERGE_SYS_APN1 TT
                WHERE t.MSISDN_CP =TT.MSISDN(+)' ;
                
    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_APN1SYS_CP_GPRSINTRA', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;         
          
  
    
     SQL_TXT := 'CREATE TABLE CLEAN_GPRSINTA_APN1_MERGED NOLOGGING AS
                    SELECT  (CASE WHEN M.MSISDN_CP IS NULL THEN M.MSISDN 
                                 WHEN M.MSISDN  IS NULL THEN MSISDN_CP
                                 ELSE M.MSISDN
                                 END)  AS MSISDN_GPRSINTRA_APN, m.*
                    FROM MERGE_APN1SYS_CP_GPRSINTRA M';
                    
    IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_GPRSINTA_APN1_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
      -- CPs and Services having GPRSINTRA on SV and not in HLR1 (ACTIVATE)
      
      SQL_TXT := 'CREATE TABLE REP_GPRSINTRA_SV_NOT_HLRAPN1 NOLOGGING AS
                  SELECT * FROM CLEAN_GPRSINTA_APN1_MERGED B
                   WHERE B.GPRS_INTRA_APN1 IS NULL
                     AND B.MSISDN_CP IS NOT NULL
                     AND B.CP_STATUS = ''Active''
                     AND B.SERVICE_TYPE_NAME = ''Voice''' ;
                     
      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSINTRA_SV_NOT_HLRAPN1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;    
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSINTRA_SV_NOT_HLRAPN1','CREATE_ACTIVATE','GPRS_INTRANET','1');
     -- CPs and Services having GPRSINTRA on HLR and not in SV (Fraud)   
     
       SQL_TXT := 'CREATE TABLE REP_GPRSINTA_HLRAPN_NOT_SV NOLOGGING AS
                  SELECT * FROM CLEAN_GPRSINTA_APN1_MERGED B
                   WHERE B.GPRS_INTRA_APN1 IS NOT NULL
                     AND B.MSISDN_CP IS NULL
                     AND B.SERVICE_TYPE_NAME = ''Voice''';   
                    
    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSINTA_HLRAPN_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;      
     RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSINTA_HLRAPN_NOT_SV','DELETE','GPRS_INTRANET','1');        

   --HLR2 
     SQL_TXT :='CREATE TABLE MERGE_APN1SYS_CP_GPRSINTRA_2 AS
                   SELECT T.*, TT.*
                   FROM MAIN_GPRS_INTRA_SYS t, MERGE_SYS_APN2 TT
                   WHERE T.MSISDN_CP(+)=TT.MSISDN
                   UNION
                   SELECT t.*, TT.*  
                   FROM MAIN_GPRS_INTRA_SYS t, MERGE_SYS_APN2 TT
                   WHERE t.MSISDN_CP =TT.MSISDN(+)';
                   
   IF UTILS_INTERFACES.CREATE_TABLE('MERGE_APN1SYS_CP_GPRSINTRA_2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    SQL_TXT :='CREATE TABLE CLEAN_GPRSINTA_APN2_MERGED NOLOGGING AS
                    SELECT  (CASE WHEN M.MSISDN_CP IS NULL THEN M.MSISDN 
                                 WHEN M.MSISDN  IS NULL THEN MSISDN_CP
                                 ELSE M.MSISDN
                                 END)  AS MSISDN_GPRSINTRA_APN, m.*
                    FROM MERGE_APN1SYS_CP_GPRSINTRA_2 M';
                    
    IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_GPRSINTA_APN2_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    -- CPs and Services having GPRSINTRA on SV and not in HLR2 (ACTIVATE)
   
    SQL_TXT :='CREATE TABLE REP_GPRSINTRA_SV_NOT_HLRAPN2 NOLOGGING AS
                  SELECT * FROM CLEAN_GPRSINTA_APN2_MERGED B
                   WHERE B.GPRS_INTRA_APN2 IS NULL
                     AND B.MSISDN_CP IS NOT NULL
                     AND B.CP_STATUS = ''Active''
                     AND B.SERVICE_TYPE_NAME = ''Voice''';
                     
    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSINTRA_SV_NOT_HLRAPN2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSINTRA_SV_NOT_HLRAPN2','CREATE_ACTIVATE','GPRS_INTRANET','2');
    -- CPs and Services having GPRSINTRA on HLR and not in SV (Fraud)   
    
    SQL_TXT :='CREATE TABLE REP_GPRSINTA_HLRAPN2_NOT_SV NOLOGGING AS
                  SELECT * FROM CLEAN_GPRSINTA_APN2_MERGED B
                   WHERE B.GPRS_INTRA_APN2 IS NOT NULL
                     AND B.MSISDN_CP IS NULL
                     AND B.SERVICE_TYPE_NAME = ''Voice''';
                         
    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSINTA_HLRAPN2_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSINTA_HLRAPN2_NOT_SV','DELETE','GPRS_INTRANET','2');
    
    
    --END ADDED BY  JULIE RECONCILIATION GPRS INTRANET 12/07/2010
    
    
    -- ADDED BY JULIE 17/09/2010
    --================================================================================================================
    -- CONFERENCE MULTIPARTY
    --================================================================================================================
    
     SQL_TXT := 'CREATE TABLE MAIN_CMP NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID in (1000262,1000241) -- Alfa Classic, Alfa Active
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000334 -- Conference Multiparty CMP
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CMP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;    
    
    -- CMP SV NOT HLR1
    
       SQL_TXT := 'CREATE TABLE REP_CMP_SV_NO_HLR1 NOLOGGING AS
                    select * from MAIN_CMP T
                    WHERE T.MPTY_1 IS NULL
                      AND T.CP_STATUS = 3
                      AND t.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CMP_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;    
    
  --  RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CMP_SV_NO_HLR1','CREATE_ACTIVATE','CMP','1');
    
    
    SQL_TXT := 'CREATE TABLE REP_CMP_SV_NO_HLR2 NOLOGGING AS
                   select * from MAIN_CMP T
                   WHERE T.MPTY_2 IS NULL
                     AND T.CP_STATUS = 3
                    AND t.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                     AND t.MSISDN_HLRS IS NOT NULL';
                     
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CMP_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
  --  RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CMP_SV_NO_HLR2','CREATE_ACTIVATE','CMP','2');
    
     -- CMP HLR1 NOT SV ==> Fraud

     SQL_TXT := 'CREATE TABLE REP_CMP_HLR_NOT_SV1 NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE NVL(M.MPTY_1,0) = 1
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_CMP MC WHERE MC.MSISDN = m.msisdn)';
                   
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CMP_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
   -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CMP_HLR_NOT_SV1','DELETE','CMP','1');
    
     -- CMP HLR2 NOT SV ==> Fraud
     
     SQL_TXT := 'CREATE TABLE REP_CMP_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE NVL(M.MPTY_2,0) = 1
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_CMP MC WHERE MC.MSISDN = m.msisdn)';
                   
    IF UTILS_INTERFACES.CREATE_TABLE('REP_CMP_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
  --  RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CMP_HLR_NOT_SV2','DELETE','CMP','2');
    
    --================================================================================================================
    -- DBJUM
    --================================================================================================================
    --================================================================================================================
    -- SMS
    --================================================================================================================
    
    /* SQL_TXT := 'CREATE TABLE MAIN_SMS_SYS NOLOGGING AS
            SELECT \*+ index(t IX_PRODUCT_INSTANCE_ID)*\
                     T.*,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1001760
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS SMS_MODE         
                 FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262 -- Alfa Classic
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000332 -- SMS
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
           
     
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_SMS_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;        
               
      -- BOTH SMS MODE ON SV NOT ON HLR1  
      
          SQL_TXT := 'CREATE TABLE REP_SMS_SV_NO_HLR1 NOLOGGING AS
                   select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''Both''
                      AND NVL(T.TS21_1,0) <> 1 
                      AND NVL(T.TS22_1,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL'; 
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
   --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1');
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMS_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1','BOTH');

    -- BOTH SMS MODE ON SV NOT ON HLR2  
    
      SQL_TXT := 'CREATE TABLE REP_SMS_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''Both''
                      AND  NVL(T.TS21_2,0) <> 1 
                      AND NVL(T.TS22_2,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL'; 
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;                                
            
    --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2');
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMS_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2','BOTH');    
    -- BOTH SMS MODE ON HLR1 NOT ON SV                    
    
     SQL_TXT := ' CREATE TABLE REP_SMS_HLR_NO_SV1 NOLOGGING AS
                  select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS21_1,0) = 1
                      AND NVL(T.TS22_1,0) = 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND MS.SMS_MODE = ''Both'')';
        
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;   
    
     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_HLR_NO_SV1','DELETE','SMS','1');
     RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMS_HLR_NO_SV1','DELETE','SMS','1','BOTH');  
    
    -- BOTH SMS MODE ON HLR2 NOT ON SV            
         
    SQL_TXT := 'CREATE TABLE REP_SMS_HLR_NO_SV2 NOLOGGING AS
                    select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS21_2,0) = 1 
                      AND NVL(T.TS22_2,0) = 1 
                       AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND MS.SMS_MODE = ''Both'')'; 
                   
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;    
    
     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_HLR_NO_SV2','DELETE','SMS','2'); 
     RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMS_HLR_NO_SV2','DELETE','SMS','2','BOTH');  
      
     -- SMSMO SMS MODE ON SV NOT ON HLR1   
     SQL_TXT := 'CREATE TABLE REP_SMSMO_SV_NO_HLR1 NOLOGGING AS
                   select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMO''
                      AND NVL(T.TS22_1,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1');     
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMO_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1','MO');
     -- SMSMO SMS MODE ON SV NOT ON HLR2 
     
      SQL_TXT := 'CREATE TABLE REP_SMSMO_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMO''
                      AND NVL(T.TS22_2,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
     -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2');
      RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMO_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2','MO');     
     -- SMSMO SMS MODE ON HLR1 NOT ON SV
     
    SQL_TXT := 'CREATE TABLE REP_SMSMO_HLR_NO_SV1 NOLOGGING AS
                  select * from REP_CLEAN_ALL_MERGED T
                    WHERE  NVL(T.TS22_1,0) = 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMO'' OR MS.SMS_MODE = ''Both''))';
       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_HLR_NO_SV1','DELETE','SMS','1'); 
        RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMO_HLR_NO_SV1','DELETE','SMS','1','MO');     
    
    -- SMSMO SMS MODE ON HLR1 NOT ON SV
     SQL_TXT := ' CREATE TABLE REP_SMSMO_HLR_NO_SV2 NOLOGGING AS
                    select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS22_2,0) = 1 
                       AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMO'' OR MS.SMS_MODE = ''Both''))';
       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_HLR_NO_SV2','DELETE','SMS','2');
 RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMO_HLR_NO_SV2','DELETE','SMS','2','MO');
     -- SMSMT SMS MODE ON SV NOT ON HLR1                   
           
      SQL_TXT := ' CREATE TABLE REP_SMSMT_SV_NO_HLR1 NOLOGGING AS
                   select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMT''
                      AND NVL(T.TS21_1,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
                
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
     -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1'); 
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMT_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1','MT');
    -- SMSMT SMS MODE ON SV NOT ON HLR2 
    SQL_TXT := 'CREATE TABLE REP_SMSMT_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMT''
                      AND NVL(T.TS21_2,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
       
     IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF; 
     
     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2');   
        RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMT_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2','MT');
      -- SMSMT SMS MODE ON HLR1 NOT ON SV
      SQL_TXT := 'CREATE TABLE REP_SMSMT_HLR_NO_SV1 NOLOGGING AS
                  select * from REP_CLEAN_ALL_MERGED T
                    WHERE  NVL(T.TS21_1,0) = 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMT'' OR MS.SMS_MODE = ''Both''))';
                   
     IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF; 
     
    -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_HLR_NO_SV1','DELETE','SMS','1'); 
       RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMT_HLR_NO_SV1','DELETE','SMS','1','MT');   
     
      -- SMSMT SMS MODE ON HLR2 NOT ON SV  
        SQL_TXT := 'CREATE TABLE REP_SMSMT_HLR_NO_SV2 NOLOGGING AS
                    select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS21_2,0) = 1 
                       AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMT'' OR MS.SMS_MODE = ''Both''))';
                   
     IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF; 
     
     -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_HLR_NO_SV2','DELETE','SMS','2');
       RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMT_HLR_NO_SV2','DELETE','SMS','2','MT');*/ 
    --================================================================================================================
    -- SMS
    --================================================================================================================
    
    /* SQL_TXT := 'CREATE TABLE MAIN_SMS_SYS NOLOGGING AS
            SELECT \*+ index(t IX_PRODUCT_INSTANCE_ID)*\
                     T.*,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1001760
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS SMS_MODE         
                 FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262 -- Alfa Classic
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000332 -- SMS
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
           
     
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_SMS_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;        
               
      -- BOTH SMS MODE ON SV NOT ON HLR1  
      
          SQL_TXT := 'CREATE TABLE REP_SMS_SV_NO_HLR1 NOLOGGING AS
                   select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''Both''
                      AND NVL(T.TS21_1,0) <> 1 
                      AND NVL(T.TS22_1,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL'; 
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
   RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1');
    
    -- BOTH SMS MODE ON SV NOT ON HLR2  
    
      SQL_TXT := 'CREATE TABLE REP_SMS_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''Both''
                      AND  NVL(T.TS21_2,0) <> 1 
                      AND NVL(T.TS22_2,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL'; 
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;                                
            
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2');    
    -- BOTH SMS MODE ON HLR1 NOT ON SV                    
    
     SQL_TXT := ' CREATE TABLE REP_SMS_HLR_NO_SV1 NOLOGGING AS
                  select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS21_1,0) = 1
                      AND NVL(T.TS22_1,0) = 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND MS.SMS_MODE = ''Both'')';
        
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;   
    
     RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_HLR_NO_SV1','DELETE','SMS','1');
    
    -- BOTH SMS MODE ON HLR2 NOT ON SV            
         
    SQL_TXT := 'CREATE TABLE REP_SMS_HLR_NO_SV2 NOLOGGING AS
                    select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS21_2,0) = 1 
                      AND NVL(T.TS22_2,0) = 1 
                       AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND MS.SMS_MODE = ''Both'')'; 
                   
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;    
    
     RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_HLR_NO_SV2','DELETE','SMS','2');   
     -- SMSMO SMS MODE ON SV NOT ON HLR1   
     SQL_TXT := 'CREATE TABLE REP_SMSMO_SV_NO_HLR1 NOLOGGING AS
                   select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMO''
                      AND NVL(T.TS22_1,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
     RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1');     
    
     -- SMSMO SMS MODE ON SV NOT ON HLR2 
     
      SQL_TXT := 'CREATE TABLE REP_SMSMO_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMO''
                      AND NVL(T.TS22_2,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2');     
     -- SMSMO SMS MODE ON HLR1 NOT ON SV
     
    SQL_TXT := 'CREATE TABLE REP_SMSMO_HLR_NO_SV1 NOLOGGING AS
                  select * from REP_CLEAN_ALL_MERGED T
                    WHERE  NVL(T.TS22_1,0) = 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMO'' OR MS.SMS_MODE = ''Both''))';
       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
     RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_HLR_NO_SV1','DELETE','SMS','1');     
    
    -- SMSMO SMS MODE ON HLR1 NOT ON SV
     SQL_TXT := ' CREATE TABLE REP_SMSMO_HLR_NO_SV2 NOLOGGING AS
                    select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS22_2,0) = 1 
                       AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMO'' OR MS.SMS_MODE = ''Both''))';
       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
     RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_HLR_NO_SV2','DELETE','SMS','2');
    
     -- SMSMT SMS MODE ON SV NOT ON HLR1                   
           
      SQL_TXT := ' CREATE TABLE REP_SMSMT_SV_NO_HLR1 NOLOGGING AS
                   select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMT''
                      AND NVL(T.TS21_1,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
                
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1'); 
    
    -- SMSMT SMS MODE ON SV NOT ON HLR2 
    SQL_TXT := 'CREATE TABLE REP_SMSMT_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMT''
                      AND NVL(T.TS21_2,0) <> 1 
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
       
     IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF; 
     
     RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2');   
     
      -- SMSMT SMS MODE ON HLR1 NOT ON SV
      SQL_TXT := 'CREATE TABLE REP_SMSMT_HLR_NO_SV1 NOLOGGING AS
                  select * from REP_CLEAN_ALL_MERGED T
                    WHERE  NVL(T.TS21_1,0) = 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMT'' OR MS.SMS_MODE = ''Both''))';
                   
     IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF; 
     
     RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_HLR_NO_SV1','DELETE','SMS','1');    
     
      -- SMSMT SMS MODE ON HLR2 NOT ON SV  
        SQL_TXT := 'CREATE TABLE REP_SMSMT_HLR_NO_SV2 NOLOGGING AS
                    select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS21_2,0) = 1 
                       AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMT'' OR MS.SMS_MODE = ''Both''))';
                   
     IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF; 
     
      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_HLR_NO_SV2','DELETE','SMS','2');*/
     
     -- VIDEO CALL SCENARIOS
     
     SQL_TXT := 'CREATE TABLE MAIN_VIDEOCALL_SYS NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.*,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1200041
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_6) AS VIDEO_RATE_PLAN         
                 FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262 -- Alfa Classic
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1200041 -- VIDEO CALL
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
           
     
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_VIDEOCALL_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    
     SQL_TXT := 'CREATE TABLE REP_VCALL_SV_NO_HLR1 NOLOGGING AS
                    select * from MAIN_VIDEOCALL_SYS T
                    WHERE T.BS3G_1 IS NULL
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                        AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_VCALL_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.PROV_RECON_BS3G_PARAM ('FAFIF','REP_VCALL_SV_NO_HLR1','1');
    
     SQL_TXT := ' CREATE TABLE REP_VCALL_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_VIDEOCALL_SYS T
                    WHERE T.BS3G_2 IS NULL
                      AND T.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_VCALL_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.PROV_RECON_BS3G_PARAM ('FAFIF','REP_VCALL_SV_NO_HLR2','1');
    
      SQL_TXT := ' CREATE TABLE REP_VCALL_HLR_NOT_SV1 NOLOGGING AS
            select * from REP_CLEAN_ALL_MERGED T
            WHERE T.BS3G_1 = 1 
              AND T.PROD_STATUS = 3
              AND T.SERVICE_STATUS <> ''Cancelled''
              AND T.SERVICE_TYPE_NAME = ''Voice'' 
                 AND NOT EXISTS
                   (SELECT 1 FROM MAIN_VIDEOCALL_SYS MV WHERE MV.MSISDN = T.MSISDN)';
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_VCALL_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.PROV_RECON_BS3G_PARAM ('FAFIF','REP_VCALL_HLR_NOT_SV1','0'); 
    
     SQL_TXT := ' CREATE TABLE REP_VCALL_HLR_NOT_SV2 NOLOGGING AS
            select * from REP_CLEAN_ALL_MERGED T
            WHERE T.BS3G_2 = 1 
              AND T.PROD_STATUS = 3
              AND T.SERVICE_STATUS <> ''Cancelled''
              AND T.SERVICE_TYPE_NAME = ''Voice''
                 AND NOT EXISTS
                   (SELECT 1 FROM MAIN_VIDEOCALL_SYS MV WHERE MV.MSISDN = T.MSISDN)';
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_VCALL_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    RECONCILIATION_INTERFACES.PROV_RECON_BS3G_PARAM ('FAFIF','REP_VCALL_HLR_NOT_SV2','0'); 
    
     -- MOBILE BROADBAND SCENARIOS
     
     SQL_TXT := 'CREATE TABLE MAIN_MBB_SYS NOLOGGING AS
                 SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.Msisdn AS MSISDN_BP,
                     T.IMSI AS IMSI_SV,
                     T.PRODUCT_INSTANCE_ID AS BP_INSTANCE_ID,
                     T.SERVICE_TYPE_NAME AS MBB_TYPE,
                     T.SERVICE_STATUS AS MBB_STATUS,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=1200100
                           AND RCR.REFERENCE_CODE = T.RATE_PLAN) AS VOLUME_OPTION
                 FROM REP_CLEAN_ALL_MERGED T
                 WHERE T.PRODUCT_TYPE_NAME in (''Mobile Broadband Postpaid'',''Mobile Broadband Prepaid'')';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_MBB_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
     SQL_TXT := 'CREATE TABLE MERGE_APN1SYS_MBB NOLOGGING AS
                  SELECT T.*, TT.*
                  FROM MAIN_MBB_SYS t, MERGE_SYS_APN1 TT
                  WHERE T.MSISDN_BP(+)=TT.MSISDN
                  UNION
                  SELECT t.*, TT.*  
                  FROM MAIN_MBB_SYS t, MERGE_SYS_APN1 TT
                  WHERE t.MSISDN_BP =TT.MSISDN(+)';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_APN1SYS_MBB', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
       
     SQL_TXT := 'CREATE TABLE CLEAN_MBB_APN1SYS_MERGED NOLOGGING AS 
                SELECT  (CASE WHEN M.MSISDN_BP IS NULL THEN M.MSISDN 
                                 WHEN M.MSISDN  IS NULL THEN MSISDN_BP
                                 ELSE M.MSISDN
                                 END)  AS MSISDN_MBB_APN, m.*
                    FROM MERGE_APN1SYS_MBB M';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_MBB_APN1SYS_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
    
     SQL_TXT := 'CREATE TABLE MERGE_APN2SYS_MBB NOLOGGING AS
                  SELECT T.*, TT.*
                  FROM MAIN_MBB_SYS t, MERGE_SYS_APN2 TT
                  WHERE T.MSISDN_BP(+)=TT.MSISDN
                  UNION
                  SELECT t.*, TT.*  
                  FROM MAIN_MBB_SYS t, MERGE_SYS_APN2 TT
                  WHERE t.MSISDN_BP =TT.MSISDN(+)';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_APN2SYS_MBB', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    
         SQL_TXT := 'CREATE TABLE CLEAN_MBB_APN2SYS_MERGED NOLOGGING AS 
                SELECT  (CASE WHEN M.MSISDN_BP IS NULL THEN M.MSISDN 
                                 WHEN M.MSISDN  IS NULL THEN MSISDN_BP
                                 ELSE M.MSISDN
                                 END)  AS MSISDN_MBB_APN, m.*
                    FROM MERGE_APN2SYS_MBB M';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_MBB_APN2SYS_MERGED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;   
              
     SQL_TXT := 'CREATE TABLE REP_MBB_SV_NOT_HLR1 NOLOGGING AS
                  select * from CLEAN_MBB_APN1SYS_MERGED t
                 WHERE T.MBB_TYPE IN (''Prepaid Broadband'',''Postpaid Broadband'') 
                 AND T.MBB_STATUS = ''Active''
                 AND (T.MSISDN_HLR1 IS NULL
                  OR T.BS26_1 <> 1
                  --OR T.NAM_1 <> 0
                  OR T.MBB_APN1 IS NULL)';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    
    
     SQL_TXT := 'CREATE TABLE REP_MBB_POST_SV_NOT_HLR1 NOLOGGING AS
                  select * from REP_MBB_SV_NOT_HLR1 t
                 WHERE T.MBB_TYPE IN (''Postpaid Broadband'')
                 
                  '; --MISP MSISDN requested by jihane Nassif to be excluded
                        
                        /*AND t.msisdn_mbb_apn not in ( 
                                              ''76541892'',
                                              ''76541894'',
                                              ''76541926'',
                                              ''76541901'',
                                              ''76541895'' )    */    
     
     
                            
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_POST_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MBB_POST_SV_NOT_HLR1','CREATE_ACTIVATE','MOBILE_BROADBAND_POSTPAY','1'); 
    
      SQL_TXT := 'CREATE TABLE REP_MBB_PREP_SV_NOT_HLR1 NOLOGGING AS
                  select * from REP_MBB_SV_NOT_HLR1 t
                 WHERE T.MBB_TYPE IN (''Prepaid Broadband'')
                  ';  --MISP MSISDN requested by jihane Nassif to be excluded
                 
   
               /*  AND t.msisdn_mbb_apn not in (''76447479'',
                                              ''76541892'',
                                              ''76541894'',
                                              ''76541926'',
                                              ''76541901'',
                                              ''76541895'' )*/
   
   
   
   
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_PREP_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MBB_PREP_SV_NOT_HLR1','CREATE_ACTIVATE','MOBILE_BROADBAND_PREPAY','1');
     
    
     SQL_TXT := 'CREATE TABLE REP_MBB_SV_NOT_HLR2 NOLOGGING AS
                  select * from CLEAN_MBB_APN2SYS_MERGED t
                 WHERE T.MBB_TYPE IN (''Prepaid Broadband'',''Postpaid Broadband'') 
                 AND T.MBB_STATUS = ''Active'' 
                 AND (T.MSISDN_HLR2 IS NULL
                  OR T.BS26_2 <> 1
                  --OR T.NAM_2 <> 0
                  OR T.MBB_APN2 IS NULL)';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
     SQL_TXT := 'CREATE TABLE REP_MBB_POST_SV_NOT_HLR2 NOLOGGING AS
                  select * from REP_MBB_SV_NOT_HLR2 t
                 WHERE T.MBB_TYPE IN (''Postpaid Broadband'')
                 ';  
   
   
   
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_POST_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MBB_POST_SV_NOT_HLR2','CREATE_ACTIVATE','MOBILE_BROADBAND_POSTPAY','2');
     
      SQL_TXT := 'CREATE TABLE REP_MBB_PREP_SV_NOT_HLR2 NOLOGGING AS
                  select * from REP_MBB_SV_NOT_HLR2 t
                 WHERE T.MBB_TYPE IN (''Prepaid Broadband'')
                 ';  
    
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_PREP_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MBB_PREP_SV_NOT_HLR2','CREATE_ACTIVATE','MOBILE_BROADBAND_PREPAY','2');
     
       
     SQL_TXT := '  CREATE TABLE REP_MBB_HLR1_NOT_SV NOLOGGING AS
                   select * from CLEAN_MBB_APN1SYS_MERGED t
                    WHERE T.MSISDN_HLR1 IS NOT NULL
                    AND T.BS26_1 = 1
                    AND T.NAM_1 = 0
                    AND T.MBB_APN1 IS NOT NULL
                    AND (T.PRODUCT_TYPE_NAME not in (''Mobile Broadband Postpaid'', ''Mobile Broadband Prepaid'', ''Alfa Active'')
                          OR T.SERVICE_STATUS = ''Cancelled'' )
                  
                  
                    )'; 
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_HLR1_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MBB_HLR1_NOT_SV','DELETE','MOBILE_BROADBAND_POSTPAY','1');

      SQL_TXT := ' CREATE TABLE REP_MBB_HLR2_NOT_SV NOLOGGING AS
                    select * from CLEAN_MBB_APN2SYS_MERGED t
                    WHERE T.MSISDN_HLR2 IS NOT NULL
                    AND T.BS26_2 = 1
                    AND T.NAM_2 = 0
                    AND T.MBB_APN2 IS NOT NULL
                    AND (T.PRODUCT_TYPE_NAME not in (''Mobile Broadband Postpaid'', ''Mobile Broadband Prepaid'', ''Alfa Active'') 
                    OR T.SERVICE_STATUS = ''Cancelled'' )
                    '; -- THESE MSISDN SHOULD BE RE-INCLUDED IN 23/08/2012
                      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_HLR2_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
     
     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MBB_HLR2_NOT_SV','DELETE','MOBILE_BROADBAND_POSTPAY','2');
     
    -- ==========================================================================================================
    -- End of Reconciliation Phase IV Interface
    -- ==========================================================================================================

 EXCEPTION
 WHEN OTHERS THEN
 NULL;



    
  END P4_CP_INTERFACES_OLD;

PROCEDURE P1_CALL_COMPLETION_INTERFACES(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS

    -- =============================================================================================
    --    Pre-requisite               : 
    --    Release                     : 
    --    Date                        : 19/07/2018
    --    Author                      : fady/jULIE
    --    Requirement  version        : V1.0
    --    Comments                    : Reconciliation CPs
    --   -------------------------------------------------------------------------------------------


    --================================================================================================================
    -- sql_txt : contains the sql statment body
    --================================================================================================================
    SQL_TXT             VARCHAR2(6000);
    RELEASE              VARCHAR2(20)    := 'R1.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;


    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);

BEGIN

 --================================================================================================================
    -- Call Completion main Recon
    --================================================================================================================*/

           
SQL_TXT :='CREATE TABLE MAIN_CALL_COMPLETION_SYS NOLOGGING AS
             SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.* ,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1325280
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS SMART_COMPANION_NAME,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1375021
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_6) AS SCP_VOLUME_OPTION
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID  in (1000262,1000241)  -- ALFA CLASSIC and ALFA ACTIVE
                 AND T.Service_Type_Name in (''Voice'', ''Prepaid'')
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID in (1375022,1375023) -- Smart Companion Postpaid
                  AND PIH.GENERAL_5 in (70001003,70001004) -- SCP NAMES For Call ME Back and Collect Call: ,70001017,70001018,70001019,70001020,70001021,70001022 Decommissioned
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CALL_COMPLETION_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
      IF UTILS_INTERFACES.CREATE_INDEX('MAIN_CALL_COMPLETION_SYS',
                                     'FAFIF',
                                     'IX_MAIN_CC_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;

 EXCEPTION
 WHEN OTHERS THEN
 NULL;
  
END P1_CALL_COMPLETION_INTERFACES;

PROCEDURE P4_CP_INTERFACES(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS


    -- =============================================================================================
    --    Pre-requisite               : SV DMP
    --    Release                     : R1.0
    --    Date                        : 31/10/2009
    --    Author                      : FAF
    --    Requirement  version        : V1.0
    --    Comments                    : Reconciliation CPs
    --   -------------------------------------------------------------------------------------------


    --================================================================================================================
    -- sql_txt : contains the sql statment body
    --================================================================================================================
    SQL_TXT             VARCHAR2(4000);
    RELEASE              VARCHAR2(20)    := 'R1.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;


    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);




  BEGIN


    UTILS_INTERFACES.INTERFACE_NAME := 'P4_CP_INTERFACES';
    
    --================================================================================================================
    -- MMS is decommissioned
    --================================================================================================================

  /*SQL_TXT := 'CREATE TABLE MAIN_MMS_SYS NOLOGGING AS
            SELECT \*+ index(t IX_PRODUCT_INSTANCE_ID)*\
                     T.*,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1325070
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_6) AS MMS_VOLUME_OPTION
                 FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID in (1000241,1000262) -- Alfa Active, Alfa Classic
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000333 -- MMS
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_MMS_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

           SQL_TXT := 'CREATE TABLE REP_MMS_SV_NO_HLR1 NOLOGGING AS
                       SELECT T.MSISDN, T.MMS_APN1,T.IMSI from MAIN_MMS_SYS T
                       WHERE 
                       T.MMS_APN1 <> 9
                       AND T.CP_STATUS not in (''Cancelled'',''Moved'')
                       AND T.SERVICE_STATUS NOT IN (''Cancelled'',''Moved'')
                       AND t.MSISDN_HLRS IS NOT NULL';
                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MMS_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MMS_SV_NO_HLR1','CREATE_ACTIVATE','MMS','1');   
    
               SQL_TXT := 'CREATE TABLE REP_MMS_SV_NO_HLR2 NOLOGGING AS
                       SELECT T.MSISDN, T.MMS_APN1,T.IMSI from MAIN_MMS_SYS T
                       WHERE 
                       T.MMS_APN2 <> 9
                       AND T.CP_STATUS NOT IN (''Cancelled'',''Moved'')
                       AND T.SERVICE_STATUS NOT IN (''Cancelled'',''Moved'')
                       AND t.MSISDN_HLRS IS NOT NULL';
                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MMS_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;   
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MMS_SV_NO_HLR2','CREATE_ACTIVATE','MMS','2');
    
               SQL_TXT := 'CREATE TABLE REP_MMS_HLR_NO_SV1 NOLOGGING AS
                               SELECT * from REP_CLEAN_ALL_MERGED T
                               WHERE T.MMS_APN1 = 9
                               AND T.Service_Status <> ''Cancelled''
                               AND t.MSISDN_HLRS IS NOT NULL
                                AND NOT EXISTS
                                (SELECT 1 FROM MAIN_MMS_SYS MS WHERE T.MSISDN = MS.MSISDN)';
                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MMS_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;     
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MMS_HLR_NO_SV1','DELETE','MMS','1');            
              
               SQL_TXT := 'CREATE TABLE REP_MMS_HLR_NO_SV2 NOLOGGING AS
                               SELECT * from REP_CLEAN_ALL_MERGED T
                               WHERE T.MMS_APN2 = 9
                               AND T.Service_Status <> ''Cancelled''
                               AND t.MSISDN_HLRS IS NOT NULL
                                AND NOT EXISTS
                                (SELECT 1 FROM MAIN_MMS_SYS MS WHERE T.MSISDN = MS.MSISDN)';
                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MMS_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF; 
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MMS_HLR_NO_SV2','DELETE','MMS','2');          */

--================================================================================================================
    -- SMS
    --================================================================================================================

     SQL_TXT := 'CREATE TABLE MAIN_SMS_SYS NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.*,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1001760
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS SMS_MODE
                 FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
              -- AND T.PRODUCT_ID in (1000262,1000241) -- Alfa Classic, Alfa Active
               AND T.PRODUCT_ID in (1000262) -- Alfa Classic, Alfa Active
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000332 -- SMS
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_SMS_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

      -- BOTH SMS MODE ON SV NOT ON HLR1

          SQL_TXT := 'CREATE TABLE REP_SMS_SV_NO_HLR1 NOLOGGING AS
                   select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''Both''
                      AND (NVL(T.TS21_1,0) <> 1
                      OR NVL(T.TS22_1,0) <> 1)
                      --AND t.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                      AND t.SERVICE_TYPE_NAME in (''Voice'')
                      AND T.CP_STATUS = ''Active''
                      AND T.SERVICE_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

   --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1');
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMS_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1','BOTH');

    -- BOTH SMS MODE ON SV NOT ON HLR2

      SQL_TXT := 'CREATE TABLE REP_SMS_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''Both''
                      AND  (NVL(T.TS21_2,0) <> 1
                      OR NVL(T.TS22_2,0) <> 1 )
                      --AND t.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                      AND t.SERVICE_TYPE_NAME in (''Voice'')
                      AND T.CP_STATUS = ''Active''
                      AND T.SERVICE_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2');
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMS_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2','BOTH');
    -- BOTH SMS MODE ON HLR1 NOT ON SV

     SQL_TXT := ' CREATE TABLE REP_SMS_HLR_NO_SV1 NOLOGGING AS
                  select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS21_1,0) = 1
                      AND NVL(T.TS22_1,0) = 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND MS.SMS_MODE = ''Both'')';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_HLR_NO_SV1','DELETE','SMS','1');
     RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMS_HLR_NO_SV1','DELETE','SMS','1','BOTH');

    -- BOTH SMS MODE ON HLR2 NOT ON SV

    SQL_TXT := 'CREATE TABLE REP_SMS_HLR_NO_SV2 NOLOGGING AS
                    select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS21_2,0) = 1
                      AND NVL(T.TS22_2,0) = 1
                       AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND MS.SMS_MODE = ''Both'')';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMS_HLR_NO_SV2','DELETE','SMS','2');
     RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMS_HLR_NO_SV2','DELETE','SMS','2','BOTH'); 

     -- SMSMO SMS MODE ON SV NOT ON HLR1
     SQL_TXT := 'CREATE TABLE REP_SMSMO_SV_NO_HLR1 NOLOGGING AS
                   select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMO''
                      AND NVL(T.TS22_1,0) <> 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1');
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMO_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1','MO');
     -- SMSMO SMS MODE ON SV NOT ON HLR2

      SQL_TXT := 'CREATE TABLE REP_SMSMO_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMO''
                      AND NVL(T.TS22_2,0) <> 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2');
      RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMO_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2','MO');
     -- SMSMO SMS MODE ON HLR1 NOT ON SV

    SQL_TXT := 'CREATE TABLE REP_SMSMO_HLR_NO_SV1 NOLOGGING AS
                  select * from REP_CLEAN_ALL_MERGED T
                    WHERE  NVL(T.TS22_1,0) = 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMO'' OR MS.SMS_MODE = ''Both''))';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_HLR_NO_SV1','DELETE','SMS','1');
        RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMO_HLR_NO_SV1','DELETE','SMS','1','MO');

    -- SMSMO SMS MODE ON HLR1 NOT ON SV
     SQL_TXT := ' CREATE TABLE REP_SMSMO_HLR_NO_SV2 NOLOGGING AS
                    select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS22_2,0) = 1
                       AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMO'' OR MS.SMS_MODE = ''Both''))';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMO_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMO_HLR_NO_SV2','DELETE','SMS','2');
 RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMO_HLR_NO_SV2','DELETE','SMS','2','MO');
     -- SMSMT SMS MODE ON SV NOT ON HLR1

      SQL_TXT := ' CREATE TABLE REP_SMSMT_SV_NO_HLR1 NOLOGGING AS
                   select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMT''
                      AND NVL(T.TS21_1,0) <> 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
     -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1');
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMT_SV_NO_HLR1','CREATE_ACTIVATE','SMS','1','MT');
    -- SMSMT SMS MODE ON SV NOT ON HLR2
    SQL_TXT := 'CREATE TABLE REP_SMSMT_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_SMS_SYS T
                    WHERE T.SMS_MODE = ''SMSMT''
                      AND NVL(T.TS21_2,0) <> 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';

     IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;

     --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2');
        RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMT_SV_NO_HLR2','CREATE_ACTIVATE','SMS','2','MT');
      -- SMSMT SMS MODE ON HLR1 NOT ON SV
      SQL_TXT := 'CREATE TABLE REP_SMSMT_HLR_NO_SV1 NOLOGGING AS
                  select * from REP_CLEAN_ALL_MERGED T
                    WHERE  NVL(T.TS21_1,0) = 1
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMT'' OR MS.SMS_MODE = ''Both''))';

     IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;

    -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_HLR_NO_SV1','DELETE','SMS','1');
       RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMT_HLR_NO_SV1','DELETE','SMS','1','MT');

      -- SMSMT SMS MODE ON HLR2 NOT ON SV
        SQL_TXT := 'CREATE TABLE REP_SMSMT_HLR_NO_SV2 NOLOGGING AS
                    select * from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.TS21_2,0) = 1
                       AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.Service_Status <> ''Cancelled''
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                   (SELECT 1 FROM MAIN_SMS_SYS MS WHERE T.MSISDN = MS.MSISDN AND (MS.SMS_MODE = ''SMSMT'' OR MS.SMS_MODE = ''Both''))';

     IF UTILS_INTERFACES.CREATE_TABLE('REP_SMSMT_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;

     -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SMSMT_HLR_NO_SV2','DELETE','SMS','2');
       RECONCILIATION_INTERFACES.PROV_RECON_SMS_CPS('FAFIF','REP_SMSMT_HLR_NO_SV2','DELETE','SMS','2','MT'); 

    --================================================================================================================
    -- GPRS Roaming main Recon
    --================================================================================================================

  SQL_TXT := 'CREATE TABLE MAIN_GPRS_ROAM_SYS NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.*,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID in (1000262,1200080)
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1001800 -- GPRS Roaming
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE NOT IN (9,10)';

      IF UTILS_INTERFACES.CREATE_TABLE('MAIN_GPRS_ROAM_SYS', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;


    -- GPRS Roam SV Not GPRS Roam in HLRs

    SQL_TXT := ' CREATE TABLE REP_GPRSROAM_SV_NO_HLR NOLOGGING AS
                    select * from MAIN_GPRS_ROAM_SYS T
                    WHERE T.RSA_1 <> 0
                      AND t.SERVICE_TYPE_NAME in (''Voice'',''Postpaid Broadband'')
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSROAM_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSROAM_SV_NO_HLR','CREATE_ACTIVATE','GPRS_ROAMING','1');



    SQL_TXT := ' CREATE TABLE REP_GPRSROAM_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_GPRS_ROAM_SYS T
                    WHERE T.RSA_2 <> 0
                      AND t.SERVICE_TYPE_NAME in (''Voice'',''Postpaid Broadband'')
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSROAM_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSROAM_SV_NO_HLR2','CREATE_ACTIVATE','GPRS_ROAMING','2');



    -- GPRS ROAM HLR NOT SV ==> Fraud
    -- 17092010 Added with Elsy and OBR=0

    SQL_TXT := 'CREATE TABLE REP_GPRSROAM_HLR_NOT_SV NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE (M.RSA_1 = 0 AND m.obr_1 = 0)
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME in (''Voice'', ''Postpaid Broadband'')
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_GPRS_ROAM_SYS MC WHERE MC.MSISDN = m.msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSROAM_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSROAM_HLR_NOT_SV','DELETE','GPRS_ROAMING','1');


    SQL_TXT := 'CREATE TABLE REP_GPRSROAM_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE (M.RSA_2 = 0 AND m.obr_2 = 0)
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME in (''Voice'',''Postpaid Broadband'')
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_GPRS_ROAM_SYS MC WHERE MC.MSISDN = m.msisdn)';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSROAM_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSROAM_HLR_NOT_SV2','DELETE','GPRS_ROAMING','2');

    --================================================================================================================
    -- BlackBerry main Recon BLACKEBRRY RECONCILIATION DELETED DUE TO PRODUCT DECOMMISSIONED
    --================================================================================================================
    
  
   --================================================================================================================
    -- PPN main Recon
    --================================================================================================================*/

SQL_TXT :='CREATE TABLE MAIN_PPN_SYS NOLOGGING AS
             SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.* ,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1325280
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS SMART_COMPANION_NAME,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1375021
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_6) AS SCP_VOLUME_OPTION
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1000262  -- ALFA CLASSIC
                 AND T.Service_Type_Name =''Voice''
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1375022 -- Smart Companion Postpaid
                 AND PIH.GENERAL_5 in (70000025,70000043) -- SCP NAME
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_PPN_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
      IF UTILS_INTERFACES.CREATE_INDEX('MAIN_PPN_SYS',
                                     'FAFIF',
                                     'IX_MAIN_PPN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;

 /*   -- PPN SV NOT ACTIVE IN HLR*/

    SQL_TXT := ' CREATE TABLE REP_PPN_SV_NO_HLR NOLOGGING AS
                    select * from MAIN_PPN_SYS T
                    WHERE (T.CAMEL_1 <> 4
                    OR T.TCSIST_1 <>1)
                      AND t.SERVICE_TYPE_NAME in (''Voice'')
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_PPN_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_PPN_SV_NO_HLR','CREATE_ACTIVATE','PPN','1');

    SQL_TXT := ' CREATE TABLE REP_PPN_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_PPN_SYS T
                    WHERE (T.CAMEL_2 <> 4
                           OR T.TCSIST_2 <>1)
                      AND t.SERVICE_TYPE_NAME in (''Voice'')
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_PPN_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_PPN_SV_NO_HLR2','CREATE_ACTIVATE','PPN','2');

/* --PPN HLR NOT ACTIVE IN SV*/

 SQL_TXT := 'CREATE TABLE REP_PPN_HLR_NO_SV1 NOLOGGING AS
                               SELECT * from REP_CLEAN_ALL_MERGED T
                               WHERE T.CAMEL_1 = 4
                               AND T.TCSIST_1 = 1
                               AND T.Service_Status <> ''Cancelled''
                               AND t.MSISDN_HLRS IS NOT NULL
                                AND NOT EXISTS
                                (SELECT 1 FROM MAIN_PPN_SYS PS WHERE T.MSISDN = PS.MSISDN)';
                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_PPN_HLR_NO_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_PPN_HLR_NO_SV1','DELETE','PPN','1');               
    
  SQL_TXT := 'CREATE TABLE REP_PPN_HLR_NO_SV2 NOLOGGING AS
                               SELECT * from REP_CLEAN_ALL_MERGED T
                               WHERE T.CAMEL_2 = 4
                               AND T.TCSIST_2 = 1
                               AND T.Service_Status <> ''Cancelled''
                               AND t.MSISDN_HLRS IS NOT NULL
                                AND NOT EXISTS
                                (SELECT 1 FROM MAIN_PPN_SYS PS WHERE T.MSISDN = PS.MSISDN)';
                       
    IF UTILS_INTERFACES.CREATE_TABLE('REP_PPN_HLR_NO_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;  
    
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_PPN_HLR_NO_SV2','DELETE','PPN','2');               


    --================================================================================================================
    -- BUNDLED VAS main Recon
    --================================================================================================================

    -- Bundled VAS MAIN
    -- Message Box (regular), Call Divert, CLIP Alert, CLIP, Call Waiting/Hold and AOC
    -- not a full recon since this is a parent/Global CP for above CPs

    SQL_TXT := ' CREATE TABLE MAIN_BVAS NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000345 -- Bundled VAS
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_BVAS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_BVAS',
                                     'FAFIF',
                                     'IX_MAIN_BVAS_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

    -- CLIP MAIN

    SQL_TXT := ' CREATE TABLE MAIN_CLIP NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               --AND T.PRODUCT_ID in (1000262,1000241) -- Alfa Classic, Alfa Active
               AND T.PRODUCT_ID in (1000262) -- Alfa Classic, Alfa Active
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000302 -- CLIP
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CLIP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_CLIP',
                                     'FAFIF',
                                     'IX_MAIN_CLIP_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

    -- CLIP SV Not Clip in HLR

    SQL_TXT := ' CREATE TABLE REP_CLIP_SV_NO_HLR NOLOGGING AS
                    select * from main_clip T
                    WHERE T.CLIP_1 IS NULL
                      --AND t.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                      AND t.SERVICE_TYPE_NAME in (''Voice'')
                      AND T.CP_STATUS = 3
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND T.MSISDN NOT IN (''76459199'',''76459210'')';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIP_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIP_SV_NO_HLR','CREATE_ACTIVATE','CLIP','1');

    SQL_TXT := ' CREATE TABLE REP_CLIP_SV_NO_HLR2 NOLOGGING AS
                    select * from main_clip T
                    WHERE T.CLIP_2 IS NULL
                      --AND t.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                      AND t.SERVICE_TYPE_NAME in (''Voice'')
                      AND T.CP_STATUS = 3
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND T.MSISDN NOT IN (''76459199'',''76459210'')';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIP_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIP_SV_NO_HLR2','CREATE_ACTIVATE','CLIP','2');

    -- CLIP HLR NOT SV ==> Fraud

    SQL_TXT := 'CREATE TABLE REP_CLIP_HLR_NOT_SV NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE NVL(M.CLIP_1,0) = 1
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME in (''Voice'')
                     AND M.MSISDN NOT IN (''76459199'',''76459210'')
                     --AND M.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                     AND NOT EXISTS
                   (SELECT 1 FROM main_clip MC WHERE MC.MSISDN = m.msisdn)
                    AND NOT EXISTS
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIP_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIP_HLR_NOT_SV','DELETE','CLIP','1');

    SQL_TXT := ' CREATE TABLE REP_CLIP_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE NVL(M.CLIP_2,0) = 1
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME in (''Voice'')
                     AND M.MSISDN NOT IN (''76459199'',''76459210'')
                      --AND M.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                     AND NOT EXISTS
                   (SELECT 1 FROM main_clip MC WHERE MC.MSISDN = m.msisdn)
                     AND NOT EXISTS
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIP_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIP_HLR_NOT_SV2','DELETE','CLIP','2');

    --================================================================================================================
    -- AOC Recon
    --================================================================================================================

    -- AOC MAIN

    SQL_TXT := 'CREATE TABLE MAIN_AOC NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000325 -- Advice of Charge
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_AOC', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_AOC',
                                     'FAFIF',
                                     'IX_MAIN_AOC_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

        -- AOC SV Not AOC in HLR

    SQL_TXT := ' CREATE TABLE REP_AOC_SV_NO_HLR NOLOGGING AS
                    select * from MAIN_AOC T
                    WHERE T.AOC_1 IS NULL
                      AND T.CP_STATUS = 3
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_AOC_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_AOC_SV_NO_HLR','CREATE_ACTIVATE','AOC','1');

    SQL_TXT := 'CREATE TABLE REP_AOC_SV_NO_HLR2 NOLOGGING AS
                   select * from MAIN_AOC T
                   WHERE T.AOC_2 IS NULL
                     AND T.CP_STATUS = 3
                     AND t.SERVICE_TYPE_NAME = ''Voice''
                     AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_AOC_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_AOC_SV_NO_HLR2','CREATE_ACTIVATE','AOC','2');

    -- AOC HLR NOT SV ==> Fraud

    SQL_TXT := 'CREATE TABLE REP_AOC_HLR_NOT_SV NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE NVL(M.AOC_1,0) = 1
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME = ''Voice''
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_AOC MC WHERE MC.MSISDN = m.msisdn)
                     AND NOT EXISTS
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_AOC_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_AOC_HLR_NOT_SV','DELETE','AOC','1');

    SQL_TXT := ' CREATE TABLE REP_AOC_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE NVL(M.AOC_2,0) = 1
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME = ''Voice''
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_AOC MC WHERE MC.MSISDN = m.msisdn)
                     AND NOT EXISTS
                        (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_AOC_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_AOC_HLR_NOT_SV2','DELETE','AOC','2');

    --================================================================================================================
    -- Call Barring Recon
    --================================================================================================================

    -- Call Barring MAIN

    SQL_TXT := 'CREATE TABLE MAIN_CALLBAR NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000326 -- Call Barring
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CALLBAR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_CALLBAR',
                                     'FAFIF',
                                     'IX_MAIN_CALLBAR_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


     -- Call Barring SV Not Call Barring in HLR

    SQL_TXT := ' CREATE TABLE REP_CBAR_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_CALLBAR T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.BAOC_1, 0) <> 1
                        OR NVL(T.BOIC_1, 0) <> 1
                        OR NVL(T.BOIEX_1, 0) <> 1
                        OR NVL(T.BAIC_1, 0) <> 1
                        OR NVL(T.BICRO_1, 0) <> 1
                        OR NVL(T.SOCB_1, 0) not in (1,3))
                       AND T.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CBAR_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CBAR_SV_NO_HLR','CREATE_ACTIVATE','CALL_BAR','1');

    SQL_TXT := 'CREATE TABLE REP_CBAR_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_CALLBAR T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.BAOC_2, 0) <> 1
                        OR NVL(T.BOIC_2, 0) <> 1
                        OR NVL(T.BOIEX_2, 0) <> 1
                        OR NVL(T.BAIC_2, 0) <> 1
                        OR NVL(T.BICRO_2, 0) <> 1
                        OR NVL(T.SOCB_2, 0) not in (1,3))
                       AND T.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CBAR_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CBAR_SV_NO_HLR2','CREATE_ACTIVATE','CALL_BAR','2');

    -- Call Bar HLR NOT SV ==> Fraud

    SQL_TXT := 'CREATE TABLE REP_CBAR_HLR_NOT_SV NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE NVL(M.BAOC_1, 0) = 1
                   AND NVL(M.BOIC_1, 0) = 1
                   AND NVL(M.BOIEX_1, 0) = 1
                   AND NVL(M.BAIC_1, 0) = 1
                   AND NVL(M.BICRO_1, 0) = 1
                   AND NVL(M.SOCB_1, 0) = 1
                   AND M.MSISDN_HLRS IS NOT NULL
                   AND M.SERVICE_STATUS <> ''Cancelled''
                   AND M.SERVICE_TYPE_NAME = ''Voice''
                   AND NOT EXISTS
                 (SELECT 1 FROM MAIN_CALLBAR MC WHERE MC.MSISDN = M.msisdn)';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CBAR_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CBAR_HLR_NOT_SV','DELETE','CALL_BAR','1');--CALL_BARRING

    SQL_TXT := 'CREATE TABLE REP_CBAR_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE NVL(M.BAOC_2, 0) = 1
                   AND NVL(M.BOIC_2, 0) = 1
                   AND NVL(M.BOIEX_2, 0) = 1
                   AND NVL(M.BAIC_2, 0) = 1
                   AND NVL(M.BICRO_2, 0) = 1
                   AND NVL(M.SOCB_2, 0) = 1
                   AND M.MSISDN_HLRS IS NOT NULL
                   AND M.SERVICE_STATUS <> ''Cancelled''
                   AND M.SERVICE_TYPE_NAME = ''Voice''
                   AND NOT EXISTS
                 (SELECT 1 FROM MAIN_CALLBAR MC WHERE MC.MSISDN = M.msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CBAR_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CBAR_HLR_NOT_SV2','DELETE','CALL_BAR','2');--CALL BARRING

    --================================================================================================================
    -- Call Divert Recon
    --================================================================================================================

    -- Call Divert MAIN

    SQL_TXT := 'CREATE TABLE MAIN_CALLDIV NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000321 -- Call Divert
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CALLDIV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_CALLDIV',
                                     'FAFIF',
                                     'IX_MAIN_CALLDIV_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


   -- Call Divert SV Not Call Divert in HLR

    SQL_TXT :=  'CREATE TABLE REP_CADIV_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_CALLDIV T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.CFU_1, 0) <> 1
                        OR NVL(T.CFB_1, 0) <> 1
                        OR NVL(T.CFNRY_1, 0) <> 1
                        OR NVL(T.CFNRC_1, 0) <> 1)
                       AND T.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CADIV_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CADIV_SV_NO_HLR','CREATE_ACTIVATE','CALL_DIVERT','1'); --CALL_DIVERT

    SQL_TXT := 'CREATE TABLE REP_CADIV_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_CALLDIV T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.CFU_2, 0) <> 1
                        OR NVL(T.CFB_2, 0) <> 1
                        OR NVL(T.CFNRY_2, 0) <> 1
                        OR NVL(T.CFNRC_2, 0) <> 1)
                       AND T.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CADIV_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CADIV_SV_NO_HLR2','CREATE_ACTIVATE','CALL_DIVERT','2'); --CALL_DIVERT

   -- Call Divert HLR NOT SV ==> Fraud

    SQL_TXT := 'CREATE TABLE REP_CDIVER_HLR_NOT_SV NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE NVL(m.CFU_1, 0) = 1
                  AND NVL(m.CFB_1, 0) = 1
                  AND NVL(m.CFNRY_1, 0) = 1
                  AND NVL(m.CFNRC_1, 0) = 1
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                  AND M.SERVICE_TYPE_NAME = ''Voice''
                  AND NOT EXISTS
                 (SELECT 1 FROM MAIN_CALLDIV MC WHERE MC.MSISDN = M.msisdn)
                   AND NOT EXISTS
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)
                  ';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CDIVER_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CDIVER_HLR_NOT_SV','DELETE','CALL_DIVERT','1');--CALL_DIVERT

    SQL_TXT := 'CREATE TABLE REP_CDIVER_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE NVL(m.CFU_2, 0) = 1
                  AND NVL(m.CFB_2, 0) = 1
                  AND NVL(m.CFNRY_2, 0) = 1
                  AND NVL(m.CFNRC_2, 0) = 1
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                  AND M.SERVICE_TYPE_NAME = ''Voice''
                  AND NOT EXISTS
                 (SELECT 1 FROM MAIN_CALLDIV MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS
                   (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)
                   ';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CDIVER_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CDIVER_HLR_NOT_SV2','DELETE','CALL_DIVERT','2');--CALL_DIVERT

    --================================================================================================================
    -- Call Waiting Recon
    --================================================================================================================

    -- Call Waiting MAIN

    SQL_TXT := 'CREATE TABLE MAIN_CALLWAIT NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               --AND T.PRODUCT_ID in (1000262,1000241) -- Alfa Classic, Alfa Active
               AND T.PRODUCT_ID in (1000262) -- Alfa Classic, Alfa Active
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000320 -- Call Waiting
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CALLWAIT', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_CALLWAIT',
                                     'FAFIF',
                                     'IX_MAIN_CALLWAIT_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


   -- Call Waiting SV Not Call Waiting in HLR

    SQL_TXT :=  'CREATE TABLE REP_CAWAIT_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_CALLWAIT T
                     WHERE T.SERVICE_TYPE_NAME in (''Voice'')
                       --T.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                       AND T.CP_STATUS = 3
                       AND NVL(T.CAW_1,0) <> 1
                       AND T.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CAWAIT_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CAWAIT_SV_NO_HLR','CREATE_ACTIVATE','CALL_WAITHOLD','1');--CALL_WAITING

    SQL_TXT := 'CREATE TABLE REP_CAWAIT_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_CALLWAIT T
                     WHERE  T.SERVICE_TYPE_NAME in (''Voice'')
                     -- T.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                       AND T.CP_STATUS = 3
                       AND NVL(T.CAW_2,0) <> 1
                       AND T.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CAWAIT_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CAWAIT_SV_NO_HLR2','CREATE_ACTIVATE','CALL_WAITHOLD','2');--CALL_WAITING

   -- Call Waiting HLR NOT SV ==> Fraud

    SQL_TXT := 'CREATE TABLE REP_CWAIT_HLR_NOT_SV NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE NVL(M.CAW_1,0) = 1
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                 -- AND M.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                  AND M.SERVICE_TYPE_NAME in (''Voice'')
                  AND NOT EXISTS
                 (SELECT 1 FROM MAIN_CALLWAIT MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS
                     (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CWAIT_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CWAIT_HLR_NOT_SV','DELETE','CALL_WAITHOLD','1');--CALL_WAITING

    SQL_TXT := 'CREATE TABLE REP_CWAIT_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE NVL(M.CAW_2,0) = 1
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''CANCELLED''
                  --AND M.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                  AND M.SERVICE_TYPE_NAME in (''Voice'')
                  AND NOT EXISTS
                 (SELECT 1 FROM MAIN_CALLWAIT MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CWAIT_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CWAIT_HLR_NOT_SV2','DELETE','CALL_WAITHOLD','2');--CALL_WAITING

    --================================================================================================================
    -- Clip Alert Recon
    --================================================================================================================

    -- Clip Alert MAIN
    -- Recon After Message BOX

    SQL_TXT := 'CREATE TABLE MAIN_CLIPALERT NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000344 -- Clip Alert
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CLIPALERT', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_CLIPALERT',
                                     'FAFIF',
                                     'IX_MAIN_CLIPALERT_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;


    --================================================================================================================
    -- Message Box Recon
    --================================================================================================================

    -- Message Box MAIN

    SQL_TXT := 'CREATE TABLE MAIN_MESS_BOX NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000322 -- Message Box
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_MESS_BOX', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_MESS_BOX',
                                     'FAFIF',
                                     'IX_MAIN_MBOX_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;



   -- Clip Alert SV Not Clip Alert in HLR (with Message BOX)

    SQL_TXT := 'CREATE TABLE REP_CLIPAL_MBOX_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_CLIPALERT T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.OFA_1, 0) <> 3
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND T.MSISDN NOT IN (''76459199'',''76459210'')
                       AND EXISTS
                           (SELECT 1
                              FROM MAIN_MESS_BOX MC
                             WHERE MC.MSISDN = T.MSISDN)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIPAL_MBOX_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIPAL_MBOX_SV_NO_HLR','CREATE_ACTIVATE','CLIP_ALERT','1');--CLIP_ALERT
   -- RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIPAL_MBOX_SV_NO_HLR','CREATE_ACTIVATE','MESSAGE_BOX','1');--MESSAGE_BOX

    SQL_TXT := 'CREATE TABLE REP_CLIPAL_MBOX_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_CLIPALERT T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.OFA_2, 0) <> 3
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND T.MSISDN NOT IN (''76459199'',''76459210'')
                       AND EXISTS
                           (SELECT 1
                              FROM MAIN_MESS_BOX MC
                             WHERE MC.MSISDN = T.MSISDN)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIPAL_MBOX_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIPAL_MBOX_SV_NO_HLR2','CREATE_ACTIVATE','CLIP_ALERT','2');--CLIP_ALERT
    --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIPAL_MBOX_SV_NO_HLR2','CREATE_ACTIVATE','MESSAGE_BOX','2');--MESSAGE_BOX

   -- Clip Alert SV Not Clip Alert in HLR (without Message BOX)


    SQL_TXT := 'CREATE TABLE REP_CLIPAL_NOMBOX_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_CLIPALERT T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.OFA_1, 0) <> 4
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND T.MSISDN NOT IN (''76459199'',''76459210'')
                       AND NOT EXISTS
                           (SELECT 1
                              FROM MAIN_MESS_BOX MC
                             WHERE MC.MSISDN = T.MSISDN)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIPAL_NOMBOX_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIPAL_NOMBOX_SV_NO_HLR','CREATE_ACTIVATE','CLIP_ALERT','1');--CLIP_ALERT WITHOUT MSGBOX

    SQL_TXT := 'CREATE TABLE REP_CLIPAL_NOMBOX_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_CLIPALERT T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.OFA_2, 0) <> 4
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND T.MSISDN NOT IN (''76459199'',''76459210'')
                       AND NOT EXISTS
                           (SELECT 1
                              FROM MAIN_MESS_BOX MC
                             WHERE MC.MSISDN = T.MSISDN)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CLIPAL_NOMBOX_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CLIPAL_NOMBOX_SV_NO_HLR2','CREATE_ACTIVATE','CLIP_ALERT','2');--CLIP_ALERT WITHOUT MSGBOX

   -- Clip Alert HLR NOT SV ==> Fraud
   -- With Message Box

      SQL_TXT := 'CREATE TABLE REP_CALERT_WMB_HLR_NOT_SV NOLOGGING AS
                    SELECT *
                      FROM REP_CLEAN_ALL_MERGED M
                     WHERE NVL(M.OFA_1,0) = 3
                      AND M.MSISDN_HLRS IS NOT NULL
                      AND M.SERVICE_STATUS <> ''CANCELLED''
                      AND M.SERVICE_TYPE_NAME = ''Voice''
                      AND M.MSISDN NOT IN (''76459199'',''76459210'')
                      AND EXISTS
                     (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                      AND NOT EXISTS
                     (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                     AND NOT EXISTS
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CALERT_WMB_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CALERT_WMB_HLR_NOT_SV','DELETE','CLIP_ALERT','1');--CLIP_ALERT

          SQL_TXT := 'CREATE TABLE REP_CALERT_WMB_HLR_NOT_SV2 NOLOGGING AS
                    SELECT *
                      FROM REP_CLEAN_ALL_MERGED M
                     WHERE NVL(M.OFA_2,0) = 3
                      AND M.MSISDN_HLRS IS NOT NULL
                      AND M.SERVICE_STATUS <> ''CANCELLED''
                      AND M.SERVICE_TYPE_NAME = ''Voice''
                      AND M.MSISDN NOT IN (''76459199'',''76459210'')
                      AND EXISTS
                     (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                      AND NOT EXISTS
                     (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                     AND NOT EXISTS
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CALERT_WMB_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CALERT_WMB_HLR_NOT_SV2','DELETE','CLIP_ALERT','2');--CLIP_ALERT
       -- Without Message Box

      SQL_TXT := 'CREATE TABLE REP_CALERT_NOMB_HLR_NOT_SV NOLOGGING AS
                    SELECT *
                      FROM REP_CLEAN_ALL_MERGED M
                     WHERE NVL(M.OFA_1,0) = 4
                      AND M.MSISDN_HLRS IS NOT NULL
                      AND M.SERVICE_STATUS <> ''CANCELLED''
                      AND M.SERVICE_TYPE_NAME = ''Voice''
                      AND M.MSISDN NOT IN (''76459199'',''76459210'')
                      AND NOT EXISTS
                     (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                      AND NOT EXISTS
                     (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                     AND NOT EXISTS
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CALERT_NOMB_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CALERT_NOMB_HLR_NOT_SV','DELETE','CLIP_ALERT','1');--CLIP_ALERT WITHOUT MSGBOX

      SQL_TXT := 'CREATE TABLE REP_CALERT_NOMB_HLR_NOT_SV2 NOLOGGING AS
                    SELECT *
                      FROM REP_CLEAN_ALL_MERGED M
                     WHERE NVL(M.OFA_2,0) = 4
                      AND M.MSISDN_HLRS IS NOT NULL
                      AND M.SERVICE_STATUS <> ''CANCELLED''
                      AND M.SERVICE_TYPE_NAME = ''Voice''
                      AND M.MSISDN NOT IN (''76459199'',''76459210'')
                      AND NOT EXISTS
                     (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                      AND NOT EXISTS
                     (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                      AND NOT EXISTS
                       (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CALERT_NOMB_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CALERT_NOMB_HLR_NOT_SV2','DELETE','CLIP_ALERT','2');--CLIP_ALERT WITHOUT MSGBOX

 -- Message BOX reconciliation

 -- Message Box SV without Clip Alert in HLR

       SQL_TXT := 'CREATE TABLE REP_MB_CLIPAL_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_MESS_BOX T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.CFU_1, 0) <> 1
                        OR NVL(T.CFB_1, 0) <> 1
                        OR NVL(T.CFNRY_1, 0) <> 1
                        OR NVL(T.CFNRC_1, 0) <> 1
                        OR NVL(T.OFA_1, 0) <> 3)
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND EXISTS
                           (SELECT 1
                              FROM MAIN_CLIPALERT MC
                             WHERE MC.MSISDN = T.MSISDN)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MB_CLIPAL_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

   
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MB_CLIPAL_SV_NO_HLR','CREATE_ACTIVATE','MESSAGE_BOX','1');
    
  -- Message Box SV without Clip Alert in HLR

       SQL_TXT := 'CREATE TABLE REP_MB_CLIPAL_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_MESS_BOX T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.CFU_2, 0) <> 1
                        OR NVL(T.CFB_2, 0) <> 1
                        OR NVL(T.CFNRY_2, 0) <> 1
                        OR NVL(T.CFNRC_2, 0) <> 1
                        OR NVL(T.OFA_2, 0) <> 3)
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND EXISTS
                           (SELECT 1
                              FROM MAIN_CLIPALERT MC
                             WHERE MC.MSISDN = T.MSISDN)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MB_CLIPAL_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

  
   RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MB_CLIPAL_SV_NO_HLR2','CREATE_ACTIVATE','MESSAGE_BOX','2');--MSGBOX WITHOUT CLIP_ALERT

 -- Message Box SV with Clip Alert in HLR

        SQL_TXT := 'CREATE TABLE REP_MB_NOCLIPAL_SV_NO_HLR NOLOGGING AS
                    SELECT *
                      FROM MAIN_MESS_BOX T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND (NVL(T.CFU_1, 0) <> 1
                        OR NVL(T.CFB_1, 0) <> 1
                        OR NVL(T.CFNRY_1, 0) <> 1
                        OR NVL(T.CFNRC_1, 0) <> 1
                        OR NVL(T.OFA_1, 0) <> 10)
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND NOT EXISTS
                           (SELECT 1
                              FROM MAIN_CLIPALERT MC
                             WHERE MC.MSISDN = T.MSISDN)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MB_NOCLIPAL_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MB_NOCLIPAL_SV_NO_HLR','CREATE_ACTIVATE','MESSAGE_BOX','1');--List Message Box  not having Clip Alert in SV with Clip Alert in HLR


        SQL_TXT := 'CREATE TABLE REP_MB_NOCLIPAL_SV_NO_HLR2 NOLOGGING AS
            SELECT *
              FROM MAIN_MESS_BOX T
             WHERE T.SERVICE_TYPE_NAME = ''Voice''
               AND T.CP_STATUS = 3
               AND (NVL(T.CFU_2, 0) <> 1
                OR NVL(T.CFB_2, 0) <> 1
                OR NVL(T.CFNRY_2, 0) <> 1
                OR NVL(T.CFNRC_2, 0) <> 1
                OR NVL(T.OFA_2, 0) <> 10)
               AND T.MSISDN_HLRS IS NOT NULL
               AND NOT EXISTS
                   (SELECT 1
                      FROM MAIN_CLIPALERT MC
                     WHERE MC.MSISDN = T.MSISDN)';

      IF UTILS_INTERFACES.CREATE_TABLE('REP_MB_NOCLIPAL_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;

      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MB_NOCLIPAL_SV_NO_HLR2','CREATE_ACTIVATE','MESSAGE_BOX','2');--List Message Box  not having Clip Alert in SV with Clip Alert in HLR
    -- Message BOX HLR NOT SV ==> Fraud
   -- With Clip Alert

         SQL_TXT := 'CREATE TABLE REP_MBOX_CLAL_HLR_NOT_SV NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                WHERE NVL(m.CFU_1, 0) = 1
                  AND NVL(m.CFB_1, 0) = 1
                  AND NVL(m.CFNRY_1, 0) = 1
                  AND NVL(m.CFNRC_1, 0) = 1
                  AND NVL(m.OFA_1, 0) = 3
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                  AND M.SERVICE_TYPE_NAME = ''Voice''
                  AND NOT EXISTS
                  (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                  AND EXISTS
                  (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)
                  ';

      IF UTILS_INTERFACES.CREATE_TABLE('REP_MBOX_CLAL_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;

    --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBOX_CLAL_HLR_NOT_SV','DELETE','CLIP_ALERT','1');--List Products having Message Box (with Clip Alert) in HLR and not in SV
    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBOX_CLAL_HLR_NOT_SV','DELETE','MESSAGE_BOX','1');--List Products having Message Box (with Clip Alert) in HLR and not in SV

             SQL_TXT := 'CREATE TABLE REP_MBOX_CLAL_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                WHERE NVL(m.CFU_2, 0) = 1
                  AND NVL(m.CFB_2, 0) = 1
                  AND NVL(m.CFNRY_2, 0) = 1
                  AND NVL(m.CFNRC_2, 0) = 1
                  AND NVL(m.OFA_2, 0) = 3
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                  AND M.SERVICE_TYPE_NAME = ''Voice''
                  AND NOT EXISTS
                  (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                  AND EXISTS
                  (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)
                  ';

      IF UTILS_INTERFACES.CREATE_TABLE('REP_MBOX_CLAL_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;

      --RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBOX_CLAL_HLR_NOT_SV2','DELETE','CLIP_ALERT','2');--List Products having Message Box (with Clip Alert) in HLR and not in SV
      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBOX_CLAL_HLR_NOT_SV2','DELETE','MESSAGE_BOX','2');--List Products having Message Box (with Clip Alert) in HLR and not in SV
    -- Without Clip Alert

       SQL_TXT := 'CREATE TABLE REP_MBOX_NO_CLAL_HLR_NOT_SV NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                WHERE NVL(m.CFU_1, 0) = 1
                  AND NVL(m.CFB_1, 0) = 1
                  AND NVL(m.CFNRY_1, 0) = 1
                  AND NVL(m.CFNRC_1, 0) = 1
                  AND NVL(m.OFA_1, 0) = 10
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                  AND M.SERVICE_TYPE_NAME = ''Voice''
                  AND EXISTS
                  (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS
                  (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)
                  ';

      IF UTILS_INTERFACES.CREATE_TABLE('REP_MBOX_NO_CLAL_HLR_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;

      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBOX_NO_CLAL_HLR_NOT_SV','DELETE','MESSAGE_BOX','1');--List Products having Message Box (without Clip Alert) in HLR and not in SV

     SQL_TXT := 'CREATE TABLE REP_MBOX_NO_CLAL_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                WHERE NVL(m.CFU_2, 0) = 1
                  AND NVL(m.CFB_2, 0) = 1
                  AND NVL(m.CFNRY_2, 0) = 1
                  AND NVL(m.CFNRC_2, 0) = 1
                  AND NVL(m.OFA_2, 0) = 10
                  AND M.MSISDN_HLRS IS NOT NULL
                  AND M.SERVICE_STATUS <> ''Cancelled''
                  AND M.SERVICE_TYPE_NAME = ''Voice''
                  AND EXISTS
                  (SELECT 1 FROM MAIN_MESS_BOX MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS
                  (SELECT 1 FROM MAIN_CLIPALERT MC WHERE MC.MSISDN = M.msisdn)
                  AND NOT EXISTS
                    (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = M.Msisdn)
                  ';

      IF UTILS_INTERFACES.CREATE_TABLE('REP_MBOX_NO_CLAL_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;

      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBOX_NO_CLAL_HLR_NOT_SV2','DELETE','MESSAGE_BOX','2');--List Products having Message Box (without Clip Alert) in HLR and not in SV
 -- added by julie 17/092010
 --================================================================================================================
    -- BUNDLED VAS Recon
    --================================================================================================================
  -- BVAS SV NOT  HLR1

      SQL_TXT := 'CREATE TABLE REP_BVAS_SV_NO_HLR1 NOLOGGING AS
                    select * from MAIN_BVAS T
                    WHERE (NVL(T.CLIP_1, 0)<>1
                           OR NVL(T.AOC_1, 0) <>1
                           OR NVL(T.CFU_1, 0) <> 1
                           OR NVL(T.CFB_1, 0) <> 1
                           OR NVL(T.CFNRY_1, 0) <> 1
                           OR NVL(T.CFNRC_1, 0) <> 1
                           OR NVL(T.CAW_1, 0) <> 1
                           OR NVL(T.OFA_1, 0) <> 3)
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = 3
                      AND t.MSISDN_HLRS IS NOT NULL';

      IF UTILS_INTERFACES.CREATE_TABLE('REP_BVAS_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;

      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_BVAS_SV_NO_HLR1','CREATE_ACTIVATE','BUNDLED_VAS','1');--List Products having BUNDLED VAS ON SV NOT IN HLR1

     -- BVAS SV NOT  HLR2

        SQL_TXT := 'CREATE TABLE REP_BVAS_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_BVAS T
                    WHERE (NVL(T.CLIP_2, 0)<>1
                           OR NVL(T.AOC_2, 0) <>1
                           OR NVL(T.CFU_2, 0) <> 1
                           OR NVL(T.CFB_2, 0) <> 1
                           OR NVL(T.CFNRY_2, 0) <> 1
                           OR NVL(T.CFNRC_2, 0) <> 1
                           OR NVL(T.CAW_2, 0) <> 1
                           OR NVL(T.OFA_2, 0) <> 3)
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = 3
                      AND t.MSISDN_HLRS IS NOT NULL';

      IF UTILS_INTERFACES.CREATE_TABLE('REP_BVAS_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;

      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_BVAS_SV_NO_HLR2','CREATE_ACTIVATE','BUNDLED_VAS','2');--List Products having BUNDLED VAS ON SV NOT IN HLR2


     -- BVAS HLR1 NOT SV

       SQL_TXT := 'CREATE TABLE REP_BVAS_HLR_NOT_SV1 NOLOGGING AS
                   SELECT *
                   FROM REP_CLEAN_ALL_MERGED T
                   WHERE NVL(T.CFU_1, 0) = 1
                         AND NVL(T.CFB_1, 0) = 1
                         AND NVL(T.CFNRY_1, 0) = 1
                         AND NVL(T.CFNRC_1, 0) = 1
                         AND NVL(T.AOC_1, 0) = 1
                         AND NVL(T.CLIP_1, 0) = 1
                          AND NVL(T.CAW_1, 0) = 1
                          AND NVL(T.OFA_1, 0) = 3
                          AND T.MSISDN_HLRS IS NOT NULL
                           AND T.SERVICE_STATUS <> ''Cancelled''
                           AND T.SERVICE_TYPE_NAME = ''Voice''
                           AND NOT EXISTS
                           (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = T.Msisdn)
                           AND NOT EXISTS
                            ( SELECT 1 FROM MAIN_AOC AOC WHERE AOC.MSISDN = T.MSISDN)
                           AND NOT EXISTS
                            (SELECT 1 FROM MAIN_CLIP CP WHERE CP.MSISDN = T.MSISDN)
                           AND NOT EXISTS
                            (SELECT 1 FROM MAIN_CLIPALERT CPA WHERE CPA.MSISDN = T.MSISDN)
                           AND NOT EXISTS
                            (SELECT 1 FROM MAIN_MESS_BOX MB WHERE MB.MSISDN = T.MSISDN)
                           AND NOT EXISTS
                             (SELECT 1 FROM MAIN_CALLDIV CD WHERE CD.MSISDN = T.MSISDN)
                           AND NOT EXISTS
                             (SELECT 1 FROM MAIN_CALLWAIT CW WHERE CW.MSISDN = T.MSISDN)
                           ';

      IF UTILS_INTERFACES.CREATE_TABLE('REP_BVAS_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;

      RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_BVAS_HLR_NOT_SV1','DELETE','BUNDLED_VAS','1');--List Products having BUNDLED VAS ON HLR1 NOT IN SV


 -- BVAS HLR2 NOT SV

         SQL_TXT := 'CREATE TABLE REP_BVAS_HLR_NOT_SV2 NOLOGGING AS
                     SELECT *
                     FROM REP_CLEAN_ALL_MERGED T
                     WHERE NVL(T.CFU_2, 0) = 1
                        AND NVL(T.CFB_2, 0) = 1
                        AND NVL(T.CFNRY_2, 0) = 1
                        AND NVL(T.CFNRC_2, 0) = 1
                        AND NVL(T.AOC_2, 0) = 1
                        AND NVL(T.CAW_2, 0) = 1
                        AND NVL(T.CLIP_2, 0) = 1
                        AND NVL(T.OFA_2, 0) = 3
                        AND T.MSISDN_HLRS IS NOT NULL
                        AND T.SERVICE_STATUS <> ''Cancelled''
                        AND T.SERVICE_TYPE_NAME = ''Voice''
                        AND NOT EXISTS
                         (SELECT 1 FROM MAIN_BVAS BV WHERE BV.MSISDN = T.Msisdn)
                        AND NOT EXISTS
                         ( SELECT 1 FROM MAIN_AOC AOC WHERE AOC.MSISDN = T.MSISDN)
                        AND NOT EXISTS
                         (SELECT 1 FROM MAIN_CLIP CP WHERE CP.MSISDN = T.MSISDN)
                        AND NOT EXISTS
                         (SELECT 1 FROM MAIN_CLIPALERT CPA WHERE CPA.MSISDN = T.MSISDN)
                        AND NOT EXISTS
                         (SELECT 1 FROM MAIN_MESS_BOX MB WHERE MB.MSISDN = T.MSISDN)
                        AND NOT EXISTS
                         (SELECT 1 FROM MAIN_CALLDIV CD WHERE CD.MSISDN = T.MSISDN)
                        AND NOT EXISTS
                         (SELECT 1 FROM MAIN_CALLWAIT CW WHERE CW.MSISDN = T.MSISDN)
                        ';


          IF UTILS_INTERFACES.CREATE_TABLE('REP_BVAS_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
          END IF;

          RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_BVAS_HLR_NOT_SV2','DELETE','BUNDLED_VAS','2');--List Products having BUNDLED VAS ON HLR1 NOT IN SV

 --- END ADDED BY JULIE 17/09/2010

    --================================================================================================================
    -- CLEAR SOC Recon
    --================================================================================================================

    -- CLEAR SOC MAIN

    SQL_TXT := ' CREATE TABLE MAIN_CLIR_SOC NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON,
                   (SELECT RC.CODE_LABEL FROM REFERENCE_CODE RC
                     WHERE RC.REFERENCE_TYPE_ID = 1000446
                       AND PIH.GENERAL_5 = RC.REFERENCE_CODE) AS SOCLIR_TYPE
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000323 -- CLIR SOC
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CLIR_SOC', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_CLIR_SOC',
                                     'FAFIF',
                                     'IX_MAIN_CLSOC_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

    -- CLIR SOCLIR T1 SV Not CLIR SOCLIR in HLR

 SQL_TXT := 'CREATE TABLE REP_CL_SOCT1_SV_NO_HLR NOLOGGING AS
            select * from MAIN_CLIR_SOC T
            WHERE (T.CLIR_1 <> 1 OR T.SOCLIR_1 <> 1)
              AND T.CP_STATUS = 3
              AND t.SERVICE_TYPE_NAME = ''Voice''
              AND T.soclir_type = ''TYPE_1''
              AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT1_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CL_SOCT1_SV_NO_HLR','CREATE_ACTIVATE','CLIR_SOCLIR','1'); -- CLIR SOCLIR

    SQL_TXT := ' CREATE TABLE REP_CL_SOCT1_SV_NO_HLR2 NOLOGGING AS
                  select * from MAIN_CLIR_SOC T
                  WHERE (T.CLIR_2 <> 1 OR T.SOCLIR_2 <> 1)
                    AND T.CP_STATUS = 3
                    AND t.SERVICE_TYPE_NAME = ''Voice''
                    AND T.soclir_type = ''TYPE_1''
                    AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT1_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CL_SOCT1_SV_NO_HLR2','CREATE_ACTIVATE','CLIR_SOCLIR','2'); -- CLIR SOCLIR

-- added by julie 15-04-2010

-- CLIR SOCLIR T1 in HLR Not SV
--HLR1
SQL_TXT := 'CREATE TABLE REP_CL_SOCT1_HLR_NOT_SV1 NOLOGGING AS
            select * from MAIN_CLIR_SOC T
            WHERE T.CLIR_1 = 1
              AND T.SOCLIR_1 = 1
              AND T.CP_STATUS = 3
              AND T.SERVICE_STATUS <> ''Cancelled''
              AND T.SERVICE_TYPE_NAME = ''Voice''
              AND T.soclir_type = ''TYPE_1''
              AND t.MSISDN_HLRS IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT1_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;



--HLR2
SQL_TXT := 'CREATE TABLE REP_CL_SOCT1_HLR_NOT_SV2 NOLOGGING AS
            select * from MAIN_CLIR_SOC T
            WHERE T.CLIR_2 = 1
              AND T.SOCLIR_2 = 1
              AND T.CP_STATUS = 3
              AND T.SERVICE_STATUS <> ''Cancelled''
              AND T.SERVICE_TYPE_NAME = ''Voice''
              AND T.soclir_type = ''TYPE_1''
              AND t.MSISDN_HLRS IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT1_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

 
 
 
 --end added by julie

 -- CLIR SOCLIR T2 SV Not CLIR SOCLIR in HLR

     SQL_TXT := 'CREATE TABLE REP_CL_SOCT2_SV_NO_HLR NOLOGGING AS
                select * from MAIN_CLIR_SOC T
                WHERE (T.CLIR_1 <> 1 OR T.SOCLIR_1 <> 2)
                  AND T.CP_STATUS = 3
                  AND t.SERVICE_TYPE_NAME = ''Voice''
                  AND T.soclir_type = ''TYPE_2''
                  AND t.MSISDN_HLRS IS NOT NULL';


        IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT2_SV_NO_HLR', 'FAFIF', SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
        END IF;

        RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CL_SOCT2_SV_NO_HLR','CREATE_ACTIVATE','CLIR_SOCLIR','1'); -- CLIR SOCLIR T2

    SQL_TXT := ' CREATE TABLE REP_CL_SOCT2_SV_NO_HLR2 NOLOGGING AS
                  select * from MAIN_CLIR_SOC T
                  WHERE (T.CLIR_2 <> 1 OR T.SOCLIR_2 <> 2)
                    AND T.CP_STATUS = 3
                    AND t.SERVICE_TYPE_NAME = ''Voice''
                    AND T.soclir_type = ''TYPE_2''
                    AND t.MSISDN_HLRS IS NOT NULL';


    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT2_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CL_SOCT2_SV_NO_HLR2','CREATE_ACTIVATE','CLIR_SOCLIR','2'); -- CLIR SOCLIR T2


    -- added by julie 15-04-2010
   --CLIR SOCLIR T2 HLR Not CLIR SOCLIR in SV
   --hlr1

   SQL_TXT := 'CREATE TABLE REP_CL_SOCT2_HLR_NOT_SV1 NOLOGGING AS
            select * from MAIN_CLIR_SOC T
            WHERE T.CLIR_1 = 1
              AND T.SOCLIR_1 = 1
              AND T.CP_STATUS = 3
              AND T.SERVICE_STATUS <> ''Cancelled''
              AND T.SERVICE_TYPE_NAME = ''Voice''
              AND T.soclir_type = ''TYPE_2''
              AND t.MSISDN_HLRS IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT2_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

--HLR2
 SQL_TXT :='CREATE TABLE REP_CL_SOCT2_HLR_NOT_SV2 NOLOGGING AS
            select * from MAIN_CLIR_SOC T
            WHERE T.CLIR_2 = 1
              AND T.SOCLIR_2 = 1
              AND T.CP_STATUS = 3
              AND T.SERVICE_STATUS <> ''Cancelled''
              AND T.SERVICE_TYPE_NAME = ''Voice''
              AND T.soclir_type = ''TYPE_2''
              AND t.MSISDN_HLRS IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOCT2_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    --end added by julie
    
       SQL_TXT := 'CREATE TABLE REP_CL_SOC_HLR_NOT_SV1 NOLOGGING AS
                  SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                       WHERE NVL(M.CLIR_1, 0) = 1
                       AND NVL(M.SOCLIR_1, 0) = 1
                       AND M.MSISDN_HLRS IS NOT NULL
                       AND M.SERVICE_STATUS <> ''Cancelled''
                       AND M.SERVICE_TYPE_NAME = ''Voice''
                       AND NOT EXISTS
                       (SELECT 1 FROM MAIN_CLIR_SOC MC WHERE MC.MSISDN = M.msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOC_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CL_SOC_HLR_NOT_SV1','DELETE','CLIR_SOCLIR','1'); 

--HLR2

 SQL_TXT :='CREATE TABLE REP_CL_SOC_HLR_NOT_SV2 NOLOGGING AS
                   SELECT *
               FROM REP_CLEAN_ALL_MERGED M
                 WHERE NVL(M.CLIR_2, 0) = 1
                   AND NVL(M.SOCLIR_2, 0) = 1
                   AND M.MSISDN_HLRS IS NOT NULL
                   AND M.SERVICE_STATUS <> ''Cancelled''
                   AND M.SERVICE_TYPE_NAME = ''Voice''
                   AND NOT EXISTS
                 (SELECT 1 FROM MAIN_CLIR_SOC MC WHERE MC.MSISDN = M.msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CL_SOC_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CL_SOC_HLR_NOT_SV2','DELETE','CLIR_SOCLIR','2'); 


     --================================================================================================================
    -- VPN Recon
    --================================================================================================================


    -- added by julie 16-04-2010
    -- VPN

 SQL_TXT :='CREATE TABLE MAIN_VPN NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262 --ALFA CLASSIC
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000339 -- VPN
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_VPN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    --VPN SV NOT IN HLR
    --HLR1

    SQL_TXT :='CREATE TABLE REP_VPN_SV_NO_HLR1 NOLOGGING AS
                    SELECT *
                      FROM MAIN_VPN T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.OICK_1, 0)not in (42,151)
                       AND T.MSISDN_HLRS IS NOT NULL
                      ';
        
    IF UTILS_INTERFACES.CREATE_TABLE('REP_VPN_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

   RECONCILIATION_INTERFACES.PROV_RECON_VPN_CPS('FAFIF','REP_VPN_SV_NO_HLR1','CREATE_ACTIVATE','VPN','1');

    --HLR2

         SQL_TXT :='CREATE TABLE REP_VPN_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_VPN T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.OICK_2, 0)not in (42,151)
                       AND T.MSISDN_HLRS IS NOT NULL
                      ';
         

    IF UTILS_INTERFACES.CREATE_TABLE('REP_VPN_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.PROV_RECON_VPN_CPS('FAFIF','REP_VPN_SV_NO_HLR2','CREATE_ACTIVATE','VPN','2');

    -- VPN HLR NOT IN SV
    --HLR1

       SQL_TXT :='CREATE TABLE REP_VPN_HLR_NOT_SV1 NOLOGGING AS
                     SELECT *
                      FROM REP_CLEAN_ALL_MERGED T
                      WHERE T.SERVICE_TYPE_NAME = ''Voice''
                      AND T.SERVICE_STATUS <> ''Cancelled''
                      AND( NVL(T.OICK_1, 0)= 42
                       or NVL(T.OICK_1, 0)= 151)
                      AND T.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                      (SELECT 1 FROM MAIN_VPN TV WHERE TV.MSISDN = T.msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_VPN_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.PROV_RECON_VPN_CPS('FAFIF','REP_VPN_HLR_NOT_SV1','DELETE','VPN','1');

    --HLR2

      SQL_TXT :='CREATE TABLE REP_VPN_HLR_NOT_SV2 NOLOGGING AS
                     SELECT *
                     FROM REP_CLEAN_ALL_MERGED T
                      WHERE T.SERVICE_TYPE_NAME = ''Voice''
                      AND T.SERVICE_STATUS <> ''Cancelled''
                      AND( NVL(T.OICK_2, 0)= 42
                       or NVL(T.OICK_2, 0)= 151)
                      AND T.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                      (SELECT 1 FROM MAIN_VPN TV WHERE TV.MSISDN = T.msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_VPN_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.PROV_RECON_VPN_CPS('FAFIF','REP_VPN_HLR_NOT_SV2','DELETE','VPN','2');

    -- end added by julie


       --================================================================================================================
    -- VIP Recon
    --================================================================================================================


    -- added by julie 20-04-2010
    -- VIP

 SQL_TXT :='CREATE TABLE MAIN_VIP NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262 --ALFA CLASSIC
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000324 -- VIP
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_VIP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    --VIP SV NOT IN HLR
    --HLR1

    SQL_TXT :='CREATE TABLE REP_VIP_SV_NO_HLR1 NOLOGGING AS
                    SELECT *
                      FROM MAIN_VIP T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.TICK_1, 0)<>320
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND T.MSISDN NOT IN (''76459199'',''76459210'')';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_VIP_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_VIP_SV_NO_HLR1','CREATE_ACTIVATE','VIP','1');
    --HLR2

         SQL_TXT :='CREATE TABLE REP_VIP_SV_NO_HLR2 NOLOGGING AS
                    SELECT *
                      FROM MAIN_VIP T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.CP_STATUS = 3
                       AND NVL(T.TICK_2, 0)<>320
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND T.MSISDN NOT IN (''76459199'',''76459210'')';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_VIP_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_VIP_SV_NO_HLR2','CREATE_ACTIVATE','VIP','2');

    -- VIP HLR NOT IN SV
    --HLR1

       SQL_TXT :='CREATE TABLE REP_VIP_HLR_NOT_SV1 NOLOGGING AS
                  SELECT *
                      FROM REP_CLEAN_ALL_MERGED T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.SERVICE_STATUS<> ''Cancelled''
                       AND NVL(T.TICK_1, 0)= 320
                       AND T.MSISDN_HLRS IS NOT NULL
                        AND T.MSISDN NOT IN (''76459199'',''76459210'')
                        AND NOT EXISTS
                   (SELECT 1 FROM MAIN_VIP TV WHERE TV.MSISDN = T.msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_VIP_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_VIP_HLR_NOT_SV1','DELETE','VIP','1');

    --HLR2

      SQL_TXT :='CREATE TABLE REP_VIP_HLR_NOT_SV2 NOLOGGING AS
                 SELECT *
                      FROM REP_CLEAN_ALL_MERGED T
                     WHERE T.SERVICE_TYPE_NAME = ''Voice''
                       AND T.SERVICE_STATUS<> ''Cancelled''
                       AND NVL(T.TICK_2, 0)= 320
                       AND T.MSISDN_HLRS IS NOT NULL
                       AND T.MSISDN NOT IN (''76459199'',''76459210'')
                        AND NOT EXISTS
                   (SELECT 1 FROM MAIN_VIP TV WHERE TV.MSISDN = T.msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_VIP_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_VIP_HLR_NOT_SV2','DELETE','VIP','2');

    -- end added by julie


    -- ADDED BY JULIE RECONCILIATION DATA WITH ADDITIONAL NUMBER

    --MERGE FAX AND DATA SV
     SQL_TXT :='CREATE TABLE FAX_DATA_SV NOLOGGING AS
                  SELECT T.*
                  FROM REP_CLEAN_ALL_MERGED T
                  WHERE T.SERVICE_TYPE_NAME IN (''FAX with additional number'',''Data with additional number'')';

    IF UTILS_INTERFACES.CREATE_TABLE('FAX_DATA_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    SQL_TXT := 'CREATE TABLE BASE_PRODUCT_SV NOLOGGING AS
                SELECT T.*
                FROM REP_CLEAN_ALL_MERGED T
                WHERE T.SERVICE_TYPE_NAME IN (''Voice'')';

    IF UTILS_INTERFACES.CREATE_TABLE('BASE_PRODUCT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     SQL_TXT :='CREATE TABLE FAX_DATA_ALL_SV NOLOGGING AS
                  SELECT T.MSISDN AS MSISDN_MAIN,
                   T.IMSI AS IMSI_MAIN,
                   TT.*
                FROM base_product_sv T, FAX_DATA_SV TT
                WHERE T.PRODUCT_INSTANCE_ID (+)= TT.PRODUCT_INSTANCE_ID';

    IF UTILS_INTERFACES.CREATE_TABLE('FAX_DATA_ALL_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    --MERGE DATA AND FAX ADDITIONAL NUMBER IN HLR
     SQL_TXT :='CREATE TABLE DATA_ADDITION_NUM1_CLEAN NOLOGGING AS
                SELECT T.IMSI,
                DECODE(SUBSTR(SUBSTR(T.msisdn1, 4), 1, 1),7,SUBSTR(T.msisdn1, 4),3,''0'' || (SUBSTR(T.msisdn1, 4)),1,''0'' || (SUBSTR(T.msisdn1, 4))) AS MAIN_VOICE,
                DECODE(SUBSTR(SUBSTR(T.amsisdn, 4), 1, 1),7,SUBSTR(T.amsisdn, 4),3,''0'' || (SUBSTR(T.amsisdn, 4)),1,''0'' || (SUBSTR(T.amsisdn, 4))) AS ADDITIONAL_MSISDN ,
                T.BC,
                T.BS
                FROM DATA_ADDITION_NUMBER1 T';

    IF UTILS_INTERFACES.CREATE_TABLE('DATA_ADDITION_NUM1_CLEAN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

       SQL_TXT :='CREATE TABLE DATA_ADDITION_NUM2_CLEAN NOLOGGING AS
                  SELECT T.IMSI,
                  DECODE(SUBSTR(SUBSTR(T.msisdn1, 4), 1, 1),7,SUBSTR(T.msisdn1, 4),3,''0'' || (SUBSTR(T.msisdn1, 4)),1,''0'' || (SUBSTR(T.msisdn1, 4))) AS MAIN_VOICE,
                  DECODE(SUBSTR(SUBSTR(T.amsisdn, 4), 1, 1),7,SUBSTR(T.amsisdn, 4),3,''0'' || (SUBSTR(T.amsisdn, 4)),1,''0'' || (SUBSTR(T.amsisdn, 4))) AS ADDITIONAL_MSISDN ,
                  T.BC,
                  T.BS
                  FROM DATA_ADDITION_NUMBER2 T';

    IF UTILS_INTERFACES.CREATE_TABLE('DATA_ADDITION_NUM2_CLEAN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    SQL_TXT :='CREATE TABLE MERGE_ADDITION_NUM1_NUM2_CLEAN NOLOGGING AS
               SELECT T.IMSI AS IMSI1,
                  T.MAIN_VOICE AS MAIN_VOICE1,
                  T.ADDITIONAL_MSISDN AS ADDITIONAL_MSISDN1,
                  TT.IMSI AS IMSI2,
                  TT.MAIN_VOICE AS MAIN_VOICE2,
                  TT.ADDITIONAL_MSISDN AS ADDITIONAL_MSISDN2,
                  T.BC AS BC1,
                  T.BS AS BS1,
                  TT.BC AS BC2,
                  TT.BS AS BS2
                  FROM DATA_ADDITION_NUM1_CLEAN T, DATA_ADDITION_NUM2_CLEAN TT
                  WHERE T.ADDITIONAL_MSISDN(+)=TT.ADDITIONAL_MSISDN
                  UNION
                  SELECT T.IMSI AS IMSI1,
                  T.MAIN_VOICE AS MAIN_VOICE1,
                  T.ADDITIONAL_MSISDN AS ADDITIONAL_MSISDN1,
                  TT.IMSI AS IMSI2,
                  TT.MAIN_VOICE AS MAIN_VOICE2,
                  TT.ADDITIONAL_MSISDN AS ADDITIONAL_MSISDN2,
                  T.BC AS BC1,
                  T.BS AS BS1,
                   TT.BC AS BC2,
                   TT.BS AS BS2
                   FROM DATA_ADDITION_NUM1_CLEAN T, DATA_ADDITION_NUM2_CLEAN TT
                   WHERE T.ADDITIONAL_MSISDN=TT.ADDITIONAL_MSISDN(+)';


    IF UTILS_INTERFACES.CREATE_TABLE('MERGE_ADDITION_NUM1_NUM2_CLEAN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    -- MERGE FAX DATA SV/ HLRS

     SQL_TXT :='CREATE TABLE FAX_DATA_MERGED_HLR_SV NOLOGGING AS
                 SELECT t.*,
                        TT.MAIN_VOICE1,
                        TT.MAIN_VOICE2,
                        TT.ADDITIONAL_MSISDN1,
                        TT.BC1,
                        TT.BS1,
                        TT.BC2,
                        TT.BS2
                      FROM FAX_DATA_ALL_SV t, MERGE_ADDITION_NUM1_NUM2_CLEAN TT
                      WHERE T.MSISDN(+)= TT.ADDITIONAL_MSISDN1
                      UNION
                      SELECT   t.*,
                        TT.MAIN_VOICE1,
                        TT.MAIN_VOICE2,
                        TT.ADDITIONAL_MSISDN1,
                        TT.BC1,
                        TT.BS1,
                        TT.BC2,
                        TT.BS2
                      FROM FAX_DATA_ALL_SV t, MERGE_ADDITION_NUM1_NUM2_CLEAN TT
                      WHERE t.msisdn =TT.ADDITIONAL_MSISDN1(+)';


    IF UTILS_INTERFACES.CREATE_TABLE('FAX_DATA_MERGED_HLR_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    -- FAX SV NOT HLR
    -- HLR1

     SQL_TXT :='CREATE TABLE REP_FAX_SV_NOT_HLR1 NOLOGGING AS
                 SELECT T.*
                 FROM FAX_DATA_MERGED_HLR_SV T
                 WHERE
                 T.SERVICE_TYPE_NAME =''FAX with additional number''
                 AND T.SERVICE_STATUS <>''Cancelled''
                 AND
                 (T.BC1 <> ''161''
                 OR T.BS1<> ''TS62''
                 OR T.BC1 IS NULL
                 OR T.BS1 IS NULL)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_FAX_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_FAX_SV_NOT_HLR1','CREATE_ACTIVATE','FAX','1');
    -- HLR2

     SQL_TXT :='CREATE TABLE REP_FAX_SV_NOT_HLR2 NOLOGGING AS
                SELECT T.*
                FROM FAX_DATA_MERGED_HLR_SV T
                WHERE
                T.SERVICE_TYPE_NAME =''FAX with additional number''
                AND T.SERVICE_STATUS <>''Cancelled''
                AND
                (T.BC2 <> ''161''
                OR T.BS2<> ''TS62''
                OR T.BC2 IS NULL
                OR T.BS2 IS NULL)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_FAX_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_FAX_SV_NOT_HLR2','CREATE_ACTIVATE','FAX','2');

    -- FAX HLR NOT IN SV
    -- HLR1
    SQL_TXT :='CREATE TABLE REP_FAX_HLR_NOT_SV1 NOLOGGING AS
                SELECT T.*
                FROM FAX_DATA_MERGED_HLR_SV T
                WHERE T.SERVICE_TYPE_NAME <>''FAX with additional number''
                AND T.BC1 = ''161''
                AND T.BS1 = ''TS62''';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_FAX_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_FAX_HLR_NOT_SV1','DELETE','FAX','1');

    -- HLR2
    SQL_TXT :='CREATE TABLE REP_FAX_HLR_NOT_SV2 NOLOGGING AS
                SELECT T.*
                FROM FAX_DATA_MERGED_HLR_SV T
                WHERE T.SERVICE_TYPE_NAME <>''FAX with additional number''
                AND T.BC2 = ''161''
                AND T.BS2 = ''TS62''';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_FAX_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_FAX_HLR_NOT_SV2','DELETE','FAX','2');


    -- DATA SV NOT HLR
    -- HLR1

      SQL_TXT :='CREATE TABLE REP_DATA_SV_NOT_HLR1 NOLOGGING AS
                  SELECT T.*
                  FROM FAX_DATA_MERGED_HLR_SV T
                  WHERE T.SERVICE_TYPE_NAME =''Data with additional number''
                  AND T.SERVICE_STATUS <>''Cancelled''
                  AND (T.BC1 <> ''326''
                  OR T.BS1<> ''BS26''
                  OR T.BC1 IS NULL
                  OR T.BS1 IS NULL)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_DATA_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_DATA_SV_NOT_HLR1','CREATE_ACTIVATE','DATA','1');

    -- HLR2

     SQL_TXT :='CREATE TABLE REP_DATA_SV_NOT_HLR2 NOLOGGING AS
                  SELECT T.*
                  FROM FAX_DATA_MERGED_HLR_SV T
                  WHERE T.SERVICE_TYPE_NAME =''Data with additional number''
                  AND T.SERVICE_STATUS <>''Cancelled''
                  AND (T.BC2 <> ''326''
                  OR T.BS2<> ''BS26''
                  OR T.BC2 IS NULL
                  OR T.BS2 IS NULL)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_DATA_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_DATA_SV_NOT_HLR2','CREATE_ACTIVATE','DATA','2');

    -- DATA HLR NOT SV
    --HLR1

    SQL_TXT :='CREATE TABLE REP_DATA_HLR_NOT_SV1 NOLOGGING AS
                SELECT T.*
                FROM FAX_DATA_MERGED_HLR_SV T
                WHERE T.SERVICE_TYPE_NAME <>''Data with additional number''
                AND T.BC1 = ''326''
                AND T.BS1 = ''BS26''';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_DATA_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_DATA_HLR_NOT_SV1','DELETE','DATA','1');

    --HLR2

     SQL_TXT :='CREATE TABLE REP_DATA_HLR_NOT_SV2 NOLOGGING AS
                SELECT T.*
                FROM FAX_DATA_MERGED_HLR_SV T
                WHERE T.SERVICE_TYPE_NAME <>''Data with additional number''
                AND T.BC2 = ''326''
                AND T.BS2 = ''BS26''';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_DATA_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_DATA_HLR_NOT_SV2','DELETE','DATA','2');

    -- END ADDED BY JULIE RECONCILIATION DATA WITH ADDITIONAL NUMBER
    
    -- ADDED BY JULIE RECONCILIATION MI GIFT PROMO 15-02-2017
     /*
    --================================================================================================================
    -- MI Gift main Recon
    --================================================================================================================*/
     SQL_TXT :='CREATE TABLE MAIN_MI_GIFT_SYS NOLOGGING AS
             SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.*,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1325080
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_3) AS PROMO_NAME
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1000262  -- ALFA CLASSIC
                 AND T.Service_Type_Name in (''Voice'')
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1325020 -- Ad Hoc Promotion
                 AND PIH.GENERAL_3 IN (SELECT DSC.DATA_SCP_PROMO_REFCODE 
                        FROM DATA_SCP_PROMO_CONFIG DSC
                      WHERE DSC.ACTIVE = 1 
                        AND DSC.DATA_TYPE = ''PROMO'') -- PROMO NAME
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_MI_GIFT_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
   
 --HLR1

   -- CPs and Services having MI Gift on SV and not in HLR1 (ACTIVATE)

    SQL_TXT := 'CREATE TABLE REP_MI_GIFT_SV_NOT_HLR1 NOLOGGING AS
                SELECT * FROM MAIN_MI_GIFT_SYS G
                   WHERE
                    ((G.GPRS_APN1 IS NULL AND G.ALFA_APN1 IS NULL) OR G.NAM_1 = 1)
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.MSISDN NOT IN (''76447470'')
                     AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''DATA'',''ALL''))';
                    

     IF UTILS_INTERFACES.CREATE_TABLE('REP_MI_GIFT_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MI_GIFT_SV_NOT_HLR1','CREATE_ACTIVATE','MOBILE_INTERNET','1');

--HLR2
 
   -- CPs and Services having GPRS_WEB_WAP on SV and not in HLR2 (ACTIVATE)

    SQL_TXT := 'CREATE TABLE REP_MI_GIFT_SV_NOT_HLR2 NOLOGGING AS
                SELECT * FROM MAIN_MI_GIFT_SYS G
                   WHERE ((G.GPRS_APN2 IS NULL AND G.ALFA_APN2 IS NULL) OR G.NAM_2 = 1)
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active'' 
                     AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                     WHERE REASON in (''DATA'',''ALL''))';
                    

     IF UTILS_INTERFACES.CREATE_TABLE('REP_MI_GIFT_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MI_GIFT_SV_NOT_HLR2','CREATE_ACTIVATE','MOBILE_INTERNET','2'); 

--================================================================================================================
    -- MAIN_DATASCP_SYS Recon FOR ALL DATA SCP added on 28-03-2019
    --================================================================================================================*/

-- SV

    SQL_TXT :='CREATE TABLE MAIN_DATASCP_SYS NOLOGGING AS
             SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.* ,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1325280
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS SMART_COMPANION_NAME,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1375021
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_6) AS SCP_VOLUME_OPTION
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1000262  -- ALFA CLASSIC
                 AND T.Service_Type_Name =''Voice''
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1375022 -- Smart Companion Postpaid
                 AND PIH.GENERAL_5 IN (
                    SELECT DSC.DATA_SCP_PROMO_REFCODE 
                        FROM DATA_SCP_PROMO_CONFIG DSC
                    WHERE DSC.ACTIVE = 1 
                        AND DSC.DATA_TYPE = ''SCP'')-- SCP NAME
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
                 
 IF UTILS_INTERFACES.CREATE_TABLE('MAIN_DATASCP_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
      IF UTILS_INTERFACES.CREATE_INDEX('MAIN_DATASCP_SYS',
                                     'FAFIF',
                                     'IX_MAIN_DATASCP_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;

   --HLR1
      
    SQL_TXT := 'CREATE TABLE REP_DATASCP_SV_NOT_HLR1 NOLOGGING AS
                SELECT * FROM MAIN_DATASCP_SYS G
                   WHERE
                    ((G.GPRS_APN1 IS NULL AND G.ALFA_APN1 IS NULL) OR G.NAM_1 = 1)
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''DATA'',''ALL''))';   
      
      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_DATASCP_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_DATASCP_SV_NOT_HLR1','CREATE_ACTIVATE','MOBILE_INTERNET','1');   

    --HLR2
      
    SQL_TXT := 'CREATE TABLE REP_DATASCP_SV_NOT_HLR2 NOLOGGING AS
                SELECT * FROM MAIN_DATASCP_SYS G
                   WHERE
                    ((G.GPRS_APN2 IS NULL AND G.ALFA_APN2 IS NULL) OR G.NAM_2 = 1)
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                      AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''DATA'',''ALL''))';   
      
      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_DATASCP_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_DATASCP_SV_NOT_HLR2','CREATE_ACTIVATE','MOBILE_INTERNET','2');   
 
    --ADDED BY  JULIE RECONCILIATION GPRS WEB-WAP 17/06/2010
    /*
    --================================================================================================================
    -- GPRS WEB-WAP main Recon
    --================================================================================================================*/
SQL_TXT :='CREATE TABLE MAIN_GPRS_WEB_WAP_SYS NOLOGGING AS
             SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.MSISDN AS MSISDN_CP,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON,
                      T.*
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1000262
                 AND T.Service_Type_Name =''Voice''
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1000327 -- GPRS_WEB_WAP
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9
                 AND T.RATE_PLAN <> 8';

    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_GPRS_WEB_WAP_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


      IF UTILS_INTERFACES.CREATE_INDEX('MAIN_GPRS_WEB_WAP_SYS',
                                     'FAFIF',
                                     'IX_MAIN_GPRS_MSISDN',
                                     'MSISDN_CP') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;

--HLR1

   -- CPs and Services having GPRS_WEB_WAP on SV and not in HLR1 (ACTIVATE)

    SQL_TXT := 'CREATE TABLE REP_GPRSWEBWAP_SV_NOT_HLR1 NOLOGGING AS
                SELECT * FROM MAIN_GPRS_WEB_WAP_SYS G
                   WHERE
                    ((G.GPRS_APN1 IS NULL AND G.ALFA_APN1 IS NULL) OR G.NAM_1 = 1)
                     AND G.MSISDN_CP IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.MSISDN_CP NOT IN (''76447470'')
                     AND G.MSISDN_CP NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''DATA'',''ALL''))';
                  

     IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSWEBWAP_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSWEBWAP_SV_NOT_HLR1','CREATE_ACTIVATE','MOBILE_INTERNET','1');
    -- CPs and Services having GPRS_WEB_WAP on HLR and not in SV (Fraud)

   SQL_TXT := 'CREATE TABLE REP_GPRSWEBWAP_HLR_NOT_SV1 NOLOGGING AS
               SELECT * FROM REP_CLEAN_ALL_MERGED G
                   WHERE G.GPRS_APN1 IS NOT NULL
                     AND G.NAM_1 = 0
                     AND G.SERVICE_TYPE_NAME = ''Voice''
                     AND G.MSISDN NOT IN (SELECT T.MSISDN_CP FROM MAIN_BB_SYS T)
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_GPRS_WEB_WAP_SYS MMI WHERE MMI.MSISDN_CP = G.msisdn)
                   AND NOT EXISTS
                   (SELECT 1 FROM MAIN_MI_GIFT_SYS MW WHERE MW.MSISDN = G.msisdn)
                   AND NOT EXISTS
                  (SELECT 1 FROM MAIN_DATASCP_SYS MV WHERE MV.MSISDN = G.msisdn)
                   AND G.MSISDN NOT IN (''76447470'')
                   AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''DATA'',''ALL''))';
               

    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSWEBWAP_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSWEBWAP_HLR_NOT_SV1','DELETE','INTERNET_APN','1');


 --HLR2
 
   -- CPs and Services having GPRS_WEB_WAP on SV and not in HLR1 (ACTIVATE)

    SQL_TXT := 'CREATE TABLE REP_GPRSWEBWAP_SV_NOT_HLR2 NOLOGGING AS
                SELECT * FROM MAIN_GPRS_WEB_WAP_SYS G
                   WHERE ((G.GPRS_APN2 IS NULL AND G.ALFA_APN2 IS NULL) OR G.NAM_2 = 1)
                     AND G.MSISDN_CP IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.MSISDN_CP NOT IN (''76447470'')
                     AND G.MSISDN_CP NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''DATA'',''ALL''))
                     ';
                   

     IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSWEBWAP_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSWEBWAP_SV_NOT_HLR2','CREATE_ACTIVATE','MOBILE_INTERNET','2');

    -- CPs and Services having GPRS_WEB_WAP on HLR and not in SV (Fraud)

   SQL_TXT := 'CREATE TABLE REP_GPRSWEBWAP_HLR_NOT_SV2 NOLOGGING AS
               SELECT * FROM REP_CLEAN_ALL_MERGED G
                   WHERE G.GPRS_APN2 IS NOT NULL
                     AND G.NAM_2 = 0
                     --AND (G.MSISDN_CP IS NULL OR G.CP_STATUS LIKE ''%Suspended%'') Omitted since after rechecking with Jihane the Suspension for WAP and MI no action is taken into consideration for the suspension scenarios 26-03-2012
                     --AND (G.MSISDN_CP IS NULL)
                     AND G.SERVICE_TYPE_NAME = ''Voice''
                     AND G.MSISDN NOT IN (SELECT T.MSISDN_CP FROM MAIN_BB_SYS T)
                     AND NOT EXISTS
                     (SELECT 1 FROM MAIN_GPRS_WEB_WAP_SYS MMI WHERE MMI.MSISDN_CP = G.msisdn)
                    AND NOT EXISTS
                   (SELECT 1 FROM MAIN_MI_GIFT_SYS MW WHERE MW.MSISDN = G.msisdn)
                    AND NOT EXISTS
                   (SELECT 1 FROM MAIN_DATASCP_SYS MV WHERE MV.MSISDN = G.msisdn)
                    AND G.MSISDN NOT IN (''76447470'')
                    AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''DATA'',''ALL''))';
                  

    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSWEBWAP_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSWEBWAP_HLR_NOT_SV2','DELETE','INTERNET_APN','2');

    --ADDED BY  JULIE RECONCILIATION GPRS INTRANET 12/07/2010
    /*
    --================================================================================================================
    -- GPRS INTRANET main Recon
    --================================================================================================================*/
    SQL_TXT := 'CREATE TABLE MAIN_GPRS_INTRA_SYS NOLOGGING AS
                  SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.MSISDN AS MSISDN_CP,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON,
                T.*         
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1000262
                 AND T.Service_Type_Name =''Voice''
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1000338 -- GPRS Intranet
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_GPRS_INTRA_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
   --HLR1

      -- CPs and Services having GPRSINTRA on SV and not in HLR1 (ACTIVATE)

      SQL_TXT := 'CREATE TABLE REP_GPRSINTRA_SV_NOT_HLRAPN1 NOLOGGING AS
                  SELECT * FROM MAIN_GPRS_INTRA_SYS B
                   WHERE B.GPRS_INTRA_APN1 IS NULL
                     AND B.MSISDN_CP IS NOT NULL
                     AND B.CP_STATUS = ''Active''' ;


    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSINTRA_SV_NOT_HLRAPN1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSINTRA_SV_NOT_HLRAPN1','CREATE_ACTIVATE','GPRS_INTRANET','1');
     -- CPs and Services having GPRSINTRA on HLR and not in SV (Fraud)

       SQL_TXT := 'CREATE TABLE REP_GPRSINTA_HLRAPN_NOT_SV NOLOGGING AS
                  SELECT * FROM REP_CLEAN_ALL_MERGED B
                   WHERE B.GPRS_INTRA_APN1 IS NOT NULL
                     AND B.SERVICE_TYPE_NAME = ''Voice''
                     AND NOT EXISTS
                     (SELECT 1 FROM MAIN_GPRS_INTRA_SYS MG WHERE MG.MSISDN_CP = B.msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSINTA_HLRAPN_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
     RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSINTA_HLRAPN_NOT_SV','DELETE','GPRS_INTRANET','1');

   --HLR2

    -- CPs and Services having GPRSINTRA on SV and not in HLR2 (ACTIVATE)

    SQL_TXT :='CREATE TABLE REP_GPRSINTRA_SV_NOT_HLRAPN2 NOLOGGING AS
                  SELECT * FROM MAIN_GPRS_INTRA_SYS B
                   WHERE B.GPRS_INTRA_APN2 IS NULL
                     AND B.MSISDN_CP IS NOT NULL
                     AND B.CP_STATUS = ''Active''';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSINTRA_SV_NOT_HLRAPN2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSINTRA_SV_NOT_HLRAPN2','CREATE_ACTIVATE','GPRS_INTRANET','2');
    -- CPs and Services having GPRSINTRA on HLR and not in SV (Fraud)

    SQL_TXT :='CREATE TABLE REP_GPRSINTA_HLRAPN2_NOT_SV NOLOGGING AS
                  SELECT * FROM REP_CLEAN_ALL_MERGED B
                   WHERE B.GPRS_INTRA_APN2 IS NOT NULL
                    AND B.SERVICE_TYPE_NAME = ''Voice''
                    AND NOT EXISTS
                     (SELECT 1 FROM MAIN_GPRS_INTRA_SYS MG WHERE MG.MSISDN_CP = B.msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_GPRSINTA_HLRAPN2_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_GPRSINTA_HLRAPN2_NOT_SV','DELETE','GPRS_INTRANET','2');


    --END ADDED BY  JULIE RECONCILIATION GPRS INTRANET 12/07/2010


    -- ADDED BY JULIE 17/09/2010
    --================================================================================================================
    -- CONFERENCE MULTIPARTY
    --================================================================================================================

     SQL_TXT := 'CREATE TABLE MAIN_CMP NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID in (1000262,1000241) -- Alfa Classic, Alfa Active
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000334 -- Conference Multiparty CMP
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_CMP', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    -- CMP SV NOT HLR1

       SQL_TXT := 'CREATE TABLE REP_CMP_SV_NO_HLR1 NOLOGGING AS
                    select * from MAIN_CMP T
                    WHERE T.MPTY_1 IS NULL
                      AND T.CP_STATUS = 3
                      AND t.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                      AND t.MSISDN_HLRS IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CMP_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CMP_SV_NO_HLR1','CREATE_ACTIVATE','CMP','1');


    SQL_TXT := 'CREATE TABLE REP_CMP_SV_NO_HLR2 NOLOGGING AS
                   select * from MAIN_CMP T
                   WHERE T.MPTY_2 IS NULL
                     AND T.CP_STATUS = 3
                    AND t.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                     AND t.MSISDN_HLRS IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CMP_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CMP_SV_NO_HLR2','CREATE_ACTIVATE','CMP','2');

     -- CMP HLR1 NOT SV ==> Fraud

     SQL_TXT := 'CREATE TABLE REP_CMP_HLR_NOT_SV1 NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE NVL(M.MPTY_1,0) = 1
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_CMP MC WHERE MC.MSISDN = m.msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CMP_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CMP_HLR_NOT_SV1','DELETE','CMP','1');

     -- CMP HLR2 NOT SV ==> Fraud

     SQL_TXT := 'CREATE TABLE REP_CMP_HLR_NOT_SV2 NOLOGGING AS
                SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE NVL(M.MPTY_2,0) = 1
                     AND M.MSISDN_HLRS IS NOT NULL
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND M.SERVICE_TYPE_NAME in (''Voice'',''Prepaid'')
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_CMP MC WHERE MC.MSISDN = m.msisdn)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_CMP_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_CMP_HLR_NOT_SV2','DELETE','CMP','2');

    --================================================================================================================
    -- DBJUM
    --================================================================================================================

     -- VIDEO CALL SCENARIOS

     SQL_TXT := 'CREATE TABLE MAIN_VIDEOCALL_SYS NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.*,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1200041
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_6) AS VIDEO_RATE_PLAN
                 FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID =1000262 -- Alfa Classic
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1200041 -- VIDEO CALL
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';


    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_VIDEOCALL_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


     SQL_TXT := 'CREATE TABLE REP_VCALL_SV_NO_HLR1 NOLOGGING AS
                    select * from MAIN_VIDEOCALL_SYS T
                    WHERE T.BS3G_1 IS NULL
                      AND t.SERVICE_TYPE_NAME = ''Voice''
                        AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_VCALL_SV_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.PROV_RECON_BS3G_PARAM ('FAFIF','REP_VCALL_SV_NO_HLR1','1');

     SQL_TXT := ' CREATE TABLE REP_VCALL_SV_NO_HLR2 NOLOGGING AS
                    select * from MAIN_VIDEOCALL_SYS T
                    WHERE T.BS3G_2 IS NULL
                      AND T.SERVICE_TYPE_NAME = ''Voice''
                      AND T.CP_STATUS = ''Active''
                      AND t.MSISDN_HLRS IS NOT NULL';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_VCALL_SV_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.PROV_RECON_BS3G_PARAM ('FAFIF','REP_VCALL_SV_NO_HLR2','1');

      SQL_TXT := ' CREATE TABLE REP_VCALL_HLR_NOT_SV1 NOLOGGING AS
            select * from REP_CLEAN_ALL_MERGED T
            WHERE T.BS3G_1 = 1
              AND T.PROD_STATUS = 3
              AND T.SERVICE_STATUS <> ''Cancelled''
              AND T.SERVICE_TYPE_NAME = ''Voice''
                 AND NOT EXISTS
                   (SELECT 1 FROM MAIN_VIDEOCALL_SYS MV WHERE MV.MSISDN = T.MSISDN)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_VCALL_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.PROV_RECON_BS3G_PARAM ('FAFIF','REP_VCALL_HLR_NOT_SV1','0');

     SQL_TXT := ' CREATE TABLE REP_VCALL_HLR_NOT_SV2 NOLOGGING AS
            select * from REP_CLEAN_ALL_MERGED T
            WHERE T.BS3G_2 = 1
              AND T.PROD_STATUS = 3
              AND T.SERVICE_STATUS <> ''Cancelled''
              AND T.SERVICE_TYPE_NAME = ''Voice''
                 AND NOT EXISTS
                   (SELECT 1 FROM MAIN_VIDEOCALL_SYS MV WHERE MV.MSISDN = T.MSISDN)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_VCALL_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.PROV_RECON_BS3G_PARAM ('FAFIF','REP_VCALL_HLR_NOT_SV2','0');

-- MBB PRIVATE APN IN SV

      SQL_TXT := 'CREATE TABLE MAIN_MBB_PRIV_NET_SYS NOLOGGING AS
             SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.* ,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1325280
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS SMART_COMPANION_NAME,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1375021
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_6) AS SCP_VOLUME_OPTION,
                      PIH.INDUSTRY_GENERAL_7 AS MBB_SV_APN
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1200080  -- MOBILE BROADBAND POSTPAID
                 AND T.Service_Type_Name =''Postpaid Broadband''
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1375022 -- Smart Companion Postpaid
                 AND PIH.GENERAL_5 in (70000064) -- SCP NAME
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

     IF UTILS_INTERFACES.CREATE_TABLE('MAIN_MBB_PRIV_NET_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;
    
      IF UTILS_INTERFACES.CREATE_INDEX('MAIN_MBB_PRIV_NET_SYS',
                                     'FAFIF',
                                     'IX_MAIN_MBB_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;


     -- MOBILE BROADBAND SCENARIOS

     SQL_TXT := 'CREATE TABLE MAIN_MBB_SYS NOLOGGING AS
                 SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.Msisdn AS MSISDN_BP,
                     T.IMSI AS IMSI_SV,
                     T.PRODUCT_INSTANCE_ID AS BP_INSTANCE_ID,
                     T.SERVICE_TYPE_NAME AS MBB_TYPE,
                     T.SERVICE_STATUS AS MBB_STATUS,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=1200100
                           AND RCR.REFERENCE_CODE = T.RATE_PLAN) AS VOLUME_OPTION,
                      T.*
                 FROM REP_CLEAN_ALL_MERGED T
                 WHERE T.PRODUCT_TYPE_NAME in (''Mobile Broadband Postpaid'',''Mobile Broadband Prepaid'')
                  AND T.RATE_PLAN NOT IN (''1053'')
                  AND T.MSISDN NOT IN (SELECT TT.MSISDN_SYS FROM MAIN_MBB_PRIV_NET_SYS TT)
                  ';

    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_MBB_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
      IF UTILS_INTERFACES.CREATE_INDEX('MAIN_MBB_SYS',
                                     'FAFIF',
                                     'IX_MAIN_MBB_MSISDN',
                                     'MSISDN_BP') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;
      

      

     SQL_TXT := 'CREATE TABLE REP_MBB_SV_NOT_HLR1 NOLOGGING AS
                  select * from MAIN_MBB_SYS t
                 WHERE T.MBB_TYPE IN (''Prepaid Broadband'',''Postpaid Broadband'')
                 AND T.MBB_STATUS = ''Active''
                 AND T.MSISDN_BP NOT IN (SELECT TT.SERVICE_NAME FROM REP_SV_MSISDN_IN_MISP TT)
                 AND T.MSISDN_BP NOT IN (SELECT T.MSISDN from MAIN_MBB_PRIV_NET_SYS T)
                 AND (T.MSISDN_HLR1 IS NULL
                                   OR T.BS26_1 <> 1
                  --OR T.NAM_1 <> 0
                  OR (T.MBB_APN1 IS NULL  
                  AND T.ALFA_APN1 IS NULL)
                  )';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;



     SQL_TXT := 'CREATE TABLE REP_MBB_POST_SV_NOT_HLR1 NOLOGGING AS
                 SELECT * from REP_MBB_SV_NOT_HLR1 t
                 WHERE T.MBB_TYPE IN (''Postpaid Broadband'')
                 and T.MSISDN_BP not in (''71636712'')
                 AND T.MSISDN_BP NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''DATA'',''ALL''))
                  AND T.CUSTOMER_NODE_ID not in (606061,619231,644671,630478) --Allo Taxi , ZOMATO, EDL
                   AND T.LOGIN_OPTION NOT IN (
                   SELECT reference_code
                          FROM REFERENCE_CODE RCR
                           WHERE REFERENCE_TYPE_ID=1002520 
                          and rcr.code_label IN ( select a.apn_id from MBB_DATA_CARD_PRIVATE_APN a))
                 ';

                                              
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_POST_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MBB_POST_SV_NOT_HLR1','CREATE_ACTIVATE','MOBILE_BROADBAND_POSTPAY','1');

      SQL_TXT := 'CREATE TABLE REP_MBB_PREP_SV_NOT_HLR1 NOLOGGING AS
                  select * from REP_MBB_SV_NOT_HLR1 t
                 WHERE T.MBB_TYPE IN (''Prepaid Broadband'')
                 and T.MSISDN_BP not in (''71636712'')
                 AND T.MSISDN_BP NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''DATA'',''ALL''))
                 ';
               
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_PREP_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MBB_PREP_SV_NOT_HLR1','CREATE_ACTIVATE','MOBILE_BROADBAND_PREPAY','1');


     SQL_TXT := 'CREATE TABLE REP_MBB_SV_NOT_HLR2 NOLOGGING AS
                  select * from MAIN_MBB_SYS t
                 WHERE T.MBB_TYPE IN (''Prepaid Broadband'',''Postpaid Broadband'')
                 AND T.MSISDN_BP NOT IN (SELECT TT.SERVICE_NAME FROM REP_SV_MSISDN_IN_MISP TT)
                 AND T.MSISDN_BP NOT IN (SELECT T.MSISDN from MAIN_MBB_PRIV_NET_SYS T)
                 AND T.MBB_STATUS = ''Active''
                 AND (T.MSISDN_HLR2 IS NULL
                  OR T.BS26_2 <> 1
                  --OR T.NAM_2 <> 0
                  OR (T.MBB_APN2 IS NULL 
                  AND T.ALFA_APN2 IS NULL)
                  )';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     SQL_TXT := 'CREATE TABLE REP_MBB_POST_SV_NOT_HLR2 NOLOGGING AS
                  select * from REP_MBB_SV_NOT_HLR2 t
                 WHERE T.MBB_TYPE IN (''Postpaid Broadband'')
                 AND T.MSISDN_BP NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''DATA'',''ALL''))
                 AND T.CUSTOMER_NODE_ID NOT IN (606061,619231,644671,630478) --Allo Taxi,ZOMATO
                  AND T.LOGIN_OPTION NOT IN (
                   SELECT reference_code
                          FROM REFERENCE_CODE RCR
                           WHERE REFERENCE_TYPE_ID=1002520 
                          and rcr.code_label IN ( select a.apn_id from MBB_DATA_CARD_PRIVATE_APN a))
                 ';
                                          
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_POST_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MBB_POST_SV_NOT_HLR2','CREATE_ACTIVATE','MOBILE_BROADBAND_POSTPAY','2');

      SQL_TXT := 'CREATE TABLE REP_MBB_PREP_SV_NOT_HLR2 NOLOGGING AS
                  select * from REP_MBB_SV_NOT_HLR2 t
                 WHERE T.MBB_TYPE IN (''Prepaid Broadband'')
                 AND T.MSISDN_BP NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''DATA'',''ALL''))
                 ';
                                          
    
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_PREP_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

     RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MBB_PREP_SV_NOT_HLR2','CREATE_ACTIVATE','MOBILE_BROADBAND_PREPAY','2');


     SQL_TXT := '  CREATE TABLE REP_MBB_HLR1_NOT_SV NOLOGGING AS
                   select * from REP_CLEAN_ALL_MERGED t
                    WHERE T.MSISDN_HLR1 IS NOT NULL
                    AND T.BS26_1 = 1
                    AND T.NAM_1 = 0
                    AND T.MBB_APN1 IS NOT NULL 
                    --AND T.ALFA_APN1 IS NOT NULL
                    AND (T.PRODUCT_TYPE_NAME not in (''Mobile Broadband Postpaid'', ''Mobile Broadband Prepaid'', ''Alfa Active'')
                          OR T.SERVICE_STATUS = ''Cancelled'' ))
                    AND T.MSISDN_HLR1 NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''DATA'',''ALL''))
                    AND T.MSISDN_HLR1 NOT IN (SELECT TT.SERVICE_NAME FROM REP_SV_MSISDN_IN_MISP TT)
                    AND NOT EXISTS
                   (SELECT 1 FROM MAIN_MBB_SYS MMB WHERE MMB.MSISDN_BP = T.msisdn)'; -- THESE MSISDN SHOULD BE RE-INCLUDED IN 23/08/2012
 

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_HLR1_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

   -- RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MBB_HLR1_NOT_SV','DELETE','MOBILE_BROADBAND_POSTPAY','1');


      SQL_TXT := ' CREATE TABLE REP_MBB_HLR2_NOT_SV NOLOGGING AS
                    select * from REP_CLEAN_ALL_MERGED t
                    WHERE T.MSISDN_HLR2 IS NOT NULL
                    AND T.BS26_2 = 1
                    AND T.NAM_2 = 0
                    AND T.MBB_APN2 IS NOT NULL 
                   -- AND T.ALFA_APN2 IS NOT NULL
                    AND (T.PRODUCT_TYPE_NAME not in (''Mobile Broadband Postpaid'', ''Mobile Broadband Prepaid'', ''Alfa Active'')
                    OR T.SERVICE_STATUS = ''Cancelled'' )
                    AND T.MSISDN_HLR2 NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''DATA'',''ALL''))
                    AND T.MSISDN_HLR2 NOT IN (SELECT TT.SERVICE_NAME FROM REP_SV_MSISDN_IN_MISP TT)                                          
                    AND NOT EXISTS
                   (SELECT 1 FROM MAIN_MBB_SYS MMB WHERE MMB.MSISDN_BP = T.msisdn)'; -- THESE MSISDN SHOULD BE RE-INCLUDED IN 23/08/2012


    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_HLR2_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

  --   RECONCILIATION_INTERFACES.prov_recon_services('FAFIF','REP_MBB_HLR2_NOT_SV','DELETE','MOBILE_BROADBAND_POSTPAY','2');

-- RECONCILIATION SCENARIO DEFINED AS MBB ON SV AND HAVING VOICE PARAMETER ON HLR

      SQL_TXT := 'CREATE TABLE REP_MBB_SV_VOICE_HLR1 AS
                  SELECT t.MSISDN_SYS,T.IMSI, t.PRODUCT_TYPE_NAME, t.PROD_STATUS, t.TS11_1
                  FROM REP_CLEAN_ALL_MERGED t
                  WHERE T.PRODUCT_TYPE_NAME in (''Mobile Broadband Postpaid'',''Mobile Broadband Prepaid'')
                  and (T.TS11_1 IS NOT NULL OR T.TS11_1 <> ''0'')
                  ';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_SV_VOICE_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
   
    RECONCILIATION_INTERFACES.PROV_RECON_TS11_PARAM ('FAFIF','REP_MBB_SV_VOICE_HLR1','0');
    
      SQL_TXT := 'CREATE TABLE REP_MBB_SV_VOICE_HLR2 AS
                  SELECT t.MSISDN_SYS,T.IMSI, t.PRODUCT_TYPE_NAME, t.PROD_STATUS, t.TS11_2
                  FROM REP_CLEAN_ALL_MERGED t
                  WHERE T.PRODUCT_TYPE_NAME in (''Mobile Broadband Postpaid'',''Mobile Broadband Prepaid'')
                  and (T.TS11_2 IS NOT NULL OR T.TS11_2 <> ''0'')
                  ';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_SV_VOICE_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
     RECONCILIATION_INTERFACES.PROV_RECON_TS11_PARAM ('FAFIF','REP_MBB_SV_VOICE_HLR2','0');

    -- ==========================================================================================================
    -- End of Reconciliation Phase IV Interface
    -- ==========================================================================================================

 EXCEPTION
 WHEN OTHERS THEN
 NULL;

  END P4_CP_INTERFACES;


PROCEDURE P_IA_CP_INTERFACES(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS
  

    -- =============================================================================================
    --    Pre-requisite               : SV DMP
    --    Release                     : R1.0
    --    Date                        : 31/10/2009
    --    Author                      : FAF
    --    Requirement  version        : V1.0
    --    Comments                    : Reconciliation CPs
    --   ------------------------------------------------------------------------------------------- 
    
    
    --================================================================================================================
    -- sql_txt : contains the sql statment body
    --================================================================================================================
    SQL_TXT             VARCHAR2(4000);
    RELEASE              VARCHAR2(20)    := 'R1.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;
    

    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);




  BEGIN


    UTILS_INTERFACES.INTERFACE_NAME := 'P_IA_CP_INTERFACES';
 


-- ###########################################
-- ********** PHASE II CPs Recon***************
-- ###########################################

   -- International Access CP

         SQL_TXT := 'CREATE TABLE MAIN_INTL_ACCESS NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID IN (1000262, 1000241)
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000331
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE not in (9,10)';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('MAIN_INTL_ACCESS', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_INTL_ACCESS',
                                     'FAFIF',
                                     'IX_MSISDN_IA',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;
    

   -- Limited INTL CP

         SQL_TXT := 'CREATE TABLE MAIN_LIMITED_INT_ACC NOLOGGING AS
          SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON,
                   (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000450
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS CREDIT_LIMIT   
            FROM REP_CLEAN_ALL_MERGED T,
                 PRODUCT_INSTANCE_HISTORY PIH
           WHERE T.PROD_BP_INST IS NULL
             AND T.PRODUCT_ID IN (1000262)
             AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
             AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND
                 PIH.EFFECTIVE_END_DATE
             AND PIH.PRODUCT_ID = 1000335
             AND PIH.PRODUCT_INSTANCE_STATUS_CODE not in (9,10)';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('MAIN_LIMITED_INT_ACC', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_LIMITED_INT_ACC',
                                     'FAFIF',
                                     'IX_MSISDN_LIA',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;
    
   -- Regional Roaming CP

         SQL_TXT := 'CREATE TABLE MAIN_REG_ROAMING NOLOGGING AS
            SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                   T.*,
                   PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                   PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                   PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                   PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
                   PIH.GENERAL_1 AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID = 1000262
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND
                   PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000330
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE not in (9,10)';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('MAIN_REG_ROAMING', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;


    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_REG_ROAMING',
                                     'FAFIF',
                                     'IX_MSISDN_RR',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;
    
   -- SMS Roaming CP

         SQL_TXT := 'CREATE TABLE MAIN_SMS_ROAMING NOLOGGING AS
                     SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                             T.*,
                             PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                             PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                             PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                             PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS_ID,
                             PIH.GENERAL_1 AS CP_REASON_ID,
                             (SELECT RCR.ABBREVIATION
                               FROM REFERENCE_CODE RCR
                              WHERE REFERENCE_TYPE_ID=490
                              AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                            (SELECT RCR.ABBREVIATION
                             FROM REFERENCE_CODE RCR
                             WHERE REFERENCE_TYPE_ID=1000225
                             AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON
              FROM REP_CLEAN_ALL_MERGED T,
                   PRODUCT_INSTANCE_HISTORY PIH
             WHERE T.PROD_BP_INST IS NULL
               AND T.PRODUCT_ID IN (1000262)
               AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
               AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND
                   PIH.EFFECTIVE_END_DATE
               AND PIH.PRODUCT_ID = 1000329 -- SMS ROAMING
               AND PIH.PRODUCT_INSTANCE_STATUS_CODE NOT IN (9,10)';
               
                   
          IF UTILS_INTERFACES.CREATE_TABLE('MAIN_SMS_ROAMING', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_SMS_ROAMING',
                                     'FAFIF',
                                     'IX_MSISDN_SR',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;
       
   -- Roaming CP

         SQL_TXT := 'CREATE TABLE MAIN_ROAMING NOLOGGING AS
          SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
               T.*,
               PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
               PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
               PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
               PIH.PRODUCT_INSTANCE_STATUS_CODE AS CP_STATUS,
               PIH.GENERAL_1 AS CP_REASON
            FROM REP_CLEAN_ALL_MERGED T,
                 PRODUCT_INSTANCE_HISTORY PIH
           WHERE T.PROD_BP_INST IS NULL
             AND T.PRODUCT_ID = 1000262
             AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
             AND PIH.PRODUCT_ID = 1000343
             AND PIH.PRODUCT_INSTANCE_STATUS_CODE NOT IN (9,10)';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('MAIN_ROAMING', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_ROAMING',
                                     'FAFIF',
                                     'IX_MSISDN_R',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;

    -- Fraud: Limited International Access on HLR not having LIA CP subscribed to in SV HLR1

    SQL_TXT := 'CREATE TABLE REP_LIA_HLR_NOT_SV1 NOLOGGING AS
                  SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE 
                   ((M.OBO_1 = 3 AND M.OBR_1 = 0 AND M.OICK_1 = 160)
                    OR
                    (M.OBO_1 = 0 AND M.OBR_1 = 0 AND M.OICK_1 = 161)
                    OR
                    (M.OBO_1 = 0 AND M.OBR_1 = 0 AND M.OICK_1 = 160)
                    OR
                    (M.OBO_1 = 3 AND M.OBR_1 = 0 AND M.RSA_1 = 5)
                    OR
                    (M.OBR_1 = 2 AND M.OBO_1 = 3 AND RSA_1 = 5)
                    OR
                    (M.RSA_1 = 11 AND M.OBR_1 = 0 AND M.OICK_1 = 160 AND M.OBO_1 = 3)
                    OR
                    (M.RSA_1 = 13 AND M.OBR_1 = 0 AND M.OICK_1 = 160 AND M.OBO_1 = 3)
                    OR
                    (M.RSA_1 = 15 AND M.OBR_1 = 0 AND M.OICK_1 = 160 AND M.OBO_1 = 3)
                    )
                   AND M.SERVICE_TYPE_NAME = ''Voice''
                   AND M.SERVICE_STATUS <> ''Cancelled''
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_LIMITED_INT_ACC IA WHERE IA.MSISDN = M.MSISDN)
                   ';
         
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_LIA_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_LIA_HLR_NOT_SV1','DELETE','LIMITED_IA','1');

-- Fraud: Limited International Access on HLR not having LIA CP subscribed to in SV HLR2

   SQL_TXT := 'CREATE TABLE REP_LIA_HLR_NOT_SV2 NOLOGGING AS
                  SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE 
                   ((M.OBO_2 = 3 AND M.OBR_2 = 0 AND M.OICK_2 = 160)
                    OR
                    (M.OBO_2 = 0 AND M.OBR_2 = 0 AND M.OICK_2 = 161)
                    OR
                    (M.OBO_2 = 0 AND M.OBR_2 = 0 AND M.OICK_2 = 160)
                    OR
                    (M.OBO_2 = 3 AND M.OBR_2 = 0 AND M.RSA_2 = 5)
                    OR 
                     (M.OBR_2 = 2 AND M.OBO_2 = 3 AND RSA_2 = 5)
                    OR
                    (M.RSA_2 = 11 AND M.OBR_2 = 0 AND M.OICK_2 = 160 AND M.OBO_2 = 3)
                    OR
                    (M.RSA_2 = 13 AND M.OBR_2 = 0 AND M.OICK_2 = 160 AND M.OBO_2 = 3)
                    OR
                    (M.RSA_2 = 15 AND M.OBR_2 = 0 AND M.OICK_2 = 160 AND M.OBO_2 = 3)
                     )
                   AND M.SERVICE_TYPE_NAME = ''Voice''
                   AND M.SERVICE_STATUS <> ''Cancelled''
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_LIMITED_INT_ACC IA WHERE IA.MSISDN = M.MSISDN)
                   ';
               
          IF UTILS_INTERFACES.CREATE_TABLE('REP_LIA_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

     RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_LIA_HLR_NOT_SV2','DELETE','LIMITED_IA','2');

  
       -- Fadi-Elsy 17092010 added OICK not IN
        
        -- HLR1
        
     SQL_TXT := 'CREATE TABLE REP_IA_HLR_NOT_SV1 NOLOGGING AS
                    SELECT *
                    FROM REP_CLEAN_ALL_MERGED M
                   WHERE 
                   ((M.OBO_1 = 0 AND M.OBR_1 = 0 AND M.RSA_1 = 3 AND M.OICK_1 = 0)
                     OR
                    (M.OBO_1 = 0 AND M.OBR_1 = 0 AND M.OICK_1 = 150 AND M.RSA_1 = 4)
                    OR
                    (M.OBO_1 = 0  AND M.OBR_1 = 0 AND M.OICK_1 = 0 AND M.RSA_1 = 4)
                    OR
                    (M.OBO_1 = 0 AND M.OBR_1 = 0 AND M.OICK_1 = 42 AND M.RSA_1 = 3)
                    OR
                    (M.OBO_1 = 0 AND M.OBR_1 = 0 AND M.OICK_1 = 151 AND M.RSA_1 = 4)
                    OR
                    (M.OBO_1 = 0 AND M.OBR_1 = 2 AND M.OICK_1 = 0 AND M.RSA_1 in(0,10,12,14,16,18))
                     OR
                    (M.OBO_1 = 0 AND M.OBR_1 = 2 AND M.OICK_1 = 42 AND M.RSA_1 in(0,10,12,14,16,18))
                   )
                   AND M.SERVICE_TYPE_NAME = ''Voice''
                   AND M.SERVICE_STATUS <> ''Cancelled''
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_INTL_ACCESS MIA WHERE MIA.MSISDN = M.MSISDN)
                   ';
                  
                   
          IF UTILS_INTERFACES.CREATE_TABLE('REP_IA_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
          RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_IA_HLR_NOT_SV1','DELETE','IA','1');
          
         -- HLR2
         
          SQL_TXT := 'CREATE TABLE REP_IA_HLR_NOT_SV2 NOLOGGING AS
                       SELECT *
                      FROM REP_CLEAN_ALL_MERGED M
                      WHERE 
                      ((M.OBO_2 = 0 AND M.OBR_2 = 0 AND M.RSA_2 = 3 AND M.OICK_2 = 0)
                       OR
                       (M.OBO_2 = 0 AND M.OBR_2 = 0 AND M.OICK_2 = 150 AND M.RSA_2 = 4)
                       OR
                       (M.OBO_2 = 0  AND M.OBR_2 = 0 AND M.OICK_2 = 0 AND M.RSA_2 = 4)
                       OR
                       (M.OBO_2 = 0 AND M.OBR_2 = 0 AND M.OICK_2 = 42 AND M.RSA_2 = 3)
                       OR
                       (M.OBO_2 = 0 AND M.OBR_2 = 0 AND M.OICK_2 = 151 AND M.RSA_2 = 4)
                       OR
                       (M.OBO_2 = 0 AND M.OBR_2 = 2 AND M.OICK_2 = 0 AND M.RSA_2 = 0)
                       OR
                       (M.OBO_2 = 0 AND M.OBR_2 = 2 AND M.OICK_2 = 42 AND M.RSA_2 = 0)
                       OR
                       (M.OBO_2 = 0 AND M.OBR_2 = 0 AND M.OICK_2 = 0 AND M.RSA_2 in(0,10,12,14,16,18))
                       OR
                       (M.OBO_2 = 0 AND M.OBR_2 = 0 AND M.OICK_2 = 42 AND M.RSA_2 in(0,10,12,14,16,18))
                       )
                     AND M.SERVICE_TYPE_NAME in (''Voice'')
                     AND M.SERVICE_STATUS <> ''Cancelled''
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_INTL_ACCESS MIA WHERE MIA.MSISDN = M.MSISDN)
                  ';
                
                   
          IF UTILS_INTERFACES.CREATE_TABLE('REP_IA_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_IA_HLR_NOT_SV2','DELETE','IA','2');
  
    
    --#### Check HLR Values
    
    -- FA 13122009: Added status in order to include only Active Services  for All mismatches as recommended by IT VAS
    --updated Julie Bou Mikhael 15-07-2011 in order to generate the required scenarios
    -- CP IA      Regional Roaming
                                    
     SQL_TXT := 'CREATE TABLE INTL_ACCESS_VS_REG_ROAM NOLOGGING AS
                SELECT IA.MSISDN,
                       IA.IMSI,
                       IA.SERVICE_TYPE_NAME,
                       IA.ACCOUNT_NAME,
                       IA.ACCOUNT_TYPE,
                       IA.CP_INSTANCE_ID AS IA_CP_ID,
                       IA.OBO_1 ,
                       IA.OICK_1 ,
                       IA.OBR_1 ,
                       IA.OBO_2 ,
                       IA.OICK_2 ,
                       IA.OBR_2 ,
                       RR.CP_INSTANCE_ID AS SR_CP_ID,
                       RR.RSA_1,
                       RR.RSA_2 
                  FROM MAIN_INTL_ACCESS IA, MAIN_REG_ROAMING RR
                 WHERE IA.MSISDN = RR.MSISDN
                   AND RR.SERVICE_STATUS = ''Active''
                   AND IA.MSISDN_HLRS IS NOT NULL';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('INTL_ACCESS_VS_REG_ROAM', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

       -- Report discrepencies 
      -- Residential Postpaid/INTERNATIONAL ACCES/REGIONAL ROAMING/on SV not HLR1
      
    SQL_TXT := 'CREATE TABLE REP_DISC_IA_VS_REG_ROAM_RES1 NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_REG_ROAM R
                WHERE (R.OBO_1 <>0 OR R.OICK_1 <> 0 OR R.OBR_1 <> 0 OR R.RSA_1 <> 2)
                AND R.ACCOUNT_TYPE in (''Residential  Postpaid Customer Type'',''Business Postpaid Customer Type'')
                AND R.service_type_name = ''Voice''
                AND NOT EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = R.MSISDN)
                ';
    

                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_REG_ROAM_RES1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
         
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_REG_ROAM_RES1','CREATE_ACTIVATE','KSA_ROAMING','1');
     
       -- Residential Postpaid/INTERNATIONAL ACCES/REGIONAL ROAMING/on SV not HLR2
          
      SQL_TXT := 'CREATE TABLE REP_DISC_IA_VS_REG_ROAM_RES2 NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_REG_ROAM R
                WHERE (R.OBO_2 <>0 OR R.OICK_2 <> 0 OR R.OBR_2 <> 0 OR R.RSA_2 <> 2)
                AND R.ACCOUNT_TYPE in (''Residential  Postpaid Customer Type'',''Business Postpaid Customer Type'')
                AND R.service_type_name = ''Voice''
                AND NOT EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = R.MSISDN)
                ';
  
              
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_REG_ROAM_RES2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
       
      RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_REG_ROAM_RES2','CREATE_ACTIVATE','KSA_ROAMING','2');   
               
       -- Business Postpaid/INTERNATIONAL ACCES/REGIONAL ROAMING/on SV not HLR1
          
      SQL_TXT := '  CREATE TABLE REP_DISC_IA_VS_REG_ROAM_BUS1 NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_REG_ROAM R
                WHERE (R.OBO_1 <>0 OR R.OICK_1 <> 42 OR R.OBR_1 <> 0 OR R.RSA_1 <> 2)
                AND R.ACCOUNT_TYPE = ''Business Postpaid Customer Type''
                AND R.service_type_name = ''Voice''
                AND EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = R.MSISDN)
                '; 
              
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_REG_ROAM_BUS1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
     
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_REG_ROAM_BUS1','CREATE_ACTIVATE','KSA_ROAMING','1');
      
      -- Business Postpaid/INTERNATIONAL ACCES/REGIONAL ROAMING/on SV not HLR2 
      
      SQL_TXT := '  CREATE TABLE REP_DISC_IA_VS_REG_ROAM_BUS2 NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_REG_ROAM R
                WHERE (R.OBO_2 <>0 OR R.OICK_2 <> 42 OR R.OBR_2 <> 0 OR R.RSA_2 <> 2)
                AND R.ACCOUNT_TYPE = ''Business Postpaid Customer Type''
                AND R.service_type_name = ''Voice''
                AND EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = R.MSISDN)
                ';
     
              
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_REG_ROAM_BUS2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
     RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_REG_ROAM_BUS2','CREATE_ACTIVATE','KSA_ROAMING','2');

    --  CP IA Vs SMS Roaming
    
    SQL_TXT := 'CREATE TABLE INTL_ACCESS_VS_SMS_ROAM NOLOGGING AS
                SELECT IA.MSISDN,
                       IA.IMSI,
                       IA.SERVICE_TYPE_NAME,
                       IA.ACCOUNT_NAME,
                       IA.ACCOUNT_TYPE,
                       IA.CP_INSTANCE_ID AS IA_CP_ID,
                       IA.OBO_1 ,
                       IA.OICK_1 ,
                       IA.OBR_1 ,
                       IA.OBO_2 ,
                       IA.OICK_2 ,
                       IA.OBR_2 ,
                       SR.CP_INSTANCE_ID AS SR_CP_ID,
                       sr.rsa_1,
                       sr.rsa_2 
                  FROM MAIN_INTL_ACCESS IA, MAIN_SMS_ROAMING SR
                 WHERE IA.MSISDN = SR.MSISDN
                   AND SR.SERVICE_STATUS = ''Active''
                   AND IA.MSISDN_HLRS IS NOT NULL';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('INTL_ACCESS_VS_SMS_ROAM', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;


      -- Report discrepencies 
      -- Residential Postpaid/INTERNATIONAL ACCES/SMS ROAMING/on SV not HLR1
      
    SQL_TXT := 'CREATE TABLE REP_DISC_IA_VS_SMS_ROAM_RES1 NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_SMS_ROAM R
                WHERE (R.OBO_1 <>0 OR R.OICK_1 <> 150 OR R.OBR_1 <> 0 OR R.RSA_1 <> 4)
                AND R.ACCOUNT_TYPE in (''Residential  Postpaid Customer Type'',''Business Postpaid Customer Type'')
                AND R.service_type_name = ''Voice''
                AND NOT EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = R.MSISDN)
                ';
                  
                
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_SMS_ROAM_RES1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
     RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_SMS_ROAM_RES1','CREATE_ACTIVATE','SMS_ROAMING','1');
          
      -- Residential Postpaid/INTERNATIONAL ACCES/SMS ROAMING/on SV not HLR2
      
    SQL_TXT := 'CREATE TABLE REP_DISC_IA_VS_SMS_ROAM_RES2 NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_SMS_ROAM R
                WHERE (R.OBO_2 <>0 OR R.OICK_2 <> 150 OR R.OBR_2 <> 0 OR R.RSA_2 <> 4)
                AND R.ACCOUNT_TYPE in (''Residential  Postpaid Customer Type'',''Business Postpaid Customer Type'')
                AND R.service_type_name = ''Voice''
                AND NOT EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = R.MSISDN)
               ';
                             
               
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_SMS_ROAM_RES2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
      RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_SMS_ROAM_RES2','CREATE_ACTIVATE','SMS_ROAMING','2');
          
     -- Business Postpaid/INTERNATIONAL ACCES/SMS ROAMING/on SV not HLR1 
     SQL_TXT := 'CREATE TABLE REP_DISC_IA_VS_SMS_ROAM_BUS1 NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_SMS_ROAM R
                WHERE (R.OBO_1 <>0 OR R.OICK_1 <> 151 OR R.OBR_1 <> 0 OR R.RSA_1 <> 4)
                AND R.ACCOUNT_TYPE in (''Business Postpaid Customer Type'')
                AND R.service_type_name = ''Voice''
                AND EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = R.MSISDN)
                ';
                
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_SMS_ROAM_BUS1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
     RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_SMS_ROAM_BUS1','CREATE_ACTIVATE','SMS_ROAMING','1');
          
     -- Business Postpaid/INTERNATIONAL ACCES/SMS ROAMING/on SV not HLR2 
     SQL_TXT := 'CREATE TABLE REP_DISC_IA_VS_SMS_ROAM_BUS2 NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_SMS_ROAM R
                WHERE (R.OBO_2 <>0 OR R.OICK_2 <> 151 OR R.OBR_2 <> 0 OR R.RSA_2 <> 4)
                AND R.ACCOUNT_TYPE in (''Business Postpaid Customer Type'')
                AND R.service_type_name = ''Voice''
                AND EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = R.MSISDN)
                ';
                  
                
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_SMS_ROAM_BUS2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
     RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_SMS_ROAM_BUS2','CREATE_ACTIVATE','SMS_ROAMING','2');

    -- CP IA Vs Roaming WITHOUT HAVING GPRS_ROAMING
    
    SQL_TXT := 'CREATE TABLE INTL_ACCESS_VS_ROAMING NOLOGGING AS
                SELECT IA.MSISDN,
                       IA.IMSI,
                       IA.SERVICE_TYPE_NAME,
                       IA.ACCOUNT_NAME,
                       IA.ACCOUNT_TYPE,
                       IA.CP_INSTANCE_ID AS IA_CP_ID,
                       IA.OBO_1 ,
                       IA.OICK_1 , 
                       IA.OBR_1 ,
                       IA.RSA_1 ,
                       IA.OBO_2 ,
                       IA.OICK_2 ,
                       IA.OBR_2 ,
                       IA.RSA_2,
                       R.CP_INSTANCE_ID AS R_CP_ID
                  FROM MAIN_INTL_ACCESS IA, MAIN_ROAMING R
                 WHERE IA.MSISDN = R.MSISDN
                   AND R.SERVICE_STATUS = ''Active''
                   AND R.CP_STATUS = 3
                   AND IA.CP_STATUS = 3
                   AND IA.MSISDN_HLRS IS NOT NULL
                   AND NOT EXISTS
                    (SELECT 1 FROM MAIN_GPRS_ROAM_SYS MGR WHERE MGR.MSISDN = R.MSISDN)';

          IF UTILS_INTERFACES.CREATE_TABLE('INTL_ACCESS_VS_ROAMING', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;


          -- Report discrepencies 
          -- Residential Postpaid/INTERNATIONAL ACCES/ROAMING/NOT HAVING GPRS_ROAMING on SV not HLR1
      
    SQL_TXT := 'CREATE TABLE REP_DISC_IA_VS_ROAM_RES1 NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_ROAMING R
                WHERE (R.OBO_1 <>0 OR R.OICK_1 <>0 OR R.OBR_1 <> 0 OR R.RSA_1 <> 4)
                AND R.ACCOUNT_TYPE in (''Residential  Postpaid Customer Type'',''Business Postpaid Customer Type'')
                AND R.service_type_name = ''Voice''
                AND NOT EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = R.MSISDN)
                ';
                
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_ROAM_RES1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
     RECONCILIATION_INTERFACES.PROV_RECON_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_ROAM_RES1','CREATE_ACTIVATE','ROAMING','1');
          
          -- Residential Postpaid/INTERNATIONAL ACCES/ROAMING/NOT HAVING GPRS_ROAMING on SV not HLR2
          
     SQL_TXT := ' CREATE TABLE REP_DISC_IA_VS_ROAM_RES2 NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_ROAMING R
                WHERE (R.OBO_2 <>0 OR R.OICK_2 <> 0 OR R.OBR_2 <> 0 OR R.RSA_2 <> 4)
                AND R.ACCOUNT_TYPE in (''Residential  Postpaid Customer Type'',''Business Postpaid Customer Type'')
                AND R.service_type_name = ''Voice''
                AND NOT EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = R.MSISDN)
                ';
                

                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_ROAM_RES2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
     
     RECONCILIATION_INTERFACES.PROV_RECON_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_ROAM_RES2','CREATE_ACTIVATE','ROAMING','2');
          
          -- Business Postpaid/INTERNATIONAL ACCES/ROAMING/NOT HAVING GPRS_ROAMING on SV not HLR1
          -- Oick 42 has been eliminated since this scenario is only for Business postpaid customer having VPN Rate plan
          
     SQL_TXT := 'CREATE TABLE REP_DISC_IA_VS_ROAM_BUS1 NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_ROAMING R
                WHERE (R.OBO_1 <>0 OR R.OBR_1 <> 0 OR R.RSA_1 <> 4)
                AND R.ACCOUNT_TYPE = ''Business Postpaid Customer Type''
                AND R.service_type_name = ''Voice''
                AND EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = R.MSISDN)
                ';
                
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_ROAM_BUS1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
      
     RECONCILIATION_INTERFACES.PROV_RECON_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_ROAM_BUS1','CREATE_ACTIVATE','ROAMING','1');
         
          -- Business Postpaid/INTERNATIONAL ACCES/ROAMING/NOT HAVING GPRS_ROAMING on SV not HLR2
          -- Oick 42 has been eliminated since this scenario is only for Business postpaid customer having VPN Rate plan
          
     SQL_TXT := 'CREATE TABLE REP_DISC_IA_VS_ROAM_BUS2 NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_ROAMING R
                WHERE (R.OBO_2 <>0 OR R.OBR_2 <> 0 OR R.RSA_2 <> 4)
                AND R.ACCOUNT_TYPE = ''Business Postpaid Customer Type''
                AND R.service_type_name = ''Voice''
                AND EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = R.MSISDN)
                ';
                
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_ROAM_BUS2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
     RECONCILIATION_INTERFACES.PROV_RECON_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_ROAM_BUS2','CREATE_ACTIVATE','ROAMING','2'); 
                
    -- CP LIA Vs Regional Roaming
    
    SQL_TXT := 'CREATE TABLE LIM_INTL_ACC_VS_REG_ROAM NOLOGGING AS
                SELECT LIA.MSISDN,
                       LIA.IMSI,
                       LIA.SERVICE_TYPE_NAME,
                       LIA.ACCOUNT_NAME,
                       LIA.ACCOUNT_TYPE,
                       LIA.CP_INSTANCE_ID AS IA_CP_ID,
                       LIA.CREDIT_LIMIT,
                       LIA.OBO_1 ,
                       LIA.OICK_1 ,
                       LIA.OBR_1 ,
                       LIA.OBO_2 ,
                       LIA.OICK_2 ,
                       LIA.OBR_2 ,
                       RR.CP_INSTANCE_ID AS SR_CP_ID,
                       RR.RSA_1,
                       RR.RSA_2 
                  FROM MAIN_LIMITED_INT_ACC LIA, MAIN_REG_ROAMING RR
                 WHERE LIA.MSISDN = RR.MSISDN
                   AND RR.SERVICE_STATUS = ''Active''
                   AND LIA.MSISDN_HLRS IS NOT NULL';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('LIM_INTL_ACC_VS_REG_ROAM', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

        -- Report discrepencies 
        -- Residential Postpaid&Business Postpaid/LIMITED INTERNATIONAL ACCES/REGIONAL ROAMING/on SV not HLR1
        
    SQL_TXT := 'CREATE TABLE REP_DISC_LIM_IA_VSREG_ROAM1 AS
                SELECT * FROM LIM_INTL_ACC_VS_REG_ROAM R
                WHERE (R.OBO_1 <>3 OR R.OBR_1 <>0 OR R.RSA_1<>2 OR R.OICK_1<>160)
                AND R.service_type_name = ''Voice''
                ';
                
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_LIM_IA_VSREG_ROAM1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

    RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_DISC_LIM_IA_VSREG_ROAM1','CREATE_ACTIVATE','KSA_ROAMING','1');

        -- Residential Postpaid&Business Postpaid/LIMITED INTERNATIONAL ACCES/REGIONAL ROAMING/on SV not HLR2
        
    SQL_TXT := 'CREATE TABLE REP_DISC_LIM_IA_VSREG_ROAM2 AS
                SELECT * FROM LIM_INTL_ACC_VS_REG_ROAM R
                WHERE (R.OBO_2 <>3 OR R.OBR_2 <>0 OR R.RSA_2<>2 OR R.OICK_2<>160)
                AND R.service_type_name = ''Voice''';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_LIM_IA_VSREG_ROAM2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
   
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_DISC_LIM_IA_VSREG_ROAM2','CREATE_ACTIVATE','KSA_ROAMING','2');
        
    -- CP LIA Vs SMS Roaming
    
    SQL_TXT := 'CREATE TABLE LIM_INTL_ACC_VS_SMS_ROAM NOLOGGING AS
                SELECT LIA.MSISDN,
                       LIA.SERVICE_TYPE_NAME,
                       LIA.ACCOUNT_NAME,
                       LIA.ACCOUNT_TYPE,
                       LIA.SERVICE_STATUS,
                       LIA.CP_STATUS,
                       LIA.CP_INSTANCE_ID AS LIA_CP_ID,
                       LIA.CREDIT_LIMIT,
                       LIA.IMSI,
                       LIA.OBO_1 ,
                       LIA.OICK_1 ,
                       LIA.OBR_1 ,
                       LIA.OBO_2,
                       LIA.OICK_2,
                       LIA.OBR_2,
                       SR.CP_INSTANCE_ID AS SR_CP_ID,
                       sr.rsa_1 ,
                       sr.rsa_2
                  FROM MAIN_LIMITED_INT_ACC LIA, MAIN_SMS_ROAMING SR
                 WHERE LIA.MSISDN = SR.MSISDN
                   AND SR.SERVICE_STATUS = ''Active''
                   AND SR.CP_STATUS = ''Active''
                   AND LIA.MSISDN_HLRS IS NOT NULL';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('LIM_INTL_ACC_VS_SMS_ROAM', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

        -- Report discrepencies 
        -- Residential Postpaid&Business Postpaid/LIMITED INTERNATIONAL ACCES/SMS ROAMING/on SV not HLR1
    SQL_TXT := 'CREATE TABLE REP_DISC_LIM_IA_VSSMS_ROAM1 NOLOGGING AS
                SELECT * FROM LIM_INTL_ACC_VS_SMS_ROAM R
                WHERE (R.OBO_1 <>3 OR R.OBR_1 <>0 OR R.OICK_1<>161 OR R.RSA_1 <> 5)
                --(R.OBO_1 <>0 OR R.OBR_1 <>0 OR R.OICK_1<>161 OR R.RSA_1 <> 4)
                AND R.service_type_name = ''Voice''
                ';
 

          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_LIM_IA_VSSMS_ROAM1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

    RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_DISC_LIM_IA_VSSMS_ROAM1','CREATE_ACTIVATE','SMS_ROAMING','1');

         -- Residential Postpaid&Business Postpaid/LIMITED INTERNATIONAL ACCES/SMS ROAMING/on SV not HLR2
    SQL_TXT := 'CREATE TABLE REP_DISC_LIM_IA_VSSMS_ROAM2 NOLOGGING AS
                SELECT * FROM LIM_INTL_ACC_VS_SMS_ROAM R
                WHERE (R.OBO_2 <>3 OR R.OBR_2 <>0 OR R.OICK_2<>161 OR R.RSA_2 <> 5)
                --(R.OBO_2 <>0 OR R.OBR_2 <>0 OR R.OICK_2<>161 OR R.RSA_2 <> 4)
                AND R.service_type_name = ''Voice''
                ';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_LIM_IA_VSSMS_ROAM2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
        
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_DISC_LIM_IA_VSSMS_ROAM2','CREATE_ACTIVATE','SMS_ROAMING','2');  

    -- CP LIA Vs Roaming

    SQL_TXT := 'CREATE TABLE LIM_INTL_ACC_VS_ROAM NOLOGGING AS
                SELECT LIA.MSISDN,
                       LIA.SERVICE_TYPE_NAME,
                       LIA.ACCOUNT_NAME,
                       LIA.ACCOUNT_TYPE,
                       LIA.SERVICE_STATUS,
                       LIA.CP_STATUS,
                       LIA.CP_INSTANCE_ID AS LIA_CP_ID,
                       LIA.CREDIT_LIMIT,
                       LIA.IMSI,
                       LIA.OBO_1 ,
                       LIA.OICK_1 ,
                       LIA.OBR_1 ,
                       LIA.OBO_2,
                       LIA.OICK_2,
                       LIA.OBR_2,
                       R.CP_INSTANCE_ID AS SR_CP_ID,
                       r.rsa_1 ,
                       r.rsa_2
                  FROM MAIN_LIMITED_INT_ACC LIA, MAIN_ROAMING R
                 WHERE LIA.MSISDN = R.MSISDN
                   AND R.SERVICE_STATUS = ''Active''
                   AND R.CP_STATUS = 3
                   AND LIA.CP_STATUS = 3
                   AND LIA.MSISDN_HLRS IS NOT NULL
                   AND NOT EXISTS
                    (SELECT 1 FROM MAIN_GPRS_ROAM_SYS MGR WHERE MGR.MSISDN = R.MSISDN)';

          IF UTILS_INTERFACES.CREATE_TABLE('LIM_INTL_ACC_VS_ROAM', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

        -- Report discrepencies 
        -- Residential Postpaid&Business Postpaid/LIMITED INTERNATIONAL ACCES/ROAMING/on SV not HLR1

    SQL_TXT := 'CREATE TABLE REP_DISC_LIM_IA_VS_ROAM1 NOLOGGING AS
                SELECT * FROM LIM_INTL_ACC_VS_ROAM R
                WHERE (R.OBO_1 <>0 OR R.OBR_1 <>0 OR R.OICK_1<>160 OR R.RSA_1 <> 4)
                AND R.service_type_name = ''Voice''
                ';

                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_LIM_IA_VS_ROAM1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
   RECONCILIATION_INTERFACES.PROV_RECON_ROAMING_CPS('FAFIF','REP_DISC_LIM_IA_VS_ROAM1','CREATE_ACTIVATE','ROAMING','1');
          
       -- Report discrepencies 
       -- Residential Postpaid&Business Postpaid/LIMITED INTERNATIONAL ACCES/ROAMING/on SV not HLR2
       
     SQL_TXT := 'CREATE TABLE REP_DISC_LIM_IA_VS_ROAM2 NOLOGGING AS
                SELECT * FROM LIM_INTL_ACC_VS_ROAM R
                WHERE (R.OBO_2 <>0 OR R.OBR_2 <>0 OR R.OICK_2<>160 OR R.RSA_2 <> 4)
                AND R.service_type_name = ''Voice''
                ';

                  
         IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_LIM_IA_VS_ROAM2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
         END IF;

   RECONCILIATION_INTERFACES.PROV_RECON_ROAMING_CPS('FAFIF','REP_DISC_LIM_IA_VS_ROAM2','CREATE_ACTIVATE','ROAMING','2');

-- Fraud: International Access on HLR and not having IA or LIA CP subscribed to

      -- FA13122009: Take into consideration only cases where Service Status <> Cancelled as per IT VAS recommendation

          -- Merge IA and LIA
          
       SQL_TXT := 'CREATE TABLE MERGE_IA_LIA NOLOGGING AS
                  SELECT IA.MSISDN
                    FROM MAIN_INTL_ACCESS IA
                  UNION
                  SELECT LIA.MSISDN FROM MAIN_LIMITED_INT_ACC LIA ';

          IF UTILS_INTERFACES.CREATE_TABLE('MERGE_IA_LIA', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

         IF UTILS_INTERFACES.CREATE_INDEX('MERGE_IA_LIA',
                                         'FAFIF',
                                         'IX_IALIA_MSISDN',
                                         'MSISDN') = 0 THEN
          RAISE INDEX_CREATION_FAILED;
        END IF;

-- Fraud: Roaming on HLR but not registered to any Roaming CP

       -- Merge Roamings

       SQL_TXT := 'CREATE TABLE MERGE_ROAMING_REG_SMS NOLOGGING AS
                      SELECT r.MSISDN
                        FROM MAIN_ROAMING r
                      UNION
                      SELECT RR.MSISDN 
                        FROM MAIN_REG_ROAMING RR
                      UNION
                      SELECT SR.MSISDN 
                        FROM MAIN_SMS_ROAMING SR';

          IF UTILS_INTERFACES.CREATE_TABLE('MERGE_ROAMING_REG_SMS', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

         IF UTILS_INTERFACES.CREATE_INDEX('MERGE_ROAMING_REG_SMS',
                                         'FAFIF',
                                         'IX_ROSRRR_MSISDN',
                                         'MSISDN') = 0 THEN
          RAISE INDEX_CREATION_FAILED;
        END IF;


        -- HLR1
    SQL_TXT := 'CREATE TABLE REP_ROAM_HLR_NOT_CP NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE M.OBR_1 =0
                   AND M.MSISDN_HLRS IS NOT NULL
                   AND M.SERVICE_TYPE_NAME <> ''Twin Card''
                   and M.SERVICE_TYPE_NAME<>''Prepaid''
                   AND M.SERVICE_STATUS <> ''Cancelled''
                   AND NOT EXISTS
                 (SELECT 1 FROM MERGE_ROAMING_REG_SMS MR WHERE MR.MSISDN = m.msisdn)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_ROAM_HLR_NOT_CP', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

          -- HLR2

    SQL_TXT := 'CREATE TABLE REP_ROAM_HLR_NOT_CP2 NOLOGGING AS
                SELECT *
                  FROM REP_CLEAN_ALL_MERGED M
                 WHERE M.OBR_2 = 0
                   AND M.MSISDN_HLRS IS NOT NULL
                   AND M.SERVICE_TYPE_NAME <> ''Twin Card''
                   and M.SERVICE_TYPE_NAME<>''Prepaid''
                   AND M.SERVICE_STATUS <> ''Cancelled''
                   AND NOT EXISTS
                 (SELECT 1 FROM MERGE_ROAMING_REG_SMS MR WHERE MR.MSISDN = m.msisdn)';

          IF UTILS_INTERFACES.CREATE_TABLE('REP_ROAM_HLR_NOT_CP2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;
          
  -- REGIONAL ROAMING ONLY RECONCILIATION ADDED 08-06-2011 "JULIEBM"          
 ---- MSISDN having SMS ROAMING WITHOUT Limited international access or International Access on SV
      SQL_TXT :='CREATE TABLE REG_ROAM_ONLY_AS_CP NOLOGGING AS                
                 SELECT RR.MSISDN,
                       RR.SERVICE_TYPE_NAME,
                       RR.ACCOUNT_NAME,
                       RR.ACCOUNT_TYPE,
                       RR.SERVICE_STATUS,
                       RR.CP_STATUS,
                       RR.CP_INSTANCE_ID AS SR_CP_ID,
                       RR.IMSI,
                       RR.OBO_1 ,
                       RR.OICK_1 ,
                       RR.OBR_1 ,
                       RR.RSA_1,
                       RR.OBO_2 ,
                       RR.OICK_2 ,
                       RR.OBR_2,
                       RR.RSA_2
                  FROM 
                  MAIN_INTL_ACCESS IA, MAIN_REG_ROAMING RR, MAIN_LIMITED_INT_ACC LIA
                 WHERE  RR.MSISDN = IA.MSISDN(+)
                   AND RR.MSISDN =  LIA.MSISDN(+)
                   AND RR.SERVICE_STATUS = ''Active''
                   AND RR.CP_STATUS = ''3'' -- ACTIVE
                   AND IA.MSISDN_HLRS IS NULL
                   AND LIA.MSISDN IS NULL';
      
      IF UTILS_INTERFACES.CREATE_TABLE('REG_ROAM_ONLY_AS_CP', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
      END IF;
       
   -- Report discrepencies 
    -- Residential Postpaid/REGIONAL ROAMING/on SV not HLR1
      
    SQL_TXT :='CREATE TABLE REP_REG_ROAM_RES_NOT_HLR1 NOLOGGING AS
                SELECT * FROM REG_ROAM_ONLY_AS_CP RR
                WHERE (RR.OBO_1 <>3 OR RR.OICK_1 <> 0 OR RR.OBR_1 <> 0 OR RR.RSA_1 <> 3)
                AND RR.SERVICE_TYPE_NAME = ''Voice''
                AND RR.ACCOUNT_TYPE in (''Residential  Postpaid Customer Type'',''Business Postpaid Customer Type'')
                AND NOT EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = RR.MSISDN)
                ';
                  
      IF UTILS_INTERFACES.CREATE_TABLE('REP_REG_ROAM_RES_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
      
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_REG_ROAM_RES_NOT_HLR1','CREATE_ACTIVATE','KSA_ROAMING','1');
      
     -- Residential Postpaid/REGIONAL ROAMING/on SV not HLR2
      
    SQL_TXT :='CREATE TABLE REP_REG_ROAM_RES_NOT_HLR2 NOLOGGING AS
                SELECT * FROM REG_ROAM_ONLY_AS_CP RR
                WHERE (RR.OBO_2 <>3 OR RR.OICK_2 <> 0 OR RR.OBR_2 <> 0 OR RR.RSA_2 <> 3)
                AND RR.SERVICE_TYPE_NAME = ''Voice''
                AND RR.ACCOUNT_TYPE in (''Residential  Postpaid Customer Type'',''Business Postpaid Customer Type'')
                AND NOT EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = RR.MSISDN)
                ';
                
                  
      IF UTILS_INTERFACES.CREATE_TABLE('REP_REG_ROAM_RES_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
     
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_REG_ROAM_RES_NOT_HLR2','CREATE_ACTIVATE','KSA_ROAMING','2');
     
      -- Business Postpaid/REGIONAL ROAMING/on SV not HLR1
      
    SQL_TXT :='CREATE TABLE REP_REG_ROAM_BUS_NOT_HLR1 NOLOGGING AS
                SELECT * FROM REG_ROAM_ONLY_AS_CP RR
                WHERE (RR.OBO_1 <>3 OR RR.OICK_1 <> 42 OR RR.OBR_1 <> 0 OR RR.RSA_1 <> 3)
                AND RR.SERVICE_TYPE_NAME = ''Voice''
                AND RR.ACCOUNT_TYPE in (''Business Postpaid Customer Type'')
                AND EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = RR.MSISDN)
                ';
                  

      IF UTILS_INTERFACES.CREATE_TABLE('REP_REG_ROAM_BUS_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
      
       RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_REG_ROAM_BUS_NOT_HLR1','CREATE_ACTIVATE','KSA_ROAMING','1');
      
      -- Business Postpaid/REGIONAL ROAMING/on SV not HLR2
      
      SQL_TXT :='CREATE TABLE REP_REG_ROAM_BUS_NOT_HLR2 NOLOGGING AS
                SELECT * FROM REG_ROAM_ONLY_AS_CP RR
                WHERE (RR.OBO_2 <>3 OR RR.OICK_2 <> 42 OR RR.OBR_2 <> 0 OR RR.RSA_2 <> 3)
                AND RR.SERVICE_TYPE_NAME = ''Voice''
                AND RR.ACCOUNT_TYPE in (''Business Postpaid Customer Type'')
                AND EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = RR.MSISDN)
                ';
                
                  
      IF UTILS_INTERFACES.CREATE_TABLE('REP_REG_ROAM_BUS_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
     
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_REG_ROAM_BUS_NOT_HLR2','CREATE_ACTIVATE','KSA_ROAMING','2');
           
 -- SMS ROAMING ONLY RECONCILIATION ADDED 08-06-2011 "JULIEBM"          
 ---- MSISDN having SMS ROAMING WITHOUT Limited international access or International Access on SV
      SQL_TXT :='CREATE TABLE SMS_ROAM_ONLY_AS_CP NOLOGGING AS
                SELECT SR.MSISDN,
                       SR.SERVICE_TYPE_NAME,
                       SR.ACCOUNT_NAME,
                       SR.ACCOUNT_TYPE,
                       SR.SERVICE_STATUS,
                       SR.CP_STATUS,
                       SR.CP_INSTANCE_ID AS SR_CP_ID,
                       SR.IMSI,
                       SR.OBO_1 ,
                       SR.OICK_1 ,
                       SR.OBR_1 ,
                       SR.RSA_1,
                       SR.OBO_2 ,
                       SR.OICK_2 ,
                       SR.OBR_2,
                       SR.RSA_2
                  FROM MAIN_INTL_ACCESS IA, MAIN_SMS_ROAMING SR, MAIN_LIMITED_INT_ACC LIA
                 WHERE  SR.MSISDN = IA.MSISDN(+)
                   AND SR.MSISDN =  LIA.MSISDN(+)
                   AND SR.SERVICE_STATUS = ''Active''
                   AND SR.CP_STATUS = ''Active''
                   AND IA.MSISDN_HLRS IS NULL
                   AND LIA.MSISDN IS NULL';
      
      IF UTILS_INTERFACES.CREATE_TABLE('SMS_ROAM_ONLY_AS_CP', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
      END IF;
      
      
    -- Report discrepencies 
    -- Residential Postpaid/SMS ROAMING/on SV not HLR1
      
    SQL_TXT :='CREATE TABLE REP_SMS_ROAM_RES_NOT_HLR1 NOLOGGING AS
                SELECT * FROM SMS_ROAM_ONLY_AS_CP RR
                WHERE (RR.OBO_1 <>3 OR RR.OICK_1 <> 150 OR RR.OBR_1 <> 0 OR RR.RSA_1 <> 4)
                AND RR.SERVICE_TYPE_NAME = ''Voice''
                AND RR.ACCOUNT_TYPE in (''Residential  Postpaid Customer Type'',''Business Postpaid Customer Type'')
                AND NOT EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = RR.MSISDN)
                ';
                
                  
      IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_ROAM_RES_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
      
   RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_SMS_ROAM_RES_NOT_HLR1','CREATE_ACTIVATE','SMS_ROAMING','1');
          
    -- Business Postpaid/SMS ROAMING/on SV not HLR1 
    SQL_TXT :='CREATE TABLE REP_SMS_ROAM_BUS_NOT_HLR1 NOLOGGING AS
                SELECT * FROM SMS_ROAM_ONLY_AS_CP SR
                WHERE (SR.OBO_1 <>3 OR SR.OICK_1 <> 151 OR SR.OBR_1 <> 0 OR SR.RSA_1 <> 4)
                AND SR.SERVICE_TYPE_NAME = ''Voice''
                AND SR.ACCOUNT_TYPE = ''Business Postpaid Customer Type''
                AND EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = SR.MSISDN)
                ';
                
                
      IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_ROAM_BUS_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
      
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_SMS_ROAM_BUS_NOT_HLR1','CREATE_ACTIVATE','SMS_ROAMING','1');
                
    -- Report discrepencies 
    -- Residential Postpaid/SMS ROAMING/on SV not HLR2
      
    SQL_TXT :='CREATE TABLE REP_SMS_ROAM_RES_NOT_HLR2 NOLOGGING AS
                SELECT * FROM SMS_ROAM_ONLY_AS_CP SR
                WHERE (SR.OBO_2 <>3 OR SR.OICK_2 <> 150 OR SR.OBR_2 <> 0 OR SR.RSA_2 <> 4)
                AND SR.SERVICE_TYPE_NAME = ''Voice''
                AND SR.ACCOUNT_TYPE in (''Residential  Postpaid Customer Type'',''Business Postpaid Customer Type'')
                AND NOT EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = SR.MSISDN)
                ';
                
                  
      IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_ROAM_RES_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF; 
          
    RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_SMS_ROAM_RES_NOT_HLR2','CREATE_ACTIVATE','SMS_ROAMING','2');
      
    -- Business Postpaid/SMS ROAMING/on SV not HLR2 
    SQL_TXT :='CREATE TABLE REP_SMS_ROAM_BUS_NOT_HLR2 NOLOGGING AS
                SELECT * FROM SMS_ROAM_ONLY_AS_CP SR
                WHERE (SR.OBO_2 <>3 OR SR.OICK_2 <> 151 OR SR.OBR_2 <> 0 OR SR.RSA_2 <> 4)
                AND SR.SERVICE_TYPE_NAME = ''Voice''
                AND SR.ACCOUNT_TYPE = ''Business Postpaid Customer Type''
                AND EXISTS  
                (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = SR.MSISDN)
               ';
               
 
      IF UTILS_INTERFACES.CREATE_TABLE('REP_SMS_ROAM_BUS_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_SMS_ROAM_BUS_NOT_HLR2','CREATE_ACTIVATE','SMS_ROAMING','2');
      
    -- RESIDENTIAL POSTPAID HAVING SMS ROAMING ON HLR1 NOT SV  
      SQL_TXT := 'CREATE TABLE REP_RES_SMSROAM_HLR1_NO_SV NOLOGGING AS
                  select T.MSISDN, T.PRIMARY_HLR, T.IMSI, T.ACCOUNT_TYPE, T.PRODUCT_TYPE_NAME, T.SERVICE_TYPE_NAME,
                    T.OBO_1, T.OICK_1, T.OBR_1, T.RSA_1
                  from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.OBO_1,0) = 3 
                      AND NVL(T.OICK_1,0) = 150 
                      AND NVL(T.OBR_1,0) = 0
                      AND NVL(T.RSA_1,0) = 4
                      AND t.SERVICE_TYPE_NAME IN (''Voice'')
                      AND T.Service_Status = ''Active''
                      AND T.ACCOUNT_TYPE IN( ''Residential  Postpaid Customer Type'', ''Business Postpaid Customer Type'')
                      AND NOT EXISTS  
                      (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = T.MSISDN)
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                          (SELECT 1 FROM MAIN_SMS_ROAMING SR WHERE T.MSISDN = SR.MSISDN)
                      ' ;
                
            
      IF UTILS_INTERFACES.CREATE_TABLE('REP_RES_SMSROAM_HLR1_NO_SV', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;   
      
      RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF', 'REP_RES_SMSROAM_HLR1_NO_SV', 'DELETE', 'SMS_ROAMING','1');
      
       -- RESIDENTIAL POSTPAID HAVING SMS ROAMING ON HLR2 NOT SV  
      
      SQL_TXT := 'CREATE TABLE REP_RES_SMSROAM_HLR2_NO_SV NOLOGGING AS
                  select T.MSISDN, T.PRIMARY_HLR, T.IMSI, T.ACCOUNT_TYPE, T.PRODUCT_TYPE_NAME, T.SERVICE_TYPE_NAME,
                   T.OBO_2, T.OICK_2, T.OBR_2, T.RSA_2
                   from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.OBO_2,0) = 3 
                      AND NVL(T.OICK_2,0) = 150 
                      AND NVL(T.OBR_2,0) = 0
                      AND NVL(T.RSA_2,0) = 4
                      AND t.SERVICE_TYPE_NAME IN (''Voice'')
                      AND T.Service_Status = ''Active''
                      AND T.ACCOUNT_TYPE IN( ''Residential  Postpaid Customer Type'', ''Business Postpaid Customer Type'')
                      AND NOT EXISTS  
                      (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = T.MSISDN)
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                          (SELECT 1 FROM MAIN_SMS_ROAMING SR WHERE T.MSISDN = SR.MSISDN)
                      ' ;   
                      
                          
      IF UTILS_INTERFACES.CREATE_TABLE('REP_RES_SMSROAM_HLR2_NO_SV', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;                                   
         
      RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_RES_SMSROAM_HLR2_NO_SV','DELETE','SMS_ROAMING','2');                 
  
    
    -- BUSINESS POSTPAID HAVING SMS ROAMING ON HLR1 NOT SV
      
      SQL_TXT := 'CREATE TABLE REP_BUS_SMSROAM_HLR1_NO_SV NOLOGGING AS
                  select T.MSISDN, T.PRIMARY_HLR, T.IMSI, T.ACCOUNT_TYPE, T.PRODUCT_TYPE_NAME, T.SERVICE_TYPE_NAME,
                    T.OBO_1, T.OICK_1, T.OBR_1, T.RSA_1
                  from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.OBO_1,0) = 3 
                      AND NVL(T.OICK_1,0) = 151 
                      AND NVL(T.OBR_1,0) = 0
                      AND NVL(T.RSA_1,0) = 4
                      AND t.SERVICE_TYPE_NAME IN (''Voice'')
                      AND T.Service_Status = ''Active''
                      AND T.ACCOUNT_TYPE IN( ''Business Postpaid Customer Type'')
                      AND EXISTS  
                      (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = T.MSISDN)
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                          (SELECT 1 FROM MAIN_SMS_ROAMING SR WHERE T.MSISDN = SR.MSISDN)
                      ' ;
                      
            
      IF UTILS_INTERFACES.CREATE_TABLE('REP_BUS_SMSROAM_HLR1_NO_SV', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;   
      
      RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF', 'REP_BUS_SMSROAM_HLR1_NO_SV', 'DELETE', 'SMS_ROAMING','1');
      
       -- BUSINESS POSTPAID HAVING SMS ROAMING ON HLR2 NOT SV
      
      SQL_TXT := 'CREATE TABLE REP_BUS_SMSROAM_HLR2_NO_SV NOLOGGING AS
                  select T.MSISDN, T.PRIMARY_HLR, T.IMSI, T.ACCOUNT_TYPE, T.PRODUCT_TYPE_NAME, T.SERVICE_TYPE_NAME,
                   T.OBO_2, T.OICK_2, T.OBR_2, T.RSA_2
                   from REP_CLEAN_ALL_MERGED T
                    WHERE NVL(T.OBO_2,0) = 3 
                      AND NVL(T.OICK_2,0) = 151 
                      AND NVL(T.OBR_2,0) = 0
                      AND NVL(T.RSA_2,0) = 4
                      AND t.SERVICE_TYPE_NAME IN (''Voice'')
                      AND T.Service_Status = ''Active''
                      AND T.ACCOUNT_TYPE IN( ''Business Postpaid Customer Type'')
                      AND EXISTS  
                       (SELECT 1 FROM MAIN_VPN MV WHERE MV.MSISDN = T.MSISDN)
                      AND t.MSISDN_HLRS IS NOT NULL
                      AND NOT EXISTS
                          (SELECT 1 FROM MAIN_SMS_ROAMING SR WHERE T.MSISDN = SR.MSISDN)
                      ' ;
                         
                          
      IF UTILS_INTERFACES.CREATE_TABLE('REP_BUS_SMSROAM_HLR2_NO_SV', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;                                   
         
      RECONCILIATION_INTERFACES.PROV_RECON_SMS_ROAMING_CPS('FAFIF','REP_BUS_SMSROAM_HLR2_NO_SV','DELETE','SMS_ROAMING','2');  
    
    
     -- (POSTPAID OR ALFA DATA CARD) AND SDP01 "POSTPAID USB BROWSING NOT YET INCLUDED, IT DOES NOT YET EXIST" HAVING SCHAR <> 5 ON HLR1 
     -- (POSTPAID OR ALFA DATA CARD OR POSTPAID USB BROWSING) AND SDP01  HAVING SCHAR <> 6 ON HLR2 
     
      SQL_TXT := 'CREATE TABLE REP_POST_SDP01_SCHAR_NO_HLR1 NOLOGGING AS
                    select * from rep_clean_all_merged T
                    WHERE t.service_status = ''Active''
                    and t.service_type_name in (''Voice'', ''Data Card'',''Postpaid Broadband'')
                    and t.product_type_name in (''Alfa Classic'',''Alfa Data Card'',''Mobile Broadband Postpaid'')
                    and t.sdp in (''SDP03'', ''SDP05'')
                    and (t.schar_1 <> ''6'' OR t.schar_1 IS NULL)
                    AND t.msisdn_sys NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''PREPAID'',''ALL''))';

 
      IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SDP01_SCHAR_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;   
      
      RECONCILIATION_INTERFACES.PROV_RECON_SCHAR_PARAM ('FAFIF','REP_POST_SDP01_SCHAR_NO_HLR1','6');
      
      -- (POSTPAID OR ALFA DATA CARD) AND SDP01 "POSTPAID USB BROWSING NOT YET INCLUDED, IT DOES NOT YET EXIST" HAVING SCHAR <> 5 ON HLR2 
      -- (POSTPAID OR ALFA DATA CARD OR POSTPAID USB BROWSING) AND SDP01  HAVING SCHAR <> 6 ON HLR2 
       
      SQL_TXT := 'CREATE TABLE REP_POST_SDP01_SCHAR_NO_HLR2 NOLOGGING AS
                    select * from rep_clean_all_merged T
                    WHERE t.service_status = ''Active''
                    and t.service_type_name in (''Voice'', ''Data Card'',''Postpaid Broadband'')
                    and t.product_type_name in (''Alfa Classic'',''Alfa Data Card'',''Mobile Broadband Postpaid'')
                    and t.sdp in (''SDP03'', ''SDP05'')
                    and (t.schar_2 <> ''6'' OR t.schar_2 IS NULL)
                     AND t.msisdn_sys NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''PREPAID'',''ALL''))';
           
 
      IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SDP01_SCHAR_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;   
 
      RECONCILIATION_INTERFACES.PROV_RECON_SCHAR_PARAM ('FAFIF','REP_POST_SDP01_SCHAR_NO_HLR2','6');
      
     -- (POSTPAID OR ALFA DATA CARD) AND SDP02 "POSTPAID USB BROWSING NOT YET INCLUDED, IT DOES NOT YET EXIST" HAVING SCHAR <> 9 ON HLR1 
     -- (POSTPAID OR ALFA DATA CARD OR POSTPAID USB BROWSING) AND SDP01  HAVING SCHAR <> 10 ON HLR2
    
      SQL_TXT := 'CREATE TABLE REP_POST_SDP02_SCHAR_NO_HLR1 NOLOGGING AS
                    select * from rep_clean_all_merged T
                    WHERE t.service_status = ''Active''
                    and t.service_type_name in (''Voice'', ''Data Card'',''Postpaid Broadband'')
                    and t.product_type_name in (''Alfa Classic'',''Alfa Data Card'',''Mobile Broadband Postpaid'')
                    and t.sdp in (''SDP04'', ''SDP06'')
                    and (t.schar_1 <> ''10'' OR t.schar_1 IS NULL)
                    AND t.msisdn_sys NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''PREPAID'',''ALL''))';
          
 
      IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SDP02_SCHAR_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;   
 
      RECONCILIATION_INTERFACES.PROV_RECON_SCHAR_PARAM ('FAFIF','REP_POST_SDP02_SCHAR_NO_HLR1','10');
      
      -- (POSTPAID OR ALFA DATA CARD) AND SDP02 "POSTPAID USB BROWSING NOT YET INCLUDED, IT DOES NOT YET EXIST" HAVING SCHAR <> 9 ON HLR2
      -- (POSTPAID OR ALFA DATA CARD OR POSTPAID USB BROWSING) AND SDP02  HAVING SCHAR <> 10 ON HLR2 
      
       SQL_TXT := 'CREATE TABLE REP_POST_SDP02_SCHAR_NO_HLR2 NOLOGGING AS
                    select * from rep_clean_all_merged T
                    WHERE t.service_status = ''Active''
                    and t.service_type_name in (''Voice'', ''Data Card'',''Postpaid Broadband'')
                    and t.product_type_name in (''Alfa Classic'',''Alfa Data Card'', ''Mobile Broadband Postpaid'')
                    and t.sdp in (''SDP04'', ''SDP06'')
                    and (t.schar_2 <> ''10'' OR t.schar_2 IS NULL)
                     AND t.msisdn_sys NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''PREPAID'',''ALL''))';
            
                        
 
      IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_SDP02_SCHAR_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;   
 
      RECONCILIATION_INTERFACES.PROV_RECON_SCHAR_PARAM ('FAFIF','REP_POST_SDP02_SCHAR_NO_HLR2','10');
      
       -- (PREPAID) AND SDP01 "PREPAID USB BROWSING NOT YET INCLUDED, IT DOES NOT YET EXIST" HAVING SCHAR <> 4 ON HLR1
       
       SQL_TXT := 'CREATE TABLE REP_PREP_SDP01_SCHAR_NO_HLR1 NOLOGGING AS
                    select * from rep_clean_all_merged T
                    WHERE t.service_status = ''Active''
                    and t.service_type_name in (''Prepaid'',''Prepaid Broadband'')
                    and t.product_type_name in (''Alfa Active'',''Mobile Broadband Prepaid'')
                    and t.sdp in (''SDP03'', ''SDP05'')
                    and (t.schar_1 <> ''4'' OR t.schar_1 IS NULL)
                    AND T.MSISDN_SYS NOT IN (SELECT T.SERVICE_NAME FROM REP_SV_MSISDN_IN_MISP T)
                    AND t.msisdn_sys NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''PREPAID'',''ALL''))';
  
 
 
      IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SDP01_SCHAR_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;   
 
      RECONCILIATION_INTERFACES.PROV_RECON_SCHAR_PARAM ('FAFIF','REP_PREP_SDP01_SCHAR_NO_HLR1','4');
      
      -- (PREPAID) AND SDP01 "PREPAID USB BROWSING NOT YET INCLUDED, IT DOES NOT YET EXIST" HAVING SCHAR <> 4 ON HLR2
 
       SQL_TXT := 'CREATE TABLE REP_PREP_SDP01_SCHAR_NO_HLR2 NOLOGGING AS
                    select * from rep_clean_all_merged T
                    WHERE t.service_status = ''Active''
                    and t.service_type_name in (''Prepaid'',''Prepaid Broadband'')
                    and t.product_type_name in (''Alfa Active'',''Mobile Broadband Prepaid'')
                    and t.sdp in (''SDP03'', ''SDP05'')
                    and (t.schar_2 <> ''4'' OR t.schar_2 IS NULL)
                    AND T.MSISDN_SYS NOT IN (SELECT T.SERVICE_NAME FROM REP_SV_MSISDN_IN_MISP T)
                    AND t.msisdn_sys NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''PREPAID'',''ALL''))';
           
 
      IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SDP01_SCHAR_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;   
 
      RECONCILIATION_INTERFACES.PROV_RECON_SCHAR_PARAM ('FAFIF','REP_PREP_SDP01_SCHAR_NO_HLR2','4');
      
      -- (PREPAID) AND SDP02 "PREPAID USB BROWSING NOT YET INCLUDED, IT DOES NOT YET EXIST" HAVING SCHAR <> 8 ON HLR1
      
      SQL_TXT := 'CREATE TABLE REP_PREP_SDP02_SCHAR_NO_HLR1 NOLOGGING AS
                    select * from rep_clean_all_merged T
                    WHERE t.service_status = ''Active''
                    and t.service_type_name in (''Prepaid'',''Prepaid Broadband'')
                    and t.product_type_name in (''Alfa Active'',''Mobile Broadband Prepaid'')
                    and t.sdp in (''SDP04'', ''SDP06'')
                    and (t.schar_1 <> ''8'' OR t.schar_1 IS NULL)
                    AND T.MSISDN_SYS NOT IN (SELECT T.SERVICE_NAME FROM REP_SV_MSISDN_IN_MISP T)
                    AND t.msisdn_sys NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''PREPAID'',''ALL''))';
             
                   
      IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SDP02_SCHAR_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_SCHAR_PARAM ('FAFIF','REP_PREP_SDP02_SCHAR_NO_HLR1','8');  
      
      -- (PREPAID) AND SDP02 "PREPAID USB BROWSING NOT YET INCLUDED, IT DOES NOT YET EXIST" HAVING SCHAR <> 8 ON HLR2
      
      SQL_TXT := 'CREATE TABLE REP_PREP_SDP02_SCHAR_NO_HLR2 NOLOGGING AS
                    select * from rep_clean_all_merged T
                    WHERE t.service_status = ''Active''
                    and t.service_type_name in (''Prepaid'',''Prepaid Broadband'')
                    and t.product_type_name in (''Alfa Active'',''Mobile Broadband Prepaid'')
                    and t.sdp in (''SDP04'', ''SDP06'')
                    and (t.schar_2 <> ''8'' OR t.schar_2 IS NULL)
                    AND T.MSISDN_SYS NOT IN (SELECT T.SERVICE_NAME FROM REP_SV_MSISDN_IN_MISP T)
                    AND t.msisdn_sys NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''PREPAID'',''ALL''))';
                 
                    
      IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SDP02_SCHAR_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_SCHAR_PARAM ('FAFIF','REP_PREP_SDP02_SCHAR_NO_HLR2','8');    
                    
      -- (TWIN) HAVING SCHAR <> 0 ON HLR1
      
      SQL_TXT := 'CREATE TABLE REP_POST_TWIN_SCHAR_NO_HLR1 NOLOGGING AS
                    select * from rep_clean_all_merged T
                    WHERE t.service_status = ''Active''
                    and t.service_type_name = ''Twin Card''
                    and (t.schar_1 <> ''0'' OR t.schar_1 IS NULL)
                    AND t.msisdn_sys NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''PREPAID'',''ALL''))';
                  
                    
      IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_TWIN_SCHAR_NO_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_SCHAR_PARAM ('FAFIF','REP_POST_TWIN_SCHAR_NO_HLR1','0'); 
      
        -- (TWIN) HAVING SCHAR <> 0 ON HLR1
      
      SQL_TXT := 'CREATE TABLE REP_POST_TWIN_SCHAR_NO_HLR2 NOLOGGING AS
                    select * from rep_clean_all_merged T
                    WHERE t.service_status = ''Active''
                    and t.service_type_name = ''Twin Card''
                    and (t.schar_2 <> ''0'' OR t.schar_2 IS NULL)
                    AND t.msisdn_sys NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                             WHERE REASON in (''PREPAID'',''ALL''))'; 
                       
                    
      IF UTILS_INTERFACES.CREATE_TABLE('REP_POST_TWIN_SCHAR_NO_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_SCHAR_PARAM ('FAFIF','REP_POST_TWIN_SCHAR_NO_HLR1','0');                
 
                    
      SQL_TXT := 'CREATE TABLE REP_PREP_RSA_INC_HLR1 NOLOGGING AS
                  select T.Msisdn_Sv AS NUM_APPEL, T.OICK_1 AS OICK, T.RSA_1 AS RSA from rep_clean_all_merged T
                    WHERE T.Product_Type_Name = ''Alfa Active'' 
                    AND T.RSA_1 not in (''6'',''7'',''8'',''9'' )
                    and t.oick_1 = ''100''
                    AND T.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON 
                                         WHERE REASON in(''ROAMING'',''ALL''))';
                    
                    
      IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_RSA_INC_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_RSA_PARAM ('FAFIF','REP_PREP_RSA_INC_HLR1','6');                
   
      /*SQL_TXT := 'CREATE TABLE REP_PREP_RSA_INC_HLR2 NOLOGGING AS
                    select T.NUM_APPEL_2 AS NUM_APPEL, T.OICK_2 AS OICK, T.RSA_2 AS RSA from MERGE_HLR1_HLR2 T
                    WHERE T.OICK_2 = ''100''
                    AND T.RSA_2 not in (''6'', ''8'',''9'')';*/
                    
      SQL_TXT := 'CREATE TABLE REP_PREP_RSA_INC_HLR2 NOLOGGING AS
                  select T.Msisdn_Sv AS NUM_APPEL, T.OICK_2 AS OICK, T.RSA_2 AS RSA from rep_clean_all_merged T
                    WHERE T.Product_Type_Name = ''Alfa Active'' 
                    AND T.RSA_2 not in (''6'',''7'',''8'',''9'' )
                    and t.oick_2 = ''100''
                    AND T.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                         WHERE REASON in(''ROAMING'',''ALL''))';
                    
                    
                    
      IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_RSA_INC_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_RSA_PARAM ('FAFIF','REP_PREP_RSA_INC_HLR2','8');                
   
   
      SQL_TXT := 'CREATE TABLE REP_PREP_SDP01_INC_CSP_HLR1 AS 
                  SELECT T.MSISDN,T.SERVICE_TYPE_NAME, T.SERVICE_STATUS,T.CAMEL_1
                  FROM REP_CLEAN_ALL_MERGED t
                  WHERE T.SERVICE_TYPE_NAME = ''Prepaid''
                  AND T.SERVICE_STATUS NOT IN (''Cancelled'',''Moved'')
                  AND t.sdp in (''SDP05'', ''SDP03'') 
                  AND (T.CAMEL_1 NOT IN (1,3) -- CSP Parameter
                       OR T.OCSIST_1 <> 1)
                 AND t.volte01_apn1  IS NULL   
                  AND T.MSISDN_HLRS IS NOT NULL';
                    
                    
                    
      IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SDP01_INC_CSP_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_CSP_PARAM ('FAFIF','REP_PREP_SDP01_INC_CSP_HLR1','1','1');
  
  
     
      SQL_TXT := 'CREATE TABLE REP_PREP_SDP01_INC_CSP_HLR2 AS 
                  SELECT T.MSISDN,T.SERVICE_TYPE_NAME, T.SERVICE_STATUS,T.CAMEL_2
                  FROM REP_CLEAN_ALL_MERGED t
                  WHERE T.SERVICE_TYPE_NAME = ''Prepaid''
                  AND T.SERVICE_STATUS NOT IN (''Cancelled'',''Moved'')
                  AND t.sdp in (''SDP05'', ''SDP03'') 
                  AND (T.CAMEL_2 NOT IN (1,3) -- CSP Parameter
                       OR T.OCSIST_2 <> 1)
                  AND t.volte01_apn1  IS NULL        
                  AND T.MSISDN_HLRS IS NOT NULL';
                    
                    
                    
      IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SDP01_INC_CSP_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
      
       RECONCILIATION_INTERFACES.PROV_RECON_CSP_PARAM ('FAFIF','REP_PREP_SDP01_INC_CSP_HLR2','1','1');
      
      
      SQL_TXT := 'CREATE TABLE REP_PREP_SDP02_INC_CSP_HLR1 AS 
                  SELECT T.MSISDN,T.SERVICE_TYPE_NAME, T.SERVICE_STATUS,T.CAMEL_1
                  FROM REP_CLEAN_ALL_MERGED t
                  WHERE T.SERVICE_TYPE_NAME = ''Prepaid''
                  AND T.SERVICE_STATUS NOT IN (''Cancelled'',''Moved'')
                  AND t.sdp in (''SDP04'', ''SDP06'') 
                  AND (T.CAMEL_1 NOT IN (2,3) -- CSP Parameter
                       OR T.OCSIST_1 <> 1)
                  AND t.volte01_apn1  IS NULL   
                  AND T.MSISDN_HLRS IS NOT NULL';
                    
                    
                    
      IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SDP02_INC_CSP_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_CSP_PARAM ('FAFIF','REP_PREP_SDP02_INC_CSP_HLR1','2','1');     
      
       SQL_TXT := 'CREATE TABLE REP_PREP_SDP02_INC_CSP_HLR2 AS 
                   SELECT T.MSISDN,T.SERVICE_TYPE_NAME, T.SERVICE_STATUS,T.CAMEL_1
                   FROM REP_CLEAN_ALL_MERGED t
                   WHERE T.SERVICE_TYPE_NAME = ''Prepaid''
                   AND T.SERVICE_STATUS NOT IN (''Cancelled'',''Moved'')
                   AND t.sdp in (''SDP04'', ''SDP06'') 
                   AND (T.CAMEL_2 NOT IN (2,3) -- CSP Parameter
                        OR T.OCSIST_2 <> 1) 
                  AND t.volte01_apn1  IS NULL   
                   AND T.MSISDN_HLRS IS NOT NULL';
                    
                    
                    
      IF UTILS_INTERFACES.CREATE_TABLE('REP_PREP_SDP02_INC_CSP_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_CSP_PARAM ('FAFIF','REP_PREP_SDP02_INC_CSP_HLR2','2','1');
      
    -- ==========================================================================================================
    -- End of Reconciliation IA Interface
    -- ==========================================================================================================

 EXCEPTION
 WHEN OTHERS THEN
 NULL;
    
 END P_IA_CP_INTERFACES;
  
  
  PROCEDURE P4_WLL_CP_INTERFACES(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS

    SQL_TXT             VARCHAR2(4000);
    RELEASE              VARCHAR2(20)    := 'R4.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;
    

    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);




  BEGIN


    UTILS_INTERFACES.INTERFACE_NAME := 'P4_WLL_CP_INTERFACES';
    
    SQL_TXT :='CREATE TABLE REP_WLL_SV_NOT_IN_HLR NOLOGGING AS
                    SELECT *
                    FROM REP_CLEAN_ALL_MERGED HH
                    WHERE HH.SERVICE_STATUS = ''Active''
                    AND HH.SERVICE_TYPE_NAME in (''Voice'')      
                    AND HH.RATE_PLAN = 8
                    AND (HH.OICK_1 <> 170
                    OR HH.OBO_1 = 1
                    OR HH.REGSER_1 IS NULL
                    OR HH.SOSDCF_1 <> 4
                    OR HH.OFA_1 <> 12)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_WLL_SV_NOT_IN_HLR', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


      IF UTILS_INTERFACES.CREATE_INDEX('REP_WLL_SV_NOT_IN_HLR',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;


  SQL_TXT :='CREATE TABLE REP_WLL_SV_NOT_IN_HLR2 NOLOGGING AS
                    SELECT *
                    FROM REP_CLEAN_ALL_MERGED HH
                    WHERE HH.SERVICE_STATUS = ''Active''
                    AND HH.SERVICE_TYPE_NAME in (''Voice'')      
                    AND HH.RATE_PLAN = 8
                    AND (HH.OICK_2 <> 170
                    OR HH.OBO_2 =1
                    OR HH.REGSER_2 IS NULL
                    OR HH.SOSDCF_2 <> 4
                    OR HH.OFA_2 <> 12)';

    IF UTILS_INTERFACES.CREATE_TABLE('REP_WLL_SV_NOT_IN_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


      IF UTILS_INTERFACES.CREATE_INDEX('REP_WLL_SV_NOT_IN_HLR2',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;


  --================================================================================================================
    -- Mobile Internet main Recon
  --================================================================================================================*/
SQL_TXT :='CREATE TABLE MAIN_MI_WLL_SYS NOLOGGING AS
             SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.MSISDN AS MSISDN_CP,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1000225
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_1) AS CP_REASON,
                      T.*
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1000262
                 AND T.Service_Type_Name =''Voice''
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1000327 -- MI
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9
                 AND T.RATE_PLAN = 8';

    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_MI_WLL_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


      IF UTILS_INTERFACES.CREATE_INDEX('MAIN_MI_WLL_SYS',
                                     'FAFIF',
                                     'IX_MAIN_MI_MSISDN',
                                     'MSISDN_CP') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;

--HLR1

   -- CPs and Services having WLL MOBILE INTERNET on SV and not in HLR1 (ACTIVATE)

    SQL_TXT := 'CREATE TABLE REP_MI_WLL_SV_NOT_HLR1 NOLOGGING AS
                SELECT * FROM MAIN_MI_WLL_SYS G
                   WHERE
                    (G.WLL_APN1 IS NULL OR G.NAM_1 = 1)
                     AND G.MSISDN_CP IS NOT NULL
                     AND G.CP_STATUS = ''Active''';
                     

     IF UTILS_INTERFACES.CREATE_TABLE('REP_MI_WLL_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MI_WLL_SV_NOT_HLR1','CREATE_ACTIVATE','MOBILE_INTERNET','1');
    
   -- CPs and Services having WLL MOBILE INTERNET on HLR and not in SV (Fraud)

   SQL_TXT := 'CREATE TABLE REP_MI_WLL_HLR_NOT_SV1 NOLOGGING AS
               SELECT * FROM REP_CLEAN_ALL_MERGED G
                   WHERE G.WLL_APN1 IS NOT NULL
                     AND G.NAM_1 = 0
                     AND G.SERVICE_TYPE_NAME = ''Voice''
                     AND G.RATE_PLAN = 8
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_MI_WLL_SYS MMI WHERE MMI.MSISDN_CP = G.msisdn)';
           

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MI_WLL_HLR_NOT_SV1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MI_WLL_HLR_NOT_SV1','DELETE','MOBILE_INTERNET','1');


 --HLR2
 
   -- CPs and Services having GPRS_WEB_WAP on SV and not in HLR1 (ACTIVATE)

    SQL_TXT := 'CREATE TABLE REP_MI_WLL_SV_NOT_HLR2 NOLOGGING AS
                SELECT * FROM MAIN_MI_WLL_SYS G
                   WHERE (G.WLL_APN2 IS NULL OR G.NAM_2 = 1)
                     AND G.MSISDN_CP IS NOT NULL
                     AND G.CP_STATUS = ''Active''';
                  

     IF UTILS_INTERFACES.CREATE_TABLE('REP_MI_WLL_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MI_WLL_SV_NOT_HLR2','CREATE_ACTIVATE','MOBILE_INTERNET','2');

    -- CPs and Services having GPRS_WEB_WAP on HLR and not in SV (Fraud)

   SQL_TXT := 'CREATE TABLE REP_MI_WLL_HLR_NOT_SV2 NOLOGGING AS
               SELECT * FROM REP_CLEAN_ALL_MERGED G
                   WHERE G.WLL_APN2 IS NOT NULL
                     AND G.NAM_2 = 0
                     AND G.SERVICE_TYPE_NAME = ''Voice''
                     AND G.RATE_PLAN = 8
                     AND NOT EXISTS
                   (SELECT 1 FROM MAIN_MI_WLL_SYS MMI WHERE MMI.MSISDN_CP = G.msisdn)';

        

    IF UTILS_INTERFACES.CREATE_TABLE('REP_MI_WLL_HLR_NOT_SV2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MI_WLL_HLR_NOT_SV2','DELETE','MOBILE_INTERNET','2');


END P4_WLL_CP_INTERFACES;
 
--MT ROAMING RECONCILIATION  04-06-2015
  
PROCEDURE P_MTROAMING_CP_INTERFACES(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS

    SQL_TXT             VARCHAR2(4000);
    RELEASE              VARCHAR2(20)    := 'R4.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;
    

    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);




  BEGIN


    UTILS_INTERFACES.INTERFACE_NAME := 'P_MTROAMING_CP_INTERFACES';
    
    SQL_TXT :='CREATE TABLE MAIN_MTROAMING_SYS NOLOGGING AS
             SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.* ,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.CODE_LABEL
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1325280
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS SMART_COMPANION_NAME,
                     (SELECT RCR.CODE_LABEL
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1375021
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_6) AS SCP_VOLUME_OPTION
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1000262  -- ALFA CLASSIC
                 AND T.Service_Type_Name =''Voice''
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1375022 -- Smart Companion Postpaid
                 AND PIH.GENERAL_5 in (70000028) -- SCP NAME
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';

    IF UTILS_INTERFACES.CREATE_TABLE('MAIN_MTROAMING_SYS', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_MTROAMING_SYS',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
    END IF;

-- INTERNATIONAL ACCESS WITH MT ROAMING

   SQL_TXT := 'CREATE TABLE INTL_ACCESS_VS_MT_ROAM NOLOGGING AS
                SELECT IA.MSISDN,
                       IA.IMSI,
                       IA.SERVICE_TYPE_NAME,
                       IA.ACCOUNT_NAME,
                       IA.ACCOUNT_TYPE,
                       IA.CP_INSTANCE_ID AS IA_CP_ID,
                       IA.OBO_1 ,
                       IA.OICK_1 ,
                       IA.OBR_1 ,
                       IA.OBO_2 ,
                       IA.OICK_2 ,
                       IA.OBR_2 ,
                       MTR.CP_INSTANCE_ID AS MR_CP_ID,
                       MTR.SCP_VOLUME_OPTION,
                       MTR.RSA_1,
                       MTR.RSA_2,
                       MTR.TICK_1,
                       MTR.TICK_2,
                       MTR.CAMEL_1,
                       MTR.CAMEL_2  
                  FROM MAIN_INTL_ACCESS IA, MAIN_MTROAMING_SYS MTR
                 WHERE IA.MSISDN = MTR.MSISDN
                   AND MTR.SERVICE_STATUS = ''Active''
                   AND IA.MSISDN_HLRS IS NOT NULL';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('INTL_ACCESS_VS_MT_ROAM', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

      IF UTILS_INTERFACES.CREATE_INDEX('INTL_ACCESS_VS_MT_ROAM',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;

-- INACC WITH MT ROAMING

   SQL_TXT := 'CREATE TABLE LIM_INTL_ACC_VS_MT_ROAM NOLOGGING AS
                SELECT LIA.MSISDN,
                       LIA.IMSI,
                       LIA.SERVICE_TYPE_NAME,
                       LIA.ACCOUNT_NAME,
                       LIA.ACCOUNT_TYPE,
                       LIA.CP_INSTANCE_ID AS IA_CP_ID,
                       LIA.CREDIT_LIMIT,
                       LIA.OBO_1 ,
                       LIA.OICK_1 ,
                       LIA.OBR_1 ,
                       LIA.OBO_2 ,
                       LIA.OICK_2 ,
                       LIA.OBR_2 ,
                       MTR.CP_INSTANCE_ID AS SR_CP_ID,
                       MTR.SCP_VOLUME_OPTION,
                       MTR.RSA_1,
                       MTR.RSA_2,
                       MTR.TICK_1,
                       MTR.TICK_2,
                       MTR.CAMEL_1,
                       MTR.CAMEL_2 
                  FROM MAIN_LIMITED_INT_ACC LIA, MAIN_MTROAMING_SYS MTR
                 WHERE LIA.MSISDN = MTR.MSISDN
                   AND MTR.SERVICE_STATUS = ''Active''
                   AND LIA.MSISDN_HLRS IS NOT NULL';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('LIM_INTL_ACC_VS_MT_ROAM', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

      IF UTILS_INTERFACES.CREATE_INDEX('LIM_INTL_ACC_VS_MT_ROAM',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;


-- VIP WITH MT ROAMING (This Scenario Will Include VPN + Non VPN since the only difference is OICK
-- This parameter will be corrected within the VPN Scenario

   SQL_TXT := 'CREATE TABLE VIP_VS_MT_ROAM NOLOGGING AS
                SELECT V.MSISDN,
                       V.IMSI,
                       V.SERVICE_TYPE_NAME,
                       V.ACCOUNT_NAME,
                       V.ACCOUNT_TYPE,
                       V.OBO_1 ,
                       V.OICK_1 ,
                       V.OBR_1 ,
                       V.OBO_2 ,
                       V.OICK_2 ,
                       V.OBR_2 ,
                       MTR.CP_INSTANCE_ID AS MT_CP_ID,
                       MTR.SCP_VOLUME_OPTION,
                       MTR.RSA_1,
                       MTR.RSA_2,
                       MTR.TICK_1,
                       MTR.TICK_2,
                       MTR.CAMEL_1,
                       MTR.CAMEL_2 
                  FROM MAIN_VIP V, MAIN_MTROAMING_SYS MTR
                 WHERE V.MSISDN = MTR.MSISDN
                   AND MTR.SERVICE_STATUS = ''Active''
                   AND V.MSISDN_HLRS IS NOT NULL';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('VIP_VS_MT_ROAM', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

      IF UTILS_INTERFACES.CREATE_INDEX('VIP_VS_MT_ROAM',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;
    
      -- VIP/INACC WITH MT ROAMING

   SQL_TXT := 'CREATE TABLE VIP_INACC_VS_MTROAM NOLOGGING AS
                SELECT V.MSISDN,
                       V.IMSI,
                       V.SERVICE_TYPE_NAME,
                       V.ACCOUNT_NAME,
                       V.ACCOUNT_TYPE,
                       V.MT_CP_ID,
                       V.SCP_VOLUME_OPTION,
                       V.OBO_1 ,
                       V.OICK_1 ,
                       V.OBR_1 ,
                       V.OBO_2 ,
                       V.OICK_2 ,
                       V.OBR_2 ,
                       LIA.CP_INSTANCE_ID AS LIA_CP_ID,
                       LIA.RSA_1,
                       LIA.RSA_2,
                       LIA.TICK_1,
                       LIA.TICK_2,
                       LIA.CAMEL_1,
                       LIA.CAMEL_2 
                  FROM VIP_VS_MT_ROAM V, MAIN_LIMITED_INT_ACC LIA
                  WHERE LIA.MSISDN = V.MSISDN
                   AND LIA.SERVICE_STATUS = ''Active''
                   AND LIA.MSISDN_HLRS IS NOT NULL';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('VIP_INACC_VS_MTROAM', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

      IF UTILS_INTERFACES.CREATE_INDEX('VIP_INACC_VS_MTROAM',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;
 
--MAIN_PPN_SYS     

-- PPN WITH MT ROAMING (This Scenario Will Include VPN + Non VPN since the only difference is OICK
-- This parameter will be corrected within the VPN Scenario

   SQL_TXT := 'CREATE TABLE PPN_VS_MTROAM NOLOGGING AS
                SELECT V.MSISDN,
                       V.IMSI,
                       V.SERVICE_TYPE_NAME,
                       V.ACCOUNT_NAME,
                       V.ACCOUNT_TYPE,
                       V.CP_INSTANCE_ID AS IA_CP_ID,
                       V.OBO_1 ,
                       V.OICK_1 ,
                       V.OBR_1 ,
                       V.OBO_2 ,
                       V.OICK_2 ,
                       V.OBR_2 ,
                       MTR.CP_INSTANCE_ID AS SR_CP_ID,
                       MTR.SCP_VOLUME_OPTION,
                       MTR.RSA_1,
                       MTR.RSA_2,
                       MTR.TICK_1,
                       MTR.TICK_2,
                       MTR.CAMEL_1,
                       MTR.CAMEL_2 
                  FROM MAIN_PPN_SYS V, MAIN_MTROAMING_SYS MTR
                 WHERE V.MSISDN = MTR.MSISDN
                   AND MTR.SERVICE_STATUS = ''Active''
                   AND V.MSISDN_HLRS IS NOT NULL';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('PPN_VS_MTROAM', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

      IF UTILS_INTERFACES.CREATE_INDEX('PPN_VS_MTROAM',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;


   -- PPN/INACC WITH MT ROAMING

   SQL_TXT := 'CREATE TABLE PPN_INACC_VS_MTROAM NOLOGGING AS
                SELECT V.MSISDN,
                       V.IMSI,
                       V.SERVICE_TYPE_NAME,
                       V.ACCOUNT_NAME,
                       V.ACCOUNT_TYPE,
                       V.SCP_VOLUME_OPTION,
                       V.OBO_1 ,
                       V.OICK_1 ,
                       V.OBR_1 ,
                       V.OBO_2 ,
                       V.OICK_2 ,
                       V.OBR_2 ,
                       LIA.CP_INSTANCE_ID AS SR_CP_ID,
                       LIA.RSA_1,
                       LIA.RSA_2,
                       LIA.TICK_1,
                       LIA.TICK_2,
                       LIA.CAMEL_1,
                       LIA.CAMEL_2 
                  FROM PPN_VS_MTROAM V, MAIN_LIMITED_INT_ACC LIA
                  WHERE LIA.MSISDN = V.MSISDN
                   AND LIA.SERVICE_STATUS = ''Active''
                   AND LIA.MSISDN_HLRS IS NOT NULL';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('PPN_INACC_VS_MTROAM', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

      IF UTILS_INTERFACES.CREATE_INDEX('PPN_INACC_VS_MTROAM',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;


   -- Discrepancies MSISDNs having MT ROAMING and INACC not on HLR
   -- HLR1 
   SQL_TXT := 'CREATE TABLE REP_DISC_LIM_IA_VS_MTROAM NOLOGGING AS
                SELECT * FROM LIM_INTL_ACC_VS_MT_ROAM MT
                WHERE MT.RSA_1 NOT IN (11,13,15)
                OR MT.OICK_1<>160
                OR MT.OBR_1 <>0
                OR MT.OBO_1 <>3';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_LIM_IA_VS_MTROAM', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

      IF UTILS_INTERFACES.CREATE_INDEX('REP_DISC_LIM_IA_VS_MTROAM',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;
      
    RECONCILIATION_INTERFACES.PROV_RECON_MT_ROAMING_CPS('FAFIF','REP_DISC_LIM_IA_VS_MTROAM','CREATE_ACTIVATE','1');

   -- HLR2
    SQL_TXT := 'CREATE TABLE REP_DISC_LIM_IA_VS_MTROAM2 NOLOGGING AS
                SELECT * FROM LIM_INTL_ACC_VS_MT_ROAM MT
                WHERE MT.RSA_2 NOT IN (11,13,15)
                OR MT.OICK_2<>160
                OR MT.OBR_2 <>0
                OR MT.OBO_2 <>3';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_LIM_IA_VS_MTROAM2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

      IF UTILS_INTERFACES.CREATE_INDEX('REP_DISC_LIM_IA_VS_MTROAM2',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_MT_ROAMING_CPS('FAFIF','REP_DISC_LIM_IA_VS_MTROAM2','CREATE_ACTIVATE','2');

   -- Discrepancies MSISDNs having MT ROAMING and IA not on HLR
   -- HLR1

   SQL_TXT := 'CREATE TABLE REP_DISC_IA_VS_MTROAM NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_MT_ROAM MT
                WHERE MT.RSA_1 NOT IN (10,12,14)
                OR MT.OICK_1 not in (0,42)
                OR MT.OBR_1 <>0
                OR MT.OBO_1 <>0';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_MTROAM', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

      IF UTILS_INTERFACES.CREATE_INDEX('REP_DISC_IA_VS_MTROAM',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_MT_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_MTROAM','CREATE_ACTIVATE','1');

    -- HLR2
    
     SQL_TXT := 'CREATE TABLE REP_DISC_IA_VS_MTROAM2 NOLOGGING AS
                SELECT * FROM INTL_ACCESS_VS_MT_ROAM MT
                WHERE MT.RSA_2 NOT IN (10,12,14)
                OR MT.OICK_2 not in (0,42)
                OR MT.OBR_2 <>0
                OR MT.OBO_2 <>0';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_DISC_IA_VS_MTROAM2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

      IF UTILS_INTERFACES.CREATE_INDEX('REP_DISC_IA_VS_MTROAM2',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;
      
   RECONCILIATION_INTERFACES.PROV_RECON_MT_ROAMING_CPS('FAFIF','REP_DISC_IA_VS_MTROAM2','CREATE_ACTIVATE','2');

-- MT ROAMING ONLY ON SV

   SQL_TXT := 'CREATE TABLE MAIN_MTROAMING_ONLY AS
               SELECT * FROM MAIN_MTROAMING_SYS MT  
                   WHERE MT.MSISDN NOT IN (SELECT IA_MT.MSISDN FROM INTL_ACCESS_VS_MT_ROAM IA_MT)
                   AND  MT.MSISDN NOT IN (SELECT LIA_MT.MSISDN  FROM LIM_INTL_ACC_VS_MT_ROAM  LIA_MT) 
                   AND  MT.MSISDN NOT IN (SELECT V_MT.MSISDN FROM VIP_VS_MT_ROAM V_MT)
                   AND  MT.MSISDN NOT IN (SELECT P_MT.MSISDN FROM PPN_VS_MTROAM P_MT)
                   AND  MT.SERVICE_STATUS = ''Active''';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('MAIN_MTROAMING_ONLY', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

      IF UTILS_INTERFACES.CREATE_INDEX('MAIN_MTROAMING_ONLY',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;

 -- Discrepancies MSISDNs having MT ROAMING not on HLR
   -- HLR1

   SQL_TXT := 'CREATE TABLE REP_MTROAM_SV_NOT_HLR1 NOLOGGING AS
                SELECT * FROM MAIN_MTROAMING_ONLY MT
                WHERE MT.RSA_1 <> 10
                OR MT.OICK_1 not in (0,42)
                OR MT.OBR_1 <>0
                OR MT.OBO_1 <>3';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_MTROAM_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

      IF UTILS_INTERFACES.CREATE_INDEX('REP_MTROAM_SV_NOT_HLR1',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_MT_ROAMING_CPS('FAFIF','REP_MTROAM_SV_NOT_HLR1','CREATE_ACTIVATE','1');


 -- HLR2

   SQL_TXT := 'CREATE TABLE REP_MTROAM_SV_NOT_HLR2 NOLOGGING AS
                SELECT * FROM MAIN_MTROAMING_ONLY MT
                WHERE MT.RSA_2 <> 10
                OR MT.OICK_2 not in (0,42)
                OR MT.OBR_2 <>0
                OR MT.OBO_2 <>3';
                  
          IF UTILS_INTERFACES.CREATE_TABLE('REP_MTROAM_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
          END IF;

      IF UTILS_INTERFACES.CREATE_INDEX('REP_MTROAM_SV_NOT_HLR2',
                                     'FAFIF',
                                     'IX_MAIN_MSISDN',
                                     'MSISDN') = 0 THEN
         RAISE INDEX_CREATION_FAILED;
      END IF;
      
      RECONCILIATION_INTERFACES.PROV_RECON_MT_ROAMING_CPS('FAFIF','REP_MTROAM_SV_NOT_HLR2','CREATE_ACTIVATE','2');

END P_MTROAMING_CP_INTERFACES;


PROCEDURE P5_ALFA_CP_INTERFACES(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS

    SQL_TXT             VARCHAR2(4000);
    RELEASE              VARCHAR2(20)    := 'R4.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;
    

    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);




  BEGIN


    UTILS_INTERFACES.INTERFACE_NAME := 'P5_ALFA_CP_INTERFACES';
    
   
    SQL_TXT := 'CREATE TABLE REP_MI_SV_NOT_HLR1_ALFA_APN NOLOGGING AS
                SELECT * FROM MAIN_GPRS_WEB_WAP_SYS G
                   WHERE (G.ALFA_APN1 IS NULL)
                     AND G.MSISDN_CP IS NOT NULL
                     AND G.CP_STATUS = ''Active''
               ';
                   

     IF UTILS_INTERFACES.CREATE_TABLE('REP_MI_SV_NOT_HLR1_ALFA_APN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MI_SV_NOT_HLR1_ALFA_APN','CREATE_ACTIVATE','ALFA_APN','1');
    
        SQL_TXT := 'CREATE TABLE REP_MI_SV_NOT_HLR2_ALFA_APN NOLOGGING AS
                    SELECT * FROM MAIN_GPRS_WEB_WAP_SYS G
                       WHERE (G.ALFA_APN2 IS NULL)
                          AND G.MSISDN_CP IS NOT NULL
                          AND G.CP_STATUS = ''Active''
               ';
                   

     IF UTILS_INTERFACES.CREATE_TABLE('REP_MI_SV_NOT_HLR2_ALFA_APN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MI_SV_NOT_HLR2_ALFA_APN','CREATE_ACTIVATE','ALFA_APN','2');
  
 /*MAIN_MIGIFT_SYS*/
  
    --HLR1
      
    SQL_TXT := 'CREATE TABLE REP_MIG_SV_NOT_HLR1_ALFA_APN NOLOGGING AS
                SELECT * FROM MAIN_MI_GIFT_SYS G
                   WHERE
                    (G.ALFA_APN1 IS NULL OR G.NAM_1 = 1)
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''';   
      
      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MIG_SV_NOT_HLR1_ALFA_APN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MIG_SV_NOT_HLR1_ALFA_APN','CREATE_ACTIVATE','ALFA_APN','1');   

    --HLR2
      
    SQL_TXT := 'CREATE TABLE REP_MIG_SV_NOT_HLR2_ALFA_APN NOLOGGING AS
                SELECT * FROM MAIN_MI_GIFT_SYS G
                   WHERE
                    (G.ALFA_APN2 IS NULL OR G.NAM_2 = 1)
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''';   
      
      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MIG_SV_NOT_HLR2_ALFA_APN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MIG_SV_NOT_HLR2_ALFA_APN','CREATE_ACTIVATE','ALFA_APN','2');     

    /*MAIN_DATASCP_SYS*/

  --HLR1
      
    SQL_TXT := 'CREATE TABLE REP_SCP_SV_NOT_HLR1_ALFA_APN NOLOGGING AS
                SELECT * FROM MAIN_DATASCP_SYS G
                   WHERE
                    (G.ALFA_APN1 IS NULL OR G.NAM_1 = 1)
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''';   
      
      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SCP_SV_NOT_HLR1_ALFA_APN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SCP_SV_NOT_HLR1_ALFA_APN','CREATE_ACTIVATE','ALFA_APN','1');   

    --HLR2
      
    SQL_TXT := 'CREATE TABLE REP_SCP_SV_NOT_HLR2_ALFA_APN NOLOGGING AS
                SELECT * FROM MAIN_DATASCP_SYS G
                   WHERE
                    (G.ALFA_APN2 IS NULL OR G.NAM_2 = 1)
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''';   
      
      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_SCP_SV_NOT_HLR2_ALFA_APN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_SCP_SV_NOT_HLR2_ALFA_APN','CREATE_ACTIVATE','ALFA_APN','2');    

/*CLEAN_MBB_APN1SYS_MERGED*/

  --HLR1
      
    SQL_TXT := 'CREATE TABLE REP_MBB_SV_NOT_HLR1_ALFA_APN NOLOGGING AS
                SELECT * FROM MAIN_MBB_SYS G 
                   WHERE
                   G.MBB_TYPE = ''Postpaid Broadband''
                   AND G.MSISDN_BP NOT IN (SELECT T.MSISDN from MAIN_MBB_PRIV_NET_SYS T)
                   AND G.MSISDN_BP NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''DATA'',''ALL''))
                   AND G.MBB_STATUS = ''Active''
                   AND (G.ALFA_APN1 IS NULL OR G.NAM_1 = 1)
                   AND G.CUSTOMER_NODE_ID NOT IN (644671)
                   AND G.LOGIN_OPTION NOT IN (
                   SELECT reference_code
                          FROM REFERENCE_CODE RCR
                           WHERE REFERENCE_TYPE_ID=1002520 
                          and rcr.code_label IN ( select a.apn_id from MBB_DATA_CARD_PRIVATE_APN a))'; 
                           --- PART ADDED TO EXCLUDE ALL PRIVATE APN CONFIGURED IN THE db B_DATA_CARD_PRIVATE_APN
                   
      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_SV_NOT_HLR1_ALFA_APN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBB_SV_NOT_HLR1_ALFA_APN','CREATE_ACTIVATE','ALFA_APN','1');   

    --HLR2
      
    SQL_TXT := 'CREATE TABLE REP_MBB_SV_NOT_HLR2_ALFA_APN NOLOGGING AS
                SELECT * FROM MAIN_MBB_SYS G 
                   WHERE
                   G.MBB_TYPE = ''Postpaid Broadband''
                   AND G.MSISDN_BP NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''DATA'',''ALL''))
                   AND G.MSISDN_BP NOT IN (SELECT T.MSISDN from MAIN_MBB_PRIV_NET_SYS T)
                   AND G.MBB_STATUS = ''Active''
                   AND (G.ALFA_APN2 IS NULL OR G.NAM_2 = 1)
                   AND G.CUSTOMER_NODE_ID NOT IN (644671)
                   AND G.LOGIN_OPTION NOT IN (
                   SELECT reference_code
                          FROM REFERENCE_CODE RCR
                           WHERE REFERENCE_TYPE_ID=1002520 
                          and rcr.code_label IN ( select a.apn_id from MBB_DATA_CARD_PRIVATE_APN a))';
                             -- EDL EXCLUDED DUE TO SPECIFIC APN +ALL PRIVATE AP
      
      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_MBB_SV_NOT_HLR2_ALFA_APN', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    RECONCILIATION_INTERFACES.prov_recon_services_cps('FAFIF','REP_MBB_SV_NOT_HLR2_ALFA_APN','CREATE_ACTIVATE','ALFA_APN','2');     

END P5_ALFA_CP_INTERFACES;

PROCEDURE P6_VOLTE_INTERFACES(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS
SQL_TXT             VARCHAR2(4000);

BEGIN
------Postpaid - HH 10-01-2020 (NEW Procedure)------------------------------------------------------------------------------------  
--Postpaid: Get all Postpaid MSISDNs having VOLTE on SV
   SQL_TXT :='CREATE TABLE MAIN_VOLTE_SCP_POST NOLOGGING AS
             SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.* ,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1325280
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS SMART_COMPANION_NAME,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1375021
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_6) AS SCP_VOLUME_OPTION
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1000262  -- ALFA CLASSIC
                 AND T.Service_Type_Name =''Voice''
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1375022 -- Smart Companion Postpaid
                 AND PIH.GENERAL_5 =''70004046''-- VOLTE SCP 
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
                 
                 
   IF UTILS_INTERFACES.CREATE_TABLE('MAIN_VOLTE_SCP_POST', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_VOLTE_SCP_POST',
                                     'FAFIF',
                                     'IX_MAIN_DATASCP_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;
    
    --------HLR1-------------------------------------------------------------------------------
    --Postpaid: GET ALL MSISDNS HAVING VOLTE ENABLED ON SV AND INCORRECT PARAMETERS ON HLR                 
        SQL_TXT :='CREATE TABLE POST_V_SV_NOT_HLR1 NOLOGGING AS
                   SELECT * FROM MAIN_VOLTE_SCP_POST G
                    WHERE
                    ((G.VOLTE01_APN1 IS NULL AND G.VOLTE02_APN1 IS NULL) OR G.NAM_1 <> 0 OR G.CAMEL_1 <>18 OR G.TCSIST_1 <>1 )
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.SCP_VOLUME_OPTION = ''VOLTE Enabled''
                     AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                         WHERE REASON in (''VOLTE_ENABLED'',''ALL''))'; 
                                          
                                          
   IF UTILS_INTERFACES.CREATE_TABLE('POST_V_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
  RECONCILIATION_INTERFACES.prov_recon_volte_cps('FAFIF','POST_V_SV_NOT_HLR1','CLASSIC','VOLTE_ENABLED','VOLTE_POSTPAID');   
     
--Postpaid: GET ALL MSISDNS HAVING VOLTE NON ENABLED ON SV AND HAVING VOLTE PARAMETERS ON HLR                                
        SQL_TXT :='CREATE TABLE POST_V_HLR1_NOT_SV NOLOGGING AS
                   SELECT * FROM MAIN_VOLTE_SCP_POST G
                     WHERE
                     (G.VOLTE01_APN1 =94 AND G.VOLTE02_APN1 =95 AND G.NAM_1 = 0 
                     AND G.CAMEL_1 =18 AND G.TCSIST_1 =1 )
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.SCP_VOLUME_OPTION <> ''VOLTE Enabled''
                     AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''VOLTE_ENABLED'',''ALL''))';  
                                          
                                          
   IF UTILS_INTERFACES.CREATE_TABLE('POST_V_HLR1_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

 RECONCILIATION_INTERFACES.prov_recon_volte_cps('FAFIF','POST_V_HLR1_NOT_SV','CLASSIC','NON_VOLTE','VOLTE_POSTPAID');   


--------HLR2-------------------------------------------------------------------------------
    --Postpaid: GET ALL MSISDNS HAVING VOLTE ENABLED ON SV AND INCORRECT PARAMETERS ON HLR                 
        SQL_TXT :='CREATE TABLE POST_V_SV_NOT_HLR2 NOLOGGING AS
                   SELECT * FROM MAIN_VOLTE_SCP_POST G
                    WHERE
                    ((G.VOLTE01_APN2 IS NULL AND G.VOLTE02_APN2 IS NULL) OR G.NAM_2 <> 0 OR G.CAMEL_2 <>18 OR G.TCSIST_2 <>1 )
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.SCP_VOLUME_OPTION = ''VOLTE Enabled''
                     AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                         WHERE REASON in (''VOLTE_ENABLED'',''ALL''))'; 
                                          
                                          
   IF UTILS_INTERFACES.CREATE_TABLE('POST_V_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
 --HH commented on 02-08-2021
 --RECONCILIATION_INTERFACES.prov_recon_volte_cps('FAFIF','POST_V_SV_NOT_HLR2','CLASSIC','VOLTE_ENABLED','VOLTE_POSTPAID');    
    
--Postpaid: GET ALL MSISDNS HAVING VOLTE NON ENABLED ON SV AND HAVING VOLTE PARAMETERS ON HLR                                
        SQL_TXT :='CREATE TABLE POST_V_HLR2_NOT_SV NOLOGGING AS
                   SELECT * FROM MAIN_VOLTE_SCP_POST G
                     WHERE
                     (G.VOLTE01_APN2 =94 AND G.VOLTE02_APN2 =95 AND G.NAM_2 = 0 
                     AND G.CAMEL_2 =18 AND G.TCSIST_2 =1 )
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.SCP_VOLUME_OPTION <> ''VOLTE Enabled''
                     AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                        WHERE REASON in (''VOLTE_ENABLED'',''ALL''))';  
                                          
                                          
   IF UTILS_INTERFACES.CREATE_TABLE('POST_V_HLR2_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
 --HH commented on 02-08-2021
--RECONCILIATION_INTERFACES.prov_recon_volte_cps('FAFIF','POST_V_HLR2_NOT_SV','CLASSIC','NON_VOLTE','VOLTE_POSTPAID');   


------Prepaid------------------------------------------------------------------------------------  
--Prepaid: Get all Postpaid MSISDNs having VOLTE on SV
   SQL_TXT :='CREATE TABLE MAIN_VOLTE_SCP_PRE NOLOGGING AS
             SELECT /*+ index(t IX_PRODUCT_INSTANCE_ID)*/
                     T.* ,
                     PIH.PRODUCT_INSTANCE_ID AS CP_INSTANCE_ID,
                     PIH.EFFECTIVE_START_DATE AS CP_START_DATE,
                     PIH.EFFECTIVE_END_DATE AS CP_END_DATE,
                     (SELECT RCR.ABBREVIATION
                          FROM REFERENCE_CODE RCR
                         WHERE REFERENCE_TYPE_ID=490
                           AND RCR.REFERENCE_CODE = PIH.PRODUCT_INSTANCE_STATUS_CODE) AS CP_STATUS,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1325280
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_5) AS SMART_COMPANION_NAME,
                     (SELECT RCR.ABBREVIATION
                        FROM REFERENCE_CODE RCR
                       WHERE REFERENCE_TYPE_ID=1375021
                         AND RCR.REFERENCE_CODE = PIH.GENERAL_6) AS SCP_VOLUME_OPTION
                FROM REP_CLEAN_ALL_MERGED T,
                     PRODUCT_INSTANCE_HISTORY PIH
               WHERE T.PROD_BP_INST IS NULL
                 AND T.PRODUCT_ID =1000241 -- ALFA Active
                 AND T.Service_Type_Name =''Prepaid''
                 AND PIH.BASE_PRODUCT_INSTANCE_ID = T.PRODUCT_INSTANCE_ID
                 AND SYSDATE BETWEEN PIH.EFFECTIVE_START_DATE AND PIH.EFFECTIVE_END_DATE
                 AND PIH.PRODUCT_ID = 1375023 -- Smart Companion Prepaid
                 AND PIH.GENERAL_5 =''70004045''-- Prepaid VOLTE SCP 
                 AND PIH.PRODUCT_INSTANCE_STATUS_CODE <> 9';
                 
                 
   IF UTILS_INTERFACES.CREATE_TABLE('MAIN_VOLTE_SCP_PRE', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    IF UTILS_INTERFACES.CREATE_INDEX('MAIN_VOLTE_SCP_PRE',
                                     'FAFIF',
                                     'IX_MAIN_DATASCP_MSISDN',
                                     'MSISDN') = 0 THEN
      RAISE INDEX_CREATION_FAILED;
    END IF;
    
    --------HLR1-------------------------------------------------------------------------------
    --Prepaid: GET ALL MSISDNS HAVING VOLTE ENABLED ON SV AND INCORRECT PARAMETERS ON HLR                 
        SQL_TXT :='CREATE TABLE PRE_V_SV_NOT_HLR1 NOLOGGING AS
                   SELECT *
                    FROM MAIN_VOLTE_SCP_PRE G
                   WHERE ((G.VOLTE01_APN1 IS NULL AND G.VOLTE02_APN1 IS NULL) OR G.NAM_1 <> 0 OR
                         (G.CAMEL_1 <> 11 AND G.CAMEL_1 <> 21) OR G.TCSIST_1 <> 1)
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.SCP_VOLUME_OPTION = ''VOLTE Enabled''
                     AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                           WHERE REASON in (''VOLTE_ENABLED'',''ALL''))'; 
                                          
                                          
   IF UTILS_INTERFACES.CREATE_TABLE('PRE_V_SV_NOT_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
   RECONCILIATION_INTERFACES.prov_recon_volte_cps('FAFIF','PRE_V_SV_NOT_HLR1','ACTIVE','VOLTE_ENABLED','VOLTE_PREPAID');      
    
--Prepaid: GET ALL MSISDNS HAVING VOLTE NON ENABLED ON SV AND HAVING VOLTE PARAMETERS ON HLR                                
        SQL_TXT :='CREATE TABLE PRE_V_HLR1_NOT_SV NOLOGGING AS
                   SELECT * FROM MAIN_VOLTE_SCP_PRE G
                    WHERE
                    (G.VOLTE01_APN1 =94 AND G.VOLTE02_APN1 =95 AND  G.NAM_1 = 0 
                        AND (G.CAMEL_1 =11 OR G.CAMEL_1 =21) AND G.TCSIST_1 =1 )
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.SCP_VOLUME_OPTION <> ''VOLTE Enabled''
                     AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                            WHERE REASON in (''VOLTE_ENABLED'',''ALL''))';  
                                          
                                          
   IF UTILS_INTERFACES.CREATE_TABLE('PRE_V_HLR1_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

  RECONCILIATION_INTERFACES.prov_recon_volte_cps('FAFIF','PRE_V_HLR1_NOT_SV','ACTIVE','NON_VOLTE','VOLTE_PREPAID');   

--------HLR2-------------------------------------------------------------------------------
    --Prepaid: GET ALL MSISDNS HAVING VOLTE ENABLED ON SV AND INCORRECT PARAMETERS ON HLR                 
        SQL_TXT :='CREATE TABLE PRE_V_SV_NOT_HLR2 NOLOGGING AS
                   SELECT *
                    FROM MAIN_VOLTE_SCP_PRE G
                   WHERE ((G.VOLTE01_APN2 IS NULL AND G.VOLTE02_APN2 IS NULL) OR G.NAM_2 <> 0 OR
                         (G.CAMEL_2 <> 11 AND G.CAMEL_2 <> 21) OR G.TCSIST_2 <> 1)
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.SCP_VOLUME_OPTION = ''VOLTE Enabled''
                     AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                           WHERE REASON in (''VOLTE_ENABLED'',''ALL''))'; 
                            
   IF UTILS_INTERFACES.CREATE_TABLE('PRE_V_SV_NOT_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
   --HH commented on 02-08-2021  
 --RECONCILIATION_INTERFACES.prov_recon_volte_cps('FAFIF','PRE_V_SV_NOT_HLR2','ACTIVE','VOLTE_ENABLED','VOLTE_PREPAID');      
     
--Prepaid GET ALL MSISDNS HAVING VOLTE NON ENABLED ON SV AND HAVING VOLTE PARAMETERS ON HLR                                
       SQL_TXT :='CREATE TABLE PRE_V_HLR2_NOT_SV NOLOGGING AS
                   SELECT * FROM MAIN_VOLTE_SCP_PRE G
                    WHERE
                    (G.VOLTE01_APN2 =94 AND G.VOLTE02_APN2 =95 AND  G.NAM_2 = 0 
                        AND (G.CAMEL_2 =11 OR G.CAMEL_2 =21) AND G.TCSIST_2 =1 )
                     AND G.MSISDN IS NOT NULL
                     AND G.CP_STATUS = ''Active''
                     AND G.SCP_VOLUME_OPTION <> ''VOLTE Enabled''
                    AND G.MSISDN NOT IN (SELECT MSISDN FROM MSISDNS_EXCLUDED_FROM_RECON
                                          WHERE REASON in (''VOLTE_ENABLED'',''ALL''))'; 
                                          
                                          
   IF UTILS_INTERFACES.CREATE_TABLE('PRE_V_HLR2_NOT_SV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
 --HH commented on 02-08-2021
  -- RECONCILIATION_INTERFACES.prov_recon_volte_cps('FAFIF','PRE_V_HLR2_NOT_SV','ACTIVE','NON_VOLTE','VOLTE_PREPAID');  

    
END P6_VOLTE_INTERFACES;

PROCEDURE P7_DATACARD_INTERFACES(INTEGRATION_LOG_ID IN VARCHAR2 DEFAULT '0', RESULT OUT VARCHAR2, P_ENT_TYPE IN NUMBER DEFAULT 4, P_ENT_CODE IN NUMBER DEFAULT 1) IS

    SQL_TXT              VARCHAR2(4000);
    RELEASE              VARCHAR2(20)    := 'R7.0';
    ENT_TYPE_CODE        NUMBER;
    ENT_CODE             NUMBER;
    

    CLIENT_ID            VARCHAR2(10);
    SAS_TABLE            VARCHAR2(100);
    REJ_TABLE            VARCHAR2(100);
    HIST_TABLE           VARCHAR2(100);




  BEGIN


    UTILS_INTERFACES.INTERFACE_NAME := 'P7_DATACARD_INTERFACES';
    
    --HLR1

    SQL_TXT := 'CREATE TABLE HLR1_MSISDN_MODIFIED AS
                select DECODE(SUBSTR(SUBSTR(h.NUM_APPEL, 4), 1, 1),8,SUBSTR(h.NUM_APPEL, 4),7,SUBSTR(h.NUM_APPEL, 4),3,''0'' || (SUBSTR(h.NUM_APPEL, 4)),1,''0'' || (SUBSTR(h.NUM_APPEL, 4))) AS MSISDN_APN1,
                 h.*
                from HLR1 h
               ';


    IF UTILS_INTERFACES.CREATE_TABLE('HLR1_MSISDN_MODIFIED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    SQL_TXT := 'CREATE TABLE DATA_CARD_APN_HLR1_ALL AS
                 SELECT c.service_name,c.product_type_name,c.service_status,h1.apn_id 
                 FROM HLR1_MSISDN_MODIFIED h1, clean_sv_all_upd c
                 WHERE h1.MSISDN_APN1 = c.service_name
                 AND c.service_status not in (''Cancelled'',''Moved'')
                 AND c.product_type_name = ''Alfa Data Card''
                ';
                     

    IF UTILS_INTERFACES.CREATE_TABLE('DATA_CARD_APN_HLR1_ALL', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;


    SQL_TXT := 'CREATE TABLE DATA_CARD_APN_HLR1_P1 AS
                       SELECT SERVICE_NAME AS MSISDN_HLR1,
                       max(decode(APN_ID, ''3'', APN_ID, null)) AS DATACARD1_APN1,
                       max(decode(APN_ID, ''4'', APN_ID, null)) AS DATACARD2_APN1,
                       max(decode(APN_ID, ''6'', APN_ID, null)) AS DATACARD3_APN1,
                       max(CASE WHEN APN_ID not in (''3'',''4'',''6'') 
                       THEN APN_ID
                       ELSE NULL 
                       END 
                       )
                       AS DATACARD_PRIVATE_APN1 
                       FROM
                       (
                          SELECT *
                          FROM DATA_CARD_APN_HLR1_ALL 
                        )
                  GROUP BY SERVICE_NAME';
                  
    IF UTILS_INTERFACES.CREATE_TABLE('DATA_CARD_APN_HLR1_P1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;


    SQL_TXT := 'CREATE TABLE DATA_CARD_APN_HLR1_P2 AS
                       SELECT T.MSISDN_HLR1,
                       max(CASE WHEN T.APN_ID not in (''3'',''4'',''6'', T.DATACARD_PRIVATE_APN1) 
                       THEN T.APN_ID 
                       ELSE NULL 
                       END 
                       )
                       AS DATACARD_PRIVATE2_APN1  
                       FROM
                       (  SELECT *
                          FROM DATA_CARD_APN_HLR1_ALL dh , DATA_CARD_APN_HLR1_P1 h
                          WHERE DH.SERVICE_NAME = H.MSISDN_HLR1(+)
                        ) T
                        
                 GROUP BY T.MSISDN_HLR1';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('DATA_CARD_APN_HLR1_P2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;                 


    SQL_TXT := 'CREATE TABLE DATA_CARD_APN_HLR1 AS
                    SELECT P.MSISDN_HLR1,
                           P.DATACARD1_APN1,
                           P.DATACARD2_APN1,
                           P.DATACARD3_APN1,
                           P.DATACARD_PRIVATE_APN1,
                           P1.DATACARD_PRIVATE2_APN1
                    FROM DATA_CARD_APN_HLR1_P1 P , DATA_CARD_APN_HLR1_P2 P1
                    WHERE P.MSISDN_HLR1 = P1.MSISDN_HLR1';
                 
     IF UTILS_INTERFACES.CREATE_TABLE('DATA_CARD_APN_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;
    
     SQL_TXT := 'CREATE TABLE CLEAN_DATACARD_MERGE_SV_HLR1 AS
                       SELECT c.service_name,c.imsi, c.login_option,
                      (select rc.code_label from reference_code rc
                                              where rc.reference_type_id = 1002520 
                                              and rc.reference_code = c.login_option) as APN_ID_SV,
                       d.*
                      from REP_CLEAN_ALL_MERGED c, DATA_CARD_APN_HLR1 d
                      where c.service_type_name = ''Data Card''
                      and c.service_name = d.msisdn_hlr1
                      and c.service_status not in (''Cancelled'',''Moved'') 
                      ';
                   

     IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_DATACARD_MERGE_SV_HLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;
     
     
     SQL_TXT := 'CREATE TABLE REP_DATACARDAPN_SVNOTHLR1 AS 
                  SELECT T.* from CLEAN_DATACARD_MERGE_SV_HLR1 T
                       WHERE 
                       (T.APN_ID_SV <> T.DATACARD_PRIVATE_APN1
                        AND 
                        T.APN_ID_SV <> T.DATACARD_PRIVATE2_APN1)
                       AND T.APN_ID_SV NOT IN (''BOTH'',''SEEMLESS'',''MaliaTec'',''NORMAL'')
                      ';
                   

     IF UTILS_INTERFACES.CREATE_TABLE('REP_DATACARDAPN_SVNOTHLR1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;

     
     
     SQL_TXT := 'CREATE TABLE REP_DATACARDAPN_HLR1NOTSV AS 
                  SELECT T.* from CLEAN_DATACARD_MERGE_SV_HLR1 T
                       WHERE 
                       (T.APN_ID_SV = T.DATACARD_PRIVATE_APN1 AND T.APN_ID_SV <> T.DATACARD_PRIVATE2_APN1)
                        OR 
                       (T.APN_ID_SV = T.DATACARD_PRIVATE2_APN1 AND T.APN_ID_SV <> T.DATACARD_PRIVATE_APN1)
                       AND T.APN_ID_SV NOT IN (''BOTH'',''SEEMLESS'',''MaliaTec'',''NORMAL'')
                       AND T.DATACARD_PRIVATE_APN1 IS NOT NULL
                       AND T.DATACARD_PRIVATE2_APN1 IS NOT NULL';
     
     IF UTILS_INTERFACES.CREATE_TABLE('REP_DATACARDAPN_HLR1NOTSV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;              
                       
    -- RECONCILIATION_INTERFACES.PROV_RECON_APN_MODIFY_PARAM('FAFIF','REP_DATACARDAPN_HLR1NOTSV','DELETE','1');
    
   --HLR2
    SQL_TXT := 'CREATE TABLE HLR2_MSISDN_MODIFIED AS
                   select DECODE(SUBSTR(SUBSTR(h.NUM_APPEL, 4), 1, 1),8,SUBSTR(h.NUM_APPEL, 4),7,SUBSTR(h.NUM_APPEL, 4),3,''0'' || (SUBSTR(h.NUM_APPEL, 4)),1,''0'' || (SUBSTR(h.NUM_APPEL, 4))) AS MSISDN_APN2,
                   h.*
                   from HLR2 h
                ';   
      
      
    IF UTILS_INTERFACES.CREATE_TABLE('HLR2_MSISDN_MODIFIED', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

   
    SQL_TXT := 'CREATE TABLE DATA_CARD_APN_HLR2_ALL AS
                SELECT c.service_name,c.product_type_name,c.service_status,h2.apn_id 
                FROM HLR2_MSISDN_MODIFIED h2, clean_sv_all_upd c
                where h2.MSISDN_APN2 = c.service_name
                and c.service_status not in (''Cancelled'',''Moved'')
                and c.product_type_name = ''Alfa Data Card''
                ';   
      
      
    IF UTILS_INTERFACES.CREATE_TABLE('DATA_CARD_APN_HLR2_ALL', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
      
    SQL_TXT := 'CREATE TABLE DATA_CARD_APN_HLR2_P1 AS
                SELECT SERVICE_NAME AS MSISDN_HLR2,
                       max(decode(APN_ID, ''3'', APN_ID, null)) AS DATACARD1_APN2,
                       max(decode(APN_ID, ''4'', APN_ID, null)) AS DATACARD2_APN2,
                       max(decode(APN_ID, ''6'', APN_ID, null)) AS DATACARD3_APN2,
                       max(CASE WHEN APN_ID not in (''3'',''4'',''6'') 
                       THEN APN_ID
                       ELSE NULL 
                       END 
                       )
                    AS DATACARD_PRIVATE_APN2 
                    FROM
                    (
                    SELECT *
                    FROM DATA_CARD_APN_HLR2_ALL 
                    )
                 GROUP BY SERVICE_NAME';   
      
      
    IF UTILS_INTERFACES.CREATE_TABLE('DATA_CARD_APN_HLR2_P1', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;

    SQL_TXT := 'CREATE TABLE DATA_CARD_APN_HLR2_P2 AS
                       SELECT T.MSISDN_HLR2,
                       max(CASE WHEN T.APN_ID not in (''3'',''4'',''6'', T.DATACARD_PRIVATE_APN2) 
                       THEN T.APN_ID 
                       ELSE NULL 
                       END 
                       )
                       AS DATACARD_PRIVATE2_APN2  
                       FROM
                       (  SELECT *
                          FROM DATA_CARD_APN_HLR2_ALL dh , DATA_CARD_APN_HLR2_P1 h
                          WHERE DH.SERVICE_NAME = H.MSISDN_HLR2(+)
                        ) T
                        
                 GROUP BY T.MSISDN_HLR2';
                 
    IF UTILS_INTERFACES.CREATE_TABLE('DATA_CARD_APN_HLR2_P2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;                 


    SQL_TXT := 'CREATE TABLE DATA_CARD_APN_HLR2 AS
                    SELECT P.MSISDN_HLR2,
                           P.DATACARD1_APN2,
                           P.DATACARD2_APN2,
                           P.DATACARD3_APN2,
                           P.DATACARD_PRIVATE_APN2,
                           P1.DATACARD_PRIVATE2_APN2
                    FROM DATA_CARD_APN_HLR2_P1 P , DATA_CARD_APN_HLR2_P2 P1
                    WHERE P.MSISDN_HLR2 = P1.MSISDN_HLR2';
                 
     IF UTILS_INTERFACES.CREATE_TABLE('DATA_CARD_APN_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;

      
    SQL_TXT := 'CREATE TABLE CLEAN_DATACARD_MERGE_SV_HLR2 AS
                 SELECT c.service_name,c.imsi, c.login_option,
                (SELECT rc.code_label from reference_code rc
                                              where rc.reference_type_id = 1002520 
                                                and rc.reference_code = c.login_option) as APN_ID_SV,
                                                d.*
                FROM REP_CLEAN_ALL_MERGED c, DATA_CARD_APN_HLR2 d
                WHERE c.service_type_name = ''Data Card''
                AND c.service_name = d.msisdn_hlr2
                AND c.service_status not in (''Cancelled'',''Moved'')
                ';   
      
      
    IF UTILS_INTERFACES.CREATE_TABLE('CLEAN_DATACARD_MERGE_SV_HLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
    SQL_TXT := 'CREATE TABLE REP_DATACARDAPN_SVNOTHLR2 AS 
                 SELECT T.* from CLEAN_DATACARD_MERGE_SV_HLR2 T
                       WHERE 
                       (T.APN_ID_SV <> T.DATACARD_PRIVATE_APN2
                        AND 
                        T.APN_ID_SV <> T.DATACARD_PRIVATE2_APN2)
                       AND T.APN_ID_SV NOT IN (''BOTH'',''SEEMLESS'',''MaliaTec'',''NORMAL'')
                ';   
      
      
    IF UTILS_INTERFACES.CREATE_TABLE('REP_DATACARDAPN_SVNOTHLR2', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
    
     SQL_TXT := 'CREATE TABLE REP_DATACARDAPN_HLR2NOTSV AS 
                  SELECT T.* from CLEAN_DATACARD_MERGE_SV_HLR2 T
                       WHERE 
                       (T.APN_ID_SV = T.DATACARD_PRIVATE_APN2 AND T.APN_ID_SV <> T.DATACARD_PRIVATE2_APN2)
                        OR 
                       (T.APN_ID_SV = T.DATACARD_PRIVATE2_APN2 AND T.APN_ID_SV <> T.DATACARD_PRIVATE_APN2)
                       AND T.APN_ID_SV NOT IN (''BOTH'',''SEEMLESS'',''MaliaTec'',''NORMAL'')
                       AND T.DATACARD_PRIVATE_APN2 IS NOT NULL
                       AND T.DATACARD_PRIVATE2_APN2 IS NOT NULL';
     
     IF UTILS_INTERFACES.CREATE_TABLE('REP_DATACARDAPN_HLR2NOTSV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;     

   --  RECONCILIATION_INTERFACES.PROV_RECON_APN_MODIFY_PARAM('FAFIF','REP_DATACARDAPN_HLR2NOTSV','DELETE','2');

   SQL_TXT := 'CREATE TABLE REP_DATACARDAPN_HLRNOTSV AS
                  SELECT H1.SERVICE_NAME,
                  H1.IMSI,
                  H1.LOGIN_OPTION,
                  H1.APN_ID_SV,
                  H1.MSISDN_HLR1 as MSISDN_HLR,
                  H1.DATACARD1_APN1 as DATACARD1_APN,
                  H1.DATACARD2_APN1 as DATACARD2_APN,
                  H1.DATACARD3_APN1 as DATACARD3_APN,
                  H1.DATACARD_PRIVATE_APN1 as DATACARD_PRIVATE_APN, 
                  H1.DATACARD_PRIVATE2_APN1 as DATACARD_PRIVATE2_APN from REP_DATACARDAPN_HLR1NOTSV H1
                  UNION
                  SELECT H2.SERVICE_NAME,
                  H2.IMSI,
                  H2.LOGIN_OPTION,
                  H2.APN_ID_SV,
                  H2.MSISDN_HLR2 as MSISDN_HLR,
                  H2.DATACARD1_APN2 as DATACARD1_APN,
                  H2.DATACARD2_APN2 as DATACARD2_APN,
                  H2.DATACARD3_APN2 as DATACARD3_APN,
                  H2.DATACARD_PRIVATE_APN2 as DATACARD_PRIVATE_APN, 
                  H2.DATACARD_PRIVATE2_APN2 as DATACARD_PRIVATE2_APN from REP_DATACARDAPN_HLR2NOTSV H2';
     
     IF UTILS_INTERFACES.CREATE_TABLE('REP_DATACARDAPN_HLRNOTSV', 'FAFIF', SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
     END IF;    
     
    RECONCILIATION_INTERFACES.PROV_RECON_APN_MODIFY_PARAM('FAFIF','REP_DATACARDAPN_HLRNOTSV','DELETE','2');

END P7_DATACARD_INTERFACES;

PROCEDURE PROV_RECON_SERVICES_CPS (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, OPTION_TO_ACT IN VARCHAR2, CP_PRODUCT IN VARCHAR2, HLR IN VARCHAR2) IS


-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Export            VARCHAR2(40);

TABLE_CREATION_FAILED      EXCEPTION;
POSITION_CLIR_SOCLIR       NUMBER;
CLIR_SOCLIR_TYPE           VARCHAR2(40);

CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(200);
FILE_NAME1                 VARCHAR2(200);

BEGIN

Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);
POSITION_CLIR_SOCLIR := INSTR(recon_table_name,'SOCT');
CLIR_SOCLIR_TYPE     := SUBSTR(recon_table_name, POSITION_CLIR_SOCLIR+LENGTH('SOCT'),1);


  if HLR = '1' then
  if OPTION_TO_ACT = 'CREATE_ACTIVATE' then
  
     if POSITION_CLIR_SOCLIR > 1 then 
     
      if CLIR_SOCLIR_TYPE = '1' then
          SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                SELECT 
                ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',SOCLIR_TYPE,TYPE_1''   
                AS prov_req, sysdate as prov_day
                FROM '||Schema_owner||'.'||recon_table_name||' t';
     
          IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
          END IF;
      end if;
     
      if CLIR_SOCLIR_TYPE = '2' then
      
            SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                SELECT 
                ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',SOCLIR_TYPE,TYPE_2''   
                AS prov_req, sysdate as prov_day
                FROM '||Schema_owner||'.'||recon_table_name||' t';
     
          IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
          END IF;
       end if;
       
     
      
      ELSE

      IF recon_table_name = 'REP_BB_SV_NOT_HLRAPN1' THEN
       
       SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                SELECT 
                ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',SERVICE_TYPE,''||T.SERVICE_TYPE   
                AS prov_req, sysdate as prov_day
                FROM '||Schema_owner||'.'||recon_table_name||' t';
     
      ELSE
      
      SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                SELECT 
                ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''   
                AS prov_req, sysdate as prov_day
                FROM '||Schema_owner||'.'||recon_table_name||' t';
     END IF;
      
      IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;
     end if;
     
     
    
  end if;
  
  if OPTION_TO_ACT = 'DELETE' then
  
     IF recon_table_name = 'REP_BB_HLRAPN_NOT_SV' THEN
      
      SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                SELECT 
                ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',SERVICE_TYPE,BIS''   
                AS prov_req, sysdate as prov_day
                FROM '||Schema_owner||'.'||recon_table_name||' t';
     ELSE
  
       SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                SELECT 
                ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''   
                AS prov_req, sysdate as prov_day
                FROM '||Schema_owner||'.'||recon_table_name||' t';
     END IF;
                     
    IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, Schema_owner, SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
     
   
    
  end if;
  
 end if;
 
 
  if HLR = '2' then
     if OPTION_TO_ACT = 'CREATE_ACTIVATE' then

      if POSITION_CLIR_SOCLIR > 1 then 
     
       if CLIR_SOCLIR_TYPE = '1' then
          SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                     SELECT 
                     ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',SOCLIR_TYPE,TYPE_1''   
                     AS prov_req, sysdate as prov_day
                     FROM '||Schema_owner||'.'||recon_table_name||' t';
     
          IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
          END IF;
        end if;
          
       if CLIR_SOCLIR_TYPE = '2' then
      
          SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                     SELECT 
                     ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',SOCLIR_TYPE,TYPE_2''   
                     AS prov_req, sysdate as prov_day
                     FROM '||Schema_owner||'.'||recon_table_name||' t';
     
          IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
          END IF;
       end if;
       
     
       else
       
       IF recon_table_name = 'REP_BB_SV_NOT_HLRAPN2' THEN
       
       SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                SELECT 
                ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',SERVICE_TYPE,''||T.SERVICE_TYPE   
                AS prov_req, sysdate as prov_day
                FROM '||Schema_owner||'.'||recon_table_name||' t';
     
       ELSE
      
      
         SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                     SELECT 
                     ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''   
                     AS prov_req, sysdate as prov_day
                     FROM '||Schema_owner||'.'||recon_table_name||' t';
        end if;
          
      IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, Schema_owner, SQL_TXT) = 0 THEN
         RAISE TABLE_CREATION_FAILED;
      END IF;
        
    
        end if;

     end if;
  
     if OPTION_TO_ACT = 'DELETE' then
     
      IF recon_table_name = 'REP_BB_HLRAPN2_NOT_SV' THEN
      
      SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                SELECT 
                ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',SERVICE_TYPE,BIS''   
                AS prov_req, sysdate as prov_day
                FROM '||Schema_owner||'.'||recon_table_name||' t';
                
       ELSE
     
         SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                     SELECT 
                     ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''   
                     AS prov_req, sysdate as prov_day
                     FROM '||Schema_owner||'.'||recon_table_name||' t';   
                     
       
       END IF;
       
         IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, Schema_owner, SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
         END IF;
     
      end if;
  
  end if;
   
  CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

  Table_To_Export := SUBSTR(Table_To_Create_Name,6)||'_CSV';
  FILE_NAME := SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE;
  FILE_NAME1 := 'FAFIF.'||SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE||'.csv';
  
 
 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv  FROM '||Schema_owner||'.'||Table_To_Create_Name||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;
   
   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME1);   

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;

END prov_recon_services_cps;


PROCEDURE PROV_RECON_SERVICES (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, OPTION_TO_ACT IN VARCHAR2, PRODUCT IN VARCHAR2, HLR IN VARCHAR2) IS

-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Create            Varchar2(40);
Table_To_Export            VARCHAR2(40);
TABLE_CREATION_FAILED      EXCEPTION;
TEST_TABLE                 VARCHAR2(100);

PRODUCT_TYPE_CLASSIC       VARCHAR2(40);
PRODUCT_TYPE_CLASSIC_CHECK VARCHAR2(40);
PRODUCT_TYPE_ACTIVE        VARCHAR2(40);
PRODUCT_TYPE_ACTIVE_CHECK  VARCHAR2(40);
CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(100);
FILE_NAME1                 VARCHAR2(100);


BEGIN

TEST_TABLE := SUBSTR(recon_table_name,LENGTH(recon_table_name));

IF TEST_TABLE = '1' THEN
   Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4, LENGTH(recon_table_name)-4);
ELSIF TEST_TABLE = '2' THEN
   Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4, LENGTH(recon_table_name)-4);
ELSE
   Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);
END IF;

PRODUCT_TYPE_CLASSIC_CHECK := 'Alfa Classic';
PRODUCT_TYPE_CLASSIC := 'CLASSIC';
PRODUCT_TYPE_ACTIVE_CHECK :='Alfa Active';
PRODUCT_TYPE_ACTIVE := 'ACTIVE';


CASE HLR 
     WHEN '1' THEN
          Table_To_Create := Table_To_Create_Name||'1';
          CASE 
              
              WHEN (recon_table_name = 'REP_CANC_SV_IN_HLR')  THEN
                      
                 SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                             SELECT
                             ''EricssonHLR1,IMSI,''||t.IMSI_1||'',MSISDN,961''||to_number(t.msisdn)||'','||OPTION_TO_ACT||',PRODUCT::''||decode(t.product_type_name,'''||PRODUCT_TYPE_CLASSIC_CHECK||''',''' ||PRODUCT_TYPE_CLASSIC||''','''||PRODUCT_TYPE_ACTIVE_CHECK ||''','''||PRODUCT_TYPE_ACTIVE||''')
                             AS prov_req, sysdate as prov_day
                             FROM '||Schema_owner||'.'||recon_table_name||' t';
                             
              WHEN (recon_table_name = 'REP_NOT_CANC_SV_NOT_IN_HLR') THEN
                 
                 SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                             SELECT
                             ''EricssonHLR1,IMSI,''||t.IMSI||'',MSISDN,961''||to_number(t.msisdn)||'','||OPTION_TO_ACT||',PRODUCT::''||decode(t.product_type_name,'''||PRODUCT_TYPE_CLASSIC_CHECK||''',''' ||PRODUCT_TYPE_CLASSIC||''','''||PRODUCT_TYPE_ACTIVE_CHECK ||''','''||PRODUCT_TYPE_ACTIVE||''')
                             AS prov_req, sysdate as prov_day
                             FROM '||Schema_owner||'.'||recon_table_name||' t';
                             
              WHEN (recon_table_name = 'REP_PREP_SV_POST_HLR_1') THEN
             
                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                            SELECT
                            ''EricssonHLR1,IMSI,''||t.imsi||'',MSISDN,961''||to_number(t.msisdn)||'',CREATE_ACTIVATE,PRODUCT::ACTIVE''
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';
                            
              WHEN (recon_table_name = 'REP_MIS_IMSIS_FULL_RECON_1') THEN
              
                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR1,NIMSI,''||t.IMSI_SV||'',IMSI,''||t.IMSI_1||'',MSISDN,961''||to_number(t.msisdn)||'','||OPTION_TO_ACT||',PRODUCT::''||decode(t.product_type_name,'''||PRODUCT_TYPE_CLASSIC_CHECK||''',''' ||PRODUCT_TYPE_CLASSIC||''','''||PRODUCT_TYPE_ACTIVE_CHECK ||''','''||PRODUCT_TYPE_ACTIVE||''')
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
                           
              WHEN (recon_table_name = 'REP_MSISDN_HLR_NOT_IN_BIL_1') THEN
              
                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR1,IMSI,''||t.IMSI_1||'',MSISDN,961''||to_number(t.msisdn)||'','||OPTION_TO_ACT||',PRODUCT::'||PRODUCT||'''
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
                           
              WHEN (recon_table_name = 'REP_FAX_SV_NOT_HLR1') THEN

                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR1,IMSI,''||t.IMSI_MAIN||'',MSISDN,961''||to_number(t.MSISDN_MAIN)||'',MODIFY,PRODUCT::CLASSIC,'||OPTION_TO_ACT||',SERVICE::'||PRODUCT||',SVC_MSISDN,961''||to_number(t.msisdn)||'',SVC_IMSI,''||t.IMSI_MAIN
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
                           
              WHEN (recon_table_name = 'REP_DATA_SV_NOT_HLR1') THEN

                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR1,IMSI,''||t.IMSI_MAIN||'',MSISDN,961''||to_number(t.MSISDN_MAIN)||'',MODIFY,PRODUCT::CLASSIC,'||OPTION_TO_ACT||',SERVICE::'||PRODUCT||',SVC_MSISDN,961''||to_number(t.msisdn)||'',SVC_IMSI,''||t.IMSI_MAIN
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
                           
              WHEN (recon_table_name = 'REP_FAX_HLR_NOT_SV1') THEN
              
                  SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR1,IMSI,''||t.IMSI_MAIN||'',MSISDN,961''||to_number(t.MSISDN_MAIN)||'',MODIFY,PRODUCT::CLASSIC,'||OPTION_TO_ACT||',SERVICE::'||PRODUCT||',SVC_MSISDN,961''||to_number(t.msisdn)||'',SVC_IMSI,''||t.IMSI_MAIN
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
                           
              WHEN (recon_table_name = 'REP_DATA_HLR_NOT_SV1') THEN
              
                  SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR1,IMSI,''||t.IMSI_MAIN||'',MSISDN,961''||to_number(t.MSISDN_MAIN)||'',MODIFY,PRODUCT::CLASSIC,'||OPTION_TO_ACT||',SERVICE::'||PRODUCT||',SVC_MSISDN,961''||to_number(t.msisdn)||'',SVC_IMSI,''||t.IMSI_MAIN
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
                           
              WHEN (recon_table_name = 'REP_POST_IOV_ACT_HLR1') THEN
                   SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR1,VolSuspend,true,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'','||OPTION_TO_ACT||',PRODUCT::'||PRODUCT||'''
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
                           
               WHEN (recon_table_name = 'REP_MBB_POST_SV_NOT_HLR1' OR recon_table_name = 'REP_MBB_PREP_SV_NOT_HLR1' ) THEN
              
                    SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                       SELECT
                       ''EricssonHLR1,IMSI,''||t.IMSI_SV||'',MSISDN,961''||to_number(t.MSISDN_BP)||'','||OPTION_TO_ACT||',PRODUCT::'||PRODUCT||'''
                       AS prov_req, sysdate as prov_day
                       FROM '||Schema_owner||'.'||recon_table_name||' t';
              
              WHEN  (recon_table_name = 'REP_MBB_HLR1_NOT_SV') THEN
              
                    SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                       SELECT
                       ''EricssonHLR1,IMSI,''||t.IMSI_1||'',MSISDN,961''||to_number(t.MSISDN_HLR1)||'','||OPTION_TO_ACT||',PRODUCT::'||PRODUCT||'''
                       AS prov_req, sysdate as prov_day
                       FROM '||Schema_owner||'.'||recon_table_name||' t';
              
              WHEN (recon_table_name = 'REP_SV_BOUT_DATA_ACT_HLR1') THEN
                                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR1,IMSI,''||t.imsi||'',MSISDN,961''||to_number(t.msisdn)||'',ReasonCode,THRESHOLD_EXCEEDED,SUSPEND_BAR_OUT,PRODUCT::CLASSIC''
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
                         
              WHEN (recon_table_name = 'REP_SV_BOUT_CC_ACT_HLR1') THEN -- Added for the Call Completion 01-08-2018
              
                              SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                          ''EricssonHLR1,IMSI,''||t.imsi||'',MSISDN,961''||to_number(t.msisdn)||'',ReasonCode,THRESHOLD_EXCEEDED,SUSPEND_BAR_OUT,PRODUCT::CLASSIC,ACTION,MODIFY,SETTING,FEATURE::CALL_ME_BACK_ACCESS,ReasonCode,THRESHOLD_EXCEEDED''
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
              
                                          
               WHEN (recon_table_name = 'REP_CC_NOSV_ACT_BOUT_HLR1') THEN -- Added for the Call Completion 01-08-2018
              
                  SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR1,IMSI,''||t.imsi||'',MSISDN,961''||to_number(t.msisdn)||'',ReasonCode,THRESHOLD_EXCEEDED,SUSPEND_BAR_OUT,PRODUCT::CLASSIC,ACTION,MODIFY,SETTING,FEATURE::CALL_ME_BACK_ACCESS,ReasonCode,THRESHOLD_EXCEEDED''
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
              
              ELSE
              
                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR1,IMSI,''||t.imsi||'',MSISDN,961''||to_number(t.msisdn)||'','||OPTION_TO_ACT||',PRODUCT::'||PRODUCT||'''
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
              
          
          END CASE;
          
     WHEN '2' THEN
          Table_To_Create := Table_To_Create_Name||'2';
          CASE 
                WHEN (recon_table_name = 'REP_CANC_SV_IN_HLR2') THEN
                 
                  SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                              SELECT
                              ''EricssonHLR2,IMSI,''||t.IMSI_2||'',MSISDN,961''||to_number(t.msisdn)||'','||OPTION_TO_ACT||',PRODUCT::''||decode(t.product_type_name,'''||PRODUCT_TYPE_CLASSIC_CHECK||''',''' ||PRODUCT_TYPE_CLASSIC||''','''||PRODUCT_TYPE_ACTIVE_CHECK ||''','''||PRODUCT_TYPE_ACTIVE||''')
                              AS prov_req, sysdate as prov_day
                              FROM '||Schema_owner||'.'||recon_table_name||' t';
                              
                WHEN (recon_table_name = 'REP_NOT_CANC_SV_NOT_IN_HLR') THEN
                     
                  SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                              SELECT
                              ''EricssonHLR2,IMSI,''||t.IMSI||'',MSISDN,961''||to_number(t.msisdn)||'','||OPTION_TO_ACT||',PRODUCT::''||decode(t.product_type_name,'''||PRODUCT_TYPE_CLASSIC_CHECK||''',''' ||PRODUCT_TYPE_CLASSIC||''','''||PRODUCT_TYPE_ACTIVE_CHECK ||''','''||PRODUCT_TYPE_ACTIVE||''')
                              AS prov_req, sysdate as prov_day
                              FROM '||Schema_owner||'.'||recon_table_name||' t';
                              
                WHEN (recon_table_name = 'REP_PREP_SV_POST_HLR_2') THEN
                 
                  SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                              SELECT
                              ''EricssonHLR2,IMSI,''||t.imsi||'',MSISDN,961''||to_number(t.msisdn)||'',CREATE_ACTIVATE,PRODUCT::ACTIVE''
                              AS prov_req
                              FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';
                
                
                WHEN (recon_table_name = 'REP_MIS_IMSIS_FULL_RECON_2') THEN
                 
                 SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                             SELECT
                             ''EricssonHLR2,NIMSI,''||t.IMSI_SV||'',IMSI,''||t.IMSI_2||'',MSISDN,961''||to_number(t.msisdn)||'','||OPTION_TO_ACT||',PRODUCT::''||decode(t.product_type_name,'''||PRODUCT_TYPE_CLASSIC_CHECK||''',''' ||PRODUCT_TYPE_CLASSIC||''','''||PRODUCT_TYPE_ACTIVE_CHECK ||''','''||PRODUCT_TYPE_ACTIVE||''')
                             AS prov_req, sysdate as prov_day
                             FROM '||Schema_owner||'.'||recon_table_name||' t';
                        
                WHEN (recon_table_name = 'REP_MSISDN_HLR_NOT_IN_BIL_2') THEN
                
                 SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                            SELECT
                            ''EricssonHLR2,IMSI,''||t.IMSI_2||'',MSISDN,961''||to_number(t.msisdn)||'','||OPTION_TO_ACT||',PRODUCT::'||PRODUCT||'''
                            AS prov_req, sysdate as prov_day
                            FROM '||Schema_owner||'.'||recon_table_name||' t';
                            
                WHEN (recon_table_name = 'REP_FAX_SV_NOT_HLR2') THEN
              
                  SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR2,IMSI,''||t.IMSI_MAIN||'',MSISDN,961''||to_number(t.MSISDN_MAIN)||'',MODIFY,PRODUCT::CLASSIC,'||OPTION_TO_ACT||',SERVICE::'||PRODUCT||',SVC_MSISDN,961''||to_number(t.msisdn)||'',SVC_IMSI,''||t.IMSI_MAIN
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
                           
               WHEN  (recon_table_name = 'REP_DATA_SV_NOT_HLR2') THEN

                  SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR2,IMSI,''||t.IMSI_MAIN||'',MSISDN,961''||to_number(t.MSISDN_MAIN)||'',MODIFY,PRODUCT::CLASSIC,'||OPTION_TO_ACT||',SERVICE::'||PRODUCT||',SVC_MSISDN,961''||to_number(t.msisdn)||'',SVC_IMSI,''||t.IMSI_MAIN
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
                           
               WHEN (recon_table_name = 'REP_FAX_HLR_NOT_SV2') THEN
              
                  SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR2,IMSI,''||t.IMSI_MAIN||'',MSISDN,961''||to_number(t.MSISDN_MAIN)||'',MODIFY,PRODUCT::CLASSIC,'||OPTION_TO_ACT||',SERVICE::'||PRODUCT||',SVC_MSISDN,961''||to_number(t.msisdn)||'',SVC_IMSI,''||t.IMSI_MAIN
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
                           
               WHEN (recon_table_name = 'REP_DATA_HLR_NOT_SV2') THEN
              
                  SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR2,IMSI,''||t.IMSI_MAIN||'',MSISDN,961''||to_number(t.MSISDN_MAIN)||'',MODIFY,PRODUCT::CLASSIC,'||OPTION_TO_ACT||',SERVICE::'||PRODUCT||',SVC_MSISDN,961''||to_number(t.msisdn)||'',SVC_IMSI,''||t.IMSI_MAIN
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
                           
               WHEN (recon_table_name = 'REP_POST_IOV_ACT_HLR2') THEN
                   SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR2,VolSuspend,true,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'','||OPTION_TO_ACT||',PRODUCT::'||PRODUCT||'''
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
                            
               WHEN (recon_table_name = 'REP_MBB_POST_SV_NOT_HLR2' OR recon_table_name = 'REP_MBB_PREP_SV_NOT_HLR2') THEN
              
                    SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                       SELECT
                       ''EricssonHLR2,IMSI,''||t.IMSI_SV||'',MSISDN,961''||to_number(t.MSISDN_BP)||'','||OPTION_TO_ACT||',PRODUCT::'||PRODUCT||'''
                       AS prov_req, sysdate as prov_day
                       FROM '||Schema_owner||'.'||recon_table_name||' t';
               
              WHEN  (recon_table_name = 'REP_MBB_HLR2_NOT_SV') THEN
              
                    SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                       SELECT
                       ''EricssonHLR2,IMSI,''||t.IMSI_2||'',MSISDN,961''||to_number(t.MSISDN_HLR2)||'','||OPTION_TO_ACT||',PRODUCT::'||PRODUCT||'''
                       AS prov_req, sysdate as prov_day
                       FROM '||Schema_owner||'.'||recon_table_name||' t';
               
              WHEN (recon_table_name = 'REP_SV_BOUT_DATA_ACT_HLR2') THEN 
              
                  SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR2,IMSI,''||t.imsi||'',MSISDN,961''||to_number(t.msisdn)||'',ReasonCode,THRESHOLD_EXCEEDED,SUSPEND_BAR_OUT,PRODUCT::CLASSIC''
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t';
              WHEN (recon_table_name = 'REP_SV_BOUT_CC_ACT_HLR2') THEN -- Added for the Call Completion 01-08-2018
              
                  SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR2,IMSI,''||t.imsi||'',MSISDN,961''||to_number(t.msisdn)||'',ReasonCode,THRESHOLD_EXCEEDED,SUSPEND_BAR_OUT,PRODUCT::CLASSIC,ACTION,MODIFY,SETTING,FEATURE::CALL_ME_BACK_ACCESS,ReasonCode,THRESHOLD_EXCEEDED''
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t'; 
                           
               WHEN (recon_table_name = 'REP_CC_NOSV_ACT_BOUT_HLR2') THEN -- Added for the Call Completion 01-08-2018
              
               SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                           SELECT
                           ''EricssonHLR2,IMSI,''||t.imsi||'',MSISDN,961''||to_number(t.msisdn)||'',ReasonCode,THRESHOLD_EXCEEDED,SUSPEND_BAR_OUT,PRODUCT::CLASSIC,ACTION,MODIFY,SETTING,FEATURE::CALL_ME_BACK_ACCESS,ReasonCode,THRESHOLD_EXCEEDED''
                           AS prov_req, sysdate as prov_day
                           FROM '||Schema_owner||'.'||recon_table_name||' t'; 
             
               ELSE
                
                 SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create||' NOLOGGING AS
                            SELECT
                            ''EricssonHLR2,IMSI,''||t.imsi||'',MSISDN,961''||to_number(t.msisdn)||'','||OPTION_TO_ACT||',PRODUCT::'||PRODUCT||'''
                             AS prov_req, sysdate as prov_day
                             FROM '||Schema_owner||'.'||recon_table_name||' t';
                
                
          END CASE;
     
END CASE;

IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create, 'fafif', SQL_TXT) = 0 THEN
  RAISE TABLE_CREATION_FAILED;
END IF;

 CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

 Table_To_Export := SUBSTR(Table_To_Create,6)||'_CSV';
 FILE_NAME := SUBSTR(Table_To_Create,6)||'_'||CURRENT_DATE;
 FILE_NAME1 := 'FAFIF.'||SUBSTR(Table_To_Create,6)||'_'||CURRENT_DATE||'.csv';
 
 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv  FROM '||Schema_owner||'.'||Table_To_Create||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;
       
   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME1);     

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;
   
END PROV_RECON_SERVICES;

PROCEDURE PROV_RECON_VPN_CPS (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, OPTION_TO_ACT IN VARCHAR2, CP_PRODUCT IN VARCHAR2, HLR IN VARCHAR2) IS

-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Export            VARCHAR2(40);

TABLE_CREATION_FAILED      EXCEPTION;


CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(200);
FILE_NAME1                 VARCHAR2(200);

BEGIN

Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);

  if HLR = '1' then
   if OPTION_TO_ACT = 'CREATE_ACTIVATE' then


       SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                   SELECT
                   (CASE WHEN NVL(T.OICK_1, 0)= 0  THEN ''HGSDC:MSISDN=961''||to_number(t.msisdn)||'',sud=OICK-42;''
                      WHEN NVL(T.OICK_1, 0)= 150  THEN ''HGSDC:MSISDN=961''||to_number(t.msisdn)||'',sud=OICK-151;''
                      ELSE ''HGSDC:MSISDN=961''||to_number(t.msisdn)||'',sud=OICK-42;''
                      END) AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t';

      IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;

     end if;

   if OPTION_TO_ACT = 'DELETE' then

       SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                   SELECT
                   (CASE WHEN NVL(T.OICK_1, 0)= 42  THEN ''HGSDC:MSISDN=961''||to_number(t.msisdn)||'',sud=OICK-0;''
                      WHEN NVL(T.OICK_1, 0)= 151  THEN ''HGSDC:MSISDN=961''||to_number(t.msisdn)||'',sud=OICK-150;''
                      END) AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t';

          IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
          END IF;

    end if;

  end if;

  if HLR = '2' then
   if OPTION_TO_ACT = 'CREATE_ACTIVATE' then

       SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                   SELECT
                   (CASE WHEN NVL(T.OICK_2, 0)= 0  THEN ''HGSDC:MSISDN=961''||to_number(t.msisdn)||'',sud=OICK-42;''
                      WHEN NVL(T.OICK_2, 0)= 150  THEN ''HGSDC:MSISDN=961''||to_number(t.msisdn)||'',sud=OICK-151;''
                      ELSE ''HGSDC:MSISDN=961''||to_number(t.msisdn)||'',sud=OICK-42;''
                      END) AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t';

      IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;

     end if;

   if OPTION_TO_ACT = 'DELETE' then

       SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                   SELECT
                   (CASE WHEN NVL(T.OICK_2, 0)= 42  THEN ''HGSDC:MSISDN=961''||to_number(t.msisdn)||'',sud=OICK-0;''
                      WHEN NVL(T.OICK_2, 0)= 151  THEN ''HGSDC:MSISDN=961''||to_number(t.msisdn)||'',sud=OICK-150;''
                      END) AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t';

          IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
          END IF;

    end if;

  end if;

  CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

  Table_To_Export := SUBSTR(Table_To_Create_Name,6)||'_CSV';
  FILE_NAME := SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE;
  FILE_NAME1 := 'FAFIF.'||SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE||'.csv';


 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv  FROM '||Schema_owner||'.'||Table_To_Create_Name||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;

   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME||'.csv');

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;

END prov_recon_VPN_cps;


PROCEDURE PROV_RECON_SMS_CPS (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, OPTION_TO_ACT IN VARCHAR2, CP_PRODUCT IN VARCHAR2, HLR IN VARCHAR2, SMSMode IN VARCHAR2) IS


-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Export            VARCHAR2(40);

TABLE_CREATION_FAILED      EXCEPTION;
POSITION_CLIR_SOCLIR       NUMBER;
CLIR_SOCLIR_TYPE           VARCHAR2(40);

CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(200);
FILE_NAME1                 VARCHAR2(200);

BEGIN

Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);



  if HLR = '1' then
  if OPTION_TO_ACT = 'CREATE_ACTIVATE' then
  
          SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                SELECT 
                ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',SMS_MODE,'||SMSMode||'''   
                AS prov_req, sysdate as prov_day
                FROM '||Schema_owner||'.'||recon_table_name||' t';
     
          IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
          END IF;
  end if;
  
  if OPTION_TO_ACT = 'DELETE' then
  
       SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                SELECT 
                ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',SMS_MODE,'||SMSMode||'''   
                AS prov_req, sysdate as prov_day
                FROM '||Schema_owner||'.'||recon_table_name||' t';
                     
    IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, Schema_owner, SQL_TXT) = 0 THEN
      RAISE TABLE_CREATION_FAILED;
    END IF;
     
  end if;
  
 end if;
 
 
  if HLR = '2' then
     if OPTION_TO_ACT = 'CREATE_ACTIVATE' then

          SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                     SELECT 
                     ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',SMS_MODE,'||SMSMode||'''   
                     AS prov_req, sysdate as prov_day
                     FROM '||Schema_owner||'.'||recon_table_name||' t';
     
          IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
          END IF;

     end if;
  
     if OPTION_TO_ACT = 'DELETE' then
     
         SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                     SELECT 
                     ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',SMS_MODE,'||SMSMode||'''   
                     AS prov_req, sysdate as prov_day
                     FROM '||Schema_owner||'.'||recon_table_name||' t';   
                     
         IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, Schema_owner, SQL_TXT) = 0 THEN
            RAISE TABLE_CREATION_FAILED;
         END IF;
 
      end if;
  
  end if;
   
  CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

  Table_To_Export := SUBSTR(Table_To_Create_Name,6)||'_CSV';
  FILE_NAME := SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE;
  FILE_NAME1 := 'FAFIF.'||SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE||'.csv';
  
 
 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv  FROM '||Schema_owner||'.'||Table_To_Create_Name||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;
   
   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME1);   

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;

END PROV_RECON_SMS_CPS;

PROCEDURE PROV_RECON_SMS_ROAMING_CPS (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, OPTION_TO_ACT IN VARCHAR2, CP_PRODUCT IN VARCHAR2, HLR IN VARCHAR2) IS



-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Export            VARCHAR2(40);

TABLE_CREATION_FAILED      EXCEPTION;
CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(200);
FILE_NAME1                 VARCHAR2(200);

BEGIN

Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);



  if HLR = '1' then
  
  CASE 

        WHEN (recon_table_name = 'REP_DISC_IA_VS_SMS_ROAM_RES1' OR recon_table_name = 'REP_DISC_IA_VS_SMS_ROAM_BUS1' OR recon_table_name = 'REP_DISC_IA_VS_REG_ROAM_RES1' OR recon_table_name = 'REP_DISC_IA_VS_REG_ROAM_BUS1') THEN
             
                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT
                             CASE
                             WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_IA''
                             WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::IA''
                             END
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';
                            
                            
          WHEN (recon_table_name = 'REP_DISC_LIM_IA_VSSMS_ROAM1' OR recon_table_name = 'REP_DISC_LIM_IA_VSREG_ROAM1')  THEN
             
                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT 
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::LIMITED_IA,CREDIT_LIMIT,''||T.CREDIT_LIMIT 
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';


         WHEN (recon_table_name = 'REP_LIA_HLR_NOT_SV1') THEN
           
           SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                      SELECT
                      ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',CREDIT_LIMIT,50'' 
                      AS prov_req, sysdate as prov_day
                      FROM '||Schema_owner||'.'||recon_table_name||' t';
         
       ELSE
        
          SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                      SELECT
                      ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                      AS prov_req, sysdate as prov_day
                      FROM '||Schema_owner||'.'||recon_table_name||' t';
       
       END CASE;
       
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
       END IF;
 end if;


  if HLR = '2' then
  
  CASE
   WHEN (recon_table_name = 'REP_DISC_IA_VS_SMS_ROAM_RES2' OR recon_table_name = 'REP_DISC_IA_VS_SMS_ROAM_BUS2' OR recon_table_name = 'REP_DISC_IA_VS_REG_ROAM_RES2' OR recon_table_name = 'REP_DISC_IA_VS_REG_ROAM_BUS2')
   THEN
   
        SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::IA''
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';
                            
    WHEN (recon_table_name = 'REP_DISC_LIM_IA_VSSMS_ROAM2' OR recon_table_name = 'REP_DISC_LIM_IA_VSREG_ROAM2')  THEN
             
        SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT 
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::LIMITED_IA,CREDIT_LIMIT,''||T.CREDIT_LIMIT
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';
       
     WHEN (recon_table_name = 'REP_LIA_HLR_NOT_SV2') THEN
           
           SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                      SELECT
                      ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||',CREDIT_LIMIT,50'' 
                      AS prov_req, sysdate as prov_day
                      FROM '||Schema_owner||'.'||recon_table_name||' t';
                         
    ELSE                           

        SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                     SELECT
                     ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                     AS prov_req, sysdate as prov_day
                     FROM '||Schema_owner||'.'||recon_table_name||' t';
                     
    END CASE;

      IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
       RAISE TABLE_CREATION_FAILED;
      END IF;

  end if;

  CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

  Table_To_Export := SUBSTR(Table_To_Create_Name,6)||'_CSV';
  FILE_NAME := SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE;
  FILE_NAME1 := 'FAFIF.'||SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE||'.csv';


 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv  FROM '||Schema_owner||'.'||Table_To_Create_Name||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;

   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME1);

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;
   
END PROV_RECON_SMS_ROAMING_CPS;

PROCEDURE PROV_RECON_ROAMING_CPS (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, OPTION_TO_ACT IN VARCHAR2, CP_PRODUCT IN VARCHAR2, HLR IN VARCHAR2) IS


-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Export            VARCHAR2(40);

TABLE_CREATION_FAILED      EXCEPTION;
CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(200);
FILE_NAME1                 VARCHAR2(200);

BEGIN

Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);



  if HLR = '1' then
  
  CASE recon_table_name

        WHEN 'REP_DISC_IA_VS_ROAM_RES1'  THEN
             
                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             CASE 
                             WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_' ||CP_PRODUCT ||'''
                             WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                             END
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT
                             CASE
                             WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_IA''
                             WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::IA''
                             END
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';
                            
         WHEN 'REP_DISC_IA_VS_ROAM_BUS1' THEN
             
                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             CASE 
                             WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_' ||CP_PRODUCT ||'''
                             WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                             END
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT
                             CASE
                             WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_IA''
                             WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::IA''
                             END
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';
                            
          WHEN 'REP_DISC_LIM_IA_VS_ROAM1'  THEN
             
                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             CASE 
                             WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_' ||CP_PRODUCT ||'''
                             WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                             END
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT
                             CASE
                             WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_LIMITED_IA''
                             WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::LIMITED_IA,CREDIT_LIMIT,''||T.CREDIT_LIMIT 
                             END
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';

       ELSE
        
          SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                SELECT
                CASE 
                 WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_' ||CP_PRODUCT ||'''
                 WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                end AS prov_req, sysdate as prov_day
                FROM '||Schema_owner||'.'||recon_table_name||' t';
       
       END CASE;
       
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
       END IF;
 end if;


  if HLR = '2' then
  
    CASE recon_table_name
  
         WHEN 'REP_DISC_IA_VS_ROAM_RES2'  THEN
             
                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             CASE 
                             WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_' ||CP_PRODUCT ||'''
                             WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                             END
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT
                             CASE
                             WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_IA''
                             WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::IA''
                             END
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';
                            
         WHEN 'REP_DISC_IA_VS_ROAM_BUS2' THEN
             
                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             CASE 
                             WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_' ||CP_PRODUCT ||'''
                             WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                             END
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT
                             CASE
                             WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_IA''
                             WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::IA''
                             END
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';
                            
              WHEN 'REP_DISC_LIM_IA_VS_ROAM2'  THEN
             
                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             CASE 
                             WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_' ||CP_PRODUCT ||'''
                             WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                             END
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT
                             CASE
                             WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_LIMITED_IA''
                             WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::LIMITED_IA,CREDIT_LIMIT,''||T.CREDIT_LIMIT 
                             END
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';
                            
          ELSE                           
  
  
          SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                     SELECT
                     CASE
                      WHEN T.SERVICE_TYPE_NAME = ''Twin Card'' THEN
                     ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::TWIN_' ||CP_PRODUCT ||'''
                      WHEN T.SERVICE_TYPE_NAME = ''Voice'' THEN
                     ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::' ||CP_PRODUCT ||'''
                     end AS prov_req, sysdate as prov_day
                     FROM '||Schema_owner||'.'||recon_table_name||' t';
                     
          END CASE;

          IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
          END IF;

  end if;

  CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

  Table_To_Export := SUBSTR(Table_To_Create_Name,6)||'_CSV';
  FILE_NAME := SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE;
  FILE_NAME1 := 'FAFIF.'||SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE||'.csv';


 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv  FROM '||Schema_owner||'.'||Table_To_Create_Name||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;

   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME1);

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;

END PROV_RECON_ROAMING_CPS;


PROCEDURE PROV_RECON_MT_ROAMING_CPS (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, OPTION_TO_ACT IN VARCHAR2, HLR IN VARCHAR2) IS


-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Export            VARCHAR2(40);

TABLE_CREATION_FAILED      EXCEPTION;
CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(200);
FILE_NAME1                 VARCHAR2(200);

BEGIN

Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);



  if HLR = '1' then

  CASE

        WHEN (recon_table_name = 'REP_DISC_IA_VS_MTROAM') THEN

                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::IA''
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::MT_ROAMING,VolumeOption,'' ||T.SCP_VOLUME_OPTION ||''''
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';


          WHEN (recon_table_name = 'REP_DISC_LIM_IA_VS_MTROAM')  THEN

                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::LIMITED_IA,CREDIT_LIMIT,''||T.CREDIT_LIMIT
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT
                             ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::MT_ROAMING,VolumeOption,'' ||T.SCP_VOLUME_OPTION ||''''
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';

          ELSE

          SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                      SELECT
                      ''EricssonHLR1,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::MT_ROAMING,VolumeOption,'' ||T.SCP_VOLUME_OPTION ||''''
                      AS prov_req, sysdate as prov_day
                      FROM '||Schema_owner||'.'||recon_table_name||' t';

          END CASE;

       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
       END IF;
 end if;


  if HLR = '2' then

  CASE
     WHEN (recon_table_name = 'REP_DISC_IA_VS_MTROAM2') THEN

                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::IA''
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::MT_ROAMING,VolumeOption,'' ||T.SCP_VOLUME_OPTION ||''''
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';


          WHEN (recon_table_name = 'REP_DISC_LIM_IA_VS_MTROAM2')  THEN

                SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                            SELECT
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::LIMITED_IA,CREDIT_LIMIT,''||T.CREDIT_LIMIT
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t
                            UNION
                            SELECT
                             ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::MT_ROAMING,VolumeOption,'' ||T.SCP_VOLUME_OPTION ||''''
                            AS prov_req
                            FROM '||Schema_owner||'.'||recon_table_name||' t order by prov_req DESC';

          ELSE

          SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                      SELECT
                      ''EricssonHLR2,MSISDN,961''||to_number(t.msisdn)||'',IMSI,''||t.imsi||'',MODIFY,PRODUCT::CLASSIC,' ||OPTION_TO_ACT || ',FEATURE::MT_ROAMING,VolumeOption,'' ||T.SCP_VOLUME_OPTION ||''''
                      AS prov_req, sysdate as prov_day
                      FROM '||Schema_owner||'.'||recon_table_name||' t';

          END CASE;

      IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
       RAISE TABLE_CREATION_FAILED;
      END IF;

  end if;

  CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

  Table_To_Export := SUBSTR(Table_To_Create_Name,6)||'_CSV';
  FILE_NAME := SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE;
  FILE_NAME1 := 'FAFIF.'||SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE||'.csv';


 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv  FROM '||Schema_owner||'.'||Table_To_Create_Name||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;

   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME1);

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;
   
END PROV_RECON_MT_ROAMING_CPS;


PROCEDURE PROV_RECON_BS3G_PARAM (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, SCHAR_VALUE IN VARCHAR2) IS

-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Export            VARCHAR2(40);

TABLE_CREATION_FAILED      EXCEPTION;


CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(200);
FILE_NAME1                 VARCHAR2(200);

BEGIN

Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);


   SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                   SELECT
                   ''HGSDC:MSISDN=961''||to_number(t.msisdn)||'',sud=BS3G-'||SCHAR_VALUE||';''      
                     AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t';

      IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;


  CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

  Table_To_Export := SUBSTR(Table_To_Create_Name,6)||'_CSV';
  FILE_NAME := SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE;
  FILE_NAME1 := 'FAFIF.'||SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE||'.csv';


 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv  FROM '||Schema_owner||'.'||Table_To_Create_Name||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
                
                
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;

   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME||'.csv');

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;

END PROV_RECON_BS3G_PARAM;



PROCEDURE PROV_RECON_SCHAR_PARAM (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, SCHAR_VALUE IN VARCHAR2) IS

-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Export            VARCHAR2(40);

TABLE_CREATION_FAILED      EXCEPTION;


CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(200);
FILE_NAME1                 VARCHAR2(200);

BEGIN

Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);


   SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                   SELECT
                   ''HGSDC:MSISDN=961''||to_number(t.msisdn)||'',sud=SCHAR-'||SCHAR_VALUE||'-0;''      
                     AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t';

      IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;


  CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

  Table_To_Export := SUBSTR(Table_To_Create_Name,6)||'_CSV';
  FILE_NAME := SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE;
  FILE_NAME1 := 'FAFIF.'||SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE||'.csv';


 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv  FROM '||Schema_owner||'.'||Table_To_Create_Name||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
                
                
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;

   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME||'.csv');

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;

END PROV_RECON_SCHAR_PARAM;


PROCEDURE PROV_RECON_CSP_PARAM (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, CSP_VALUE IN VARCHAR2, OCSIST_VALUE IN VARCHAR2) IS

-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Export            VARCHAR2(40);

TABLE_CREATION_FAILED      EXCEPTION;


CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(200);
FILE_NAME1                 VARCHAR2(200);

BEGIN

Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);

--HGSDC:MSISDN=**********,SUD=CSP-;

   SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                   SELECT
                   ''HGSDC:MSISDN=961''||to_number(t.MSISDN)||'',sud=CSP-'||CSP_VALUE||';''      
                     AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t
                   UNION
                   SELECT
                   ''HGSDC:MSISDN=961''||to_number(t.MSISDN)||'',sud=OCSIST-'||OCSIST_VALUE||';''      
                     AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t';

      IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;


  CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

  Table_To_Export := SUBSTR(Table_To_Create_Name,6)||'_CSV';
  FILE_NAME := SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE;
  FILE_NAME1 := 'FAFIF.'||SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE||'.csv';


 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv  FROM '||Schema_owner||'.'||Table_To_Create_Name||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
                
                
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;

   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME||'.csv');

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;

END PROV_RECON_CSP_PARAM;


PROCEDURE PROV_RECON_RSA_PARAM (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, RSA_VALUE IN VARCHAR2) IS

-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Export            VARCHAR2(40);

TABLE_CREATION_FAILED      EXCEPTION;


CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(200);
FILE_NAME1                 VARCHAR2(200);

BEGIN

Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);

--HGSDC:MSISDN=**********,SUD=RSA-6;

   SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                   SELECT
                   ''HGSDC:MSISDN=961''||to_number(t.NUM_APPEL)||'',sud=RSA-'||RSA_VALUE||';''      
                     AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t';

      IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;


  CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

  Table_To_Export := SUBSTR(Table_To_Create_Name,6)||'_CSV';
  FILE_NAME := SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE;
  FILE_NAME1 := 'FAFIF.'||SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE||'.csv';


 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv  FROM '||Schema_owner||'.'||Table_To_Create_Name||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
                
                
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;

   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME||'.csv');

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;

END PROV_RECON_RSA_PARAM;

PROCEDURE PROV_RECON_TS11_PARAM (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, TS11_VALUE IN VARCHAR2) IS

-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Export            VARCHAR2(40);

TABLE_CREATION_FAILED      EXCEPTION;


CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(200);
FILE_NAME1                 VARCHAR2(200);

BEGIN

Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);


   SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                   SELECT
                   ''HGSDC:MSISDN=961''||to_number(t.MSISDN_SYS)||'',sud=TS11-'||TS11_VALUE||';''      
                     AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t';

      IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
      END IF;


  CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

  Table_To_Export := SUBSTR(Table_To_Create_Name,6)||'_CSV';
  FILE_NAME := SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE;
  FILE_NAME1 := 'FAFIF.'||SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE||'.csv';


 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv  FROM '||Schema_owner||'.'||Table_To_Create_Name||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
                
                
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;

   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME||'.csv');

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;

END PROV_RECON_TS11_PARAM;

PROCEDURE EXPORT_TABLE_TO_CSV_FILE (Schema_owner IN VARCHAR2,TABLE_NAME IN VARCHAR2) IS

-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Export            VARCHAR2(40);
TABLE_CREATION_FAILED      EXCEPTION;

CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(100);
FILE_NAME1                 VARCHAR2(100);


BEGIN

 CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

 Table_To_Export := SUBSTR(TABLE_NAME,5)||'_CSV';
 FILE_NAME := SUBSTR(TABLE_NAME,5)||'_'||CURRENT_DATE;
 FILE_NAME1 := 'FAFIF.'||SUBSTR(TABLE_NAME,5)||'_'||CURRENT_DATE||'.csv';
 
 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select dbauser.GET_ALL_IN_LINE(''Fafif'',''rep_post_sv_prep_cs4'') from dual
                     union all
                     select  DATE_INSERTION_HLR2|| '','' ||OSMCSI_2|| '','' ||OBP_2|| '','' ||RM_2|| '','' ||RSA_2|| '','' ||OCSI_2|| '','' ||REDUND_2|| '','' ||TSMO_2|| '','' ||NAM_2|| '','' ||TICK_2|| '','' ||OICK_2|| '','' ||CAPL_2|| '','' ||SOSDCF_2|| '','' ||SODCF_2|| '','' ||DCF_2|| '','' ||PICI_2|| '','' ||REGSER_2|| '','' ||CUG_2|| '','' ||TS61_2|| '','' ||DBSG_2|| '','' ||BS34_2|| '','' ||BS33_2|| '','' ||BS32_2|| '','' ||BS31_2|| '','' ||BS26_2|| '','' ||BS25_2|| '','' ||BS24_2|| '','' ||BS23_2|| '','' ||BS22_2|| '','' ||BS21_2|| '','' ||TSD1_2|| '','' ||TS62_2|| '','' ||TS22_2|| '','' ||TS21_2|| '','' ||TS11_2|| '','' ||SOCOLP_2|| '','' ||SOCLIR_2|| '','' ||SOCLIP_2|| '','' ||SOCFRC_2|| '','' ||SOCFRY_2|| '','' ||SOCFB_2|| '','' ||SOCFU_2|| '','' ||SOCB_2|| '','' ||COLR_2|| '','' ||COLP_2|| '','' ||CLIR_2|| '','' ||CLIP_2|| '','' ||TIN_2|| '','' ||OIN_2|| '','' ||ICI_2|| '','' ||PWD_2|| '','' ||OFA_2|| '','' ||OSB4_2|| '','' ||OSB3_2|| '','' ||OSB2_2|| '','' ||OSB1_2|| '','' ||OBSSM_2|| '','' ||OBOPRE_2|| '','' ||OBOPRI_2|| '','' ||OBR_2|| '','' ||OBI_2|| '','' ||OBO_2|| '','' ||CAT_2|| '','' ||BICRO_2|| '','' ||BAIC_2|| '','' ||BOIEX_2|| '','' ||BOIC_2|| '','' ||BAOC_2|| '','' ||AOC_2|| '','' ||MPTY_2|| '','' ||HOLD_2|| '','' ||CAW_2|| '','' ||SPN_2|| '','' ||CFNRC_2|| '','' ||CFNRY_2|| '','' ||CFB_2|| '','' ||CFU_2|| '','' ||NUM_APPEL_2|| '','' ||IMSI_2|| '','' ||MSISDN_HLR2|| '','' ||DATE_INSERTION_HLR1|| '','' ||OSMCSI_1|| '','' ||OBP_1|| '','' ||RM_1|| '','' ||RSA_1|| '','' ||OCSI_1|| '','' ||REDUND_1|| '','' ||TSMO_1|| '','' ||NAM_1|| '','' ||TICK_1|| '','' ||OICK_1|| '','' ||CAPL_1|| '','' ||SOSDCF_1|| '','' ||SODCF_1|| '','' ||DCF_1|| '','' ||PICI_1|| '','' ||REGSER_1|| '','' ||CUG_1|| '','' ||TS61_1|| '','' ||DBSG_1|| '','' ||BS34_1|| '','' ||BS33_1|| '','' ||BS32_1|| '','' ||BS31_1|| '','' ||BS26_1|| '','' ||BS25_1|| '','' ||BS24_1|| '','' ||BS23_1|| '','' ||BS22_1|| '','' ||BS21_1|| '','' ||TSD1_1|| '','' ||TS62_1|| '','' ||TS22_1|| '','' ||TS21_1|| '','' ||TS11_1|| '','' ||SOCOLP_1|| '','' ||SOCLIR_1|| '','' ||SOCLIP_1|| '','' ||SOCFRC_1|| '','' ||SOCFRY_1|| '','' ||SOCFB_1|| '','' ||SOCFU_1|| '','' ||SOCB_1|| '','' ||COLR_1|| '','' ||COLP_1|| '','' ||CLIR_1|| '','' ||CLIP_1|| '','' ||TIN_1|| '','' ||OIN_1|| '','' ||ICI_1|| '','' ||PWD_1|| '','' ||OFA_1|| '','' ||OSB4_1|| '','' ||OSB3_1|| '','' ||OSB2_1|| '','' ||OSB1_1|| '','' ||OBSSM_1|| '','' ||OBOPRE_1|| '','' ||OBOPRI_1|| '','' ||OBR_1|| '','' ||OBI_1|| '','' ||OBO_1|| '','' ||CAT_1|| '','' ||BICRO_1|| '','' ||BAIC_1|| '','' ||BOIEX_1|| '','' ||BOIC_1|| '','' ||BAOC_1|| '','' ||AOC_1|| '','' ||MPTY_1|| '','' ||HOLD_1|| '','' ||CAW_1|| '','' ||SPN_1|| '','' ||CFNRC_1|| '','' ||CFNRY_1|| '','' ||CFB_1|| '','' ||CFU_1|| '','' ||NUM_APPEL_1|| '','' ||IMSI_1|| '','' ||MSISDN_HLR1|| '','' ||MSISDN_HLRS|| '','' ||PRIM_FLAG|| '','' ||DATE_RETENTION|| '','' ||AMOUNT|| '','' ||DATE_CHGT_ETAT|| '','' ||DUREE_VALIDITE|| '','' ||ETAT|| '','' ||ETAT_PPAS|| '','' ||DATE_CREAT|| '','' ||DATE_INIT|| '','' ||DATE_SUSP|| '','' ||DATE_INACTIF|| '','' ||DATE_ACTIF|| '','' ||LANGUE|| '','' ||CUST_CLASS|| '','' ||CUST_ID|| '','' ||NUM_APPEL|| '','' ||JOUR|| '','' ||MSISDN_CS4|| '','' ||DEALER_CODE_P|| '','' ||LAST_RUN_DATE|| '','' ||ACCOUNT_START_DATE|| '','' ||CUSTOMER_START_DATE|| '','' ||SERV_REASON_CODE|| '','' ||SERVICE_REASON_NAME|| '','' ||PROD_REASON_NAME|| '','' ||PROD_REASON_CODE|| '','' ||PROD_STATUS|| '','' ||PROD_BP_INST|| '','' ||PRODUCT_ID|| '','' ||PROD_END_DATE|| '','' ||PROD_START_DATE|| '','' ||PRODUCT_INSTANCE_ID|| '','' ||SERV_BP_INT|| '','' ||SERVICE_ID|| '','' ||SHELF_LIFE_EXP|| '','' ||FIRST_CALL|| '','' ||IMSI|| '','' ||SERVICE_END_DATE|| '','' ||SERVICE_START_DATE|| '','' ||CUSTOMER_NODE_ID|| '','' ||ACCOUNT_TYPE|| '','' ||SERVICE_STATUS|| '','' ||PRODUCT_TYPE_NAME|| '','' ||SERVICE_TYPE_NAME|| '','' ||SERVICE_NAME|| '','' ||ACCOUNT_NAME|| '','' ||ID|| '','' ||MSISDN_SV|| '','' ||MSISDN_SYS|| '','' ||PRIMARY_HLR|| '','' ||MSISDN
                     FROM '||Schema_owner||'.'||TABLE_NAME||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;
       
   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME1);     

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;

  
END EXPORT_TABLE_TO_CSV_FILE;

-----------------------------------------------

--------------------------------------------------------
   

PROCEDURE EXPORT_TABLE_TO_ADM_TXT (Schema_owner IN VARCHAR2,TABLE_NAME IN VARCHAR2) IS

-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Export            VARCHAR2(40);
TABLE_CREATION_FAILED      EXCEPTION;

CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(100);
FILE_NAME1                 VARCHAR2(100);


BEGIN

 CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

 Table_To_Export := SUBSTR(TABLE_NAME,5)||'_CSV';
 FILE_NAME := 'reconciliation'||'_'||CURRENT_DATE;
 FILE_NAME1 := 'reconciliation'||'_'||CURRENT_DATE||'.csv';

 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select  msisdn|| '','' ||imsi|| '','' ||companion_product|| '','' ||service_type_name
                     FROM '||Schema_owner||'.'||TABLE_NAME||' ),
                 '''||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;

   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME1);

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;

  
END EXPORT_TABLE_TO_ADM_TXT;

----------------------------------------------------------------------------------------
--HH 18-02-2020
--VOLTE NEW Procedure
PROCEDURE PROV_RECON_VOLTE_CPS (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, SERVICE_TYPE IN VARCHAR2, SCP_OPTION IN VARCHAR2,CP_PRODUCT IN VARCHAR2) IS


-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Export            VARCHAR2(40);

TABLE_CREATION_FAILED      EXCEPTION;


CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(200);
FILE_NAME_EXPORT           VARCHAR2(200);
FILE_NAME1                 VARCHAR2(200);

BEGIN

Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);



   SQL_TXT := 'CREATE TABLE ' || SCHEMA_OWNER || '.' || Table_To_Create_Name ||
    ' NOLOGGING AS SELECT ''GenericBatch,IMSI,''|| t.imsi || '',MSISDN,961'' || TO_NUMBER(T.MSISDN) 
    ||'',MODIFY,PRODUCT::' || SERVICE_TYPE ||',ReasonCode,ALL,featureAction::MODIFY,FEATURE::'
    ||CP_PRODUCT  || ',VolumeOption,' || SCP_OPTION || '''  
    AS prov_req, sysdate as prov_day FROM ' 
    ||Schema_owner||'.'||recon_table_name||' t' ;

 
    IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
           RAISE TABLE_CREATION_FAILED;
    END IF;
    
  CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

  Table_To_Export := SUBSTR(Table_To_Create_Name,9)||'_CSV';
  FILE_NAME := SUBSTR(Table_To_Create_Name,9)||'_'||CURRENT_DATE;
  FILE_NAME_EXPORT  := Schema_owner||'.'||FILE_NAME||'.csv';
  
  FILE_NAME1 := 'GenericBatchFile.'||SUBSTR(Table_To_Create_Name,9)||'_'||CURRENT_DATE;
   
  
  
   SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv FROM '||Schema_owner||'.'||Table_To_Create_Name||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
                
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;
   
   UTL_FILE.FCOPY('OUTPUT',FILE_NAME_EXPORT,'OUTPUT_BOPS',FILE_NAME1);
    -- HIBA_DIR
    --OUTPUT_BOPS
    
   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;
   
END PROV_RECON_VOLTE_CPS;

PROCEDURE PROV_RECON_APN_MODIFY_PARAM (Schema_owner IN VARCHAR2, recon_table_name IN VARCHAR2, Action IN VARCHAR2, HLR IN VARCHAR2)IS

-- variables
SQL_TXT                    VARCHAR2(4000);

Table_To_Create_Name       VARCHAR2(40);
Table_To_Export            VARCHAR2(40);

TABLE_CREATION_FAILED      EXCEPTION;


CURRENT_DATE               VARCHAR2(100);
FILE_NAME                  VARCHAR2(200);
FILE_NAME1                 VARCHAR2(200);

BEGIN

Table_To_Create_Name := 'PROV'|| SUBSTR(recon_table_name,4);

CASE Action 
     WHEN 'UPDATE' THEN

          IF HLR = '1' THEN
          SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                   SELECT
                   ''GenericBatch,IMSI,''||t.IMSI||'',MSISDN,961''||to_number(t.SERVICE_NAME)||'',MODIFY,PRODUCT::CLASSIC,featureAction::MODIFY,FEATURE::ASSIGN_APN_HLR,APNADD,''||t.APN_ID_SV||'',APNREMOVE,''||T.DATACARD_PRIVATE_APN1||'',''      
                     AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t';

      
                   ELSE
                   SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                   SELECT
                   ''GenericBatch,IMSI,''||t.IMSI||'',MSISDN,961''||to_number(t.SERVICE_NAME)||'',MODIFY,PRODUCT::CLASSIC,featureAction::MODIFY,FEATURE::ASSIGN_APN_HLR,APNADD,''||t.APN_ID_SV||'',APNREMOVE,''||T.DATACARD_PRIVATE_APN2||'',''      
                     AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t';

     
          END IF;
          
      WHEN 'DELETE' THEN
          IF HLR = '1' THEN
          SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                   SELECT
                   CASE 
                      WHEN T.APN_ID_SV <> T.DATACARD_PRIVATE_APN1  THEN
                           ''GenericBatch,IMSI,''||T.IMSI||'',MSISDN,961''||to_number(T.SERVICE_NAME)||'',MODIFY,PRODUCT::CLASSIC,featureAction::DELETE,FEATURE::ASSIGN_APN_HLR,APNREMOVE,''||T.DATACARD_PRIVATE_APN1||'',''
                      WHEN T.APN_ID_SV <> T.DATACARD_PRIVATE2_APN1  THEN   
                           ''GenericBatch,IMSI,''||T.IMSI||'',MSISDN,961''||to_number(T.SERVICE_NAME)||'',MODIFY,PRODUCT::CLASSIC,featureAction::DELETE,FEATURE::ASSIGN_APN_HLR,APNREMOVE,''||T.DATACARD_PRIVATE2_APN1||'',''   
                   END AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t';

      
          ELSE
                   SQL_TXT := 'CREATE TABLE '||Schema_owner||'.'||Table_To_Create_Name||' NOLOGGING AS
                   SELECT
                   CASE 
                      WHEN T.APN_ID_SV <> T.DATACARD_PRIVATE_APN  THEN
                           ''GenericBatch,IMSI,''||T.IMSI||'',MSISDN,961''||to_number(T.SERVICE_NAME)||'',MODIFY,PRODUCT::CLASSIC,featureAction::DELETE,FEATURE::ASSIGN_APN_HLR,APNREMOVE,''||T.DATACARD_PRIVATE_APN||'',''
                      WHEN T.APN_ID_SV <> T.DATACARD_PRIVATE2_APN  THEN   
                           ''GenericBatch,IMSI,''||T.IMSI||'',MSISDN,961''||to_number(T.SERVICE_NAME)||'',MODIFY,PRODUCT::CLASSIC,featureAction::DELETE,FEATURE::ASSIGN_APN_HLR,APNREMOVE,''||T.DATACARD_PRIVATE2_APN||'',''   
                   END AS prov_req, sysdate as prov_day
                   FROM '||Schema_owner||'.'||recon_table_name||' t';

     
          END IF;
     END CASE;
          
    
    IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Create_Name, 'fafif', SQL_TXT) = 0 THEN
        RAISE TABLE_CREATION_FAILED;
    END IF;

  CURRENT_DATE := TO_CHAR(TO_DATE(TO_CHAR(SYSDATE, 'DDMMYYYY'),'DDMMYYYY') ,'DDMMYYYY');

  Table_To_Export := SUBSTR(Table_To_Create_Name,6)||'_CSV';
  FILE_NAME :=  'GenericBatchFile.'||SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE;
  FILE_NAME1 := 'FAFIF.GenericBatchFile.'||SUBSTR(Table_To_Create_Name,6)||'_'||CURRENT_DATE||'.csv';


 SQL_TXT := 'create table '||Schema_owner||'.'||Table_To_Export||' as select * from table(
              dbauser.parallel_dump(
              CURSOR(select prov_req as csv  FROM '||Schema_owner||'.'||Table_To_Create_Name||' ),
                 '''||Schema_owner||'.'||FILE_NAME||''',
                 ''OUTPUT''
                )) nt';
                
                
       IF UTILS_INTERFACES.CREATE_TABLE(Table_To_Export, Schema_owner, SQL_TXT) = 0 THEN
          RAISE TABLE_CREATION_FAILED;
       END IF;

   UTL_FILE.FCOPY('OUTPUT',FILE_NAME1,'OUTPUT_BOPS',FILE_NAME);

   EXCEPTION
   WHEN TABLE_CREATION_FAILED THEN NULL;


END PROV_RECON_APN_MODIFY_PARAM;   
   
--------------------------------------------------------

PROCEDURE send_mail (

pSender    VARCHAR2,
pRecipient VARCHAR2,
pSubject   VARCHAR2,
pMessage   VARCHAR2) IS

mailhost  CONSTANT VARCHAR2(60) :='callisto.corp.alfamobile.com.lb' /*'smtp01.us.oracle.com'*/;
crlf      CONSTANT VARCHAR2(2):= CHR(13) || CHR(10);
mesg      VARCHAR2(1000);
mail_conn utl_smtp.connection;

BEGIN
   mail_conn := utl_smtp.open_connection(mailhost, 25);

   mesg := 'Date: ' ||
        TO_CHAR( SYSDATE, 'dd Mon yy hh24:mi:ss') || crlf ||
           'From: <'|| pSender ||'>' || crlf ||
           'Subject: '|| pSubject || crlf ||
           'To: '||pRecipient || crlf || '' || crlf || pMessage;

   utl_smtp.helo(mail_conn, mailhost);
   utl_smtp.mail(mail_conn, pSender);
   utl_smtp.rcpt(mail_conn, pRecipient);
   utl_smtp.data(mail_conn, mesg);
   utl_smtp.quit(mail_conn);
   
EXCEPTION
  WHEN INVALID_OPERATION THEN
    NULL;
  WHEN TRANSIENT_ERROR THEN
    NULL;
  WHEN PERMANENT_ERROR THEN
    NULL;
  WHEN OTHERS THEN
    NULL;
END send_mail;

-----------------------------------------------

  --------------------------------------------------------
   

END RECONCILIATION_INTERFACES;
